!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=t.Dynamsoft||{})}(this,function(e){"use strict";const t=e=>e&&"object"==typeof e&&"function"==typeof e.then,i=(async()=>{})().constructor;let n=class extends i{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let n;this._task=e,t(e)?n=e:"function"==typeof e&&(n=new i(e)),n&&(async()=>{try{const t=await n;e===this._task&&this.resolve(t)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let i,n;super((e,t)=>{i=e,n=t}),this._s="pending",this.resolve=e=>{this.isPending&&(t(e)?this.task=e:(this._s="fulfilled",i(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",n(e))},this.task=e}};function s(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function r(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}var a,o,l;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(a||(a={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(o||(o={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(l||(l={}));const c="undefined"==typeof self,d="function"==typeof importScripts,h=(()=>{if(!d){if(!c&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),u=e=>{if(null==e&&(e="./"),c||d);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},g=e=>Object.prototype.toString.call(e),m=e=>Array.isArray?Array.isArray(e):"[object Array]"===g(e),p=e=>"number"==typeof e&&!Number.isNaN(e),f=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),_=e=>!(!f(e)||!p(e.width)||e.width<=0||!p(e.height)||e.height<=0||!p(e.stride)||e.stride<=0||!("format"in e)||"tag"in e&&!y(e.tag)),E=e=>!!_(e)&&e.bytes instanceof Uint8Array,y=e=>null===e||!!f(e)&&!!p(e.imageId)&&"type"in e,I=e=>!!f(e)&&!!p(e.x)&&!!p(e.y),R=async(e,t,i)=>await new Promise((n,s)=>{let r=new XMLHttpRequest;r.responseType=t,r.onloadstart=()=>{i&&i.loadstartCallback&&i.loadstartCallback()},r.onloadend=async e=>{i&&i.loadendCallback&&i.loadendCallback(),r.status<200||r.status>=300?s(r.status):n(r.response)},r.onprogress=e=>{i&&i.progressCallback&&i.progressCallback(e)},r.onerror=e=>{s(e)},r.open("GET",e,!0),r.send()}),C=e=>/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e),w=(e,t)=>{let i=e.split("."),n=t.split(".");for(let e=0;e<i.length&&e<n.length;++e){let t=i[e],s=n[e];if(t===s)continue;let r=parseInt(i[e]),a=parseInt(n[e]);return r===a||Number.isNaN(r)&&Number.isNaN(a)?t<s?-1:1:r<a||Number.isNaN(r)&&Number.isInteger(a)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},v=e=>{const t={};for(let i in e){if("rootDirectory"===i)continue;let n=i,s=e[n],r=s&&"object"==typeof s&&s.path?s.path:s,a=e.rootDirectory;if(a&&!a.endsWith("/")&&(a+="/"),"object"==typeof s&&s.isInternal)a&&(r=e[n].version?`${a}${O[n]}@${e[n].version}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`:`${a}${O[n]}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`);else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof r&&(r=r.replace(i,a||"")),"object"==typeof r&&"dwt"===n){const s=e[n].resourcesPath,r=e[n].serviceInstallerLocation;t[n]={resourcesPath:s.replace(i,a||""),serviceInstallerLocation:r.replace(i,a||"")};continue}}t[n]=u(r)}return t},T=async(e,t,i)=>await new Promise(async(n,s)=>{try{const s=t.split(".");let r=s[s.length-1];const a=await M(`image/${r}`,e);s.length<=1&&(r="png");const o=new File([a],t,{type:`image/${r}`});if(i){const e=URL.createObjectURL(o),i=document.createElement("a");i.href=e,i.download=t,i.click()}n(o)}catch(e){s()}}),S=e=>{E(e)&&(e=L(e));const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t},D=(e,t)=>{E(t)&&(t=L(t));const i=S(t);let n=new Image,s=i.toDataURL(e);return n.src=s,n},M=async(e,t)=>{E(t)&&(t=L(t));const i=S(t);if("image/bmp"===e){const e=i.getContext("2d"),t=b(e.getImageData(0,0,i.width,i.height));return new Blob([t],{type:"image/bmp"})}return new Promise((t,n)=>{i.toBlob(e=>t(e),e)})},b=e=>{const t=e.width,i=e.height,n=e.data,s=4*Math.floor((24*t+31)/32),r=s*i,a=54+r,o=new ArrayBuffer(a),l=new DataView(o);l.setUint16(0,19778,!0),l.setUint32(2,a,!0),l.setUint16(6,0,!0),l.setUint16(8,0,!0),l.setUint32(10,54,!0),l.setUint32(14,40,!0),l.setInt32(18,t,!0),l.setInt32(22,-i,!0),l.setUint16(26,1,!0),l.setUint16(28,24,!0),l.setUint32(30,0,!0),l.setUint32(34,r,!0),l.setInt32(38,2835,!0),l.setInt32(42,2835,!0),l.setUint32(46,0,!0),l.setUint32(50,0,!0);let c=54;const d=s-3*t;for(let e=0;e<i;e++){for(let i=0;i<t;i++){const s=4*(e*t+i),r=n[s],a=n[s+1],o=n[s+2];l.setUint8(c++,o),l.setUint8(c++,a),l.setUint8(c++,r)}for(let e=0;e<d;e++)l.setUint8(c++,0)}return o},L=e=>{let t,i=e.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===l.IPF_BGR_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n+2],t[4*n+3]=255}else if(Number(e.format)===l.IPF_RGB_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n+2],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n],t[4*n+3]=255}else if(Number(e.format)===l.IPF_GRAYSCALED){const e=i.length;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;n++)t[4*n]=t[4*n+1]=t[4*n+2]=i[n],t[4*n+3]=255}else if(Number(e.format)===l.IPF_BINARY_8||Number(e.format)===l.IPF_BINARY_8_INVERTED){const n=i.length,s=e.width,r=e.height,a=e.stride;t=new Uint8ClampedArray(s*r*4);for(let e=0;e<n;e++){let n=i[e],r=e%a,o=Math.floor(e/a);for(let e=0;e<8;e++){let i=r+e,a=4*(o*s+i);if(i>=s)break;t[a]=t[a+1]=t[a+2]=(128&n)/128*255,t[a+3]=255,n<<=1}}}else if(Number(e.format)===l.IPF_ABGR_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}else if(Number(e.format)===l.IPF_ARGB_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n+2],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n],t[4*n+3]=i[4*n+3]}else Number(e.format),l.IPF_BINARY_8_INVERTED;return new ImageData(t,e.width,e.height)},A=async e=>{let t=URL.createObjectURL(e);try{const e=await new Promise((e,i)=>{const n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=t}),i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e.width,i.height=e.height,n.drawImage(e,0,0),{bytes:Uint8Array.from(n.getImageData(0,0,i.width,i.height).data),width:i.width,height:i.height,stride:4*i.width,format:l.IPF_ABGR_8888}}finally{URL.revokeObjectURL(t)}},O={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcvData:"dynamsoft-capture-vision-data",dce:"dynamsoft-camera-enhancer",identityutility:"dynamsoft-identity-utility",ddv:"dynamsoft-document-viewer",dwt:"dwt",dbrBundle:"dynamsoft-barcode-reader-bundle",dcvBundle:"dynamsoft-capture-vision-bundle"};var x,N,P,k,B,F,V,U;let Z,G,H,W,z,j=class e{get _isFetchingStarted(){return s(this,B,"f")}constructor(){x.add(this),N.set(this,[]),P.set(this,1),k.set(this,a.BOPM_BLOCK),B.set(this,!1),F.set(this,void 0),V.set(this,o.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var t;if(!E(e))throw new TypeError("Invalid 'image'.");if((null===(t=e.imageTag)||void 0===t?void 0:t.hasOwnProperty("imageId"))&&"number"==typeof e.imageTag.imageId&&this.hasImage(e.imageTag.imageId))throw new Error("Existed imageId.");if(s(this,N,"f").length>=s(this,P,"f"))switch(s(this,k,"f")){case a.BOPM_BLOCK:break;case a.BOPM_UPDATE:if(s(this,N,"f").push(e),f(s(this,F,"f"))&&p(s(this,F,"f").imageId)&&1==s(this,F,"f").keepInBuffer)for(;s(this,N,"f").length>s(this,P,"f");){const e=s(this,N,"f").findIndex(e=>{var t;return(null===(t=e.imageTag)||void 0===t?void 0:t.imageId)!==s(this,F,"f").imageId});s(this,N,"f").splice(e,1)}else s(this,N,"f").splice(0,s(this,N,"f").length-s(this,P,"f"))}else s(this,N,"f").push(e)}getImage(){if(0===s(this,N,"f").length)return null;let t;if(s(this,F,"f")&&p(s(this,F,"f").imageId)){const e=s(this,x,"m",U).call(this,s(this,F,"f").imageId);if(e<0)throw new Error(`Image with id ${s(this,F,"f").imageId} doesn't exist.`);t=s(this,N,"f").slice(e,e+1)[0]}else t=s(this,N,"f").pop();if([l.IPF_RGB_565,l.IPF_RGB_555,l.IPF_RGB_888,l.IPF_ARGB_8888,l.IPF_RGB_161616,l.IPF_ARGB_16161616,l.IPF_ABGR_8888,l.IPF_ABGR_16161616,l.IPF_BGR_888].includes(t.format)){if(s(this,V,"f")===o.CCUT_RGB_R_CHANNEL_ONLY){e._onLog&&e._onLog("only get R channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:i[e]=t.bytes[3*e+2];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:i[e]=t.bytes[4*e+2];break;case l.IPF_BGR_888:i[e]=t.bytes[3*e];break;case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}else if(s(this,V,"f")===o.CCUT_RGB_G_CHANNEL_ONLY){e._onLog&&e._onLog("only get G channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:case l.IPF_BGR_888:i[e]=t.bytes[3*e+1];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e+1]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}else if(s(this,V,"f")===o.CCUT_RGB_B_CHANNEL_ONLY){e._onLog&&e._onLog("only get B channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:i[e]=t.bytes[3*e];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:i[e]=t.bytes[4*e];break;case l.IPF_BGR_888:i[e]=t.bytes[3*e+2];break;case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e+2]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}}else[l.IPF_NV21,l.IPF_NV12].includes(t.format)&&e._onLog&&e._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(e,t){if(!((...e)=>0!==e.length&&e.every(e=>p(e)))(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&"[object Boolean]"!==g(t))throw new TypeError("Invalid 'keepInBuffer'.");r(this,F,{imageId:e,keepInBuffer:t})}_resetNextReturnedImage(){r(this,F,null)}hasImage(e){return s(this,x,"m",U).call(this,e)>=0}startFetching(){r(this,B,!0)}stopFetching(){r(this,B,!1)}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(r(this,P,e);s(this,N,"f")&&s(this,N,"f").length>e;)s(this,N,"f").shift()}getMaxImageCount(){return s(this,P,"f")}getImageCount(){return s(this,N,"f").length}clearBuffer(){s(this,N,"f").length=0}isBufferEmpty(){return 0===s(this,N,"f").length}setBufferOverflowProtectionMode(e){r(this,k,e)}getBufferOverflowProtectionMode(){return s(this,k,"f")}setColourChannelUsageType(e){r(this,V,e)}getColourChannelUsageType(){return s(this,V,"f")}};N=new WeakMap,P=new WeakMap,k=new WeakMap,B=new WeakMap,F=new WeakMap,V=new WeakMap,x=new WeakSet,U=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return s(this,N,"f").findIndex(t=>{var i;return(null===(i=t.imageTag)||void 0===i?void 0:i.imageId)===e})},"undefined"!=typeof navigator&&(Z=navigator,G=Z.userAgent,H=Z.platform,W=Z.mediaDevices),function(){if(!c){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Z.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:H,search:"Win"},Mac:{str:H},Linux:{str:H}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||G,a=s.search||t,o=s.verStr||G,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||G,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=G.indexOf("Windows NT")&&(s="HarmonyOS"),z={browser:i,version:n,OS:s}}c&&(z={browser:"ssr",version:0,OS:"ssr"})}();const Y="undefined"!=typeof WebAssembly&&G&&!(/Safari/.test(G)&&!/Chrome/.test(G)&&/\(.+\s11_2_([2-6]).*\)/.test(G)),$=!("undefined"==typeof Worker),q=!(!W||!W.getUserMedia),X=async()=>{let e=!1;if(q)try{(await W.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),e=!0}catch(e){}return e};var Q,K,J,ee,te,ie,ne,se,re;"Chrome"===z.browser&&z.version>66||"Safari"===z.browser&&z.version>13||"OPR"===z.browser&&z.version>43||"Edge"===z.browser&&z.version,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_DESKEWED_IMAGE=16]="CRIT_DESKEWED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT",e[e.CRIT_ENHANCED_IMAGE=64]="CRIT_ENHANCED_IMAGE"}(Q||(Q={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(K||(K={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_UNSUPPORTED_JSON_KEY_WARNING=-10077]="EC_UNSUPPORTED_JSON_KEY_WARNING",e[e.EC_MODEL_FILE_NOT_FOUND=-10078]="EC_MODEL_FILE_NOT_FOUND",e[e.EC_PDF_LICENSE_NOT_FOUND=-10079]="EC_PDF_LICENSE_NOT_FOUND",e[e.EC_RECT_INVALID=-10080]="EC_RECT_INVALID",e[e.EC_TEMPLATE_VERSION_INCOMPATIBLE=-10081]="EC_TEMPLATE_VERSION_INCOMPATIBLE",e[e.EC_PORTRAIT_ZONE_NOT_FOUND=-10082]="EC_PORTRAIT_ZONE_NOT_FOUND",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_LICENSE_AUTH_QUOTA_EXCEEDED=-20013]="EC_LICENSE_AUTH_QUOTA_EXCEEDED",e[e.EC_LICENSE_RESULTS_LIMIT_EXCEEDED=-20014]="EC_LICENSE_RESULTS_LIMIT_EXCEEDED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(J||(J={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV",e[e.GEM_END=-1]="GEM_END"}(ee||(ee={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV",e[e.GTM_END=-1]="GTM_END"}(te||(te={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ie||(ie={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(ne||(ne={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(se||(se={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(re||(re={}));const ae={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_DESKEWED_IMAGE:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ENHANCED_IMAGE:BigInt(Math.pow(2,30)),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var oe,le,ce,de,he;!function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_DESKEWED_IMAGE=6]="ROET_DESKEWED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI",e[e.ROET_ENHANCED_IMAGE=9]="ROET_ENHANCED_IMAGE",e[e.ROET_AUXILIARY_REGION=10]="ROET_AUXILIARY_REGION"}(oe||(oe={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_DESKEWING=7]="ST_DOCUMENT_DESKEWING",e[e.ST_IMAGE_ENHANCEMENT=8]="ST_IMAGE_ENHANCEMENT"}(le||(le={})),function(e){e[e.IFF_JPEG=0]="IFF_JPEG",e[e.IFF_PNG=1]="IFF_PNG",e[e.IFF_BMP=2]="IFF_BMP",e[e.IFF_PDF=3]="IFF_PDF"}(ce||(ce={})),function(e){e[e.ICDM_NEAR=0]="ICDM_NEAR",e[e.ICDM_FAR=1]="ICDM_FAR"}(de||(de={})),function(e){e.MN_DYNAMSOFT_CAPTURE_VISION_ROUTER="cvr",e.MN_DYNAMSOFT_CORE="core",e.MN_DYNAMSOFT_LICENSE="license",e.MN_DYNAMSOFT_IMAGE_PROCESSING="dip",e.MN_DYNAMSOFT_UTILITY="utility",e.MN_DYNAMSOFT_BARCODE_READER="dbr",e.MN_DYNAMSOFT_DOCUMENT_NORMALIZER="ddn",e.MN_DYNAMSOFT_LABEL_RECOGNIZER="dlr",e.MN_DYNAMSOFT_CAPTURE_VISION_DATA="dcvData",e.MN_DYNAMSOFT_NEURAL_NETWORK="dnn",e.MN_DYNAMSOFT_CODE_PARSER="dcp",e.MN_DYNAMSOFT_CAMERA_ENHANCER="dce",e.MN_DYNAMSOFT_CAPTURE_VISION_STD="std"}(he||(he={}));const ue={},ge=async e=>{let t="string"==typeof e?[e]:e,i=[];for(let e of t)i.push(ue[e]=ue[e]||new n);await Promise.all(i)},me=async(e,t)=>{let i,s="string"==typeof e?[e]:e,r=[];for(let e of s){let s;r.push(s=ue[e]=ue[e]||new n(i=i||t())),s.isEmpty&&(s.task=i=i||t())}await Promise.all(r)};let pe,fe=0;const _e=()=>fe++,Ee={};let ye;const Ie=e=>{ye=e,pe&&pe.postMessage({type:"setBLog",body:{value:!!e}})};let Re=!1;const Ce=e=>{Re=e,pe&&pe.postMessage({type:"setBDebug",body:{value:!!e}})},we={},ve={},Te={dip:{wasm:!0}},Se={std:{version:"2.0.0",path:u(h+"../../dynamsoft-capture-vision-std@2.0.0/dist/"),isInternal:!0},core:{version:"4.4.10-dev-20260129110706",path:h,isInternal:!0}};let De=5;"undefined"!=typeof navigator&&(De=navigator.hardwareConcurrency?navigator.hardwareConcurrency-1:5),Ee[-3]=async e=>{Me.onWasmLoadProgressChanged&&Me.onWasmLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Me{static get engineResourcePaths(){return Se}static set engineResourcePaths(e){Object.assign(Se,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ye}static set _onLog(e){Ie(e)}static get _bDebug(){return Re}static set _bDebug(e){Ce(e)}static get _workerName(){return`${Me._bundleEnv.toLowerCase()}.bundle.worker.js`}static get wasmLoadOptions(){return Me._wasmLoadOptions}static set wasmLoadOptions(e){Object.assign(Me._wasmLoadOptions,e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!ue[e]&&ue[e].isFulfilled}static async loadWasm(){return await(async()=>{let e,t;e instanceof Array||(e=e?[e]:[]);let i=ue.core;t=!i||i.isEmpty,t||await ge("core");let s=new Map;const r=e=>{if(e=e.toLowerCase(),he.MN_DYNAMSOFT_CAPTURE_VISION_STD==e||he.MN_DYNAMSOFT_CORE==e)return;let t=Te[e].deps;if(null==t?void 0:t.length)for(let e of t)r(e);let i=ue[e];s.has(e)||s.set(e,!i||i.isEmpty)};for(let t of e)r(t);let a=[];t&&a.push("core"),a.push(...s.keys());const o=[...s.entries()].filter(e=>!e[1]).map(e=>e[0]);await me(a,async()=>{const e=[...s.entries()].filter(e=>e[1]).map(e=>e[0]);await ge(o);const i=v(Se),r={};for(let t of e)r[t]=Te[t];const a={engineResourcePaths:i,autoResources:r,names:e,_bundleEnv:Me._bundleEnv,wasmLoadOptions:Me.wasmLoadOptions};let l=new n;if(t){a.needLoadCore=!0;let e=i[`${Me._bundleEnv.toLowerCase()}Bundle`]+Me._workerName;e.startsWith(location.origin)||(e=await fetch(e).then(e=>e.blob()).then(e=>URL.createObjectURL(e))),pe=new Worker(e),pe.onerror=e=>{let t=new Error(e.message);l.reject(t)},pe.addEventListener("message",e=>{let t=e.data?e.data:e,i=t.type,n=t.id,s=t.body;switch(i){case"log":ye&&ye(t.message);break;case"warning":console.warn(t.message);break;case"task":try{Ee[n](s),delete Ee[n]}catch(e){throw delete Ee[n],e}break;case"event":try{Ee[n](s)}catch(e){throw e}break;default:console.log(e)}}),a.bLog=!!ye,a.bd=Re,a.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await ge("core");let c=fe++;Ee[c]=e=>{if(e.success)Object.assign(we,e.versions),"{}"!==JSON.stringify(e.versions)&&(Me._versions=e.versions),Me.loadedWasmType=e.loadedWasmType,l.resolve(void 0);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),l.reject(t)}},pe.postMessage({type:"loadWasm",id:c,body:a}),await l})})()}static async detectEnvironment(){return await(async()=>({wasm:Y,worker:$,getUserMedia:q,camera:await X(),browser:z.browser,version:z.version,OS:z.OS}))()}static async getModuleVersion(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"getModuleVersion",id:i})})}static getVersion(){return`4.4.10-dev-20260129110706(Worker: ${we.core&&we.core.worker||"Not Loaded"}, Wasm: ${we.core&&we.core.wasm||"Not Loaded"})`}static enableLogging(){j._onLog=console.log,Me._onLog=console.log}static disableLogging(){j._onLog=null,Me._onLog=null}static async cfd(e){return await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"cfd",id:n,body:{count:e}})})}}Me._bSupportDce4Module=-1,Me._bSupportIRTModule=-1,Me._versions=null,Me._bundleEnv="DCV",Me._wasmLoadOptions={wasmType:"auto",pthreadPoolSize:De},Me.loadedWasmType="ml-simd-pthread",Me.browserInfo=z;const be="undefined"==typeof self,Le="function"==typeof importScripts,Ae=(()=>{if(!Le){if(!be&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Oe=/<style>([\s\S]*?)<\/style>/g,xe=/style="([\s\S]*?)"/g,Ne=(e,t)=>{const{inlineScript2Blob:i,internalCss2Blob:n,insertInternalCss2ExistedSheet:s}=t||{};if(s){let t,i;for(let n=0;n<document.styleSheets.length;++n){const s=document.styleSheets[n];try{i=s.cssRules,t=s;break}catch(e){}}t&&(e=e.replace(Oe,(e,n,s,r)=>{let a=n.split("}");const o=a.length-1;let l=[],c=null,d=0;for(let e=0;e<o;++e){let t=0;for(;-1!==(t=a[e].indexOf("{",t));)d+=1,t+=1;if(c)1===d?(l.push(c+a[e]+"}"),c=null,d=0):(c+=a[e]+"}",--d);else{if(d<1)throw new Error("invalid style");1===d?(l.push(a[e].trimStart()+"}"),d=0):(c=a[e].trimStart()+"}",--d)}}if(c||d)throw new Error("invalid style");for(let e of l)t.insertRule(e,i.length);return""}))}const r=[];n&&(e=e.replace(Oe,(e,t,i,n)=>(r.push(new Blob([t],{type:"text/css"})),"<HasStyle></HasStyle>")));const a=[];e=e.replace(xe,(e,t,i,n)=>(a.push(t),"hasstyle"));const o=document.createElement("div");if(o.insertAdjacentHTML("beforeend",e),o.normalize(),n){const e=o.querySelectorAll("HasStyle");for(let t=0;t<r.length;t++){const i=r[t],n=e[t],s=document.createElement("link");s.rel="stylesheet",s.href=URL.createObjectURL(i),n.replaceWith(s)}}const l=o.querySelectorAll("[hasstyle]");for(let e=0;e<a.length;e++){const t=a[e],i=l[e];i.removeAttribute("hasstyle");const n=t.split(";").map(e=>e.trim()).filter(e=>e);if(i.style)for(let e of n){const t=e.split(":");i.style[t[0].trim()]=t[1].trim()}}for(let e of o.querySelectorAll("script")){const t=document.createElement("script");e.textContent&&(i&&!e.src?(t.src=URL.createObjectURL(new Blob([e.textContent],{type:"text/javascript"})),t.addEventListener("load",()=>URL.revokeObjectURL(t.src))):t.textContent=e.textContent);for(let i of e.attributes)t.setAttribute(i.name,i.value);e.replaceWith(t)}let c=new DocumentFragment;return c.append(...o.childNodes),1===c.childNodes.length?c.firstChild:c},Pe=[["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],["camera2 0,"],["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"]],ke=e=>e&&"object"==typeof e&&"function"==typeof e.then,Be=(async()=>{})().constructor;class Fe extends Be{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,ke(e)?t=e:"function"==typeof e&&(t=new Be(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(ke(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const Ve={width:1280,height:720},Ue=function(){const e=this,t=MediaDeviceInfo.prototype.toJSON.apply(e);return t.trackLabel=e.trackLabel,t.capabilities=e.capabilities,t},Ze="The camera feature is available only in secure contexts (HTTPS)";let Ge=class e{static _cameraNameMatcher=Pe;static _mapDeviceInfo;_coreShell;_video;_coreInnerLayer;_coreOuterLayer;_regionBoxWrapper;_regionBoxMask;_regionBoxBorder;_objectFit="contain";_uiInlineScript2Blob=!0;_uiInternalCss2Blob=!0;_uiInternalCss2ExistedSheet=!1;_ui;_pOpen;_paused=!1;_shouldClose=!1;_cameraChangedWhenPaused=!1;_resolutionChangedWhenPaused=!1;_requestedCamera="back";_requestedResolution=Ve;_regionBox={unit:"view-size",center:{x:0,y:0},maskStyle:{background:"rgba(0, 0, 0, 0.5)"},borderStyle:{border:"1px solid #00ff7f"}};_eventListeners={};static _arrConstructors=[];static _arrOnOpen=[];static _arrBeforeClose=[];static _arrOnClose=[];constructor(){const t=this._coreShell=document.createElement("div");Object.assign(t.style,{width:"100%",height:"100%",minWidth:"100px",minHeight:"100px",backgroundColor:"black",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative"});const i=this._coreOuterLayer=document.createElement("div");Object.assign(i.style,{width:"auto",height:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"relative",overflow:"hidden"});const n=this._coreInnerLayer=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%",position:"relative",transformOrigin:"center"});const s=this._video=document.createElement("video");Object.assign(s.style,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",objectFit:"fill"}),s.muted=!0,s.playsInline=!0,n.append(s),i.append(n),t.append(i),new ResizeObserver(()=>{this._updateObjectFit()}).observe(t);for(let t of e._arrConstructors)t.call(this)}_updateObjectFit(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video,t=this._coreOuterLayer.style,i=this._regionBoxWrapper?.style;if("fill"===this._objectFit)return"100%"!==t.width&&(t.width="100%"),"100%"!==t.height&&(t.height="100%"),void(i&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%")));const{width:n,height:s}=this._coreShell.getBoundingClientRect(),r=`${e.videoWidth} / ${e.videoHeight}`;r!=t.aspectRatio&&(t.aspectRatio=r),i&&r!=i.aspectRatio&&(i.aspectRatio=r);let a=!1;n/s>e.videoWidth/e.videoHeight&&(a=!a),"cover"===this._objectFit&&(a=!a);const o=i&&"contain"===this._objectFit,l=i&&"cover"===this._objectFit;a?("auto"!=t.width&&(t.width="auto"),"100%"!=t.height&&(t.height="100%"),o&&("auto"!=i.width&&(i.width="auto"),"100%"!=i.height&&(i.height="100%"))):("100%"!=t.width&&(t.width="100%"),"auto"!=t.height&&(t.height="auto"),o&&("100%"!=i.width&&(i.width="100%"),"auto"!=i.height&&(i.height="auto"))),l&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%"))}get video(){return this._video}get track(){return this._video?.srcObject?.getTracks()[0]}get objectFit(){return this._objectFit}set objectFit(e){this._objectFit=e,this._updateObjectFit()}get ui(){return this._ui||this._coreShell}set ui(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if("string"==typeof e){if(!e.trim().startsWith("<"))throw Error("Invalid html string.");e=Ne(e,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet})}let t;if(e instanceof HTMLElement)t=e;else{if(!(e instanceof DocumentFragment))throw Error("Seems no HTMLElement.");t=document.createElement("div"),Object.assign(t.style,{width:"100%",height:"100%"}),t.append(e)}const i="dm-camera-core-container",n=t.classList.contains(i)?t:t.querySelector(`.${i}`);if(!n)throw Error(`Can't find element with class \`${i}\`.`);this._ui=t;for(let e of t.querySelectorAll("script"))e.currentDMCamera=this;n.append(this._coreShell)}get status(){return this._pOpen?this._pOpen.isPending?this._shouldClose?"closing":"opening":this._paused?"paused":"opened":"closed"}get requestedCamera(){return this._requestedCamera}get requestedResolution(){return this._requestedResolution}get currentCamera(){return"opened"!==this.status&&"paused"!==this.status?null:e._mapDeviceInfo?.[this.track?.getSettings()?.deviceId]}get currentResolution(){return{width:this.video?.videoWidth,height:this.video?.videoHeight}}get regionBox(){return this._regionBox}onOpened;static async hasCamera(){return!!navigator?.mediaDevices&&!!(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length}static async hasMacroCamera(){return!!navigator?.mediaDevices&&!!(await e.getDeviceInfos()).find(e=>e.capabilities?.facingMode?.includes("environment")&&e.capabilities?.focusDistance?.min<.061)}static async getDeviceInfos(){if(!navigator?.mediaDevices)throw Error(Ze);let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);if(!t.length)return[];if(t.some(e=>!e.deviceId)){let e;try{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind),t.some(e=>!e.deviceId)&&console.warn("Some camera does not have deviceId.")}catch(t){console.warn("Failed to get device ID by opening camera.",t)}if(e){const i=e.getTracks().filter(e=>"video"===e.kind)[0],n=i.getSettings().deviceId;let s=t.find(e=>e.deviceId===n);s?(s.trackLabel=i.label,s.capabilities=i.getCapabilities?.(),s.toJSON=Ue):console.warn("Can't find current device by `track.getSettings().deviceId`."),e.getTracks().forEach(e=>e.stop())}}await e._setCapabilities(t);const i=t.reduce((e,t)=>(e[t.deviceId]=t,e),{});return e._mapDeviceInfo=i,[...t]}static async _setCapabilities(t){for(let i of t){if(!i.deviceId)continue;if(Ue===i.toJSON)continue;let n=e._mapDeviceInfo?.[i.deviceId];if(n)i.trackLabel=n.trackLabel,i.capabilities=n.capabilities;else try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:i.deviceId},audio:!1}),t=e.getTracks().filter(e=>"video"===e.kind)[0];i.trackLabel=t.label,i.capabilities=t.getCapabilities?.(),e.getTracks().forEach(e=>e.stop())}catch(t){console.warn("Failed to get `trackLabel` and `capabilities`, by opening camera.",t)}i.toJSON=Ue}}async open(){if("opened"!==this.status)if("closed"===this.status||"paused"===this.status)try{if("paused"===this.status&&this._cameraChangedWhenPaused&&(await this.close(),this._cameraChangedWhenPaused=!1),"closed"===this.status){if(this._pOpen=new Fe,"customized-video"!==this._requestedCamera){let t;if("string"==typeof this._requestedCamera){switch(this._requestedCamera){case"front":t={facingMode:"user"};break;case"quick-back":t={facingMode:"environment"};break;case"back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");for(let n of e._cameraNameMatcher){for(let e of i){const i=(e.trackLabel||e.label)?.toLowerCase();for(let s of n)if(i.includes(s)){t={deviceId:e.deviceId};break}if(t)break}if(t)break}if(t)break;i.reverse();for(let e of i)if(e.capabilities?.facingMode?.includes("environment")){t={deviceId:e.deviceId};break}if(t)break;t={deviceId:i[0].deviceId};break}case"macro-back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");const n=i.reduce((e,t)=>t?.capabilities?.facingMode?.includes("environment")?e&&e?.capabilities?.focusDistance?.min?t?.capabilities?.focusDistance?.min<e?.capabilities?.focusDistance?.min?t:e:t:e);t={deviceId:n?.deviceId||i[i.length-1].deviceId};break}default:throw Error(`Unknown camera preset: ${this._requestedCamera}`)}this._requestedCamera=t}else t=this._requestedCamera;const i={video:Object.assign({},t,this._requestedResolution),audio:!1};if(!navigator?.mediaDevices)throw Error(Ze);const n=await navigator.mediaDevices.getUserMedia(i);if("closing"===this.status)throw Error("Camera closed.");this._video.srcObject=n}if(await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this.track){const e=this.track.getSettings();let t=0;for(;++t<10&&(e.width!==this.video.videoWidth||e.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));if("closing"===this.status)throw Error("Camera closed.")}this._pOpen.resolve();try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}}else{if(this._pOpen=new Fe,await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this._paused=!1,this._pOpen.resolve(),this._resolutionChangedWhenPaused){try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._resolutionChangedWhenPaused=!1}}for(let t of e._arrOnOpen)t.call(this);this._callOpenedListeners()}catch(e){let t=this._video?.srcObject?.getTracks?.();if(t)for(let e of t)e?.stop();this._video.srcObject=null;const i=this._pOpen;throw this._pOpen=null,this._shouldClose=!1,i.reject(),Error(`Error opening camera: ${e?.message}`,{cause:e})}else{if("opening"!==this.status&&"closing"!==this.status)throw Error("Never");await this._pOpen}}async pause(){try{await this._pOpen}catch(e){}"opened"===this.status&&(this._video.pause(),this._paused=!0)}async close(){for(let t of e._arrBeforeClose)t.call(this);if("closed"===this.status)return;if("opening"===this.status&&(this._shouldClose=!0),"closing"===this.status){try{await this._pOpen}catch(t){}return}let t=this._video?.srcObject?.getTracks?.();if(t){for(let e of t)e?.stop();this._video.srcObject=null}this._pOpen=null,this._paused=!1;for(let t of e._arrOnClose)t.call(this);this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility="hidden"),this._eventListeners.closed?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}async requestCamera(e){if("string"==typeof e)He.includes(e)?this._requestedCamera=e:this._requestedCamera={deviceId:e};else if(e)if("videoinput"===e.kind)e.deviceId?this._requestedCamera={deviceId:e.deviceId}:this._requestedCamera="back";else{const t=this._requestedCamera=JSON.parse(JSON.stringify(e));if(t.width||t.height||t.aspectRatio){const e=this._requestedResolution={};t.width&&(e.width=t.width,delete t.width),t.height&&(e.height=t.height,delete t.height),t.aspectRatio&&(e.aspectRatio=t.aspectRatio,delete t.aspectRatio)}}else null===e?this._requestedCamera=null:void 0===e&&(this._requestedCamera="back");"opened"===this.status?(await this.close(),await this.open()):"paused"===this.status&&(this._cameraChangedWhenPaused=!0)}async requestResolution(e,t){let i={};if("number"==typeof e?(i.width=e,"number"==typeof t&&(i.height=t)):Array.isArray(e)?(e[0]&&(i.width=e[0]),e[1]&&(i.height=e[1])):e?((e=JSON.parse(JSON.stringify(e))).width&&(i.width=e.width),e.height&&(i.height=e.height),e.aspectRatio&&(i.aspectRatio=e.aspectRatio)):null===e?i=null:void 0===e&&(i=Ve),this._requestedResolution=i,"opened"===this.status){await this.track.applyConstraints({...i});const t=this.track.getSettings();let n=0;for(;++n<10&&(t.width!==this.video.videoWidth||t.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._callOpenedListeners()}else"paused"===this.status&&(this._resolutionChangedWhenPaused=!0,await this.track.applyConstraints({...i}))}getFrame(e){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");let{x:t=0,y:i=0,width:n=this._video.videoWidth,height:s=this._video.videoHeight,reusedContext:r}=e||{};n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const a=r?.canvas||document.createElement("canvas");return a.width!=n&&(a.width=n),a.height!=s&&(a.height=s),(r||a.getContext("2d")).drawImage(this._video,t,i,n,s,0,0,n,s),a}setRegionBox(e){if(!(e=Object.assign(this._regionBox,e)).width||!e.height){if(!e.innerUi)return this._regionBoxWrapper?.remove(),this._regionBoxWrapper=null,this._regionBoxMask=null,void(this._regionBoxBorder=null);Object.assign(e,{width:1,height:1,unit:"view-size",center:{x:0,y:0}})}this._regionBoxWrapper||(this._regionBoxWrapper=document.createElement("div"),Object.assign(this._regionBoxWrapper.style,{width:"auto",height:"100%",maxWidth:"100%",maxHeight:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",containerType:"size",visibility:"opened"===this.status?"":"hidden"}),this._regionBoxMask=document.createElement("div"),Object.assign(this._regionBoxMask.style,{width:"100%",height:"100%",flex:"none"}),this._regionBoxWrapper.append(this._regionBoxMask),this._regionBoxBorder=document.createElement("div"),Object.assign(this._regionBoxBorder.style,{flex:"none",boxSizing:"content-box",position:"absolute",transform:"translate(-50%,-50%)"}),this._regionBoxWrapper.append(this._regionBoxBorder),this._coreShell.append(this._regionBoxWrapper)),"string"==typeof e.innerUi&&(e.innerUi=Ne(e.innerUi)),e.innerUi instanceof DocumentFragment?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Node?1==this._regionBoxBorder.childNodes.length&&this._regionBoxBorder.firstChild==e.innerUi||(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi)):e.innerUi instanceof NodeList?this._regionBoxBorder.childNodes!==e.innerUi&&(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Array?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):this._regionBoxBorder.innerHTML="";let t=100*e.center.y-50*e.height+50+"%",i=100*e.center.x+50*e.width+50+"%",n=100*e.center.y+50*e.height+50+"%",s=100*e.center.x-50*e.width+50+"%";Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`}),"view-min"===e.unit&&(t=`calc(${100*e.center.y+50}% + max(-${50*e.height}cqmin, -${50*e.height}cqmax))`,i=`calc(${100*e.center.x+50}% + ${50*e.width}cqmin)`,n=`calc(${100*e.center.y+50}% + ${50*e.height}cqmin)`,s=`calc(${100*e.center.x+50}% + max(-${50*e.width}cqmin, -${50*e.width}cqmax))`,Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`})),Object.assign(this._regionBoxMask.style,{...e.maskStyle}),Object.assign(this._regionBoxBorder.style,{width:100*e.width+"%",height:100*e.height+"%"}),"view-min"===e.unit&&Object.assign(this._regionBoxBorder.style,{width:100*e.width+"cqmin",height:100*e.height+"cqmin"}),Object.assign(this._regionBoxBorder.style,{top:100*e.center.y+50+"%",left:100*e.center.x+50+"%",...e.borderStyle}),"view-size"===e.unit&&1===e.width&&1===e.height&&(this._regionBoxBorder.style.borderWidth="0"),this._updateObjectFit()}addCanvas(){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),"opened"!==this.status&&"paused"!==this.status||(e.width=this._video.videoWidth,e.height=this._video.videoHeight),this._video.parentElement.append(e),e}_updateCanvasSize(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video;this._video.parentElement.querySelectorAll("canvas").forEach(t=>{t.width!==e.videoWidth&&(t.width=e.videoWidth),t.height!==e.videoHeight&&(t.height=e.videoHeight)})}addEventListener(e,t){(this._eventListeners[e]??=new Set).add(t)}removeEventListener(e,t){this._eventListeners[e]?.delete(t)}_callOpenedListeners(){try{this.onOpened?.(this)}catch(e){console.error(e)}this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility=""),this._eventListeners.opened?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}videoXY2AbsoluteLT(e){const t=this._video,i=t.getBoundingClientRect(),n=getComputedStyle(document.body);if("static"===n.position){const n=document.documentElement.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-n.x,top:e.y/t.videoHeight*i.height+i.y-n.y}))}{const s=document.body.getBoundingClientRect(),r=parseFloat(n.borderLeftWidth),a=parseFloat(n.borderTopWidth);return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-s.x-r,top:e.y/t.videoHeight*i.height+i.y-s.y-a}))}}videoXY2FixedLT(e){const t=this._video,i=t.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x,top:e.y/t.videoHeight*i.height+i.y}))}getVisibleAreaInVideoXY(e){const{isConsiderRegionBox:t=!1,rounded:i=!1}=e||{};let n;if(t&&this._regionBoxBorder){const e=this._regionBoxBorder.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height};const t=getComputedStyle(this._regionBoxBorder),i=parseFloat(t.borderLeftWidth),s=parseFloat(t.borderTopWidth),r=parseFloat(t.borderRightWidth),a=parseFloat(t.borderBottomWidth);n.x+=i,n.y+=s,n.width-=i+r,n.height-=s+a}else{const e=this._coreShell.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height}}const s=this._video.getBoundingClientRect(),r={x:(n.x-s.x)/s.width,y:(n.y-s.y)/s.height,width:n.width/s.width,height:n.height/s.height};r.x<0&&(r.width+=r.x,r.x=0),r.x>1&&(r.width-=r.x-1,r.x=1),r.y<0&&(r.height+=r.y,r.y=0),r.y>1&&(r.height-=r.y-1,r.y=1),r.x+r.width>1&&(r.width=1-r.x),r.x+r.width<0&&(r.width=-r.x),r.y+r.height>1&&(r.height=1-r.y),r.y+r.height<0&&(r.height=-r.y);const a=this._video.videoWidth,o=this._video.videoHeight;let l=(this.isMirrored?1-r.x-r.width:r.x)*a,c=r.y*o,d=r.width*a,h=r.height*o;return i&&(d=Math.round(d+l)-Math.round(l),h=Math.round(h+c)-Math.round(c),l=Math.round(l),c=Math.round(c)),{x:l,y:c,width:d,height:h}}};const He=["back","front","macro-back","quick-back","customized-video"];Ge._arrConstructors.push(function(){const e=this;e._softZoom={zoom:1,center:{x:0,y:0}},e.maxZoom4GestureWheel=20,e._lastZoomTime=-1/0,e._mapZoomTouchs=new Map,e.enableGestureZoom=!0,e.enableWheelZoom=!1}),Object.defineProperty(Ge.prototype,"softZoom",{get(){return this._softZoom}}),Object.defineProperty(Ge.prototype,"isMirrored",{get(){return this._isMirrored},set(e){const t=this;t._isMirrored=e,t.setSoftZoom(t.softZoom.zoom,{center:t.softZoom.center})}}),Object.defineProperty(Ge.prototype,"enableGestureZoom",{get(){return!!this._gestureZoomListener},set(e){const t=this;e?t._gestureZoomListener||(t._gestureZoomListener=e=>{t._changeZoomByTouch(e)},t._coreShell.addEventListener("touchstart",t._gestureZoomListener),t._coreShell.addEventListener("touchmove",t._gestureZoomListener),t._coreShell.addEventListener("touchend",t._gestureZoomListener),t._coreShell.addEventListener("touchcancel",t._gestureZoomListener)):t._gestureZoomListener&&(t._coreShell.removeEventListener("touchstart",t._gestureZoomListener),t._coreShell.removeEventListener("touchmove",t._gestureZoomListener),t._coreShell.removeEventListener("touchend",t._gestureZoomListener),t._coreShell.removeEventListener("touchcancel",t._gestureZoomListener),t._gestureZoomListener=null)}}),Object.defineProperty(Ge.prototype,"enableWheelZoom",{get(){return!!this._wheelZoomListener},set(e){const t=this;e?t._wheelZoomListener||(t._wheelZoomListener=e=>{t._changeZoomByWheel(e)},t._coreShell.addEventListener("wheel",t._wheelZoomListener)):t._wheelZoomListener&&(t._coreShell.removeEventListener("wheel",t._wheelZoomListener),t._wheelZoomListener=null)}}),Ge.prototype.getZoomRange=function(){if("opened"!==this.status)throw Error("Camera is not opened");return this.track.getCapabilities?.()?.zoom},Ge.prototype.setZoom=async function(e){if("opened"!==this.status)throw Error("Camera is not opened");await this.track.applyConstraints({advanced:[{zoom:e}]})},Ge.prototype.setSoftZoom=function(e,t){const i=this;let{center:n,limit:s}=t||{},{x:r=0,y:a=0}=n||{};s&&e<1&&(e=1);let o=i._isMirrored?`scale(${-e},${e})`:`scale(${e})`;if(n){if(s){const t=.5-.5/e;r<-t?r=-t:r>t&&(r=t),a<-t?a=-t:a>t&&(a=t)}o+=` translate(${r*=-100}%, ${a*=-100}%)`}i._softZoom={zoom:e,center:{x:r,y:a}},i._coreInnerLayer.style.transform=o},Ge.prototype._changeZoomByWheel=function(e){const t=this,i=Date.now();let n=t._softZoom.zoom,s=n-e.deltaY/200;s>t.maxZoom4GestureWheel&&(s=t.maxZoom4GestureWheel),s<1&&(s=1),s!==n&&(t.setSoftZoom(s,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,e.preventDefault(),t._eventListeners.zoom?.forEach(e=>{try{e.call(t,JSON.parse(JSON.stringify(t._softZoom)))}catch(e){console.error(e)}}))},Ge.prototype._changeZoomByTouch=function(e){const t=this;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=Date.now();if(i-t._lastZoomTime<100)return;let n=e.touches[0],s=e.touches[1],r=t._mapZoomTouchs.get(n.identifier),a=t._mapZoomTouchs.get(s.identifier);if(!r||!a)break;let o=Math.pow(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2),.5),l=Math.pow(Math.pow(n.clientX-s.clientX,2)+Math.pow(n.clientY-s.clientY,2),.5),c=t._softZoom.zoom;c*=l/o,c>t.maxZoom4GestureWheel&&(c=t.maxZoom4GestureWheel),c<1&&(c=1),t.setSoftZoom(c,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,t._eventListeners.zoom?.forEach(e=>{try{e(t)}catch(e){console.error(e)}});break}t._mapZoomTouchs.clear();for(let i of e.touches)t._mapZoomTouchs.set(i.identifier,{x:i.clientX,y:i.clientY})},Ge._arrConstructors.push(function(){const e=this;e._isFocusing=!1,e._advancedFocusParameters={minFocusDistanceLimit:.01,maxFocusDistanceLimit:10,firstStepWaitDuration:500,coarseStepWaitDuration:350,switchStepWaitDuration:400,fineStepWaitDuration:350,maxStepCount:30,backToContinousDuration:5e3,focusWH:.2,coarseTuneRate:.5,coarseTuneTolerance:.5,fineTuneRate:1.1},e._advancedFocusTaskId=0,e.enableTapToFocus="simple"}),Ge._getImageContrast=(e,t,i)=>{let n=0;for(let s=0;s<i-1;s++)for(let i=0;i<t-1;i++){const r=4*(s*t+i),a=r+4,o=r+4*t,l=e[r]-e[a],c=e[r+1]-e[a+1],d=e[r+2]-e[a+2],h=e[r]-e[o],u=e[r+1]-e[o+1],g=e[r+2]-e[o+2];n+=l*l+c*c+d*d+h*h+u*u+g*g}return n},Ge.prototype._simpleFocus=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(e._isFocusing)return;const t=e.currentCamera?.capabilities;let i,n;if(t?.focusMode?.includes("manual"))if(t?.focusMode?.includes("continuous"))i="manual",n="continuous";else{if(!t?.focusMode?.includes("single-shot"))return void e._advancedFocus();i="manual",n="single-shot"}else if(t?.focusMode?.includes("single-shot"))t?.focusMode?.includes("continuous")?(i="continuous",n="single-shot"):(i=null,n="single-shot");else{if(!t?.focusMode?.includes("continuous"))return;i=null,n="continuous"}e._isFocusing=!0;try{i&&("manual"===i?await e.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t?.focusDistance?.max||10}]}):await e.track.applyConstraints({advanced:[{focusMode:i}]}),await new Promise(e=>setTimeout(e,500))),await e.track.applyConstraints({advanced:[{focusMode:n}]}),await new Promise(e=>setTimeout(e,500))}catch(t){"opened"===e.status&&console.warn("Error while do simple focus",t)}e._isFocusing=!1},Ge.prototype._advancedFocus=async function(e,t,i){const n=this;if("opened"!==n.status)throw Error("Camera is not opened");if(n._isFocusing)return;const s=n.currentCamera?.capabilities;if(!s?.focusMode?.includes("manual"))return void n._simpleFocus();const r=n._advancedFocusParameters,a=n._video.videoWidth,o=n._video.videoHeight;if(a<2||o<2)return;let l,c=0;e?(e.x=Math.round(e.x),e.y=Math.round(e.y),t||(t=Math.min(a,o)*r.focusWH),t<2&&(t=2),t>a&&(t=a),t=2*Math.round(t/2),i||(i=t),i<2&&(i=2),i>o&&(i=o),i=2*Math.round(i/2),e.x<t/2&&(e.x=t/2),e.x>a-t/2&&(e.x=a-t/2),e.y<i/2&&(e.y=i/2),e.y>o-i/2&&(e.y=o-i/2),c=e.x-t/2,l=e.y-i/2):(t=a,i=o),n._isFocusing=!0;const d=++n._advancedFocusTaskId;let h=s?.focusDistance?.min;(!h||h<r.minFocusDistanceLimit)&&(h=r.minFocusDistanceLimit);let u=s?.focusDistance?.max;(!u||u>r.maxFocusDistanceLimit)&&(u=r.maxFocusDistanceLimit);let g=-1/0,m=-1/0,p=1/0,f=u,_=!1,E=!0;const y=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});let I=0;try{for(;++I<r.maxStepCount;){let e;await n.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),_?E?(E=!1,e=r.switchStepWaitDuration):e=r.fineStepWaitDuration:E?(E=!1,e=r.firstStepWaitDuration):e=r.coarseStepWaitDuration,await new Promise(t=>setTimeout(t,e)),n.getFrame({x:c,y:l,width:t,height:i,reusedContext:y});const s=y.getImageData(0,0,t,i).data,a=Ge._getImageContrast(s,t,i);if(_){if(a<=g){await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]}),await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]});break}if(u===f)break;g=a,a>m&&(m=a,p=f),f*=r.fineTuneRate,f>u&&(f=u)}else(a<=m*r.coarseTuneTolerance||h===f)&&(_=!0),g=a,a>m&&(m=a,p=f),_?(f=Math.sqrt(f*p),E=!0):(f*=r.coarseTuneRate,f<h&&(f=h))}}catch(e){"opened"===n.status&&console.warn("Error while do advanced focus",e)}n._isFocusing=!1,r.backToContinousDuration>0&&setTimeout(async()=>{if(n._advancedFocusTaskId===d)try{await n.track.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(e){}},r.backToContinousDuration)},Object.defineProperty(Ge.prototype,"enableTapToFocus",{get(){return this._enableTapToFocus},set(e){const t=this;t._enableTapToFocus=e,e?t._tapToFocusListner||(t._tapToFocusListner=async e=>{if(!("opened"!==t.status||!t._enableTapToFocus||!e.isPrimary||e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||"touch"===e.pointerType&&t.enableGestureZoom&&(await new Promise(e=>setTimeout(e,300)),"opened"!==t.status||!t._enableTapToFocus||t._lastZoomTime>Date.now()-1e3||t._mapZoomTouchs.size>1)))if("experimental-advanced"===t._enableTapToFocus){const[{left:i,top:n},{left:s,top:r}]=t.videoXY2FixedLT([{x:0,y:0},{x:t._video.videoWidth,y:t._video.videoHeight}]);t._advancedFocus({x:(e.clientX-i)/(s-i)*t._video.videoWidth,y:(e.clientY-n)/(r-n)*t._video.videoHeight})}else t._simpleFocus()},t._coreShell.addEventListener("pointerdown",t._tapToFocusListner)):t._tapToFocusListner&&(t._coreShell.removeEventListener("pointerdown",t._tapToFocusListner),t._tapToFocusListner=null)}}),Ge._arrConstructors.push(function(){this._isTorchOn=!1,this._autoTorchParameters={shortDelay:250,longDelay:1e3,shortLongDelaySwitchCount:10,maxErrorCount:10,grayThreshold:20,maxDarkCount:3}}),Ge._arrOnClose.push(function(){this._isTorchOn=!1}),Object.defineProperty(Ge.prototype,"isSupportTorch",{get(){return!!this.currentCamera?.capabilities?.torch}}),Object.defineProperty(Ge.prototype,"isTorchOn",{get(){return this._isTorchOn}}),Ge.prototype.turnOnTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");try{await e.track.applyConstraints({advanced:[{torch:!0}]})}catch(t){throw e._isTorchOn=!1,t}e._isTorchOn=!0},Ge.prototype.turnOffTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");await e.track.applyConstraints({advanced:[{torch:!1}]}),e._isTorchOn=!1},Ge.prototype.turnAutoTorch=function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(null==e._isTorchOn)return;e._isTorchOn=void 0;const t=e._autoTorchParameters,i=document.createElement("canvas"),n=i.getContext("2d",{willReadFrequently:!0});let s=0,r=0,a=0;(async()=>{for(;null==e._isTorchOn;){try{e.getFrame({reusedContext:n})}catch(i){if("opened"===e.status&&++s<t.maxErrorCount){await new Promise(e=>setTimeout(e,1e3));continue}e._isTorchOn=!1;break}const o=n.getImageData(0,0,i.width,i.height).data;let l=0;for(let e=0;e<o.length;e+=4)l+=o[e]+o[e+1]+o[e+2];if(l/=o.length/4*3,l<t.grayThreshold&&++r>=t.maxDarkCount){try{await e.turnOnTorch(),e._eventListeners.torchAutoOn?.forEach(t=>{try{t.call(e)}catch(e){console.error(e)}})}catch(e){}break}await new Promise(e=>setTimeout(e,a<t.shortLongDelaySwitchCount?t.shortDelay:t.longDelay)),++a}})()},Ge._arrConstructors.push(function(){this._shouldCloseWhenHide=!0,this._maxReopenTry4CloseWhenHide=4}),Ge._arrOnOpen.push(function(){const e=this;e._shouldCloseWhenHide&&(e._closeWhenHideListener||(e._closeWhenHideListener=()=>{e._closeWhenHide()},document.addEventListener("visibilitychange",e._closeWhenHideListener)))}),Ge._arrBeforeClose.push(function(){const e=this;e._closeWhenHideListener&&!e._isDuringCloseWhenHide&&(document.removeEventListener("visibilitychange",e._closeWhenHideListener),e._closeWhenHideListener=null,e._isOpenBeforeHide=!1)}),Object.defineProperty(Ge.prototype,"shouldCloseWhenHide",{get(){return this._shouldCloseWhenHide},set(e){const t=this;t._shouldCloseWhenHide=e,"opened"===t.status&&(e?t._closeWhenHideListener||(t._closeWhenHideListener=()=>{t._closeWhenHide()},document.addEventListener("visibilitychange",t._closeWhenHideListener)):t._closeWhenHideListener&&(document.removeEventListener("visibilitychange",t._closeWhenHideListener),t._closeWhenHideListener=null,t._isOpenBeforeHide=!1))}}),Ge.prototype._closeWhenHide=async function(){const e=this;if("hidden"===document.visibilityState)"opened"===e.status&&(e._isDuringCloseWhenHide=!0,e._isOpenBeforeHide=!0,await e.close(),e._isDuringCloseWhenHide=!1);else if(e._isOpenBeforeHide){let t=0;for(;t++<e._maxReopenTry4CloseWhenHide&&"visible"===document.visibilityState;){try{await e.open()}catch(e){await new Promise(e=>setTimeout(e,300));continue}e._isOpenBeforeHide=!1;break}}},Ge.showFilePicker=async function(e){let t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff",t.multiple=!0;let i=new Promise(function(e){t.addEventListener("change",function(){e(Array.from(t.files))})});Object.assign(t,e);let n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});return t.dispatchEvent(n),i};let We,ze=class{camera;_ctx;_data;_dataTime=-1/0;_x;_y;_w;_h;_type;maxTimeout=500;_pipeTaskId;isSaveOriginalRgba=!1;originalRgba;constructor(e){this.camera=e;const t=document.createElement("canvas");this._ctx=t.getContext("2d",{willReadFrequently:!0})}_getData(){if("opened"!==this.camera.status)return null;this.camera.getFrame({x:this._x,y:this._y,width:this._w,height:this._h,reusedContext:this._ctx});const e=this._ctx.getImageData(0,0,this._w,this._h).data;if(this.originalRgba=this.isSaveOriginalRgba?e:null,"rgba"===this._type)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const t=new Uint8Array(e.length/4);for(let i=0;i<e.length;i+=4)t[i/4]=.3*e[i]+.59*e[i+1]+.11*e[i+2];return t}getData(e){let{x:t=0,y:i=0,width:n=this.camera._video.videoWidth,height:s=this.camera._video.videoHeight,type:r="rgba"}=e||{};if(n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i),0===n||0===s||isNaN(n)||isNaN(s))return null;const a=t!==this._x||i!==this._y||n!==this._w||s!==this._h||r!==this._type;let o;return a&&(this._x=t,this._y=i,this._w=n,this._h=s,this._type=r),!a&&this._dataTime+this.maxTimeout>Date.now()&&this._data?(o=this._data,this._data=null):o=this._getData(),this._pipeTaskId||(this._pipeTaskId=setTimeout(()=>{this._pipeTaskId=null,this._data=this._getData(),this._dataTime=Date.now()},0)),o}},je=class{_stAudioFree=new Set;_stAudioPlaying=new Set;_timeLastPlay=0;_bWarnedMaxTrack=!1;maxPlayingBeep=16;beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";beep(){if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-this._timeLastPlay<100)){if(this._timeLastPlay=t,this._stAudioFree.size&&(e=this._stAudioFree.values().next().value,this.beepSoundSource==e.src?(this._stAudioFree.delete(e),e.play()):e=null),!e)if(this._stAudioPlaying.size<this.maxPlayingBeep){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout(()=>{this._stAudioPlaying.delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,this._stAudioPlaying.delete(e),this._stAudioFree.add(e)})}else this._bWarnedMaxTrack||(this._bWarnedMaxTrack=!0,console.warn(`The requested audio tracks exceed ${this.maxPlayingBeep} and will not be played.`));e&&this._stAudioPlaying.add(e)}}};const Ye=()=>{(We??=new je).beep()},$e=(e=300)=>{if(!navigator?.vibrate)throw new Error("Not supported.");navigator.vibrate(e)},qe=Ge,Xe=Ge;if(document?.head){const e=new Blob(["@keyframes dce-scanlight{from{top:0;}to{top:97%;}}"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}qe.createInstance=async function(e){let t;if(e instanceof Ge?(t=e,e=void 0):t=new Ge,void 0===t.disposed){if(t.disposed=!1,t._cameraEnhancer=t._cameraView=t,t._framePipeline=new ze(t),t._dceScanRegion={x:0,y:0,width:100,height:100,isMeasuredInPercentage:!0},t._dceEventListeners={},t._oriOpen=t.open,t.open=Qe,t._dceZoom=1,t._dceEnhancedFeatures=0,t._dceAutoZoomRange={min:1,max:10},t._oriSetZoom=t.setZoom,t.setZoom=Ke,t.singleFrameMode="disabled",t.addImageToBuffer=t.clearBuffer=t.getBufferOverflowProtectionMode=t.getColourChannelUsageType=t.getImageCount=t.getImageFetchInterval=t.getMaxImageCount=t.hasImage=t.setBufferOverflowProtectionMode=t.setErrorListener=t.setImageFetchInterval=t.setMaxImageCount=t.setNextImageToReturn=()=>{},e??=Xe.defaultUIElementURL,e&&await t.setUIElement(e),t._dceRegionMaskStyle={lineWidth:parseFloat(t.regionBox.borderStyle.border?.split(" ")[0]),strokeStyle:t.regionBox.borderStyle.border?.split(" ")[2],fillStyle:t.regionBox.maskStyle.background},t._dceRegionMaskVisible=!0,t._dceTipDuration=3e3,t._drawingLayers=[],t._drawingLayers.length=4,t._capturedResultReceiver={onCapturedResultReceived:ft.bind(t)},!t.regionBox.innerUi){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",width:"100%",height:"3%",borderRadius:"50%",boxShadow:"0px 0px 2vw 1px #00e5ff",background:"#fff",animation:"3s infinite dce-scanlight",pointerEvents:"none",userSelect:"none",display:"none"}),t.setRegionBox({innerUi:e})}t.addEventListener("opened",function(){this._dceEventListeners.cameraOpen?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}),this._dceEventListeners.played?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});const e=t.currentCamera?.deviceId;e!==t._dceLastDeviceId&&(t._dceLastDeviceId=e,this._dceEventListeners.cameraChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}));const i=t.currentResolution;i.width===t._dceLastResolution?.width&&i.height===t._dceLastResolution?.height||(t._dceLastResolution=i,this._dceEventListeners.resolutionChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}))}),t.addEventListener("closed",function(){this._dceEventListeners.cameraClose?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}),["mousedown","mouseup","dblclick"].forEach(e=>{t._coreShell.addEventListener(e,function(e){const i=[e.clientX,e.clientY],n=t._drawingLayers.filter(e=>e?._visible).map(e=>e._drawingItems).flat(),s=t.videoXY2AbsoluteLT(n.map(e=>{if(e instanceof ut)return e.quad.points;if(e instanceof gt||e instanceof mt||e instanceof mt){let{x:t,y:i,width:n,height:s}=e.rect,r=t+n,a=i+s;return[{x:t,y:i},{x:t,y:a},{x:r,y:a},{x:r,y:i}]}return e instanceof ht?[e.line.startPoint,e.line.endPoint]:void 0}).flat()).map(e=>[e.left,e.top]);let r=0;n.forEach(t=>{let n=!1;t instanceof ut||t instanceof gt||t instanceof mt||t instanceof mt?(n=ct(i,[s[r],s[r+1],s[r+2],s[r+3]]),r+=4):t instanceof ht&&(n=ct(i,[s[r],s[r+1]]),r+=2),n&&t._dceEventListeners[e.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})})})})}return t},qe.defaultUIElementURL="@engineResourcePath/ui/dce.ui.xml";const Qe=async function(){const e=this;if("camera"===e.singleFrameMode||"image"===e.singleFrameMode){const t={multiple:!1};"camera"===e.singleFrameMode&&(t.capture="environment");const i=(await Ge.showFilePicker(t))[0],n=document.createElement("canvas"),s=n.getContext("2d"),r=URL.createObjectURL(i),a=new Image;a.src=r,await a.decode(),n.width=a.width,n.height=a.height,s.drawImage(a,0,0),URL.revokeObjectURL(r);const o=s.getImageData(0,0,n.width,n.height).data,l={bytes:new Uint8Array(o.buffer,o.byteOffset,o.length),width:n.width,height:n.height,stride:4*n.width,format:10,toCanvas:()=>n,imageTag:{imageId:++et,type:0}};return void e._dceEventListeners.singleFrameAcquired?.forEach(e=>{try{e.call(this,l)}catch(e){console.error(e)}})}const t=e.ui.querySelector(".dce-bg-loading");t&&(t.style.display="");try{await e._oriOpen()}catch(e){throw qe.onWarning&&qe.onWarning(e?.message),e}return t&&(t.style.display="none"),await new Promise(e=>setTimeout(e,0)),{deviceId:e.currentCamera?.deviceId,...e.currentResolution}};qe.prototype.dispose=function(){this.disposed=!0,this.close(),this.setScanLaserVisible(!1)},qe.prototype.getAllCameras=async function(){return(await Ge.getDeviceInfos()).map(e=>({deviceId:e.deviceId,label:e.label}))},qe.prototype.getAvailableResolutions=async function(){const e=this,t=[];await e._oriOpen();for(let i of[[160,120],[320,240],[480,360],[640,480],[800,600],[960,720],[1280,720],[1920,1080],[2560,1440],[3840,2160]])await e.requestResolution(i),(e.currentResolution?.width===i[0]&&e.currentResolution?.height===i[1]||e.currentResolution?.width===i[1]&&e.currentResolution?.height===i[0])&&t.push({width:i[0],height:i[1]});return await e.close(),t},qe.prototype.getCameraStatus=function(){let e=this.status;return"closing"!==e&&"paused"!==e||(e="closed"),e},qe.prototype.getResolution=function(){return"opened"===this.status?this.currentResolution:this.requestedResolution},qe.prototype.getSelectedCamera=function(){return"opened"===this.status?{deviceId:this.currentCamera?.deviceId,label:this.currentCamera?.label}:null},qe.prototype.getVideoSettings=function(){let e="string"==typeof this.requestedCamera?{video:!0}:this.requestedCamera;return Object.assign(e,this.requestedResolution),e},Object.defineProperty(qe.prototype,"ifSkipCameraInspection",{get(){return"quick-back"===this.requestedCamera},set(e){e?this.requestCamera("quick-back"):this.requestCamera("back")}}),qe.prototype.isOpen=function(){return"opened"===this.status},qe.prototype.isPaused=function(){return"paused"===this.status},qe.prototype.resume=async function(){await this._oriOpen()},qe.prototype.selectCamera=async function(e){return await this.requestCamera("string"==typeof e?e:e.deviceId),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},qe.prototype.setResolution=async function(e){return await this.requestResolution(e),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},qe.testCameraAccess=async function(){let e,t=!0;try{await Ge.getDeviceInfos()}catch(i){t=!1,e=i.message||i}return{ok:t,message:e}},qe.prototype.updateVideoSettings=async function(e){await this.requestCamera(e)},Object.defineProperty(qe.prototype,"videoSrc",{get(){return this._dceVideoSrc},set(e){const t=this;t._dceVideoSrc=e,e?(t.video.src=e,t.requestCamera("customized-video")):(t.video.src="",t.requestCamera(void 0))}}),qe.prototype.disableEnhancedFeatures=function(e){this._dceEnhancedFeatures=this._dceEnhancedFeatures-(this._dceEnhancedFeatures&e)},qe.prototype.enableEnhancedFeatures=function(e){this._dceEnhancedFeatures|=e},qe.prototype.getCameraSettings=function(){return this.track.getSettings()},qe.prototype.getCapabilities=function(){return this.track.getCapabilities()},qe.prototype.getColorTemperature=function(){return this.track?.getSettings()?.colorTemperature},qe.prototype.getExposureCompensation=function(){return this.track?.getSettings()?.exposureCompensation},qe.prototype.getFrameRate=function(){return this.track?.getSettings()?.frameRate},qe.prototype.setColorTemperature=function(e){this.track?.applyConstraints?.({advanced:[{colorTemperature:{ideal:e}}]})},qe.prototype.setExposureCompensation=function(e){this.track?.applyConstraints?.({advanced:[{exposureCompensation:{ideal:e}}]})},qe.prototype.setFrameRate=function(e){this.track?.applyConstraints?.({advanced:[{frameRate:{ideal:e}}]})},qe.prototype.getZoomSettings=function(){return{factor:this._dceZoom}};const Ke=async function(e){const t=this;if("number"==typeof e)return void await t._oriSetZoom(e);let i,n=e.factor;try{i=t.getZoomRange().max}catch(e){i=null}i?n<i?(await t._oriSetZoom(n),t.setSoftZoom(1)):(await t._oriSetZoom(i),t.setSoftZoom(n/i)):t.setSoftZoom(n),t._dceZoom=n};function Je(e,t,i,n){const s=document.createElement("canvas");s.width=t,s.height=i;const r=s.getContext("2d");if(10!==n){let n=new Uint8Array(t*i*4);for(let t=0;t<e.length;++t){let i=4*t;n[i+2]=n[i+1]=n[i]=e[t],n[i+3]=255}e=n}const a=new Uint8ClampedArray(e),o=new ImageData(a,t,i);return r.putImageData(o,0,0),s}qe.prototype.resetZoom=function(){this.setZoom(1),this.setSoftZoom(1,{center:{x:0,y:0}})},qe.prototype.getFocusSettings=function(){return this._dceFocusSettings},qe.prototype.setFocus=async function(e){const t=this;if(t._dceFocusSettings=e,"manual"!==e.mode)await t.track.applyConstraints({advanced:[{focusMode:e.mode}]});else if(e.distance)await t.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:e.distance}]});else{let{x:i,y:n}=e.area.centerPoint,s=e.area.width,r=e.area.height,a=t.currentResolution.width,o=t.currentResolution.height;"string"==typeof i&&(i=i.endsWith("%")?parseFloat(i)*a:parseFloat(i)),"string"==typeof n&&(n=n.endsWith("%")?parseFloat(n)*o:parseFloat(n)),"string"==typeof s&&(s=s.endsWith("%")?parseFloat(s)*a:parseFloat(s)),"string"==typeof r&&(r=r.endsWith("%")?parseFloat(r)*o:parseFloat(r)),await t._advancedFocus({x:i,y:n},s,r)}},qe.prototype.setAutoZoomRange=function(e){this._dceAutoZoomRange=e},qe.prototype.getAutoZoomRange=function(){return this._dceAutoZoomRange};let et=0;qe.prototype.fetchImage=qe.prototype.getImage=qe.prototype.takePhoto=function(){const e=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),t=2!=this._pixelFormat,i=this._framePipeline.getData({...e,type:t?"rgba":"gray"});if(!i)return null;this._dceEventListeners.frameAddedToBuffer?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});let{width:n,height:s}=e,r=t?10:2;return{bytes:i,width:n,height:s,stride:e.width*(t?4:1),format:r,toCanvas:()=>Je(i,n,s,r),imageTag:{imageId:++et,type:1}}},Object.defineProperty(qe.prototype,"singleFrameMode",{get(){return this._singleFrameMode},set(e){const t=this;t._singleFrameMode=e;const i=t.ui.querySelector(".dce-bg-camera");i&&("disabled"!==e?(t._singleFrameModeClickCallback||(t._singleFrameModeClickCallback=()=>{t.open()},i.addEventListener("click",t._singleFrameModeClickCallback)),i.style.display=""):(t._singleFrameModeClickCallback&&(i.removeEventListener("click",t._singleFrameModeClickCallback),t._singleFrameModeClickCallback=null),i.style.display="none"))}}),qe.prototype.getScanRegion=function(){return this._dceScanRegion},qe.prototype.hasNextImageToFetch=function(){return"opened"===this.status},qe.prototype.isBufferEmpty=function(){return"opened"!==this.status},qe.prototype.setColourChannelUsageType=function(e){},qe.prototype.startFetching=function(){},qe.prototype.setPixelFormat=function(){return this._pixelFormat},qe.prototype.setPixelFormat=function(e){this._pixelFormat=e},qe.prototype.setScanRegion=function(e){this._dceScanRegion=e;const t=this._dceRegionMaskVisible,i=this._dceRegionMaskStyle;if(e.isMeasuredInPercentage)if(void 0!==e.x){let n=e;this.setRegionBox({width:n.width/100,height:n.height/100,center:{x:(n.x+n.width/2-50)/100,y:(n.y+n.height/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=e;this.setRegionBox({width:(n.right-n.left)/100,height:(n.bottom-n.top)/100,center:{x:((n.left+n.right)/2-50)/100,y:((n.top+n.bottom)/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=this.video.videoWidth||720,s=this.video.videoHeight||1280;if(void 0!==e.x){let r=e;this.setRegionBox({width:Math.min(r.width/n,1),height:Math.min(r.height/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let r=e;this.setRegionBox({width:Math.min((r.right-r.left)/n,1),height:Math.min((r.bottom-r.top)/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}}},qe.prototype.stopFetching=function(){},qe.prototype.setCameraView=function(e){if(e===this)return;const t=e.ui.parentElement;e.ui.parentElement&&(e.ui.remove(),t.append(this.ui));let i=[];for(let t in e)"function"==typeof e[t]&&i.push(t);for(let t of i)e[t]=this[t].bind(this)},qe.prototype.getCameraView=function(){return this},qe.prototype.getVideoEl=function(){return this.video},qe.prototype.convertToPageCoordinates=function(e){return this.videoXY2AbsoluteLT([e]).map(e=>({x:e.left,y:e.top}))[0]},qe.prototype.convertToClientCoordinates=function(e){return this.videoXY2FixedLT([e]).map(e=>({x:e.left,y:e.top}))[0]},qe.prototype.convertToScanRegionCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY({isConsiderRegionBox:!0});if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},qe.prototype.convertToContainCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY();if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},qe.prototype.on=function(e,t){(this._dceEventListeners[e]??=new Set).add(t)},qe.prototype.off=function(e,t){this._dceEventListeners[e]?.delete(t)},Xe.prototype.getUIElement=function(){return this.ui},Xe.prototype.setUIElement=async function(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if(e instanceof HTMLElement&&!e.childElementCount)return await this.setUIElement(Xe.defaultUIElementURL),e.append(this.getUIElement()),void(this.ui=e);if("string"==typeof e){let t=e.trim();if(!t.trimStart().startsWith("<")){if(t.includes("@engineResourcePath/")){const e=qe.handleEngineResourcePaths(qe.CoreModule.engineResourcePaths);t=t.replace("@engineResourcePath/","DBR"===qe.CoreModule._bundleEnv?e.dbrBundle:e.dcvData)}t=await fetch(t).then(e=>e.text()),t=t.trim()}if(!t.startsWith("<"))throw Error("Invalid html string.");if(t.startsWith("<template>")&&(t=t.substring(10,t.length-11).trim()),!t.startsWith("<"))throw Error("Invalid html string.");let i,n=Ne(t,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet});if(n instanceof HTMLElement)i=n;else{if(!(n instanceof DocumentFragment))throw Error("Seems no HTMLElement.");i=document.createElement("div"),Object.assign(i.style,{width:"100%",height:"100%"}),i.append(n)}e=i,Object.defineProperty(e,"shadowRoot",{value:e,writable:!0})}if(!(e instanceof HTMLElement))throw Error("Invalid html string.");const t="dm-camera-core-container";let i=e.classList.contains(t)?e:e.querySelector(`.${t}`);if(!i){const n="dce-video-container";i=e.classList.contains(n)?e:e.querySelector(`.${n}`),i&&(e.style.overflow="hidden",e.querySelector("select.dce-sel-camera")?.remove(),e.querySelector("select.dce-sel-resolution")?.remove(),i.classList.add(t))}i||e.classList.add(t),this.ui=e},Xe.prototype.getVideoElement=function(){return this.video},Xe.prototype.setVideoFit=function(e){this.objectFit=e},Xe.prototype.getVideoFit=function(){return this.objectFit},Xe.prototype.getVisibleRegionOfVideo=function(e){let{inPixels:t}=e||{inPixels:!1};const i=this.getVisibleAreaInVideoXY();if(t)return{...i,isMeasuredInPercentage:!1};{let{width:e,height:t}=this.currentResolution;return{x:i.x/e*100,y:i.y/t*100,width:i.width/e*100,height:i.height/t*100,isMeasuredInPercentage:!0}}},Xe.prototype.setScanRegionMaskStyle=function(e){const t=this._dceRegionMaskVisible;this._dceRegionMaskStyle={...e},this.setRegionBox({maskStyle:{background:t?e.fillStyle:""},borderStyle:{border:t?`${e.lineWidth}px solid ${e.strokeStyle}`:""}})},Xe.prototype.getScanRegionMaskStyle=function(){return this._dceRegionMaskStyle},Xe.prototype.setScanRegionMaskVisible=function(e){this._dceRegionMaskVisible=e;const t=this._dceRegionMaskStyle;this.setRegionBox({maskStyle:{background:e?t.fillStyle:""},borderStyle:{border:e?`${t.lineWidth}px solid ${t.strokeStyle}`:""}})},Xe.prototype.isScanRegionMaskVisible=function(){return this._dceRegionMaskVisible},Xe.prototype.setScanLaserVisible=function(e){const t=this.regionBox.innerUi.style;t.display=e?"":"none",setTimeout(()=>{t.display="none",e&&(t.display="")},0)},Xe.prototype.isScanLaserVisible=function(){return"none"!==this.regionBox.innerUi.style.display},Xe.prototype.setPowerByMessageVisible=function(e){let t=this.ui.querySelector("dce-msg-poweredby,dm-camera-mn-msg-poweredby");t&&(e?"none"!==t.style.display&&(t.style.display=""):t.style.display="none")},Xe.prototype.isPowerByMessageVisible=function(){let e=this.ui.querySelector("dce-msg-poweredby");return e&&"none"!==e.style.display},Xe.prototype.getTipConfig=function(){return{duration:this._dceTipDuration}},Xe.prototype.setTipConfig=function(e){this._dceTipDuration=e.duration},Xe.prototype.setTipVisible=function(e){if(e)this.funcShowToast?.(this._dceTipMessage,this._dceTipDuration);else{const e=this.ui.querySelector(".dm-camera-mn-toast");e&&(e.style.display="none")}},Xe.prototype.isTipVisible=function(){const e=this.ui.querySelector(".dm-camera-mn-toast");return!!e&&"none"!=e.style.display},Xe.prototype.updateTipMessage=function(e){this._dceTipMessage=e},Xe.prototype.createDrawingLayer=function(){const e=new lt;return e._ctx=this.addCanvas().getContext("2d"),this._drawingLayers.push(e),e},Xe.prototype.getDrawingLayer=function(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=new lt,t._ctx=this.addCanvas().getContext("2d"),this._drawingLayers[e]=t,1===e?t._defaultStyle=ot.STYLE_BLUE_STROKE:2===e?t._defaultStyle=ot.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=ot.STYLE_GREEN_STROKE_FILL)),t},Xe.prototype.getAllDrawingLayers=function(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)},Xe.prototype.clearUserDefinedDrawingLayers=function(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4},Xe.prototype.deleteUserDefinedDrawingLayer=function(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])},Xe.prototype.clearAllInnerDrawingItems=function(){for(let e of this._drawingLayers.slice(1,4))e?.clearDrawingItems()};let tt=class{static _beepInstance;static beep(){null!=this._beepInstance?this._beepInstance.beep():Ye()}static get beepSoundSource(){return this._beepInstance?.beepSoundSource}static set beepSoundSource(e){this._beepInstance??=new je,this._beepInstance.beepSoundSource=e}static vibrate(){null!=this.vibrateDuration?$e(this.vibrateDuration):$e()}static vibrateDuration};const it="73,245,73",nt="73,173,245",st="254,180,32",rt="245,236,73",at=(e,t)=>{let i,n;return"f"===t?(i="strokeAndFill",n="0.3"):"t"===t?(i="fill",n="0.2"):(i="stroke",n="0.3"),{lineWidth:2,fillStyle:`rgba(${e},${n})`,strokeStyle:`rgba(${e},0.9)`,fontFamily:"consolas",fontSize:40,paintMode:i}},ot={STYLE_GREEN_STROKE:at(it),STYLE_GREEN_STROKE_FILL:at(it,"f"),STYLE_GREEN_STROKE_TRANSPARENT:at(it,"t"),STYLE_BLUE_STROKE:at(nt),STYLE_BLUE_STROKE_FILL:at(nt,"f"),STYLE_BLUE_STROKE_TRANSPARENT:at(nt,"t"),STYLE_ORANGE_STROKE:at(st),STYLE_ORANGE_STROKE_FILL:at(st,"f"),STYLE_ORANGE_STROKE_TRANSPARENT:at(st,"t"),STYLE_YELLOW_STROKE:at(rt),STYLE_YELLOW_STROKE_FILL:at(rt,"f"),STYLE_YELLOW_STROKE_TRANSPARENT:at(rt,"t"),createDrawingStyle(e){let t=Object.assign({},this.STYLE_YELLOW_STROKE_FILL,e);return Object.assign(e,t),e},getDrawingStyle(e){return"number"==typeof e?this.STYLE_GREEN_STROKE:e},getAllDrawingStyles:()=>[],updateDrawingStyle(e,t){Object.keys(e).forEach(t=>{delete e[t]}),Object.assign(e,t)}};let lt=class{_visible=!0;_ctx;_defaultStyle=ot.STYLE_YELLOW_STROKE_FILL;_drawingItems=[];_mode="viewer";_renderTask;getId(){return this}isVisible(){return this._visible}setVisible(e){this._visible=e;const t=this._ctx;if(!t)return;const i=t.canvas;t.clearRect(0,0,i.width,i.height)}setDefaultStyle(e,t,i){this._defaultStyle=ot.getDrawingStyle(e),this._delayRenderAll()}addDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=this._drawingItems.concat(e),this._delayRenderAll()}removeDrawingItems(e){this._drawingItems=this._drawingItems.filter(t=>!e.includes(t))}setDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=[...e],this._delayRenderAll()}getDrawingItems(e){return this._drawingItems.filter(t=>!e||e(t))}hasDrawingItem(e){return this._drawingItems.includes(e)}clearDrawingItems(){this._drawingItems=[],this._delayRenderAll()}_delayRenderAll(){this._renderTask||(this._renderTask=setTimeout(()=>{this.renderAll(),this._renderTask=null},0))}renderAll(){if(!this._visible||!this._ctx)return;const e=this._ctx,t=e.canvas;e.clearRect(0,0,t.width,t.height);for(let t of this._drawingItems){const i=ot.getDrawingStyle(t.drawingStyleId||this._defaultStyle);if(t instanceof mt){e.font=`${i.fontSize}px ${i.fontFamily}`;const{x:n,y:s,width:r,height:a}=t.rect;e.fillText(t.text,n,s,r)}else if(t instanceof pt){const i=t.image,n=i.naturalWidth||i.videoWidth||i.width||0,s=i.naturalHeight||i.videoHeight||i.height||0;if(!n||!s)continue;let{x:r,y:a,width:o,height:l}=t.rect;t.maintainAspectRatio&&(l=o/n*s),e.drawImage(i,r,a,o,l)}else{if(e.fillStyle=i.fillStyle,e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,e.setLineDash([]),t._bSelected&&(e.strokeStyle="#0f0",e.lineWidth=4,e.setLineDash([4,4])),e.beginPath(),t instanceof ut){const i=t.quad.points;e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.lineTo(i[3].x,i[3].y)}else if(t instanceof ht){const i=t.line.startPoint,n=t.line.endPoint;e.moveTo(i.x,i.y),e.lineTo(n.x,n.y)}else if(t instanceof gt){const{x:i,y:n,width:s,height:r}=t.rect;e.moveTo(i,n),e.lineTo(i+s,n),e.lineTo(i+s,n+r),e.lineTo(i,n+r)}i.paintMode.toLowerCase().includes("fill")&&e.fill(),e.closePath(),i.paintMode.toLowerCase().includes("stroke")&&e.stroke()}}}getMode(){return this._mode}setMode(e){}};function ct(e,t){const[i,n]=e;let s=!1;for(let e=0,r=t.length-1;e<t.length;r=e++){const[a,o]=t[e],[l,c]=t[r];if((i-a)*(n-o)==(i-l)*(n-c))return!0;o>n!=c>n&&i<(l-a)*(n-o)/(c-o)+a&&(s=!s)}return s}let dt=class{coordinateBase="image";drawingLayerId;drawingStyleId;mediaType;_state=Et.DIS_DEFAULT;_notes=[];_bSelected=!1;_dceEventListeners={};getState(){return this._state}addNote(e,t){if(t){let t=!1;for(let i=0;i<this._notes.length;++i)this._notes[i].name===e.name&&(this._notes.splice(i,1,e),t=!0);t||this._notes.push(e)}else this._notes.push(e)}getNote(e){for(let t of this._notes)if(e===t.name)return t;return null}getNotes(){return[...this._notes]}hasNote(e){for(let t of this._notes)if(e===t.name)return!0;return!1}updateNote(e,t,i){for(let n of this._notes)e===n.name&&(i&&"object"==typeof n.content&&"object"==typeof t?n.content={...n.content,content:t}:n.content=t)}deleteNote(e){this._notes=this._notes.filter(t=>t.name!==e)}clearNotes(){this._notes=[]}_delayRenderAll(){this.drawingLayerId?._delayRenderAll()}_setSelected(e){this._bSelected=e,this._delayRenderAll()}on(e,t){(this._dceEventListeners[e]??=new Set).add(t)}off(e,t){this._dceEventListeners[e]?.delete(t)}},ht=class extends dt{line;constructor(e,t){super(),this.mediaType=_t.DIMT_LINE,this.line=e,this.drawingStyleId=t}getLine(){return this.line}setLine(e){this.line=e,this._delayRenderAll()}},ut=class extends dt{quad;constructor(e,t){super(),this.mediaType=_t.DIMT_QUADRILATERAL,this.quad=e,this.drawingStyleId=t}getQuad(){return this.quad}setQuad(e){this.quad=e,this._delayRenderAll()}},gt=class extends dt{rect;constructor(e,t){super(),this.mediaType=_t.DIMT_RECTANGLE,this.rect=e,this.drawingStyleId=t}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},mt=class extends dt{text;rect;constructor(e,t,i){super(),this.mediaType=_t.DIMT_TEXT,this.text=e,this.rect=t,this.drawingStyleId=i}getText(){return this.text}setText(e){this.text=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},pt=class extends dt{image;rect;maintainAspectRatio;constructor(e,t,i,n){super(),this.mediaType=_t.DIMT_IMAGE,e.bytes&&e.format&&(e=Je(e.bytes,e.width,e.height,e.format)),this.image=e,this.rect=t,this.maintainAspectRatio=i,this.drawingStyleId=n}getImage(){return this.image}setImage(e){this.image=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}};const ft=function(e,t){if(this.disposed)return;this.clearAllInnerDrawingItems();const i=e?.items;if(!i?.length)return;const n=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),s=n.x,r=n.y;for(let e of i){let i,n,a;switch(e.type){case 2:i=this.getDrawingLayer(2),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isBarcodeVerifyOpen&&!e.verified&&(a=ot.STYLE_ORANGE_STROKE_TRANSPARENT);break;case 4:i=this.getDrawingLayer(3),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isLabelVerifyOpen&&!e.verified&&(a=ot.STYLE_GREEN_STROKE_TRANSPARENT);break;case 8:i=this.getDrawingLayer(1),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isDetectVerifyOpen&&1!==e.crossVerificationStatus&&(a=ot.STYLE_BLUE_STROKE_TRANSPARENT);break;case 16:i=this.getDrawingLayer(1),n=e.sourceLocation.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isNormalizeVerifyOpen&&1!==e.crossVerificationStatus&&(a=ot.STYLE_BLUE_STROKE_TRANSPARENT);break;default:continue}i.addDrawingItems([new ut({points:n})],a)}};var _t,Et,yt,It;!function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(_t||(_t={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(Et||(Et={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(yt||(yt={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(It||(It={}));let Rt=function(){let e=this,t=1e5,i=function(e,t,i){return new Promise(function(n){if(e.toBlob)e.toBlob(function(e){n(e)},t,i);else{let s=e.toDataURL(t,i),r=Ct.convertBase64ToBlob(s.substring(s.indexOf(",")+1),t);n(r)}})},n=Rt._doCallbackNoBreak,s=Ne(['<div style="width:100%;height:100%;border:1px solid #ccc;">','<div class="kPainterBox">','<div class="kPainterImgsDiv">','<canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas>',"</div",'><div class="kPainterCroper" style="width:50px;height:50px;display:none;">','<div class="kPainterCells">',"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","</div",'><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div','><div class="kPainterEdges">','<div data-orient="-1,0"></div','><div data-orient="0,-1"></div','><div data-orient="1,0"></div','><div data-orient="0,1"></div>',"</div",'><div class="kPainterCorners">','<div data-orient="-1,-1"><i></i></div','><div data-orient="1,-1"><i></i></div','><div data-orient="1,1"><i></i></div','><div data-orient="-1,1"><i></i></div>',"</div",'><div class="kPainterMover" data-orient="0,0">',"<div></div>",'<svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg>',"</div>","</div",'><div class="kPainterPerspect" style="display:none;">','<canvas class="kPainterPerspectCvs"></canvas','><div class="kPainterPerspectCorner" data-index="0"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="1"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="2"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="3"><canvas style="display:none"></div>',"</div",'><div class="kPainterGesturePanel"></div>',"</div>","</div>"].join("")),r=s.firstChild,a=r.querySelector(".kPainterImgsDiv > .kPainterCanvas");e.getHtmlElement=function(){return s};let o=-1,l=[],c=null,d=null,h=!1,u="view";e.getCurIndex=function(){return o},e.getCount=function(){return l.length},e.isEditing=function(){return h},e.getMode=function(){return u},e.getImage=function(e,t){if(null==t&&(t=o),isNaN(t))return;if((t=Math.round(t))<0||t>=l.length)return;let i;return e?i=l[t]:(i=document.createElement("img"),i.src=l[t].src,i.setAttribute("style","")),i},e.onStartLoading=null,e.onFinishLoading=null;let g=function(){n(e.onStartLoading)},m=function(){n(e.onFinishLoading)},p=new function(){let s=this,a=new Mt,c=e.addImage=function(e){return new Promise(function(t,i){if(h)return i(Error("`addImage(imgData)`: The function is only valid in `view` mode."));if(e instanceof Blob);else if(e instanceof HTMLCanvasElement);else if("string"==typeof e||e instanceof String);else if(!(e instanceof HTMLImageElement)){if(e instanceof Array||e instanceof FileList){let n=[],s=!1;for(let r=0;r<e.length;++r)c(e[r]).then(function(i){n.push(i),s=!0,n.length==e.length&&t(n)},function(r){n.push(r),n.length==e.length&&(s?t(n):(Error("`addImage(imgData)`: No img added in this array. Get more info in `<this error object>.addImgErrArr`.").addImgErrArr=n,i(Error("`addImage(imgData)`: No img added in this array."))))});return}return i(Error("`addImage(imgData)`: Type of `imgData` should be `Blob`, `HTMLCanvasElement`, `HTMLImageElement`, `String(url)`, `Array(a array of source)`, `FileList`."))}g(),a.push(d,null,[e,function(e){"string"!=typeof e?t(e):i(Error("`addImage(imgData)`: "+e)),a.next(),a.isWorking||m()}])})},d=function(e,t){u(e,function(e,i){e instanceof Blob?n(function(){_(e,i,t)}):t(e)})},u=s.getBlobAndFormatFromAnyImgData=function(e,t){let n=function(e){t(e,"image/png")};if(e instanceof Blob)n(e);else if(e instanceof HTMLCanvasElement)i(e).then(n);else if("string"==typeof e||e instanceof String){let i=e;if("data:"==i.substring(0,5)){let e="";"image/"==i.substring(5,11)&&(e=i.substring(5,i.indexOf(";",11)));let t=Ct.convertBase64ToBlob(i.substring(i.indexOf("base64,")+7),e);n(t)}else Ct.convertURLToBlob(i,function(e){e?n(e):t("Network error.")})}else if(e instanceof HTMLImageElement){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)return void t("Cors error.");let s=e.src;u(s,function(r,a){if(r instanceof Blob)t(r,a);else{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0);let r,a="",o=s.lastIndexOf("?"),l=-1;-1!=o?(l=s.lastIndexOf(".",o),-1!=l&&o-l<=5&&(a=s.substring(l+1,o))):(l=s.lastIndexOf("."),-1!=l&&(a=s.length-l<=5?s.substring(l+1):s.substring(l+1,l+5))),r=-1!=a.indexOf("webp")?"image/webp":-1!=a.indexOf("png")||-1!=a.indexOf("gif")||-1!=a.indexOf("svg")?"image/png":"image/jpeg",i(t,r).then(n)}})}else t("Type of `imgData` not support.")};e.addedImageMaxWH=4096,e.isShowNewImgWhenAdd=!0;let p,_=function(t,n,s){let a=new Image;a.kPainterOriBlob=a.kPainterBlob=t,a.kPainterSaveFormat=n;let c=URL.createObjectURL(a.kPainterBlob);a.onload=a.onerror=function(){if(e._noAnyUseButForIosSafariBug0=a.naturalWidth,e._noAnyUseButForIosSafariBug1=a.naturalHeight,a.kPainterWidth=a.naturalWidth,a.kPainterHeight=a.naturalHeight,a.kPainterOriWidth=a.kPainterWidth,a.kPainterOriHeight=a.kPainterHeight,a.kPainterWidth>e.addedImageMaxWH||a.kPainterHeight>e.addedImageMaxWH)i(function(e,t,i){t=t||new Ct.Matrix(1,0,0,1,0,0);let n=document.createElement("canvas"),s=!1;0!=t.a*t.d&&0==t.b*t.c?(n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height):(s=!0,n.width=e.naturalHeight||e.height,n.height=e.naturalWidth||e.width);let r=1;(n.width>i||n.height>i)&&(r=i/Math.max(n.width,n.height),n.width=Math.min(n.width*r),n.height=Math.min(n.height*r));let a=n.getContext("2d");return a.setTransform(t.a,t.b,t.c,t.d,t.e*n.width,t.f*n.height),s?a.drawImage(e,0,0,n.height,n.width):a.drawImage(e,0,0,n.width,n.height),n}(a,null,e.addedImageMaxWH),n).then(function(e){URL.revokeObjectURL(c),a.kPainterOriBlob=a.kPainterBlob=e,c=URL.createObjectURL(a.kPainterBlob),a.src=c});else{a.onload=a.onerror=null,r.querySelector(".kPainterImgsDiv").append(a),(e.isShowNewImgWhenAdd||-1==o)&&R(l.length-1);try{!function(){for(let e=0;e<d.length;++e){let t=d[e].cvs,i=d[e].mwh,n=Math.min(i/a.naturalWidth,i/a.naturalHeight,1);t.width=Math.round(a.naturalWidth*n),t.height=Math.round(a.naturalHeight*n),t.getContext("2d").drawImage(a,0,0,t.width,t.height)}}()}catch(e){setTimeout(function(){throw e},0)}s&&s(l.length-1)}};let d=[];try{!function(){for(let e=0;e<w.length;++e){let t=w[e],i=t.kPainterFunWrap,n=document.createElement("canvas");n.className="kPainterThumbnailCanvas",d.push({cvs:n,mwh:t.kPainterMaxWH});let s=null;try{s=i?i(n):n}catch(e){setTimeout(function(){throw e},0);break}s&&(s.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(s),t.appendChild(s))}}()}catch(e){setTimeout(function(){throw e},0)}a.style.display="none",l.push(a),a.src=c},E=function(){let i=l[o],s=r;vt(s);let a=Tt(s),c=i.kPainterZoom=Math.min(a.width/i.kPainterWidth,a.height/i.kPainterHeight);if(i.style.width=(Math.round(i.kPainterWidth*c)||1)+"px",i.style.height=(Math.round(i.kPainterHeight*c)||1)+"px",i.style.left=i.style.right=i.style.top=i.style.bottom="-100000px",l.length>=2){let e=l[(l.length+o-1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.right=t+"px",e.style.left=e.style.top=e.style.bottom="-100000px"}if(l.length>=3){let e=l[(l.length+o+1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.left=t+"px",e.style.right=e.style.top=e.style.bottom="-100000px"}n(e.onUpdateImgPosZoom)},y=null,I=null;e.updateUIOnResize=function(t){if(null!=y&&(clearTimeout(y),y=null,I()),t)return new Promise(function(t,i){p=h,y=setTimeout(function(){if(-1==o)y=null,t();else if(p!=h)y=null,t();else{if(h){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();y=null,t()}},500),I=i});if(-1!=o){if(h){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();return!0}return!1};let R=s.showImg=function(t){let i=l[t];i.parentElement.childNodes.forEach(function(e){e.style.display="none"}),o=t,i.style.display="",l.length>=2&&(t>0||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t-1)%l.length].style.display=""),l.length>=3&&(t<l.length-1||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t+1)%l.length].style.display=""),E(),C()};e.onNumChange=null;let C=function(){let t,i;return function(){t==o&&i==l.length||(t=o,i=l.length,n(e.onNumChange,[o,l.length]))}}();e.changePage=function(e){if(h)return!1;let t;switch(e){case"f":t=0;break;case"p":t=o-1;break;case"n":t=o+1;break;case"l":t=l.length-1;break;default:if(arguments.length<1||isNaN(e))return!1;t=Math.round(e)}return!(t<0||t>=l.length||t==o||(R(t),0))},e.movePage=function(){if(h)return!1;let e,t;if(1==arguments.length?t=arguments[0]:arguments.length>=2&&(e=arguments[0],t=arguments[1]),null==e&&(e=o),isNaN(t))return!1;if(t=Math.round(t),t<0||t>l.length)return!1;if(isNaN(e))return!1;if(e=Math.round(e),e<0||e>=l.length)return!1;if(e==t)return!0;let i=l.splice(e,1)[0];t>e?l.splice(t-1,0,i):l.splice(t,0,i),e==o?o=t>e?t-1:t:e<o&&t>o?--o:e>o&&t<o&&++o,C();try{for(let i=0;i<w.length;++i){let n=w[i],s=n.kPainterThumbBoxArr[e];n.kPainterThumbBoxArr.length==t?n.append(s):n.kPainterThumbBoxArr[t].before(s),n.kPainterThumbBoxArr.splice(e,1),t>e?n.kPainterThumbBoxArr.splice(t-1,0,s):n.kPainterThumbBoxArr.splice(t,0,s)}}catch(e){setTimeout(function(){throw e},0)}return!0},e.del=function(e){if(h)return!1;if(arguments.length<1&&(e=o),isNaN(e))return!1;if((e=Math.round(e))<0||e>=l.length)return!1;URL.revokeObjectURL(l[e].src),l[e].remove(),l.splice(e,1);try{for(let t=0;t<w.length;++t){let i=w[t];i.kPainterThumbBoxArr[e].remove(),i.kPainterThumbBoxArr.splice(e,1)}}catch(e){setTimeout(function(){throw e},0)}return e<o?(--o,C()):e==o?(o==l.length&&--o,o>=0?R(o):C()):C(),!0},e.getWidth=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterWidth},e.getHeight=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterHeight},e.getBlob=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?null:l[e].kPainterBlob};let w=s.thumbnailBoxArr=[];e.bindThumbnailBox=function(t,i,n){if(h)return!1;if(!(t instanceof HTMLElement))return!1;e.unbindThumbnailBox(t),t.innerHTML="",t.kPainterFunWrap=i,t.kPainterMaxWH=n||256,t.kPainterThumbBoxArr=[];for(let n=0;n<l.length;++n){let s=l[n];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r=Math.min(t.kPainterMaxWH/s.naturalWidth,t.kPainterMaxWH/s.naturalHeight,1),a=document.createElement("canvas");a.width=Math.round(s.naturalWidth*r),a.height=Math.round(s.naturalHeight*r),a.getContext("2d").drawImage(s,0,0,a.width,a.height),a.className="kPainterThumbnailCanvas";let o=null;try{o=i?i(a):a}catch(e){return setTimeout(function(){throw e},0),!1}o&&(o.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(o),t.appendChild(o))}return w.push(t),!0},e.unbindThumbnailBox=function(e){if(h)return!1;if(e){for(let t=0;t<w.length;++t)if(w[t]==e)return e.innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0,w.splice(t,1),!0;return!1}for(let t=0;t<w.length;++t)(e=w[t]).innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0;return w.length=0,!0}},f=new function(){let i,s,u,g,m,f=Number.NEGATIVE_INFINITY;e.leftDoubleClickZoomRate=2,e.rightDoubleClickZoomRate=.5;let _,y,I,R,C,w,v,T,S,D,M,b,L,A,O,x,N,P,k=function(t){if(-1==o)return;let n,a=t.targetTouches;if(a){if(a.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";a=[{pageX:t.clientX,pageY:t.clientY}],n=t.buttons}if(1==a.length){_=s=a[0].pageX,y=u=a[0].pageY,F();let t=f;f=(new Date).getTime();let o=i;if(i=n||(Math.abs(x-N)/N<.01?1:2),f-t<1e3&&i==o&&(1==i||2==i)&&Math.abs(a[0].pageX-g)<8&&Math.abs(a[0].pageY-m)<8){f=Number.NEGATIVE_INFINITY;let t=_,n=y,s=x,r=1==i?e.leftDoubleClickZoomRate:e.rightDoubleClickZoomRate;x*=r,x>4&&(x=4,r=4/s),x<N&&(x=N,r=N/s);let a=A+T.pageX0+T.width/2,o=O+T.pageY0+T.height/2;A-=(r-1)*(t-a),O-=(r-1)*(n-o),U()}if(null!=c)return;c="posZoom",r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),P=a[0].identifier}else if(2==a.length){if(_=s=a[0].pageX,y=u=a[0].pageY,null==c&&(c="posZoom"),"posZoom"!=c)return;F(),r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),C=a[1].pageX,w=a[1].pageY,I=(_+C)/2,R=(y+w)/2,v=Math.sqrt(Math.pow(_-C,2)+Math.pow(y-w,2))}else 0==a.length&&(g=_,m=y,B())};e.allowedTouchMoveSwitchImgOverBoundary=!0;let B=function(){if(-1!=o&&"posZoom"==c){if(d=null,c=null,r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="1"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="1"),!h&&1!=l.length){let t,i,n=!1;if(x/N<1.2&&(n=!0,t=Math.sqrt(Math.pow(_-s,2)+Math.pow(y-u,2)),i=t/(((new Date).getTime()-f)/1e3)),A<-(Math.round(b*x)||1)/2||n&&t<-50&&i<-200){if(o+1<l.length||e.allowedTouchMoveSwitchImgOverBoundary)return void p.showImg((l.length+o+1)%l.length)}else if((A>(Math.round(b*x)||1)/2||n&&t>50&&i>200)&&(o-1>=0||e.allowedTouchMoveSwitchImgOverBoundary))return void p.showImg((l.length+o-1)%l.length)}U(),V()}},F=function(e){let i=r;if(h?(D=a,b=D.width,L=D.height):(D=l[o],b=D.kPainterWidth,L=D.kPainterHeight),A=parseFloat(D.style.left)+t,O=parseFloat(D.style.top)+t,M=St(D),0!=M.a*M.d&&0==M.b*M.c);else{let e=b;b=L,L=e}if(x=D.kPainterZoom||1,T=vt(i),S=Tt(i),N=Math.min(S.width/b,S.height/L),h&&E.isCropRectShowing&&!e){let e=E.getNeededRect();N=Math.max(Math.max(e.width,b*N)/b,Math.max(e.height,L*N)/L)}};e.onUpdateImgPosZoom=null;let V=function(){if(D.style.left=A-t+"px",D.style.right=-A-t+"px",D.style.top=O-t+"px",D.style.bottom=-O-t+"px",D.kPainterZoom=x,0!=M.a*M.d&&0==M.b*M.c?(D.style.width=(Math.round(b*x)||1)+"px",D.style.height=(Math.round(L*x)||1)+"px"):(D.style.height=(Math.round(b*x)||1)+"px",D.style.width=(Math.round(L*x)||1)+"px"),!h&&1!=l.length){let e=Math.max(0,((Math.round(b*x)||1)-T.width)/2);if(l.length>2||A>e){let t=l[(l.length+o-1)%l.length];t.style.left=A-e-T.width+"px",t.style.right=-A+e+T.width+"px"}if(l.length>2||A<=-e){let t=l[(l.length+o+1)%l.length];t.style.left=A+e+T.width+"px",t.style.right=-A-e-T.width+"px"}}n(e.onUpdateImgPosZoom)},U=function(e,t){if(x>4&&(x=4),x<N&&(x=N),!e){let e=Math.round(b*x)||1;if(S.width>e)A=0;else{let t=(e-S.width)/2;A<-t?A=-t:A>t&&(A=t)}}{let e=Math.round(L*x)||1;if(S.height>e)O=0;else{let t=(e-S.height)/2;O<-t?O=-t:O>t&&(O=t)}}};e.getZoom=function(){if(0!=l.length)return F(),x},e.setZoom=function(e,t){return 0==l.length||(e=parseFloat(e))!=e?null:(F(),t?x*=e:x=e,U(),V(),x)},this.setImgStyleFit=function(){F(!0),x=N,U(),V(),e.setCropRectArea()},["touchstart","touchcancel","touchend","mousedown"].forEach(e=>r.addEventListener(e,k)),r.addEventListener("mouseup",function(e){"mouse"==d&&(g=e.clientX,m=e.clientY,B())}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&(g=_,m=y,B())}),r.addEventListener("contextmenu",function(e){e.preventDefault()}),["touchmove","mousemove"].forEach(e=>r.addEventListener(e,function(e){let t=e.targetTouches;if(t){if("touch"!=d)return}else{if("mouse"!=d)return;t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("posZoom"!=c||P!=t[0].identifier)return;let i=_,n=y;_=t[0].pageX,y=t[0].pageY,A+=_-i,O+=y-n,U(!h),V(),e.preventDefault()}else if(2==t.length){if("posZoom"!=c)return;let i=I,n=R,s=v,r=x;_=t[0].pageX,y=t[0].pageY,C=t[1].pageX,w=t[1].pageY,I=(_+C)/2,R=(y+w)/2,v=Math.sqrt(Math.pow(_-C,2)+Math.pow(y-w,2));let a=v/s;x*=a,x>4&&(x=4,a=4/r),x<N&&(x=N,a=N/r);let o=A+T.pageX0+T.width/2,l=O+T.pageY0+T.height/2;A-=(a-1)*(i-o),O-=(a-1)*(n-l),U(),V(),e.preventDefault()}}))},_=new function(){let t,n=this,s=[];e.stepImgsGCThreshold=10;let _=[],I=[];e.addProtectedStep=function(e){return!!h&&(e=parseInt(e))==e&&(-1!=I.indexOf(e)||(I.push(e),I.sort(function(e,t){return e-t})),!0)},e.removeProtectedStep=function(e){if(!h)return!1;if((e=parseInt(e))!=e)return!1;let t=I.indexOf(e);return-1!=t&&(I.splice(t,1),!0)},e.getProtectedSteps=function(){return h?I.concat():null};let R=n.pushStack=function(i){s.length=t+1;for(let e=_.length-1;e>0&&_[e].beginStep>t;--e)--_.length;let n;if(i.srcBlob){n={crop:{left:0,top:0,width:1,height:1},transform:new Ct.Matrix(1,0,0,1,0,0),srcBlob:i.srcBlob,saveFormat:i.saveFormat};for(let t=0;_.length>=e.stepImgsGCThreshold;){if(I.filter(function(e){return _[t].beginStep<=e&&e<_[t].endStep}).length){if(++t<_.length)continue;break}{let e=_[t].beginStep,i=_[t].endStep;for(let t=e;t<i;++t)s[t]=null;_.splice(t,1)}}s.push(n),++t;let r={blob:n.srcBlob,beginStep:t,endStep:t+1};_.push(r)}else{let e,r=s[t],a=r.crop,c=i.transform,d=i.crop,h={};e=c||r.transform,h.left=a.left,h.top=a.top,h.width=a.width,h.height=a.height,0!=e.a*e.d&&0==e.b*e.c?(c&&(e=new Ct.Matrix(Math.sign(c.a),0,0,Math.sign(c.d),0,0)),d&&(1==e.a?h.left+=d.left*a.width:h.left+=(1-d.left-d.width)*a.width,1==e.d?h.top+=d.top*a.height:h.top+=(1-d.top-d.height)*a.height,h.width*=d.width,h.height*=d.height)):(c&&(e=new Ct.Matrix(0,Math.sign(c.b),Math.sign(c.c),0,0,0)),d&&(1==e.b?h.left+=d.top*a.width:h.left+=(1-d.top-d.height)*a.width,1==e.c?h.top+=d.left*a.height:h.top+=(1-d.left-d.width)*a.height,h.width*=d.height,h.height*=d.width));let u=l[o],g=Math.pow(10,Math.ceil(Math.max(u.kPainterWidth,u.kPainterHeight)).toString().length+2);h.left=Math.round(h.left*g)/g,h.top=Math.round(h.top*g)/g,h.width=Math.round(h.width*g)/g,h.height=Math.round(h.height*g)/g,n={crop:h,transform:e,srcBlob:r.srcBlob,saveFormat:r.saveFormat},s.push(n),++t,n.srcBlob&&(_[_.length-1].endStep=t+1)}};e.undo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t>0){let i=t-1;for(;null==s[i];)--i;w(t,i,function(){return e()})}})},e.redo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t<s.length-1){let i=t+1;for(;null==s[i];)++i;w(t,i,function(){return e()})}})},e.getStepCount=function(){return h?s.length:NaN},e.getCurStep=function(){return h?t:NaN},e.setCurStep=function(e){return new Promise(function(i,n){return arguments.length<1||isNaN(e)||(e=Math.round(e))<0||e>=s.length||null==s[e]?n(Error("`setCurStep(index)`: The parameter `index` is invalid.")):void w(t,e,function(){return i()})})},n.needAlwaysTrueTransform=!1;let C,w=function(e,i,r){t=i;let o=s[e].crop,l=s[t].crop;o.left==l.left&&o.top==l.top&&o.width==l.width&&o.bottom==l.bottom&&s[e].srcBlob==s[t].srcBlob?(Dt(a,s[t].transform.dot(s[e].transform.inversion()).dot(St(a))),f.setImgStyleFit(),r&&r()):v(n.needAlwaysTrueTransform,!1,r)};!function(){let e=window.devicePixelRatio||1,t=screen.width,i=screen.height;C=Math.min(t,i)*e}();let v=n.updateCvsAsync=function(e,i,n){a.style.display="none";let r=s[t],c=r.srcBlob||l[o].kPainterOriBlob,d=function(){let t=URL.createObjectURL(c),s=new Image;s.onload=s.onerror=function(){s.onload=s.onerror=null,T(s,r,e,i),URL.revokeObjectURL(t),n&&n()},s.src=t};window.createImageBitmap?createImageBitmap(c).then(function(t){T(t,r,e,i),n&&n()}).catch(function(){d()}):d()},T=function(t,i,n,s){e._noAnyUseButForIosSafariBug0=t.naturalWidth,e._noAnyUseButForIosSafariBug1=t.naturalHeight;let r=t.naturalWidth||t.width,o=t.naturalHeight||t.height,l=i.crop,c=i.transform,d=a.getContext("2d"),h=a.fullQualityWidth=Math.round(r*l.width)||1,u=a.fullQualityHeight=Math.round(o*l.height)||1,g=!1;if(0!=c.a*c.d&&0==c.b*c.c?(a.fullQualityWidth=h,a.fullQualityHeight=u):(a.fullQualityWidth=u,a.fullQualityHeight=h,n&&(g=!0)),a.hasCompressed=!1,n){let e,t;g?(e=u,t=h):(e=h,t=u),a.width=e,a.height=t;let i=e/2*(1-c.a-c.c),n=t/2*(1-c.b-c.d);d.setTransform(c.a,c.b,c.c,c.d,i,n)}else if(h>C||u>C){let e=C/Math.max(h,u);a.width=Math.round(h*e)||1,a.height=Math.round(u*e)||1,a.hasCompressed=!0}else a.width=h,a.height=u;let m,p,_=Math.round(r*l.left),E=Math.round(o*l.top);if(_==r&&--_,E==o&&--E,g?(m=a.height,p=a.width):(m=a.width,p=a.height),h/m<=2)d.drawImage(t,_,E,h,u,0,0,m,p);else{let e=document.createElement("canvas");e.width=Math.round(h/2),e.height=Math.round(u/2);let i,n,s=e.getContext("2d"),r=Math.round(h/2),a=Math.round(u/2);for(s.drawImage(t,_,E,h,u,0,0,r,a);i=r,n=a,r=Math.round(i/2),a=Math.round(n/2),!(r<=m||a<=p);)s.drawImage(e,0,0,i,n,0,0,r,a);d.drawImage(e,0,0,i,n,0,0,m,p)}Dt(a,n?new Ct.Matrix(1,0,0,1,0,0):c),s||(f.setImgStyleFit(),a.style.display="")};e.enterEdit=function(){return new Promise(function(i,n){if(h)return n(Error("`enterEdit()`: The function is invalid in current mode."));if(-1==o)return n(Error("`enterEdit()`: There is no image in the instance."));u="",g(),h=!0;let r=l[o].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new Ct.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};var p;s.push(r),t=0,p=function(){return m(),d=null,c=null,u="basicEdit",i()},a.parentElement.childNodes.forEach(function(e){e!==a&&(e.style.display="none")}),v(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),p()})})};let S=e.cancelEdit=function(){return!!h&&(h=!1,s.length=0,_.length=0,p.showImg(o),a.style.display="none",E.hideCropRect(),y.hideFreeTransformBorderDirectly(),d=null,c=null,u="view",!0)},D=!1;e.saveEdit=function(n){return new Promise(function(f,_){if(!h||D)return _(Error("`saveEdit(isCover)`: The function is invalid in current mode."));u="",D=!0,g(),setTimeout(function(){!function(e,n){let c=s[t].crop,d=s[t].transform,h=s[0].crop,u=s[0].transform,g=l[o];if(s[t].srcBlob||u.a!=d.a||u.b!=d.b||u.c!=d.c||u.d!=d.d||Math.round(g.kPainterOriWidth*c.left)!=Math.round(g.kPainterOriWidth*h.left)||Math.round(g.kPainterOriHeight*c.top)!=Math.round(g.kPainterOriHeight*h.top)||Math.round(g.kPainterOriWidth*(c.left+c.width))!=Math.round(g.kPainterOriWidth*(h.left+h.width))||Math.round(g.kPainterOriHeight*(c.top+c.height))!=Math.round(g.kPainterOriHeight*(h.top+h.height))){URL.revokeObjectURL(g.src);let c=new Image,h=function(){c.onload=c.onerror=function(){c.onload=c.onerror=null,n?(l[o].remove(),l.splice(o,1,c)):l.splice(++o,0,c),r.querySelector(".kPainterImgsDiv").append(c),e()},i(a,s[t].saveFormat||g.kPainterSaveFormat).then(function(e){c.kPainterBlob=e,c.kPainterWidth=a.width,c.kPainterHeight=a.height,s[t].srcBlob?(c.kPainterOriBlob=e,c.kPainterOriWidth=a.width,c.kPainterOriHeight=a.height,c.kPainterSaveFormat=s[t].saveFormat):(c.kPainterOriBlob=g.kPainterOriBlob,c.kPainterOriWidth=g.kPainterOriWidth,c.kPainterOriHeight=g.kPainterOriHeight,c.kPainterProcess=s[t],c.kPainterSaveFormat=g.kPainterSaveFormat);let i=URL.createObjectURL(e);c.src=i})};a.hasCompressed||1!=d.a||0!=d.b||0!=d.c||1!=d.d||0!=d.e||0!=d.f?(a.style.display="none",v(!0,!0,h)):h()}else e()}(function(){S(),m(),D=!1,d=null,c=null;try{!function(){for(let t=0;t<p.thumbnailBoxArr.length;++t){let i=p.thumbnailBoxArr[t],s=l[o];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r,a=Math.min(i.kPainterMaxWH/s.naturalWidth,i.kPainterMaxWH/s.naturalHeight,1);if(n){let e=i.kPainterThumbBoxArr[o];r=e.classList.contains("kPainterThumbnailCanvas")?e:e.querySelector(".kPainterThumbnailCanvas")}else r=document.createElement("canvas"),r.className="kPainterThumbnailCanvas";if(r.width=Math.round(s.naturalWidth*a),r.height=Math.round(s.naturalHeight*a),r.getContext("2d").drawImage(s,0,0,r.width,r.height),!n){let e=i.kPainterFunWrap,t=null;try{t=e?e(r):r}catch(e){return setTimeout(function(){throw e},0),!1}t&&(t.getKPainterIndex=function(){return i.kPainterThumbBoxArr.indexOf(this)},i.kPainterThumbBoxArr.splice(o,0,t),i.kPainterThumbBoxArr[o-1].after(t))}}}()}catch(e){setTimeout(function(){throw e},0)}return u="view",f()},n)},100)})},e.rotateRight=function(){if(!h)return!1;let e=St(a),t=Ct.Matrix.dot(new Ct.Matrix(0,1,-1,0,0,0),e);Dt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.rotateLeft=function(){if(!h)return!1;let e=St(a),t=Ct.Matrix.dot(new Ct.Matrix(0,-1,1,0,0,0),e);Dt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.mirror=function(){if(!h)return!1;let e=St(a),t=Ct.Matrix.dot(new Ct.Matrix(-1,0,0,1,0,0),e);return Dt(a,t),R({transform:t}),f.setImgStyleFit(),!0},e.flip=function(){if(!h)return!1;let e=St(a),t=Ct.Matrix.dot(new Ct.Matrix(1,0,0,-1,0,0),e);return Dt(a,t),R({transform:t}),f.setImgStyleFit(),!0},e.resize=function(e,t){return new Promise(function(s,r){return h?(e=parseInt(e),t=parseInt(t),e!=e||e<1?r(Error("`resize`: The parameter `newWidth` is invaild.")):t!=t||t<1?r(Error("`resize`: The parameter `newHeight` is invaild.")):(g(),void n.updateCvsAsync(!0,!0,function(){n.needAlwaysTrueTransform=!0;let r=e,o=t;for(;2*r<a.width;)r*=2;for(;2*o<a.height;)o*=2;let l,c=a;for(;;){l=document.createElement("canvas"),l.width=r,l.height=o,l.getContext("2d").drawImage(c,0,0,r,o);let i=!1;if(e!=r&&(r/=2,i=!0),t!=o&&(o/=2,i=!0),!i)break}i(l).then(function(e){n.pushStack({srcBlob:e,saveFormat:"image/jpeg"}),n.updateCvs(!1,!1,function(){return n.needAlwaysTrueTransform=!1,m(),s()})})}))):r(Error("`resize`: The function is invaild in this mode."))})},e.getEditWidth=function(){return h?a.fullQualityWidth:NaN},e.getEditHeight=function(){return h?a.fullQualityHeight:NaN}},E=new function(){let i=this;e.isAutoShowCropUI=!0;let s,o,l,u,g,m,p,f,E,y,I,R,C,w,v,T,S,D,M,b,L=r.querySelector(".kPainterCroper");i.isCropRectShowing=!1,e.showCropRect=i.showCropRect=function(){h&&(i.isCropRectShowing=!0,k(),L.style.display="")},e.hideCropRect=i.hideCropRect=function(){i.isCropRectShowing=!1,L.style.display="none"},Object.assign(L.style,{"border-left-width":t+"px","border-top-width":t+"px","border-right-width":t+"px","border-bottom-width":t+"px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"}),e.setCropRectStyle=function(e){switch(parseInt(e)){case 0:return L.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display="none"),L.querySelectorAll(".kPainterMover").forEach(e=>e.style.display=""),!0;case 1:return L.querySelectorAll(".kPainterMover").forEach(e=>e.style.display="none"),L.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display=""),!0;default:return!1}},e.cropRectMinW=50,e.cropRectMinH=50;let A=function(e){e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if(null!=c)return;c="crop",l=t[0].identifier,s=t[0].pageX,o=t[0].pageY;let e=this.getAttribute("data-orient").split(",");u=e[0],g=e[1],x()}else 0==t.length&&O()},O=function(){"crop"==c&&(d=null,c=null)},x=function(){m=Tt(r),N(),v=parseFloat(L.style.width),T=parseFloat(L.style.height),C=parseFloat(L.style.left)-v/2+t,w=parseFloat(L.style.top)-T/2+t,S=Math.max(-m.width/2,p),D=Math.max(-m.height/2,f),M=Math.min(m.width/2,E),b=Math.min(m.height/2,y)},N=function(){let e=St(a),i=parseFloat(a.style.left)+t,n=parseFloat(a.style.top)+t;0!=e.a*e.d&&0==e.b*e.c?(I=parseFloat(a.style.width),R=parseFloat(a.style.height)):(I=parseFloat(a.style.height),R=parseFloat(a.style.width));let s=I/2,r=R/2;p=i-s,f=n-r,E=i+s,y=n+r};r.querySelectorAll(".kPainterCroper > .kPainterEdges > div, .kPainterCroper > .kPainterCorners > div, .kPainterCroper > .kPainterMover, .kPainterCroper > .kPainterBigMover").forEach(e=>{["touchstart","touchcancel","touchend","mousedown"].forEach(t=>e.addEventListener(t,A))}),r.addEventListener("mouseup",function(){"mouse"==d&&O()}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&O()}),e.onCropRectChange=null;let P=function(){L.style.left=C+v/2-t+"px",L.style.right=-C-v/2-t+"px",L.style.top=w+T/2-t+"px",L.style.bottom=-w-T/2-t+"px",L.style.width=v+"px",L.style.height=T+"px",n(e.onCropRectChange)};["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if("crop"!=c||l!=i[0].identifier)return;let n=s,r=o;s=i[0].pageX,o=i[0].pageY;let a=s-n,d=o-r;-1==u?(v-a<e.cropRectMinW&&(a=v-e.cropRectMinW),C+a<S&&(a=S-C),v-=a,C+=a):1==u&&(v+a<e.cropRectMinW&&(a=-v+e.cropRectMinW),C+v+a>M&&(a=M-v-C),v+=a),-1==g?(T-d<e.cropRectMinH&&(d=T-e.cropRectMinH),w+d<D&&(d=D-w),T-=d,w+=d):1==g&&(T+d<e.cropRectMinH&&(d=-T+e.cropRectMinH),w+T+d>b&&(d=b-T-w),T+=d),0==u&&0==g&&(C+a<S?a=S-C:C+v+a>M&&(a=M-v-C),w+d<D?d=D-w:w+T+d>b&&(d=b-T-w),C+=a,w+=d),P(),t.preventDefault()}}));let k=e.setCropRectArea=function(e,t,n,s){if(!i.isCropRectShowing)return!1;e>=-.5||(e=-.5),t>=-.5||(t=-.5),n<=.5||(n=.5),s<=.5||(s=.5),e>n&&(e=n=(e+n)/2),t>s&&(t=s=(t+s)/2),x(),C=p+(e+.5)*I,C<S&&(C=S),w=f+(t+.5)*R,w<D&&(w=D);let r=p+(n+.5)*I;r>M&&(r=M),v=r-C;let a=f+(s+.5)*R;return a>b&&(a=b),T=a-w,P(),!0},B=e.getCropRectArea=function(e){if(!i.isCropRectShowing)return null;!function(){let e,t=St(a);e=0!=t.a*t.d&&0==t.b*t.c?parseFloat(a.style.width):parseFloat(a.style.height),e!=I&&x()}();let t=(C-p)/I-.5,n=(w-f)/R-.5,s=t+v/I,r=n+T/R;return e&&(t=Math.round(t*a.fullQualityWidth*2)/2,n=Math.round(n*a.fullQualityHeight*2)/2,s=Math.round(s*a.fullQualityWidth*2)/2,r=Math.round(r*a.fullQualityHeight*2)/2),[t,n,s,r]};i.getNeededRect=function(){x();let e={};return e.width=2*Math.max(-C,C+v),e.height=2*Math.max(-w,w+T),e},e.crop=function(e){return new Promise(function(t,i){if(!h)return i(Error("crop([ltrb])`: The function is invalid in this mode."));if(x(),!(e=e||B()))return i(Error("crop([ltrb])`: No thing can be cropped."));let n=e[0],s=e[1],r=e[2],o=e[3];if((n+.5)*a.fullQualityWidth<.5&&(.5-r)*a.fullQualityWidth<=.5&&(s+.5)*a.fullQualityHeight<.5&&(.5-o)*a.fullQualityHeight<=.5)return t([n,s,r,o]);_.pushStack({crop:{left:n+.5,top:s+.5,width:r-n,height:o-s}}),_.updateCvsAsync(_.needAlwaysTrueTransform,!1,function(){return t([n,s,r,o])})})}},y=new function(){let t=this;!function(){let i=r.querySelector(".kPainterPerspect");t.hideFreeTransformBorderDirectly=function(){i.style.display="none"};let s=r.querySelector(".kPainterPerspect > .kPainterPerspectCvs");e.onFreeTransformCornerPosChange=null;let o=e.setFreeTransformCornerPos=function(e){if("freeTransform"!=u)return;let t=a.kPainterZoom,n=St(a),s=a.width*t,r=a.height*t;if(0==n.a*n.d||0!=n.b*n.c){let e=s;s=r,r=e}let o=a.width*t/2,l=a.height*t/2;for(let t=0;t<I.length;++t){let i=I[t],n=e[i.getAttribute("data-index")],a=s*n[0],c=r*n[1];a<-o?a=-o:a>o&&(a=o),c<-l?c=-l:c>l&&(c=l),i.style.left=a+"px",i.style.right=-a+"px",i.style.top=c+"px",i.style.bottom=-c+"px"}p(),i.style.display=""},l=e.getFreeTransformCornerPos=function(){let e=a.kPainterZoom,t=St(a),i=a.width*e,n=a.height*e;if(0==t.a*t.d||0!=t.b*t.c){let e=i;i=n,n=e}let s=[];for(let e=0;e<I.length;++e){let t=I[e];s.push([parseFloat(t.style.left)/i,parseFloat(t.style.top)/n])}return s},p=function(){let t=wt(r);s.width=Math.round(t.width),s.height=Math.round(t.height);let i=[];for(let e=0;e<I.length;++e)i.push([Math.round(parseFloat(I[e].style.left)+t.width/2),Math.round(parseFloat(I[e].style.top)+t.height/2)]);let a,o=s.getContext("2d"),l=Number.POSITIVE_INFINITY;for(let e=0;e<4;++e){let t=i[e][0]*i[e][0]+i[e][1]*i[e][1];t<l&&(l=t,a=e)}let c=[];for(let e=0;e<4;++e)c.push([i[(a+e)%4][0],i[(a+e)%4][1]]);o.fillStyle="rgba(0,0,0,0.3)",o.beginPath(),o.moveTo(0,0),o.lineTo(c[0][0],c[0][1]);let d=[];for(let e=0;e<4;++e)d.push((h=c[e][0],u=c[e][1],g=c[(e+1)%4][0],m=c[(e+1)%4][1],p=c[(e+2)%4][0],f=c[(e+2)%4][1],_=c[(e+3)%4][0],E=c[(e+3)%4][1],[Math.sign((m-u)*p+(h-g)*f+g*u-h*m),Math.sign((m-u)*_+(h-g)*E+g*u-h*m)]));var h,u,g,m,p,f,_,E;let y,R=function(e,t,i,n,s,r,a,o){let l=n-t,c=e-i,d=i*t-e*n,h=o-r,u=s-a,g=a*r-s*o,m=c*h-u*l;return[(d*u-g*c)/m,(g*l-d*h)/m]},C=function(){let e,t,i=c[1][0]-c[0][0];i&&(e=(c[1][1]-c[0][1])/i);let n=c[3][0]-c[0][0];return n&&(t=(c[3][1]-c[0][1])/n),i>0?!(n>0)||e<=t:0==i?!(n>0):!(n>=0)&&e<=t}();d[0][0]*d[0][1]<0?d[2][0]*d[2][1]<0&&(y=R(c[0][0],c[0][1],c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]),C?(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1]))):d[1][0]*d[1][1]<0&&d[3][0]*d[3][1]<0&&(y=R(c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1],c[0][0],c[0][1]),C?(o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1])):(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]))),y||(C?(o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]))),o.lineTo(c[0][0],c[0][1]),o.lineTo(0,0),o.lineTo(0,s.height),o.lineTo(s.width,s.height),o.lineTo(s.width,0),o.lineTo(0,0),o.fill(),n(e.onFreeTransformCornerPosChange)};e.isShowMagnifier=!0,e.magnifierZoom=2;let f=function(){if(!e.isShowMagnifier)return;const t=w.querySelector("canvas");100!=t.width&&(t.width=100),100!=t.height&&(t.height=100);const i=t.getContext("2d"),n=parseInt(w.getAttribute("data-index")),[s,r]=l()[n],o=e.magnifierZoom;i.fillStyle="#aaa",i.strokeStyle="#0f0",i.lineWidth=1;let c=a.width*(.5+s)-50/o,d=a.height*(.5+r)-50/o,h=100/o,u=100/o,g=0,m=0,p=100,f=100;{const e=p/h,t=f/u;if(c<0){const t=-c*e;g+=t,p-=t,h+=c,c=0}if(d<0){const e=-d*t;m+=e,f-=e,u+=d,d=0}if(c+h>a.width){const t=c+h-a.width;p-=t*e,h-=t}if(d+u>a.height){const e=d+u-a.height;f-=e*t,u-=e}}i.fillRect(0,0,t.width,t.height),i.drawImage(a,c,d,h,u,g,m,p,f),i.beginPath(),i.moveTo(40,50),i.lineTo(60,50),i.moveTo(50,40),i.lineTo(50,60),i.closePath(),i.stroke();for(let e of v)e!==t&&"none"!==e.style.display&&(e.style.display="none");"none"===t.style.display&&(t.style.display="")},y=function(){e.isShowMagnifier&&v.forEach(e=>{"none"!==e.style.display&&(e.style.display="none")})},I=[...r.querySelectorAll(".kPainterPerspect > .kPainterPerspectCorner")];I.forEach(e=>{e.style.left="0"}),I.forEach(e=>{e.style.top="0"}),I.forEach(e=>{e.style.right="0"}),I.forEach(e=>{e.style.bottom="0"});let R,C,w,v=I.map(e=>e.querySelector("canvas")),T=null,S=function(t){let i,n=a.kPainterZoom,s=a.width*n/2,r=a.height*n/2,o=!1;i=t?I:[w];for(let e=0;e<i.length;++e){let t=i[e],n=parseFloat(t.style.left),a=parseFloat(t.style.top),l=!0,c=!0;n<-s?n=-s:n>s?n=s:l=!1,a<-r?a=-r:a>r?a=r:c=!1,l&&(t.style.left=n+"px",t.style.right=-n+"px"),c&&(t.style.top=a+"px",t.style.bottom=-a+"px"),(l||c)&&(o=!0)}if(o&&p(),e._dceGetQuads){let t,i=e._dceSelectedItemIdxs,n=a.width,s=a.height;t=i.size?[...i.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x<0?t.x=0:t.x>n&&(t.x=n),t.y<0?t.y=0:t.y>s&&(t.y=s);e.setQuad(e.quad)}}};["touchstart","touchcancel","touchend","mousedown"].forEach(e=>I.forEach(t=>t.addEventListener(e,function(e){w=this,e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("perspect"!=c)return;c="perspectCornerMoving",S(),f(),T=t[0].identifier,R=t[0].pageX,C=t[0].pageY}else 0==t.length&&"perspectCornerMoving"==c&&(S(),y(),d=null,c="perspect")}))),["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if(T!=i[0].identifier)return;if("perspectCornerMoving"!=c&&"perspectQuadMoving"!=c)return;let n=R,s=C;R=i[0].pageX,C=i[0].pageY;let r=R-n,o=C-s;if("perspectCornerMoving"===c){let t=parseFloat(w.style.left)+r,i=parseFloat(w.style.top)+o;if(w.style.left=t+"px",w.style.right=-t+"px",w.style.top=i+"px",w.style.bottom=-i+"px",e._dceGetQuads){let t=a.kPainterZoom,i=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(i){let e=parseInt(w.getAttribute("data-index")),n=i.quad.points[e];n.x+=r/t,n.y+=o/t,i.setQuad(i.quad)}}p(),f()}else if("perspectQuadMoving"===c){for(let e=0;e<I.length;++e){let t=I[e],i=parseFloat(t.style.left)+r,n=parseFloat(t.style.top)+o;t.style.left=i+"px",t.style.right=-i+"px",t.style.top=n+"px",t.style.bottom=-n+"px"}if(e._dceGetQuads){let t,i=a.kPainterZoom,n=e._dceSelectedItemIdxs;t=n.size?[...n.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x+=r/i,t.y+=o/i;e.setQuad(e.quad)}}p()}t.preventDefault()}})),["touchstart","touchcancel","touchend","mousedown"].forEach(t=>r.addEventListener(t,function(t){let n=t.targetTouches;if(n){if(n.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";n=[{pageX:t.clientX,pageY:t.clientY}]}if(1==n.length){if("perspect"!=c)return;let s=Tt(i),r=(s.pageX0+s.pageX1)/2,o=(s.pageY0+s.pageY1)/2,d=a.kPainterZoom,h=a.width*d,u=a.height*d,g=(n[0].pageX-r)/h,m=(n[0].pageY-o)/u;if(e._dceGetQuads){(t.shiftKey||t.ctrlKey)&&(e._dceThisClickShouldKeepMultiSelect=!0);const i=e._dceGetQuads(),n=e._dceSelectedItemIdxs;let s=!1;for(let r=i.length-1;r>=0;--r){let a=i[r].quad.points,o=e.getWidth(),l=e.getHeight(),c=a.map(({x:e,y:t})=>[e/o-.5,t/l-.5]);if(ct([g,m],c)){t.shiftKey||t.ctrlKey?(n.add(e._dceSelectedItemIdx),i[e._dceSelectedItemIdx]?._setSelected(!0),n.add(r),i[r]?._setSelected(!0)):n.has(r)&&(e._dceThisClickShouldKeepMultiSelect=!0),e._dceSelectedItemIdx=r,e.setFreeTransformCornerPos(c),s=!0,i[r]._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});break}}if(!s)return}else if(!ct([g,m],l()))return;c="perspectQuadMoving",T=n[0].identifier,R=n[0].pageX,C=n[0].pageY,t.preventDefault()}else 0==n.length&&"perspectQuadMoving"==c&&(S(!0),d=null,c="perspect")})),["mouseup","mouseleave"].forEach(t=>r.addEventListener(t,function(t){if("mouse"==d){if(e._dceGetQuads){if("perspectQuadMoving"==c&&!e._dceThisClickShouldKeepMultiSelect||"perspect"==c){const t=e._dceGetQuads();for(let i of e._dceSelectedItemIdxs)t[i]?._setSelected(!1);e._dceSelectedItemIdxs.clear()}e._dceThisClickShouldKeepMultiSelect=!1}if("perspectCornerMoving"==c)S(),y(),d=null,c="perspect";else if("perspectQuadMoving"==c){if(e._dceGetQuads){const i=e._dceGetQuads();i[e._dceSelectedItemIdx]?._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}S(!0),d=null,c="perspect"}}})),e.enterFreeTransformMode=function(){return new Promise(function(e,t){if(!h)return t(Error("`enterFreeTransformMode`: The function is only valid in edit mode."));u="",d=null,c="perspect",g(),setTimeout(function(){E.hideCropRect(),_.updateCvsAsync(!0,!1,async()=>{_.needAlwaysTrueTransform=!0,u="freeTransform",o([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]),i.style.display="",m(),e()})},0)})},e.exitFreeTransformMode=function(){return new Promise(function(t,n){if("freeTransform"!=u)return n(Error("`exitFreeTransformMode`: It is not in `freeTransform` mode."));u="",i.style.display="none",_.updateCvsAsync(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),d=null,c=null,_.needAlwaysTrueTransform=!1,u="basicEdit",t()})})}}()}};Rt._doCallbackNoBreak=function(e,t){if(e)try{e.apply(window,t||[])}catch(e){setTimeout(function(){throw e},0)}};let Ct={};Math.sign||(Math.sign=function(e){return e>0?1:0==e?1/e<0?-0:0:e<0?-1:NaN}),Ct.Matrix=function(e,t,i,n,s,r){this.a=e,this.b=t,this.c=i,this.d=n,this.e=s,this.f=r},Ct.Matrix.dot=function(e,t){let i=e,n=t;return new Ct.Matrix(i.a*n.a+i.c*n.b,i.b*n.a+i.d*n.b,i.a*n.c+i.c*n.d,i.b*n.c+i.d*n.d,i.a*n.e+i.c*n.f+i.e,i.b*n.e+i.d*n.f+i.f)},Ct.Matrix.prototype.dot=function(e){return Ct.Matrix.dot(this,e)},Ct.Matrix.equals=function(e,t){let i=e,n=t;return i.a==n.a&&i.b==n.b&&i.c==n.c&&i.d==n.d&&i.e==n.e&&i.f==n.f},Ct.Matrix.prototype.equals=function(e){return Ct.Matrix.equals(this,e)},Ct.Matrix.prototype.inversion=function(){let e=this.a,t=this.b,i=this.c,n=this.d,s=this.e,r=this.f,a=e*n-t*i;return new Ct.Matrix(n/a,-t/a,-i/a,e/a,(i*r-n*s)/a,(t*s-e*r)/a)},Ct.convertURLToBlob=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onloadend=function(){t(this.response)},i.send()},Ct.convertBase64ToBlob=function(e,t){let i=atob(e),n=new Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);let s=new Uint8Array(n);return new Blob([s],{type:t})};let wt=function(e){let t=getComputedStyle(e);const i=e.getBoundingClientRect();let n={};return n.pageX0=i.left+window.scrollX,n.pageY0=i.top+window.scrollY,n.width=t?parseFloat(t.width):i.width,n.height=t?parseFloat(t.height):i.height,n.pageX1=n.pageX0+n.width,n.pageY1=n.pageY0+n.height,n},vt=function(e){let t=wt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("border-left-width"))||0,i.top=parseFloat(t.getPropertyValue("border-top-width"))||0,i.right=parseFloat(t.getPropertyValue("border-right-width"))||0,i.bottom=parseFloat(t.getPropertyValue("border-bottom-width"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Tt=function(e){let t=vt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("padding-left"))||0,i.top=parseFloat(t.getPropertyValue("padding-top"))||0,i.right=parseFloat(t.getPropertyValue("padding-right"))||0,i.bottom=parseFloat(t.getPropertyValue("padding-bottom"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},St=function(e){let t=e.style.transform,i="matrix(",n=t.indexOf(i);if(-1!=n){n+=i.length;let e=t.substring(n,t.indexOf(")",n)).split(",");for(let t=0;t<e.length;++t)e[t]=parseFloat(e[t]);return new Ct.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])}i="scale(";let s=t.indexOf(i);if(-1!=s){s+=i.length;let e=parseFloat(t.substring(s));return new Ct.Matrix(e,0,0,e,0,0)}return new Ct.Matrix(1,0,0,1,0,0)},Dt=function(e,t){let i=t,n="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";e.style.transform=n},Mt=function(){this._queue=[],this.isWorking=!1,this.timeout=100};if(Mt.prototype.push=function(e,t,i,n){this._queue.push({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Mt.prototype.unshift=function(e,t,i,n){this._queue.unshift({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Mt.prototype.next=function(){if(0==this._queue.length)return void(this.isWorking=!1);this.isWorking=!0;let e=this._queue.shift(),t=e.task,i=e.context?e.context:self,n=e.args?e.args:[],s=e.handleReturn;setTimeout(function(){let e=t.apply(i,n);"function"==typeof s&&s(e)},this.timeout)},document?.head){const e=new Blob(["\n.kPainterBox, .kPainterBox *{box-sizing: border-box;}\n.kPainterBox{width:100%;height:100%;border-bottom:none;position:relative;padding:15px;}\n.kPainterBox > .kPainterImgsDiv{width:100%;height:100%;}\n.kPainterBox > .kPainterImgsDiv > canvas, .kPainterBox > .kPainterImgsDiv > img{position:absolute;margin:auto;/*left:0;top:0;right:0;bottom:0;transform-origin:left top;*/pointer-events:none;}\n/*.kPainterBox > .center{margin:auto;left:0;right:0;top:0;bottom:0;}*/\n.kPainterBox > .kPainterCroper{position:absolute;margin:auto;border-style:solid;border-color:rgba(0,0,0,0.3);/*border-right-width:100vw;border-bottom-width:100vh;*/box-sizing:content-box;}\n.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;line-height:0;position:relative;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div{display:inline-block;width:33.33%;height:33.33%;border-style:solid;border-color:rgba(255,255,255,0.5);position:absolute;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(1){border-width:1px 0 0 1px;left:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(2){border-width:1px 1px 0 1px;left:0;top:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(3){border-width:1px 1px 0 0;right:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(4){border-width:1px 0 1px 1px;left:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(5){border-width:1px 1px 1px 1px;left:0;top:0;right:0;bottom:0;margin:auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(6){border-width:1px 1px 1px 0;right:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(7){border-width:0 0 1px 1px;left:0;bottom:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(8){border-width:0 1px 1px 1px;left:0;bottom:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(9){border-width:0 1px 1px 0;right:0;bottom:0;}\n/*.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;overflow:hidden;}\n.kPainterBox > .kPainterCroper > .kPainterCells > table{width:100%;height:100%;}\n.kPainterBox > .kPainterCroper > .kPainterCells td{border:1px solid white;}*/\n.kPainterBox > .kPainterCroper > .kPainterBigMover{position:absolute;width:100%;height:100%;left:0;top:0;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div{position:absolute;border-color:white;border-style:solid;border:0;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(1){width:30px;height:100%;left:-15px;top:0;z-index:1;cursor:w-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(2){width:100%;height:30px;left:0;top:-15px;z-index:1;cursor:n-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(3){width:30px;height:100%;right:-15px;top:0;z-index:1;cursor:e-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(4){width:100%;height:30px;left:0;bottom:-15px;z-index:1;cursor:s-resize;}\n/*.kPainterBox > .kPainterCroper > .kPainterEdges > div > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterCroper > .kPainterCorners > div{position:absolute;width:16px;height:16px;border-color:white;border-style:solid;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1){left:0;top:0;border-width:2px 0 0 2px;z-index:1;cursor:nw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2){right:0;top:0;border-width:2px 2px 0 0;z-index:1;cursor:ne-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3){right:0;bottom:0;border-width:0 2px 2px 0;z-index:1;cursor:se-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4){left:0;bottom:0;border-width:0 0 2px 2px;z-index:1;cursor:sw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div > i{width:32px;height:32px;position:absolute;display:inline-block;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1) > i{left:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2) > i{right:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3) > i{right:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4) > i{left:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterMover{display:inline-block;position:absolute;border:solid 12px rgba(0,0,0,0.15);border-radius:12px;left: 13px;top:13px;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterMover > div{display:inline-block;position:absolute;border:solid 15px transparent;border-radius:15px;left:-15px;top:-15px;}\n.kPainterBox > .kPainterCroper > .kPainterMover > svg{display:inline-block;position:absolute;left:-10px;top:-10px;}\n/*.kPainterBox > .kPainterCroper > .kPainterCorners > div > i > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterPerspect{position:absolute;width:100%;height:100%;left:0;top:0;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCvs{position:absolute;margin:auto;left:-100000px;top:-100000px;right:-100000px;bottom:-100000px;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner{position:absolute;margin:auto;width:20px;height:20px;border-radius:10px;border:2px solid #0f0;color:#fff;background:rgba(0,0,0,0.3);text-align:center;line-height:16px;font-size:12px;font-family:Arial,sans-serif;z-index:1;cursor:move;}\n.kPainterBox > .kPainterGesturePanel{position:absolute;left:0;top:0;width:100%;height:100%;}\n\n.kPainterVideoMdl, .kPainterVideoMdl *{box-sizing: border-box;}\n.kPainterVideoMdl{position:fixed;left:0px;top:0px;width:100%;height:100%;display:none;background:black;}\n.kPainterVideoMdl > .kPainterVideo{width:100%;height:100%;}\n.kPainterVideoMdl > .kPainterCameraSelect{height:20px;position:absolute;left:4px;top:4px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterResolutionSelect{height:20px;position:absolute;left:4px;top:28px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo{position:absolute;margin:0 auto;left:0;right:0;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo > svg{vertical-align:middle;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo{position:absolute;right:20px;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo > svg{vertical-align:middle;}\n\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner > canvas{position:absolute;left:-43px;top:-113px;border-radius:50px;border:1px solid #0f0;pointer-events:none;user-select:none;z-index:2}\n"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}function bt(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function Lt(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;const At=e=>e&&"object"==typeof e&&"function"==typeof e.then,Ot=(async()=>{})().constructor;let xt=class extends Ot{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,At(e)?t=e:"function"==typeof e&&(t=new Ot(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(At(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}},Nt=class{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.count);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(e){return await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:e}})})}async getBufferedCharacterItemSet(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.itemSet);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})}};var Pt={onTaskResultsReceived:!1,onTargetROIResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onDeskewedImageReceived:!1,onEnhancedImageReceived:!1,onColourImageUnitReceived:!1,onScaledColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesUnitReceived:!1};const kt=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet)if(t.isDce||t.isFilter)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])};let Bt=class{constructor(e){this._irrRegistryState=Pt,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),kt(this);let t=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");t=e._observedResultUnitTypes,e._observedTaskMap.forEach((e,t)=>{i[t]=e}),e._observedTaskMap.clear()}return await new Promise((e,n)=>{let s=_e();Ee[s]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},pe.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:t.toString(),observedTaskMap:i}})})}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),kt(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr.privideDsImage}};const Ft="undefined"==typeof self,Vt="function"==typeof importScripts,Ut=(()=>{if(!Vt){if(!Ft&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Zt=e=>{if(null==e&&(e="./"),Ft||Vt);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Gt;Me.engineResourcePaths.cvr={version:"3.4.10-dev-20260129110712",path:Ut,isInternal:!0},Te.cvr={js:!0,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE,he.MN_DYNAMSOFT_IMAGE_PROCESSING,he.MN_DYNAMSOFT_NEURAL_NETWORK]},Te.dnn={wasm:!0,deps:[he.MN_DYNAMSOFT_IMAGE_PROCESSING]},ve.cvr={};const Ht="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,Ht)<0&&(Me.engineResourcePaths.std={version:Ht,path:Zt(Ut+`../../dynamsoft-capture-vision-std@${Ht}/dist/`),isInternal:!0});const Wt="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,Wt)<0)&&(Me.engineResourcePaths.dip={version:Wt,path:Zt(Ut+`../../dynamsoft-image-processing@${Wt}/dist/`),isInternal:!0});const zt="2.0.10";(!Me.engineResourcePaths.dnn||"string"!=typeof Me.engineResourcePaths.dnn&&w(Me.engineResourcePaths.dnn.version,zt)<0)&&(Me.engineResourcePaths.dnn={version:zt,path:Zt(Ut+`../../dynamsoft-capture-vision-dnn@${zt}/dist/`),isInternal:!0});let jt=class{static getVersion(){return this._version}};var Yt,$t,qt,Xt,Qt,Kt,Jt,ei,ti,ii,ni,si,ri,ai,oi,li,ci,di,hi,ui,gi,mi,pi,fi;function _i(e,t){if(e){if(e.sourceLocation){const i=e.sourceLocation.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}if(e.location){const i=e.location.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}_i(e.referencedItem,t)}}function Ei(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}function yi(e){return{type:Q.CRIT_ORIGINAL_IMAGE,referenceItem:null,targetROIDefName:"",taskName:"",imageData:e,toCanvas:()=>S(e),toImage:t=>D(t,e),toBlob:t=>M(t,e)}}function Ii(e){const t=[J.EC_UNSUPPORTED_JSON_KEY_WARNING,J.EC_LICENSE_AUTH_QUOTA_EXCEEDED,J.EC_LICENSE_RESULTS_LIMIT_EXCEEDED];if(e.errorCode&&t.includes(e.errorCode))return void console.warn(e.message);let i=new Error(e.errorCode?`[${e.functionName}] [${e.errorCode}] ${e.message}`:`[${e.functionName}] ${e.message}`);if(i.stack&&(i.stack=e.stack),e.isShouldThrow)throw i;return e.rj&&e.rj(i),!0}jt._version=`3.4.10-dev-20260129110712(Worker: ${null===(Gt=we.cvr)||void 0===Gt?void 0:Gt.worker}, Wasm: loading...`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Yt||(Yt={}));const Ri={onTaskResultsReceived:()=>{},isFilter:!0};Ee[-2]=async e=>{Ci.onDataLoadProgressChanged&&Ci.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Ci{constructor(){$t.add(this),this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(Me.browserInfo.OS)?2048:4096,this.onCaptureError=null,this._instanceID=void 0,this.privideDsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._dynamsoft=!0,qt.set(this,null),Xt.set(this,null),Qt.set(this,null),Kt.set(this,null),Jt.set(this,null),ei.set(this,new Set),ti.set(this,new Set),ii.set(this,new Set),ni.set(this,500),si.set(this,0),ri.set(this,0),ai.set(this,!1),oi.set(this,!1),li.set(this,!1),ci.set(this,null),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return bt(this,li,"f")}static async createInstance(e=!0){if(!ve.license)throw Error("The `license` module cannot be found.");return await ve.license.dynamsoft(),await Me.loadWasm(),await new Promise((t,i)=>{const n=new Ci;let s=_e();Ee[s]=async e=>{e.success?(n._instanceID=e.instanceID,n._currentSettings=JSON.parse(JSON.parse(e.outputSettings).data),Ci._isNoOnnx=e.isNoOnnx,jt._version=`3.4.10-dev-20260129110712(Worker: ${we.cvr.worker}, Wasm: ${e.version})`,Lt(n,oi,!0),Lt(n,Kt,n.getIntermediateResultManager()),Lt(n,oi,!1),t(n)):Ii({message:e.message,rj:i,stack:e.stack,functionName:"createInstance"})},pe.postMessage({type:"cvr_createInstance",id:s,body:{loadPresetTemplates:e}})})}static async appendDLModelBuffer(e,t){return await Me.loadWasm(),Ci._isNoOnnx?Promise.reject("Model not supported in the current environment."):await new Promise((i,n)=>{let s=_e();const r=v(Me.engineResourcePaths);let a;Ee[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Ii({message:t.errorString?t.errorString:"Append Model Buffer Failed.",rj:n,errorCode:t.errorCode,functionName:"appendDLModelBuffer"}),i(t)}Ii({message:e.message,rj:n,stack:e.stack,functionName:"appendDLModelBuffer"})},t?a=t.endsWith("/")?t:t+"/":"DCV"===Me._bundleEnv?a=r.dcvData+"models/":"DBR"===Me._bundleEnv&&(a=r.dbrBundle+"models/");let o=Array.isArray(e)?e:[e];o=o.map(e=>e.replace(/\.data$/i,"")),pe.postMessage({type:"cvr_appendDLModelBuffer",id:s,body:{modelNames:o,path:a}})})}static async clearDLModelBuffers(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();Ii({message:i.message,rj:t,stack:i.stack,functionName:"clearDLModelBuffers"})},pe.postMessage({type:"cvr_clearDLModelBuffers",id:i})})}async _singleFrameModeCallback(e){const t={bytes:e.bytes,width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.imageTag};for(let e of bt(this,ei,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(yi(t));this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(t,this._templateName);i.originalImageTag=e.imageTag,bt(this,qt,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1}),bt(this,$t,"m",ui).call(this,i)}setInput(e){Ei(this),Lt(this,qt,e),e||bt(this,ci,"f")&&(bt(this,Kt,"f").removeResultReceiver(bt(this,ci,"f")),Lt(this,ci,null))}getInput(){return bt(this,qt,"f")}addImageSourceStateListener(e){if(Ei(this),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&bt(this,ti,"f").add(e)}removeImageSourceStateListener(e){return Ei(this),bt(this,ti,"f").delete(e)}addResultReceiver(e){if(Ei(this),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(bt(this,ei,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){Ei(this),bt(this,ei,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onProcessedDocumentResultReceived:!1,onParsedResultsReceived:!1};for(let t of bt(this,ei,"f"))t.isDce||(e.onCapturedResultReceived=!!t.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!t.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!t.onRecognizedTextLinesReceived,e.onProcessedDocumentResultReceived=!!t.onProcessedDocumentResultReceived,e.onParsedResultsReceived=!!t.onParsedResultsReceived);let t=_e();return await new Promise((i,n)=>{Ee[t]=async e=>{e.success?i():Ii({message:e.message,rj:n,stack:e.stack,functionName:"addResultReceiver"})},pe.postMessage({type:"cvr_setCrrRegistry",id:t,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}})})}async addResultFilter(e){if(Ei(this),!e._dynamsoft)throw new Error("User defined CapturedResultFilter is not supported.");if(!e||"object"!=typeof e||!Object.keys(e).length)return console.warn("Invalid filter.");bt(this,ii,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){Ei(this),bt(this,ii,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(bt(this,Kt,"f").removeResultReceiver(Ri),0===bt(this,ii,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1,[Q.CRIT_ENHANCED_IMAGE]:!1},t={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1,[Q.CRIT_ENHANCED_IMAGE]:!1};return await bt(this,$t,"m",gi).call(this,e),void await bt(this,$t,"m",mi).call(this,t)}for(let e of bt(this,ii,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(Q.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(Q.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(Q.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(Q.CRIT_DESKEWED_IMAGE),e.isLatestOverlappingEnabled(Q.CRIT_BARCODE)&&([...bt(this,Kt,"f")._intermediateResultReceiverSet.values()].find(e=>e.isFilter)||bt(this,Kt,"f").addResultReceiver(Ri)),await bt(this,$t,"m",gi).call(this,e.verificationEnabled),await bt(this,$t,"m",mi).call(this,e.duplicateFilterEnabled),await bt(this,$t,"m",pi).call(this,e.duplicateForgetTime),await bt(this,$t,"m",fi).call(this,e.crossVerificationCriteria)}async startCapturing(e){if(Ei(this),!this._isPauseScan)return;if(!bt(this,qt,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=Ci._defaultTemplate);for(let e of bt(this,ii,"f"))await this.addResultFilter(e);const t=v(Me.engineResourcePaths);return void 0!==bt(this,qt,"f").singleFrameMode&&"disabled"!==bt(this,qt,"f").singleFrameMode?(this._templateName=e,void bt(this,qt,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind)):bt(this,Qt,"f")&&bt(this,Qt,"f").isPending?bt(this,Qt,"f"):(Lt(this,Qt,new xt((i,n)=>{if(this.disposed)return;let s=_e();Ee[s]=async t=>{bt(this,Qt,"f")&&!bt(this,Qt,"f").isFulfilled&&(t.success?(this._isPauseScan=!1,this._isOutputOriginalImage=t.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{-1!==this._minImageCaptureInterval&&bt(this,qt,"f").startFetching(),this._loopReadVideo(e),i()},0)):Ii({message:t.message,rj:n,stack:t.stack,functionName:"startCapturing"}))},pe.postMessage({type:"cvr_startCapturing",id:s,instanceID:this._instanceID,body:{templateName:e,engineResourcePaths:t}})})),await bt(this,Qt,"f"))}stopCapturing(){if(Ei(this),!bt(this,qt,"f"))return;bt(this,qt,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,Lt(this,Qt,null),bt(this,qt,"f").setColourChannelUsageType(o.CCUT_AUTO);const e=_e();Ee[e]=()=>{},pe.postMessage({type:"cvr_stopCapturing",id:e,instanceID:this._instanceID})}async containsTask(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));Ii({message:e.message,rj:i,stack:e.stack,functionName:"containsTask"})},pe.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async switchCapturingTemplate(e){this.stopCapturing(),await this.startCapturing(e)}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(Lt(this,ai,!0),bt(this,qt,"f").isBufferEmpty())if(bt(this,qt,"f").hasNextImageToFetch())for(let e of bt(this,ti,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(Yt.ISS_BUFFER_EMPTY);else if(!bt(this,qt,"f").hasNextImageToFetch())for(let e of bt(this,ti,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(Yt.ISS_EXHAUSTED);const t=bt(this,qt,"f").getImage();if(t&&t.imageTag&&Date.now()-t.imageTag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!t)return void this._reRunCurrnetFunc(e);for(let e of bt(this,ei,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(yi(t));const i=Date.now();this._captureDsimage(t,e).then(async n=>{if(Ci._onLog&&Ci._onLog("no js handle time: "+(Date.now()-i)),this._isPauseScan)return void this._reRunCurrnetFunc(e);n.originalImageTag=t.imageTag?t.imageTag:null,bt(this,qt,"f")._capturedResultReceiver&&bt(this,qt,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(n,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify});for(let e of bt(this,ii,"f")){const t=e;t.onOriginalImageResultReceived(n),t.onDecodedBarcodesReceived(n),t.onRecognizedTextLinesReceived(n),t.onProcessedDocumentResultReceived(n),t.onParsedResultsReceived(n)}bt(this,$t,"m",ui).call(this,n);const s=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-i),this._averageFetchImageTimeArray.push(t&&t.imageTag?t.imageTag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Ci._onLog&&(Ci._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Ci._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Ci._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Ci._onLog(`averageTime: ${this._averageTime}`))),Ci._onLog){const e=Date.now()-s;e>10&&Ci._onLog(`fetch image calculate time: ${e}`)}Ci._onLog&&Ci._onLog(`time finish decode: ${Date.now()}`),Ci._onLog&&Ci._onLog("main time: "+(Date.now()-i)),Ci._onLog&&Ci._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(t=>{bt(this,qt,"f").stopFetching(),"platform error"!==t.message&&(t.errorCode&&0===t.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{bt(this,qt,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),setTimeout(()=>{if(!this.onCaptureError)throw t;this.onCaptureError(t)},0))})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async getClarity(e,t,i,n,s){const{bytes:r,width:a,height:o,stride:l,format:c}=e;let d=_e();return new Promise((e,h)=>{Ee[d]=async t=>{t.success?e(t.clarity):Ii({message:t.message,rj:h,stack:t.stack,functionName:"getClarity"})},pe.postMessage({type:"cvr_getClarity",id:d,instanceID:this._instanceID,body:{bytes:r,width:a,height:o,stride:l,format:c,bitcount:t,wr:i,hr:n,grayThreshold:s}},[r.buffer])})}async capture(e,t){let i;if(Ei(this),t||(t=Ci._defaultTemplate),Lt(this,ai,!1),E(e))i=await this._captureDsimage(e,t);else if("string"==typeof e)i="data:image/"==e.substring(0,11)?await this._captureBase64(e,t):await this._captureUrl(e,t);else if(e instanceof Blob)i=await this._captureBlob(e,t);else if(e instanceof HTMLImageElement)i=await this._captureImage(e,t);else if(e instanceof HTMLCanvasElement)i=await this._captureCanvas(e,t);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");i=await this._captureVideo(e,t)}return i}async _captureDsimage(e,t){return await this._captureInWorker(e,t)}async _captureUrl(e,t){let i=await R(e,"blob");return await this._captureBlob(i,t)}async _captureBase64(e,t){e=e.substring(e.indexOf(",")+1);let i=atob(e),n=i.length,s=new Uint8Array(n);for(;n--;)s[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([s]),t)}async _captureBlob(e,t){let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await async function(t){return await new Promise((i,n)=>{let s=URL.createObjectURL(t),r=new Image;r.src=s,r.onload=()=>{URL.revokeObjectURL(r.dbrObjUrl),i(r)},r.onerror=()=>{let t="Unsupported image format. Please upload files in one of the following formats: .jpg,.jpeg,.ico,.gif,.svg,.webp,.png,.bmp";"image/svg+xml"===e.type&&(t="Invalid SVG file. The file appears to be malformed or contains invalid XML."),n(new Error(t))}})}(e));let s=await this._captureImage(i||n,t);return i&&i.close(),s}async _captureImage(e,t){let i,n,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(s,r);a>this.maxImageSideLength?(Lt(this,ri,this.maxImageSideLength/a),i=Math.round(s*bt(this,ri,"f")),n=Math.round(r*bt(this,ri,"f"))):(i=s,n=r),bt(this,Xt,"f")||Lt(this,Xt,document.createElement("canvas"));const o=bt(this,Xt,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(o,t)}async _captureCanvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:l.IPF_ABGR_8888};return await this._captureInWorker(n,t)}async _captureVideo(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,n,s=e.videoWidth,r=e.videoHeight,a=Math.max(s,r);a>this.maxImageSideLength?(Lt(this,ri,this.maxImageSideLength/a),i=Math.round(s*bt(this,ri,"f")),n=Math.round(r*bt(this,ri,"f"))):(i=s,n=r),bt(this,Xt,"f")||Lt(this,Xt,document.createElement("canvas"));const o=bt(this,Xt,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),await this._captureCanvas(o,t)}async _captureInWorker(e,t){let{bytes:i,width:n,height:s,stride:r,format:a,imageTag:o}=e,l=_e();return await new Promise((c,d)=>{this.privideDsImage=e,Ee[l]=t=>{if(t.success){const i=Date.now();Ci._onLog&&(Ci._onLog(`get result time from worker: ${i}`),Ci._onLog("worker to main time consume: "+(i-t.workerReturnMsgTime)));try{bt(this,$t,"m",di).call(this,t.captureResult,e),e.bytes=t.bytes,t.isScanner||Lt(this,ri,0),bt(this,$t,"m",hi).call(this,t.intermediateResult,o);const i=Date.now();return i-bt(this,si,"f")>bt(this,ni,"f")&&null!==t.mliRecord&&(null===localStorage||void 0===localStorage||localStorage.setItem("dynamsoft",t.mliRecord),Lt(this,si,i)),c(t.captureResult)}catch(e){Ii({message:e.message,rj:d,stack:e.stack,functionName:"capture"})}}else Ii({message:t.message,rj:d,stack:t.stack,functionName:"capture"})},Ci._onLog&&Ci._onLog(`send buffer to worker: ${Date.now()}`),pe.postMessage({type:"cvr_capture",id:l,instanceID:this._instanceID,body:{bytes:i,width:n,height:s,stride:r,format:a,templateName:t||"",isScanner:bt(this,ai,"f"),dynamsoft:this._dynamsoft}},[i.buffer])})}async initSettings(e){if(Ei(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await R(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=_e();Ee[n]=async n=>{if(n.success){const s=JSON.parse(n.response);if(0!==s.errorCode&&Ii({message:s.errorString?s.errorString:"Init Settings Failed.",rj:i,errorCode:s.errorCode,functionName:"initSettings"}))return;const r=JSON.parse(e);return this._currentSettings=r,this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,Ci._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,t(s)}Ii({message:n.message,rj:i,stack:n.stack,functionName:"initSettings"})},pe.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid template.")}async outputSettings(e,t){return Ei(this),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Ii({message:t.errorString,rj:n,errorCode:t.errorCode,functionName:"outputSettings"}),i(JSON.parse(t.data))}Ii({message:e.message,rj:n,stack:e.stack,functionName:"outputSettings"})},pe.postMessage({type:"cvr_outputSettings",id:s,instanceID:this._instanceID,body:{templateName:e,includeDefaultValues:!!t}})})}async outputSettingsToFile(e,t,i,n){const s=await this.outputSettings(e,n),r=new Blob([JSON.stringify(s,null,2,function(e,t){return t instanceof Array?JSON.stringify(t):t},2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(r),t.endsWith(".json")&&(t=t.replace(".json","")),e.download=`${t}.json`,e.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(e.href)},500)},e.click()}return r}async getTemplateNames(){return Ei(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Ii({message:n.errorString,rj:t,errorCode:n.errorCode,functionName:"getTemplateNames"}),e(JSON.parse(n.data))}Ii({message:i.message,rj:t,stack:i.stack,functionName:"getTemplateNames"})},pe.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})}async getSimplifiedSettings(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success){const n=JSON.parse(e.response);0!==n.errorCode&&Ii({message:n.errorString,rj:i,errorCode:n.errorCode,functionName:"getSimplifiedSettings"});const s=JSON.parse(n.data,(e,t)=>"barcodeFormatIds"===e?BigInt(t):t);return s.minImageCaptureInterval=this._minImageCaptureInterval,t(s)}Ii({message:e.message,rj:i,stack:e.stack,functionName:"getSimplifiedSettings"})},pe.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,t){return Ei(this),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success){const s=JSON.parse(e.response);return t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._isOutputOriginalImage=e.isOutputOriginalImage,0!==s.errorCode&&Ii({message:s.errorString?s.errorString:"Update Settings Failed.",rj:n,errorCode:s.errorCode,functionName:"updateSettings"}),this._currentSettings=await this.outputSettings("*"),i(s)}Ii({message:e.message,rj:n,stack:e.stack,functionName:"updateSettings"})},pe.postMessage({type:"cvr_updateSettings",id:s,instanceID:this._instanceID,body:{settings:t,templateName:e}})})}async resetSettings(){return Ei(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Ii({message:n.errorString?n.errorString:"Reset Settings Failed.",rj:t,errorCode:n.errorCode,functionName:"resetSettings"}),this._currentSettings=await this.outputSettings("*"),e(n)}Ii({message:i.message,rj:t,stack:i.stack,functionName:"resetSettings"})},pe.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})}getBufferedItemsManager(){return bt(this,Jt,"f")||Lt(this,Jt,new Nt(this)),bt(this,Jt,"f")}getIntermediateResultManager(){if(Ei(this),!bt(this,oi,"f")&&0!==Me.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return bt(this,Kt,"f")||Lt(this,Kt,new Bt(this)),bt(this,Kt,"f")}static async setGlobalIntraOpNumThreads(e=0){return e>4||e<0?Promise.reject(new RangeError("'intraOpNumThreads' should be between 0 and 4.")):(await Me.loadWasm(),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();Ii({message:e.message,rj:i,stack:e.stack,functionName:"setGlobalIntraOpNumThreads"})},pe.postMessage({type:"cvr_setGlobalIntraOpNumThreads",id:n,body:{intraOpNumThreads:e}})}))}async parseRequiredResources(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));Ii({message:e.message,rj:i,stack:e.stack,functionName:"parseRequiredResources"})},pe.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){Ei(this),bt(this,Qt,"f")&&this.stopCapturing(),Lt(this,qt,null),bt(this,ei,"f").clear(),bt(this,ti,"f").clear(),bt(this,ii,"f").clear(),bt(this,Kt,"f")._intermediateResultReceiverSet.clear(),Lt(this,li,!0);let e=_e();Ee[e]=e=>{e.success||Ii({message:e.message,stack:e.stack,isShouldThrow:!0,functionName:"dispose"})},pe.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:bt(this,qt,"f"),promiseStartScan:bt(this,Qt,"f"),intermediateResultManager:bt(this,Kt,"f"),bufferdItemsManager:bt(this,Jt,"f"),resultReceiverSet:bt(this,ei,"f"),isaStateListenerSet:bt(this,ti,"f"),resultFilterSet:bt(this,ii,"f"),compressRate:bt(this,ri,"f"),canvas:bt(this,Xt,"f"),isScanner:bt(this,ai,"f"),innerUseTag:bt(this,oi,"f"),isDestroyed:bt(this,li,"f")}}async _getWasmFilterState(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const t=JSON.parse(i.response);return e(t)}Ii({message:i.message,rj:t,stack:i.stack,functionName:""})},pe.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})}}qt=new WeakMap,Xt=new WeakMap,Qt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,ei=new WeakMap,ti=new WeakMap,ii=new WeakMap,ni=new WeakMap,si=new WeakMap,ri=new WeakMap,ai=new WeakMap,oi=new WeakMap,li=new WeakMap,ci=new WeakMap,$t=new WeakSet,di=function(e,t){var i,n,s,r,a,o,l,c,d,h,u,g;for(let m=0;m<e.items.length;m++){const p=e.items[m];switch(0!==bt(this,ri,"f")&&_i(p,bt(this,ri,"f")),p.type){case Q.CRIT_ORIGINAL_IMAGE:e.items[m]=yi(t);break;case Q.CRIT_BARCODE:null!==(i=(l=e.decodedBarcodesResult).barcodeResultItems)&&void 0!==i||(l.barcodeResultItems=[]),e.decodedBarcodesResult.barcodeResultItems.push(p);break;case Q.CRIT_TEXT_LINE:null!==(n=(c=e.recognizedTextLinesResult).textLineResultItems)&&void 0!==n||(c.textLineResultItems=[]),e.recognizedTextLinesResult.textLineResultItems.push(p);break;case Q.CRIT_DETECTED_QUAD:null!==(s=(d=e.processedDocumentResult).detectedQuadResultItems)&&void 0!==s||(d.detectedQuadResultItems=[]),e.processedDocumentResult.detectedQuadResultItems.push(p);break;case Q.CRIT_DESKEWED_IMAGE:ve.ddn&&ve.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(r=(h=e.processedDocumentResult).deskewedImageResultItems)&&void 0!==r||(h.deskewedImageResultItems=[]),e.processedDocumentResult.deskewedImageResultItems.push(p);break;case Q.CRIT_ENHANCED_IMAGE:ve.ddn&&ve.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(a=(u=e.processedDocumentResult).enhancedImageResultItems)&&void 0!==a||(u.enhancedImageResultItems=[]),e.processedDocumentResult.enhancedImageResultItems.push(p);break;case Q.CRIT_PARSED_RESULT:ve.dcp&&ve.dcp.handleParsedResultItem(p),null!==(o=(g=e.parsedResult).parsedResultItems)&&void 0!==o||(g.parsedResultItems=[]),e.parsedResult.parsedResultItems.push(p)}}},hi=function(e,t){const i=e;if(i){let e=0;for(let n of bt(this,Kt,"f")._intermediateResultReceiverSet){e++;for(let s of i){if(["onTaskResultsReceived","onTargetROIResultsReceived"].includes(s.info.callbackName)){for(let e of s.intermediateResultUnits)e.originalImageTag=t||null;n[s.info.callbackName]&&n[s.info.callbackName]({intermediateResultUnits:s.intermediateResultUnits},s.info)}else n[s.info.callbackName]&&n[s.info.callbackName](s.result,s.info);e===bt(this,Kt,"f")._intermediateResultReceiverSet.size&&delete s.info.callbackName}}}},ui=function(e){for(let t of bt(this,ei,"f"))e.decodedBarcodesResult&&t.onDecodedBarcodesReceived&&t.onDecodedBarcodesReceived(e.decodedBarcodesResult),e.recognizedTextLinesResult&&t.onRecognizedTextLinesReceived&&t.onRecognizedTextLinesReceived(e.recognizedTextLinesResult),e.processedDocumentResult&&t.onProcessedDocumentResultReceived&&t.onProcessedDocumentResultReceived(e.processedDocumentResult),e.parsedResult&&t.onParsedResultsReceived&&t.onParsedResultsReceived(e.parsedResult),t.onCapturedResultReceived&&t.onCapturedResultReceived(e)},gi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ii({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_enableResultCrossVerification",id:n,instanceID:this._instanceID,body:{verificationEnabled:e}})})},mi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ii({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_enableResultDeduplication",id:n,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})},pi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ii({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_setDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})},fi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();Ii({message:e.message,rj:i,stack:e.stack,functionName:"setResultCrossVerificationCriteria"})},pe.postMessage({type:"cvr_setResultCrossVerificationCriteria",id:n,instanceID:this._instanceID,body:{criteria:e}})})},Ci._defaultTemplate="Default",Ci._isNoOnnx=!1;class wi{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}var vi;!function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadSingleBarcode",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(vi||(vi={}));const Ti="undefined"==typeof self,Si=Ti?{}:self,Di="function"==typeof importScripts,Mi=(()=>{if(!Di){if(!Ti&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),bi=e=>e&&"object"==typeof e&&"function"==typeof e.then,Li=(async()=>{})().constructor;let Ai=class extends Li{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,bi(e)?t=e:"function"==typeof e&&(t=new Li(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(bi(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}};const Oi=" is not allowed to change after `createInstance` or `loadWasm` is called.",xi=!Ti&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Ni=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+Oi);i._license=t}};!Ti&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Pi=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!Ti){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},ki=(e,t)=>{t=Pi(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+Oi);i._licenseServer=t}},Bi=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Oi);i._deviceFriendlyName=t}};let Fi,Vi,Ui,Zi,Gi;"undefined"!=typeof navigator&&(Fi=navigator,Vi=Fi.userAgent,Ui=Fi.platform,Zi=Fi.mediaDevices),function(){if(!Ti){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Fi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Ui,search:"Win"},Mac:{str:Ui},Linux:{str:Ui}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||Vi,a=s.search||t,o=s.verStr||Vi,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||Vi,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=Vi.indexOf("Windows NT")&&(s="HarmonyOS"),Gi={browser:i,version:n,OS:s}}Ti&&(Gi={browser:"ssr",version:0,OS:"ssr"})}(),Zi&&Zi.getUserMedia,"Chrome"===Gi.browser&&Gi.version>66||"Safari"===Gi.browser&&Gi.version>13||"OPR"===Gi.browser&&Gi.version>43||"Edge"===Gi.browser&&Gi.version;const Hi=()=>(Me.loadWasm(),me("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:i,sp:n,rmk:s,cv:r}=((e,t=!1)=>{const i=zi;if(i._pLoad.isEmpty){let n,s,r,a=i._license||"",o=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(s=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),o=Pi(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(Si.crypto||(r="Please upgrade your browser to support online key."),Si.crypto.subtle||(r="Require https to use online key in this browser."))),r)throw new Error(r);return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:o,sp:l,rmk:n,cv:s}}throw new Error("Can't preprocess license again"+Oi)})(),a=new Ai;zi._pLoad.task=a,(async()=>{try{await zi._pLoad}catch(e){}})();let o=_e();Ee[o]=t=>{if(t.message&&zi._onAuthMessage){let e=zi._onAuthMessage(t.message);null!=e&&(t.message=e)}let i,n=!1;if(1===e&&(n=!0),t.success?(ye&&ye("init license success"),t.message&&console.warn(t.message),Me._bSupportIRTModule=t.bSupportIRTModule,Me._bSupportDce4Module=t.bSupportDce4Module,zi.bPassValidation=!0,[0,-10076].includes(t.initLicenseInfo.errorCode)?[-10076].includes(t.initLicenseInfo.errorCode)&&console.warn(t.initLicenseInfo.errorString):a.reject(new Error(t.initLicenseInfo.errorString))):(i=Error(t.message),t.stack&&(i.stack=t.stack),t.ltsErrorCode&&(i.ltsErrorCode=t.ltsErrorCode),n||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const e=v(Me.engineResourcePaths),i=("DCV"===Me._bundleEnv?e.dcvData:e.dbrBundle)+"ui/";(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.insertAdjacentHTML("beforeend",s);let a=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==r.childElementCount?r.children[0]:r;o.remove();let l,c,d,h,u,g=[o],m=o.children;for(let e of m)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}});else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",()=>{o.remove();for(let e of a)e.remove()});else if(!d&&e.classList.contains("dls-license-icon-error"))d=e,"error"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-icon-warn"))h=e,"warn"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-msg-content")){u=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),s=t.indexOf("(",n),r=t.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==r){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),o=t.substring(i+1,n);a.innerText=o;let l=t.substring(s+1,r);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(r+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:zi._bNeverShowDialog,engineResourcePath:i,_onLog:ye},t.success?"warn":"error",t.message)}t.success?a.resolve(void 0):a.reject(i)},await ge("core");const l=await Me.getModuleVersion();pe.postMessage({type:"license_dynamsoft",body:{v:"DCV"===Me._bundleEnv?l.CVR.replace(/\.\d+$/,""):l.DBR.replace(/\.\d+$/,""),brtk:!!e,bptk:1===e,l:t,os:Gi,fn:zi.deviceFriendlyName,ls:i,sp:n,rmk:s,cv:r,_e:zi._e,mliRecord:null===localStorage||void 0===localStorage?void 0:localStorage.getItem("dynamsoft")},id:o}),zi.bCallInitLicense=!0,await a}));let Wi;ve.license={},ve.license.dynamsoft=Hi,ve.license.getAR=async()=>{{let e=ue.dynamsoft_inited;e&&e.isRejected&&await e}return pe?new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){delete i.success;{let e=zi.license;e&&(e.startsWith("t")||e.startsWith("f"))&&(i.pk=e)}if(Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null)}else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},pe.postMessage({type:"license_getAR",id:i})}):null};let zi=class e{static setLicenseServer(t){ki(e,t)}static get license(){return this._license}static set license(t){Ni(e,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){ki(e,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Bi(e,t)}static initLicense(t,i){if(Ni(e,t),e.bCallInitLicense=!0,"boolean"==typeof i&&i||"object"==typeof i&&i.executeNow)return Hi()}static setDeviceFriendlyName(t){Bi(e,t)}static getDeviceFriendlyName(){return e._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await me("dynamsoft_uuid",async()=>{await Me.loadWasm();let e=new Ai,t=_e();Ee[t]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},pe.postMessage({type:"license_getDeviceUUID",id:t}),Wi=await e}),Wi))()}};zi._pLoad=new Ai,zi.bPassValidation=!1,zi.bCallInitLicense=!1,zi._license=xi,zi._licenseServer=[],zi._deviceFriendlyName="",zi._e=!0,Me.engineResourcePaths.license={version:"4.4.10-dev-20260129110719",path:Mi,isInternal:!0},Te.license={wasm:!0,js:!0},ve.license.LicenseManager=zi;const ji="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,ji)<0&&(Me.engineResourcePaths.std={version:ji,path:(e=>{if(null==e&&(e="./"),Ti||Di);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Mi+`../../dynamsoft-capture-vision-std@${ji}/dist/`),isInternal:!0});const Yi="undefined"==typeof self,$i="function"==typeof importScripts,qi=(()=>{if(!$i){if(!Yi&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Xi=e=>{if(null==e&&(e="./"),Yi||$i);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.dbr={version:"11.4.10-dev-20260129110729",path:qi,isInternal:!0},Te.dbr={js:!1,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE,he.MN_DYNAMSOFT_IMAGE_PROCESSING]},ve.dbr={};const Qi="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,Qi)<0&&(Me.engineResourcePaths.std={version:Qi,path:Xi(qi+`../../dynamsoft-capture-vision-std@${Qi}/dist/`),isInternal:!0});const Ki="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,Ki)<0)&&(Me.engineResourcePaths.dip={version:Ki,path:Xi(qi+`../../dynamsoft-image-processing@${Ki}/dist/`),isInternal:!0});const Ji={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var en,tn,nn,sn;function rn(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(en||(en={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(tn||(tn={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_NEURAL_NETWORK=512]="LM_NEURAL_NETWORK",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=-1]="LM_END"}(nn||(nn={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=-1]="DM_END"}(sn||(sn={})),"function"==typeof SuppressedError&&SuppressedError;const an="undefined"==typeof self,on=(()=>{if(!an&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),ln=e=>{if(null==e&&(e="./"),an);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var cn,dn;Me.engineResourcePaths.dlr={version:"4.4.10-dev-20260129110735",path:on,isInternal:!0},Te.dlr={js:!0,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE,he.MN_DYNAMSOFT_IMAGE_PROCESSING]};const hn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,hn)<0&&(Me.engineResourcePaths.std={version:hn,path:ln(on+`../../dynamsoft-capture-vision-std@${hn}/dist/`),isInternal:!0});const un="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,un)<0)&&(Me.engineResourcePaths.dip={version:un,path:ln(on+`../../dynamsoft-image-processing@${un}/dist/`),isInternal:!0});let gn=class e{static getVersion(){const e=we.dlr&&we.dlr.wasm;return`4.4.10-dev-20260129110735(Worker: ${we.dlr&&we.dlr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadConfusableCharsData(t,i){return rn(e,cn,"m",dn).call(e,"confusable",t,i)}static async loadOverlappingCharsData(t,i){return rn(e,cn,"m",dn).call(e,"overlapping",t,i)}};cn=gn,dn=async function(e,t,i){return await Me.loadWasm(),await new Promise((n,s)=>{let r=_e();Ee[r]=async e=>{if(e.success){const t=JSON.parse(e.result);if(0!==t.errorCode){let e=new Error(t.errorString);return e.errorCode=t.errorCode,s(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},i&&!i.endsWith("/")&&(i+="/");const a=v(Me.engineResourcePaths);pe.postMessage({type:"dlr_loadData",id:r,body:{type:e,dataName:t,dataPath:i||a.dcvData+"char-resources/"}})})},ve.dlr={loadConfusableCharsData:gn.loadConfusableCharsData,loadOverlappingCharsData:gn.loadOverlappingCharsData};const mn={filterVINResult:function(e){let t="";if(18===e.characterResults.length){let t=e.characterResults[9].location.points[0].x-e.characterResults[8].location.points[1].x;t<2&&(t=2);let i=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,n=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,s=2===t?3:t;i-t>=s&&n-t<s?e.characterResults.shift():n-t>=s&&i-t<s||e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[10].location.points[0].x-e.characterResults[9].location.points[1].x;t<2&&(t=2);let i,n,s,r=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,a=e.characterResults[18].location.points[0].x-e.characterResults[17].location.points[1].x,o=e.characterResults[2].location.points[0].x-e.characterResults[1].location.points[1].x,l=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,c=2===t?3:t;if("1"===e.characterResults[1].characterH||"1"===e.characterResults[2].characterH||"1"===e.characterResults[16].characterH||"1"===e.characterResults[17].characterH){for(let t=9;t<e.characterResults.length;t++)if("1"!==e.characterResults[t].characterH){s=e.characterResults[t].location.points[1].x-e.characterResults[t].location.points[0].x;break}"1"===e.characterResults[1].characterH&&(i=s-(e.characterResults[1].location.points[1].x-e.characterResults[1].location.points[0].x)+3),"1"===e.characterResults[2].characterH&&(i=s-(e.characterResults[2].location.points[1].x-e.characterResults[2].location.points[0].x)+3),"1"===e.characterResults[16].characterH&&(n=s-(e.characterResults[16].location.points[1].x-e.characterResults[16].location.points[0].x)+3),"1"===e.characterResults[17].characterH&&(n=s-(e.characterResults[17].location.points[1].x-e.characterResults[17].location.points[0].x)+3)}if(o-t>=(i||c)&&l-t<(n||c))e.characterResults.splice(0,2);else if(l-t>=(n||c)&&o-t<(i||c))e.characterResults.splice(17,2);else if(r>t&&a>t)e.characterResults.pop(),e.characterResults.shift();else{let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,i=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,n=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,s=Math.min(t,i,n);s===t?e.characterResults.splice(0,2):s===i?e.characterResults.splice(17,2):s===n&&(e.characterResults.pop(),e.characterResults.shift())}}for(let i of e.characterResults)t+=i.characterH;return t},checkValidVIN:function(e){return!(!e||17!=e.length)&&(e=>{const t=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let n=0;for(let s=0;s<e.length;s++){let r=t.get(e[s]);r&&(n+=r*i[s])}return n%11})(e).toString()===e[8]},checkValidMRP:function(e){if(!e||44!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),n=t(e,0,8).toString(),s=t(e,13,18).toString(),r=t(e,21,26).toString(),a=t(e,28,41).toString(),o=t(i,0,i.length).toString();return n===e[9]&&s===e[19]&&r===e[27]&&a===e[42]&&o===e[43]},checkValidMRV:function(e){if(!e||44!=e.length&&36!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=t(e,0,8).toString(),n=t(e,13,18).toString(),s=t(e,21,26).toString();return i===e[9]&&n===e[19]&&s===e[27]},checkValidIDCard:function(e,t){if(!e||30!=e.length&&36!=e.length)return!1;const i=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10};if(30===e.length){if(t&&e===t)return i(e,5,13).toString()===e[14];if(t&&e!==t){const n=`${t.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return i(n,0,n.length-1).toString()===e[29]}}else if(36===e.length){const t=i(e,0,8).toString(),n=i(e,13,18).toString(),s=i(e,21,26).toString(),r=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,a=i(r,0,r.length-1).toString();return t===e[9]&&n===e[19]&&s===e[27]&&a===e[35]}}};var pn,fn,_n;function En(e){delete e.moduleId;const t=JSON.parse(e.jsonString).ResultInfo,i=e.fullCodeString;e.getFieldValue=e=>"fullcodestring"===e.toLowerCase()?i:yn(t,e,"map"),e.getFieldRawValue=e=>"fullcodestring"===e.toLowerCase()?i:yn(t,e,"raw"),e.getFieldMappingStatus=e=>In(t,e),e.getFieldValidationStatus=e=>Rn(t,e),e.getAllFieldNames=()=>function(e){const t=[],i=e=>{const t=[];for(let n of e)for(let e of n)e.FieldName&&t.push(e.FieldName),e.ChildFields&&e.ChildFields.length>0&&t.push(...i(e.ChildFields));return t};for(let n of e)n.FieldName&&t.push(n.FieldName),n.ChildFields&&n.ChildFields.length>0&&t.push(...i(n.ChildFields));return t}(t),delete e.fullCodeString}function yn(e,t,i){for(let n of e){if(n.FieldName===t)return"raw"===i&&n.RawValue?n.RawValue:n.Value;if(n.ChildFields&&n.ChildFields.length>0){let e;for(let s of n.ChildFields)e=yn(s,t,i);if(void 0!==e)return e}}}function In(e,t){for(let i of e){if(i.FieldName===t)return i.MappingStatus?Number(fn[i.MappingStatus]):fn.MS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=In(n,t);if(void 0!==e)return e}}return fn.MS_NONE}function Rn(e,t){for(let i of e){if(i.FieldName===t&&i.ValidationStatus)return i.ValidationStatus?Number(_n[i.ValidationStatus]):_n.VS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=Rn(n,t);if(void 0!==e)return e}}return _n.VS_NONE}function Cn(e){if(e.disposed)throw new Error('"CodeParser" instance has been disposed')}!function(e){e[e.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",e[e.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",e[e.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED"}(pn||(pn={})),Ee[-1]=async e=>{gn.onDataLoadProgressChanged&&gn.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})},function(e){e[e.MS_NONE=0]="MS_NONE",e[e.MS_SUCCEEDED=1]="MS_SUCCEEDED",e[e.MS_FAILED=2]="MS_FAILED"}(fn||(fn={})),function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_SUCCEEDED=1]="VS_SUCCEEDED",e[e.VS_FAILED=2]="VS_FAILED"}(_n||(_n={}));const wn=e=>e&&"object"==typeof e&&"function"==typeof e.then,vn=(async()=>{})().constructor;class Tn extends vn{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,wn(e)?t=e:"function"==typeof e&&(t=new vn(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(wn(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const Sn="undefined"==typeof self,Dn="function"==typeof importScripts,Mn=(()=>{if(!Dn){if(!Sn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();Me.engineResourcePaths.dcp={version:"3.4.10-dev-20260129110745",path:Mn,isInternal:!0},Te.dcp={js:!0,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE]},ve.dcp={handleParsedResultItem:En};const bn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,bn)<0&&(Me.engineResourcePaths.std={version:bn,path:(e=>{if(null==e&&(e="./"),Sn||Dn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Mn+`../../dynamsoft-capture-vision-std@${bn}/dist/`),isInternal:!0}),Ee[-4]=async e=>{Ln.onSpecLoadProgressChanged&&Ln.onSpecLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};let Ln=class{static getVersion(){const e=we.dcp&&we.dcp.wasm;return`3.4.10-dev-20260129110745(Worker: ${we.dcp&&we.dcp.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadSpec(e,t){return await Me.loadWasm(),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},t&&!t.endsWith("/")&&(t+="/");let r=(e instanceof Array?e:[e]).map(e=>e.replace(/^MRTD.*$/,"MRTD"));r=r.map(e=>e.replace(/\.data$/i,""));let a=v(Me.engineResourcePaths);pe.postMessage({type:"dcp_appendResourceBuffer",id:s,body:{specificationPath:t||`${"DBR"===Me._bundleEnv?a.dbrBundle:a.dcvData}parser-resources/`,specificationNames:r}})})}};const An="undefined"==typeof self,On="function"==typeof importScripts,xn=(()=>{if(!On){if(!An&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Nn=e=>{if(null==e&&(e="./"),An||On);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.ddn={version:"3.4.10-dev-20260129110740",path:xn,isInternal:!0},Te.ddn={js:!0,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE,he.MN_DYNAMSOFT_IMAGE_PROCESSING]},ve.ddn={handleDeskewedAndEnhancedImageResultItem:function(e){let t=e,i=L(t.imageData);t.toCanvas=()=>S(i),t.toImage=e=>D(e,i),t.toBlob=e=>M(e,i)}};const Pn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,Pn)<0&&(Me.engineResourcePaths.std={version:Pn,path:Nn(xn+`../../dynamsoft-capture-vision-std@${Pn}/dist/`),isInternal:!0});const kn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,kn)<0)&&(Me.engineResourcePaths.dip={version:kn,path:Nn(xn+`../../dynamsoft-image-processing@${kn}/dist/`),isInternal:!0});var Bn;!function(e){e[e.ICM_COLOUR=0]="ICM_COLOUR",e[e.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",e[e.ICM_BINARY=2]="ICM_BINARY"}(Bn||(Bn={}));const Fn="undefined"==typeof self,Vn="function"==typeof importScripts,Un=(()=>{if(!Vn){if(!Fn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Zn=e=>{if(null==e&&(e="./"),Fn||Vn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.utility={version:"2.4.10-dev-20260129110724",path:Un,isInternal:!0},Te.utility={js:!0,wasm:!0};const Gn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,Gn)<0&&(Me.engineResourcePaths.std={version:Gn,path:Zn(Un+`../../dynamsoft-capture-vision-std@${Gn}/dist/`),isInternal:!0});const Hn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,Hn)<0)&&(Me.engineResourcePaths.dip={version:Hn,path:Zn(Un+`../../dynamsoft-image-processing@${Hn}/dist/`),isInternal:!0});function Wn(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}"function"==typeof SuppressedError&&SuppressedError;const zn="undefined"==typeof self,jn="function"==typeof importScripts,Yn=(()=>{if(!jn){if(!zn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),$n=e=>{if(null==e&&(e="./"),zn||jn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.dbr={version:"11.0.30-dev-20250522174049",path:Yn,isInternal:!0},Te.dbr={js:!1,wasm:!0,deps:[he.MN_DYNAMSOFT_LICENSE,he.MN_DYNAMSOFT_IMAGE_PROCESSING]},ve.dbr={};const qn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&w(Me.engineResourcePaths.std.version,qn)<0&&(Me.engineResourcePaths.std={version:qn,path:$n(Yn+`../../dynamsoft-capture-vision-std@${qn}/dist/`),isInternal:!0});const Xn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&w(Me.engineResourcePaths.dip.version,Xn)<0)&&(Me.engineResourcePaths.dip={version:Xn,path:$n(Yn+`../../dynamsoft-image-processing@${Xn}/dist/`),isInternal:!0});const Qn={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var Kn,Jn,es,ts,is;(is=Kn||(Kn={}))[is.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",is[is.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",is[is.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT",function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Jn||(Jn={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=4294967295]="LM_END"}(es||(es={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=4294967295]="DM_END"}(ts||(ts={}));const ns=async(e,t)=>{let i,n=document.createElement("canvas"),s=n.getContext("2d"),r=e;try{if(r instanceof Blob){i=URL.createObjectURL(r);const e=await new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.src=i});n.width=e.width,n.height=e.height,s.drawImage(e,0,0),r=s.getImageData(0,0,n.width,n.height)}else n.width=r.width,n.height=r.height,s.putImageData(r,0,0);if("image/bmp"===t){const e=b(r);return new Blob([e],{type:"image/bmp"})}return await new Promise(e=>{n.toBlob(t=>{e(t)},t)})}finally{URL.revokeObjectURL(i)}};function ss(e,t){let i=!0;for(let a=0;a<e.length;a++){const o=(a+1)%e.length;if(n=e[a],r=t,((s=e[o]).x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x)<0){i=!1;break}}var n,s,r;return i}function rs(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function as(e,t){const[i,n]=e,s=i.x,r=i.y,a=n.x,o=n.y,l=t.x,c=t.y,d=(a-s)**2+(o-r)**2;if(0===d)return Math.sqrt((l-s)**2+(c-r)**2);const h=((l-s)*(a-s)+(c-r)*(o-r))/d;if(h<0)return Math.sqrt((l-s)**2+(c-r)**2);if(h>1)return Math.sqrt((l-a)**2+(c-o)**2);{const e=s+h*(a-s),t=r+h*(o-r);return Math.sqrt((l-e)**2+(c-t)**2)}}function os(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],s=e[(i+1)%e.length];t.push([n,s])}return t}function ls(e){const[t,i]=e;return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function cs(e,t,i,n){const s=t.x-e.x,r=t.y-e.y,a=n.x-i.x,o=n.y-i.y,l=(-r*(e.x-i.x)+s*(e.y-i.y))/(-a*r+s*o),c=(a*(e.y-i.y)-o*(e.x-i.x))/(-a*r+s*o);return l>=0&&l<=1&&c>=0&&c<=1?{x:e.x+c*s,y:e.y+c*r}:null}function ds(e){let t=0;for(let i=0;i<e.length;i++){const n=(i+1)%e.length;t+=e[i].x*e[n].y,t-=e[n].x*e[i].y}return Math.abs(t/2)}function hs(e,t,i){let n=t.x-e.x,s=t.y-e.y,r=i.x-e.x;return n*(i.y-e.y)-s*r>0}function us(e,t){for(let i=0;i<4;i++)if(!hs(e.points[i],e.points[(i+1)%4],t))return!1;return!0}function gs(e,t,i,n){const s=e.points,r=t.points;let a=8*i;a=Math.max(a,5);const o=os(s)[3],l=os(s)[1],c=os(r)[3],d=os(r)[1];let h,u=0;if(h=Math.max(Math.abs(as(o,t.points[0])),Math.abs(as(o,t.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(as(l,t.points[1])),Math.abs(as(l,t.points[2]))),h>u&&(u=h),h=Math.max(Math.abs(as(c,e.points[0])),Math.abs(as(c,e.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(as(d,e.points[1])),Math.abs(as(d,e.points[2]))),h>u&&(u=h),u>a)return!1;const g=ls(os(s)[0]),m=ls(os(s)[2]),p=ls(os(r)[0]),f=ls(os(r)[2]),_=rs(g,f),E=rs(p,m),y=_>E,I=Math.min(_,E),R=rs(g,m),C=rs(p,f);let w=12*i;return w=Math.max(w,5),w=Math.min(w,R),w=Math.min(w,C),!!(I<w||ss(s,y?p:f)||ss(r,y?m:g))&&(y?(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]):(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]),n.area=ds(n.points),!0)}class ms{constructor(e,t,i,n){this.overlapCount=e,this.verificationCount=t,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const t={x:0,y:0};return e.forEach(({x:e,y:i})=>{t.x+=e,t.y+=i}),t.x/=e.length,t.y/=e.length,t}isProbablySameLocationWithOffset(e,t){const i=this.item.location,n=e.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let s=new Array(4).fill(0),r=new Array(4).fill(0),a=0,o=0;for(let e=0;e<4;++e)s[e]=Math.round(100*(n.points[e].x-i.points[e].x))/100,a+=s[e],r[e]=Math.round(100*(n.points[e].y-i.points[e].y))/100,o+=r[e];a/=4,o/=4;for(let e=0;e<4;++e){if(Math.abs(s[e]-a)>this.strictLimit||Math.abs(a)>.8)return!1;if(Math.abs(r[e]-o)>this.strictLimit||Math.abs(o)>.8)return!1}return t.x=a,t.y=o,!0}isLocationOverlap(e,t){if(this.locationArea>t){for(let t=0;t<4;t++)if(us(this.location,e.points[t]))return!0;const t=this.getCenterPoint(e.points);if(us(this.location,t))return!0}else{for(let t=0;t<4;t++)if(us(e,this.location.points[t]))return!0;if(us(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,t={x:0,y:0}){if(this.isOneD){const i=Object.assign({},e.location);for(let e=0;e<4;e++)i.points[e].x-=t.x,i.points[e].y-=t.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],s=[this.location.points[1],this.location.points[2]];for(let e=0;e<4;e++){const t=i.points[e],r=0===e||3===e?n:s;if(Math.abs(as(r,t))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=e.location.points[i],s=this.location.points[i];if(!(Math.abs(s.x+t.x-n.x)<this.locationThreshold))return!1;if(Math.abs(s.y+t.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,t,i=!0){const n=Object.assign({},e.location);for(let e=0;e<4;e++)n.points[e].x-=t.x,n.points[e].y-=t.y;if(!this.isLocationOverlap(n,e.location.area))return!1;if(i){const e=.75;return function(e,t){const i=[];for(let n=0;n<4;n++)for(let s=0;s<4;s++){const r=cs(e[n],e[(n+1)%4],t[s],t[(s+1)%4]);r&&i.push(r)}return e.forEach(e=>{ss(t,e)&&i.push(e)}),t.forEach(t=>{ss(e,t)&&i.push(t)}),ds(function(e){if(e.length<=1)return e;e.sort((e,t)=>e.x-t.x||e.y-t.y);const t=e.shift();return e.sort((e,i)=>Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(i.y-t.y,i.x-t.x)),[t,...e]}(i))}([...this.location.points],n.points)>this.locationArea*e}return!0}}var ps,fs,_s,Es,ys,Is;const Rs={barcode:2,text_line:4,detected_quad:8,deskewed_image:16,enhanced_image:64},Cs=e=>Object.values(Rs).includes(e)||Rs.hasOwnProperty(e),ws=(e,t)=>"string"==typeof e?t[Rs[e]]:t[e],vs=(e,t,i)=>{"string"==typeof e?t[Rs[e]]=i:t[e]=i},Ts=(e,t,i)=>{const n=[{type:Q.CRIT_BARCODE,resultName:"decodedBarcodesResult",itemNames:["barcodeResultItems"]},{type:Q.CRIT_TEXT_LINE,resultName:"recognizedTextLinesResult",itemNames:["textLineResultItems"]}],s=t.items;if(e.isResultCrossVerificationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type!==i||s[e].verified||s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&e.verified)})}if(e.isResultDeduplicationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type===i&&s[e].duplicate&&s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&!e.duplicate)})}};class Ss{constructor(){this.verificationEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!0,[Q.CRIT_DETECTED_QUAD]:!0,[Q.CRIT_DESKEWED_IMAGE]:!1},this.duplicateFilterEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1},this.duplicateForgetTime={[Q.CRIT_BARCODE]:3e3,[Q.CRIT_TEXT_LINE]:3e3,[Q.CRIT_DETECTED_QUAD]:3e3,[Q.CRIT_DESKEWED_IMAGE]:3e3},this.crossVerificationCriteria={[Q.CRIT_BARCODE]:{frameWindow:5,minConsistentFrames:2},[Q.CRIT_TEXT_LINE]:{frameWindow:5,minConsistentFrames:2},[Q.CRIT_DETECTED_QUAD]:{frameWindow:6,minConsistentFrames:4},[Q.CRIT_DESKEWED_IMAGE]:{frameWindow:6,minConsistentFrames:4}},ps.set(this,new Map),fs.set(this,new Map),_s.set(this,new Map),Es.set(this,new Map),ys.set(this,new Map),Is.set(this,new Map),this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,this.latestOverlappingEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1},this.maxOverlappingFrames={[Q.CRIT_BARCODE]:this.crossVerificationFrames,[Q.CRIT_TEXT_LINE]:this.crossVerificationFrames,[Q.CRIT_DETECTED_QUAD]:this.crossVerificationFrames,[Q.CRIT_DESKEWED_IMAGE]:this.crossVerificationFrames},Object.defineProperties(this,{onOriginalImageResultReceived:{value:e=>{},writable:!1},onDecodedBarcodesReceived:{value:e=>{this.latestOverlappingFilter(e),Ts(this,e,Q.CRIT_BARCODE)},writable:!1},onRecognizedTextLinesReceived:{value:e=>{Ts(this,e,Q.CRIT_TEXT_LINE)},writable:!1},onProcessedDocumentResultReceived:{value:e=>{},writable:!1},onParsedResultsReceived:{value:e=>{},writable:!1}})}_dynamsoft(){Wn(this,ps,"f").forEach((e,t)=>{vs(t,this.verificationEnabled,e)}),Wn(this,fs,"f").forEach((e,t)=>{vs(t,this.duplicateFilterEnabled,e)}),Wn(this,_s,"f").forEach((e,t)=>{vs(t,this.duplicateForgetTime,e)}),Wn(this,Es,"f").forEach((e,t)=>{vs(t,this.latestOverlappingEnabled,e)}),Wn(this,ys,"f").forEach((e,t)=>{vs(t,this.maxOverlappingFrames,e)}),Wn(this,Is,"f").forEach((e,t)=>{vs(t,this.crossVerificationCriteria,e)})}enableResultCrossVerification(e,t){Cs(e)&&Wn(this,ps,"f").set(e,t)}isResultCrossVerificationEnabled(e){return!!Cs(e)&&ws(e,this.verificationEnabled)}enableResultDeduplication(e,t){Cs(e)&&(t&&this.enableLatestOverlapping(e,!1),Wn(this,fs,"f").set(e,t))}isResultDeduplicationEnabled(e){return!!Cs(e)&&ws(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,t){Cs(e)&&(t>18e4&&(t=18e4),t<0&&(t=0),Wn(this,_s,"f").set(e,t))}getDuplicateForgetTime(e){return Cs(e)?ws(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0;const t=[Q.CRIT_BARCODE,Q.CRIT_TEXT_LINE,Q.CRIT_DETECTED_QUAD,Q.CRIT_DESKEWED_IMAGE,Q.CRIT_ENHANCED_IMAGE];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}setResultCrossVerificationCriteria(e,t,i){t<i&&(t=i),Wn(this,Is,"f").set(e,{frameWindow:t,minConsistentFrames:i})}getResultCrossVerificationCriteria(e){return ws(e,this.crossVerificationCriteria)}enableLatestOverlapping(e,t){Cs(e)&&(t&&this.enableResultDeduplication(e,!1),Wn(this,Es,"f").set(e,t))}isLatestOverlappingEnabled(e){return!!Cs(e)&&ws(e,this.latestOverlappingEnabled)}setMaxOverlappingFrames(e,t){Cs(e)&&Wn(this,ys,"f").set(e,t)}getMaxOverlappingFrames(e){return Cs(e)?ws(e,this.maxOverlappingFrames):-1}latestOverlappingFilter(e){var t,i,n;const s=this.isResultCrossVerificationEnabled(Q.CRIT_BARCODE),r=this.isLatestOverlappingEnabled(Q.CRIT_BARCODE);if(r){const a=this.crossVerificationFrames,o=60,l=r?this.getMaxOverlappingFrames(Q.CRIT_BARCODE):this.crossVerificationFrames,c=e.items.length,d=null===(n=null===(i=null===(t=null==e?void 0:e.intermediateResult)||void 0===t?void 0:t[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,h=d?d.length:0;let u=[];const g=[],m={x:0,y:0};let p=new Array(c).fill(-1),f=0;const _=e.items.map(e=>{if(1!==e.type){const t=(BigInt(e.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0);return new ms(l,t?1:2,t,e)}}).filter(Boolean);if(this.overlapSet.length>0){const e=new Array(c).fill(new Array(this.overlapSet.length).fill(1));let t=0;for(;t<c;){const i={x:0,y:0},n=new Array(c).fill(-1);let s=!1;for(;t<c;t++){if(!_[t])continue;const r=_[t].item;for(let a=0;a<this.overlapSet.length;a++){if(e[t][a]<1)continue;const o=this.overlapSet[a],l=o.item;if(r.format===l.format&&r.text===l.text){if(s=o.isProbablySameLocationWithOffset(_[t],i),s){n[t]=a,e[t][a]=0;break}}else e[t][a]=0}if(s)break}if(s){for(let s=0;s<c;s++){if(s===t||!_[s])continue;const r=_[s].item;for(let t=0;t<this.overlapSet.length;t++){if(e[s][t]<1)continue;if(n.includes(t))continue;const a=this.overlapSet[t],o=a.item;if(r.format===o.format&&r.text===o.text){if(a.isMatchedLocationWithOffset(_[s],i)){n[s]=t,e[s][t]=0;break}}else e[s][t]=0}}const s=n.filter(e=>-1!==e).length;s>f&&(f=s,p=n,m.x=i.x,m.y=i.y)}}if(0===f){for(let t=0;t<c;t++){const i=_[t].item;for(let n=0;n<this.overlapSet.length;n++){if(e[t][n]<1)continue;if(p.includes(n))continue;const s=this.overlapSet[n],r=s.item;if(i.format===r.format&&i.text===r.text){if(s.isMatchedLocationWithOffset(_[t])){p[t]=n,e[t][n]=0;break}}else e[t][n]=0}}f+=p.filter(e=>-1!=e).length}let i=this.overlapSet.length<=3?f>=1:f>=2;if(!i&&r&&h>0){let e=0;for(let t=0;t<this.overlapSet.length;t++){const i=this.overlapSet[t];for(let t=0;t<h;t++)if(i.isOverlappedLocationWithOffset(d[t],m)){e++;break}}i=this.overlapSet.length<=3?e>=1:e>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,e.items.forEach((e,t)=>{if(1!==e.type){const i=Object.assign({},e),n=(BigInt(e.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=e.confidence<o,a=new ms(l,n?1:2,n,i);s&&n&&r&&g.push(t),this.overlapSet.push(a)}});else{let t=!0;r?(Math.abs(m.x)>5||Math.abs(m.y)>5)&&(t=!1):t=!1;for(let i=0;i<e.items.length;i++){const e=p[i];if(e<0&&_[i]){const e=_[i].item;let n={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let i=0;i<4;i++)n.points[i].x=t?e.location.points[i].x-m.x:e.location.points[i].x,n.points[i].y=t?e.location.points[i].y-m.y:e.location.points[i].y;for(let s=0;s<this.overlapSet.length;s++){if(p.includes(s))continue;const r=this.overlapSet[s].item.text,a=this.overlapSet[s].item.format;if(e.format===a&&e.text===r){if(this.overlapSet[s].isOverlappedLocationWithOffset(e,m,!1)){const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new ms(l,r,n,t),p[i]=s;break}if(_[i].isOneD){let r={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let e=0;e<4;e++)r.points[e].x=t?this.overlapSet[s].location.points[e].x:this.overlapSet[s].location.points[e].x+m.x,r.points[e].y=t?this.overlapSet[s].location.points[e].y:this.overlapSet[s].location.points[e].y+m.y;let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(gs(n,r,e.moduleSize,a)){e.location=a;const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new ms(l,r,n,t),p[i]=s;break}}}}}else{if(t)_[i]&&(_[i].item.location=this.overlapSet[e].location);else{const t=Object.assign({},_[i].item),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[e]=new ms(l,s,n,t)}this.overlapSet[e]&&(this.overlapSet[e].overlapCount=l,this.overlapSet[e].verificationCount=2,this.overlapSet[e].crossVerificationFrame=a)}}t?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const n=this.overlapSet[e];n.overlapCount--,n.crossVerificationFrame--;const s=n.overlapCount+this.stabilityCount;if(r&&s>0){for(let e=0;e<c;e++)if(n.isOverlappedLocationWithOffset(_[e],m,!1)){i=!1;break}if(!i)break;const e=n.item;if(!t){for(let e=0;e<4;e++)n.location.points[e].x+=m.x,n.location.points[e].y+=m.y;e.location=n.location}2===n.verificationCount&&u.push(e)}}if(r&&!i){u=[];for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const t=this.overlapSet[e];t.overlapCount=0-this.stabilityCount,t.crossVerificationFrame=0,t.verificationCount=0}}for(let e=0;e<c;e++){if(-1!==p[e]||!_[e])continue;const i=_[e].item;if(t){for(let t=0;t<4;t++)_[e].location.points[t].x-=m.x,_[e].location.points[t].y-=m.y;i.location=_[e].location}let n=!1;for(let t of this.overlapSet)if(!(t.crossVerificationFrame<=0&&t.verificationCount<=0)&&(n=t.isLocationOverlap(_[e].location,_[e].locationArea),n))break;if(n){g.push(e);continue}const r=Object.assign({},i),a=(BigInt(i.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),c=i.confidence<o,d=new ms(l,a?1:2,a,r);s&&a&&c?g.push(e):d.verificationCount=2,this.overlapSet.push(d)}this.overlapSet=this.overlapSet.filter(e=>!(e.overlapCount+this.stabilityCount<=0&&e.crossVerificationFrame<=0))}g.sort((e,t)=>t-e).forEach((t,i)=>{e.items.splice(t,1)}),u.forEach(t=>{e.items.push(Object.assign(Object.assign({},t),{overlapped:!0}))})}}}var Ds,Ms,bs,Ls;ps=new WeakMap,fs=new WeakMap,_s=new WeakMap,Es=new WeakMap,ys=new WeakMap,Is=new WeakMap;class As{static async readFromFile(e){if("string"==typeof e){if(!C(e))return Promise.reject(new TypeError("The input string is not a valid URL."));{const t=await fetch(e);e=await t.blob()}}return await A(e)}static async saveToFile(e,t,i){if(!e||!t)return null;if("string"!=typeof t)throw new TypeError("FileName must be of type string.");const n=L(e);return T(n,t,i)}static async readFromMemory(e){if(!Wn(As,Ds,"f",Ms).has(e))throw new Error("Image data ID does not exist.");return Wn(As,Ds,"f",Ms).get(e)}static async saveToMemory(e,t){var i,n,s;const r=await ns(e,t),a=await A(r),o=(function(e,t,i,n,s){if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");s?s.value=i:t.set(e,i)}(i=As,Ds,(s=Wn(i,Ds,"f",bs),n=s++,s),0,bs),n);return Wn(As,Ds,"f",Ms).set(o,a),o}static async readFromBase64String(e){const t=await(async e=>{let t,i="image/png";if(e.includes("base64,")){const n=e.split(","),s=n[0].match(/:(.*?);/);s&&(i=s[1]),t=atob(n[1])}else t=atob(e);const n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new Blob([s],{type:i})})(e);return await A(t)}static async saveToBase64String(e,t){e instanceof Blob&&(e=await A(e));let i=L(e);const n=await ns(i,t);return await(async e=>await new Promise((t,i)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=e=>{i(e)},n.readAsDataURL(e)}))(n)}}Ds=As,Ms={value:new Map},bs={value:0};class Os{static async cropImage(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await A(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.cropImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_cropImage",id:l,body:{type:"Rect",bytes:i,width:n,height:s,stride:r,format:a,roi:t}})})}static async adjustBrightness(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await A(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.adjustBrightness);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_adjustBrightness",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,brightness:t}})})}static async adjustContrast(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await A(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.adjustContrast);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_adjustContrast",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,contrast:t}})})}static async filterImage(e,t){if(![0,1,2].includes(t))throw new Error("Invalid filterType.");const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await A(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.filterImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_filterImage",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,filterType:t}})})}static async convertToGray(e,t,i,n){const{bytes:s,width:r,height:a,stride:o,format:l}=E(e)?e:await A(e);return await new Promise((e,c)=>{let d=_e();Ee[d]=async t=>{if(t.success)return e(t.convertToGray);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},pe.postMessage({type:"utility_convertToGray",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,R:t,G:i,B:n}})})}static async convertToBinaryGlobal(e,t=-1,i=!1){const{bytes:n,width:s,height:r,stride:a,format:o}=E(e)?e:await A(e);return await new Promise((e,l)=>{let c=_e();Ee[c]=async t=>{if(t.success)return e(t.convertToBinaryGlobal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},pe.postMessage({type:"utility_convertToBinaryGlobal",id:c,body:{bytes:n,width:s,height:r,stride:a,format:o,threshold:t,invert:i}})})}static async convertToBinaryLocal(e,t=0,i=10,n=!1){const{bytes:s,width:r,height:a,stride:o,format:l}=E(e)?e:await A(e);return await new Promise((e,c)=>{let d=_e();Ee[d]=async t=>{if(t.success)return e(t.convertToBinaryLocal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},pe.postMessage({type:"utility_convertToBinaryLocal",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,blockSize:t,compensation:i,invert:n}})})}static async cropAndDeskewImage(e,t,i=0,n=0,s=0){const{bytes:r,width:a,height:o,stride:l,format:c}=E(e)?e:await A(e);return await new Promise((e,d)=>{let h=_e();Ee[h]=async t=>{if(t.success)return e(t.cropAndDeskewImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,d(e)}},pe.postMessage({type:"utility_cropAndDeskewImage",id:h,body:{bytes:r,width:a,height:o,stride:l,format:c,roi:t,dstWidth:i,dstHeight:n,padding:s}})})}}!function(e){e[e.FT_HIGH_PASS=0]="FT_HIGH_PASS",e[e.FT_SHARPEN=1]="FT_SHARPEN",e[e.FT_SMOOTH=2]="FT_SMOOTH"}(Ls||(Ls={}));class xs{static async findPortraitZone(){return await Me.loadWasm(),await ve.license.dynamsoft(),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.quad);n.errorCode&&0!==n.errorCode&&t(new Error(n.errorString)),e(n)}else{let e=new Error(i.message);e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"identityUtility_findPortraitZone",id:i})})}}Me.engineResourcePaths.rootDirectory=(e=>{if(null==e&&(e="./"),be||Le);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Ae+"../../"),Me.engineResourcePaths.dcvBundle={version:"3.4.1000-dev-20260214095351",path:Ae,isInternal:!0},Me.engineResourcePaths.dcvData={version:"1.2.0",path:Ae,isInternal:!0},qe.CoreModule=Me,qe.handleEngineResourcePaths=v;var Ns,Ps,ks,Bs,Fs=Object.freeze({__proto__:null,BarcodeReaderModule:class{static getVersion(){const e=we.dbr&&we.dbr.wasm;return`11.4.10-dev-20260129110729(Worker: ${we.dbr&&we.dbr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}},Beep:je,Camera:Ge,CameraEnhancer:qe,CameraView:Xe,CaptureVisionRouter:Ci,CaptureVisionRouterModule:jt,CapturedResultReceiver:wi,CodeParser:class e{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static async createInstance(){await ve.license.dynamsoft(),await Me.loadWasm();const t=new e,i=new Tn;let n=_e();return Ee[n]=async e=>{if(e.success)t._instanceID=e.instanceID,i.resolve(t);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),i.reject(t)}},pe.postMessage({type:"dcp_createInstance",id:n}),i}async dispose(){Cn(this);let e=_e();this.bDestroyed=!0,Ee[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},pe.postMessage({type:"dcp_dispose",id:e,instanceID:this._instanceID})}get disposed(){return this.bDestroyed}async initSettings(e){if(Cn(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await R(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString?n.errorString:"Init Settings Failed.");return e.errorCode=n.errorCode,i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"dcp_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid settings.")}async resetSettings(){return Cn(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"dcp_resetSettings",id:i,instanceID:this._instanceID})})}async parse(e,t=""){if(Cn(this),!e||!(e instanceof Array||e instanceof Uint8Array||"string"==typeof e))throw new Error("`parse` must pass in an Array or Uint8Array or string");return await new Promise((i,n)=>{let s=_e();e instanceof Array&&(e=Uint8Array.from(e)),"string"==typeof e&&(e=Uint8Array.from(function(e){let t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e))),Ee[s]=async e=>{if(e.success){let t=JSON.parse(e.parseResponse);return t.errorCode?n(new Error(t.errorString)):(En(t),i(t))}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},pe.postMessage({type:"dcp_parse",id:s,instanceID:this._instanceID,body:{source:e,taskSettingName:t}})})}},CodeParserModule:Ln,CoreModule:Me,DocumentNormalizerModule:class{static getVersion(){const e=we.ddn&&we.ddn.wasm;return`3.4.10-dev-20260129110740(Worker: ${we.ddn&&we.ddn.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}},DrawingItem:dt,DrawingLayer:lt,DrawingStyleManager:ot,EnumBarcodeFormat:Ji,get EnumBufferOverflowProtectionMode(){return a},get EnumCapturedResultItemType(){return Q},get EnumColourChannelUsageType(){return o},get EnumCornerType(){return K},get EnumCrossVerificationStatus(){return re},get EnumDeblurMode(){return sn},get EnumDrawingItemMediaType(){return _t},get EnumDrawingItemState(){return Et},get EnumEnhancedFeatures(){return yt},get EnumErrorCode(){return J},get EnumExtendedBarcodeResultType(){return en},get EnumFilterType(){return Ls},get EnumGrayscaleEnhancementMode(){return ee},get EnumGrayscaleTransformationMode(){return te},get EnumImageCaptureDistanceMode(){return de},get EnumImageColourMode(){return Bn},get EnumImageFileFormat(){return ce},get EnumImagePixelFormat(){return l},get EnumImageSourceState(){return Yt},get EnumImageTagType(){return ie},EnumIntermediateResultUnitType:ae,get EnumLocalizationMode(){return nn},get EnumMappingStatus(){return fn},get EnumModuleName(){return he},get EnumPDFReadingMode(){return ne},get EnumPixelFormat(){return It},get EnumPresetTemplate(){return vi},get EnumQRCodeErrorCorrectionLevel(){return tn},get EnumRasterDataSource(){return se},get EnumRawTextLineStatus(){return pn},get EnumRegionObjectElementType(){return oe},get EnumSectionType(){return le},get EnumValidationStatus(){return _n},Feedback:tt,FramePipeline:ze,IdentityProcessor:xs,IdentityUtilityModule:class{static getVersion(){return`1.0.10-dev-20260129110800(Worker: ${we.identityutility&&we.identityutility.worker||"Not Loaded"}, Wasm: ${we.identityutility&&we.identityutility.wasm||"Not Loaded"})`}},ImageDrawer:class{static async drawOnImage(e,t,i,n=4294901760,s=1,r="test.png",a){if(!e)throw new Error("Invalid image.");if(!t)throw new Error("Invalid drawingItem.");if(!i)throw new Error("Invalid type.");let o;if(e instanceof Blob)o=await A(e);else if("string"==typeof e){let t=await R(e,"blob");o=await A(t)}else E(e)&&(o=e,"bigint"==typeof o.format&&(o.format=Number(o.format)));return await new Promise((e,l)=>{let c=_e();Ee[c]=async t=>{if(t.success)return a&&As.saveToFile(t.image,r,a),e(t.image);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},pe.postMessage({type:"utility_drawOnImage",id:c,body:{dsImage:o,drawingItem:Array.isArray(t)?t:[t],color:n,thickness:s,type:i}})})}},ImageEditorView:class e{_painter;_oriImage;_drawingLayers=[];static async createInstance(t){const i=new e,n=i._painter=new Rt;return n._dceGetQuads=()=>i._drawingLayers.filter(e=>e).map(e=>e._drawingItems.filter(e=>e instanceof ut)).flat(),n._dceSelectedItemIdx=0,n._dceSelectedItemIdxs=new Set,t&&await i.setUIElement(t),i}disposed;dispose(){this.disposed=!0}getUIElement(){const e=this._painter.getHtmlElement();return e.parentElement||e}setUIElement(e){const t=this._painter.getHtmlElement();if(e!==t)return e.append(t),Promise.resolve()}async setOriginalImage(e){this._oriImage=e,e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||(e=Je(e.bytes,e.width,e.height,e.format));const t=this._painter;t.cancelEdit(),t.del(),await t.addImage(e),await t.enterEdit(),await t.enterFreeTransformMode(),this._updateCvsToPainter(),this._updateFreeTransformWhenInitImgOrItem()}_updateCvsToPainter(){const e=this._painter;if("freeTransform"!==e.getMode())return;const t=e.getHtmlElement(),i=t.querySelector(".kPainterCanvas").style,n=e.getWidth(),s=e.getHeight();for(let e of this._drawingLayers){if(!e)continue;const r=e._ctx.canvas;r.width!==n&&(r.width=n),r.height!==s&&(r.height=s);for(let e of["left","top","right","bottom","width","height","transform"])r.style[e]=i[e];r.style.display="",t.querySelector(".kPainterImgsDiv").append(r)}}_updateFreeTransformWhenInitImgOrItem(){const e=this._painter;if("freeTransform"!==e.getMode())return;e._dceSelectedItemIdx=0,e._dceSelectedItemIdxs.clear();let t=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(t){let i=t.quad.points,n=e.getWidth(),s=e.getHeight();e.setFreeTransformCornerPos(i.map(({x:e,y:t})=>[e/n-.5,t/s-.5]))}else e.setFreeTransformCornerPos([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]])}getOriginalImage(){return this._oriImage}_createDrawingLayer(){const e=new lt;return e._ctx=document.createElement("canvas").getContext("2d"),e._mode="editor",e._oriAddDrawingItems=e.addDrawingItems,e.addDrawingItems=t=>{e._oriAddDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e._oriSetDrawingItems=e.setDrawingItems,e.setDrawingItems=t=>{e._oriSetDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e}createDrawingLayer(){const e=this._createDrawingLayer();return this._drawingLayers.push(e),this._updateCvsToPainter(),e}getDrawingLayer(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=this._createDrawingLayer(),1===e?t._defaultStyle=ot.STYLE_BLUE_STROKE:2===e?t._defaultStyle=ot.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=ot.STYLE_GREEN_STROKE_FILL),this._drawingLayers[e]=t,this._updateCvsToPainter()),t}getAllDrawingLayers(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)}clearUserDefinedDrawingLayers(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4}deleteUserDefinedDrawingLayer(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])}getSelectedDrawingItems(){const e=this._painter,t=e._dceGetQuads();let i=e._dceSelectedItemIdxs;if(t.length&&i.size)return t.filter((e,t)=>i.has(t));let n=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(!n){const e=this._painter;if("freeTransform"!==e.getMode())return null;n=new ut({points:null});let t=e.getWidth(),i=e.getHeight();n.quad.points=e.getFreeTransformCornerPos().map(e=>({x:(e[0]+.5)*t,y:(e[1]+.5)*i}))}return[n]}},ImageIO:As,ImageProcessor:Os,ImageSourceAdapter:j,IntermediateResultReceiver:class{constructor(){this._observedResultUnitTypes=ae.IRUT_ALL,this._observedTaskMap=new Map,this._parameters={setObservedResultUnitTypes:e=>{this._observedResultUnitTypes=e},getObservedResultUnitTypes:()=>this._observedResultUnitTypes,isResultUnitTypeObserved:e=>!!(e&this._observedResultUnitTypes),addObservedTask:e=>{this._observedTaskMap.set(e,!0)},removeObservedTask:e=>{this._observedTaskMap.set(e,!1)},isTaskObserved:e=>0===this._observedTaskMap.size||!!this._observedTaskMap.get(e)},this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null,this.onShortLinesUnitReceived=null}getObservationParameters(){return this._parameters}},KPainter:Rt,LabelRecognizerModule:gn,LicenseManager:zi,LicenseModule:class{static getVersion(){return`4.4.10-dev-20260129110719(Worker: ${we.license&&we.license.worker||"Not Loaded"}, Wasm: ${we.license&&we.license.wasm||"Not Loaded"})`}},MultiFrameResultCrossFilter:Ss,QuadDrawingItem:ut,UtilityModule:class{static getVersion(){return`2.4.10-dev-20260129110724(Worker: ${we.utility&&we.utility.worker||"Not Loaded"}, Wasm: ${we.utility&&we.utility.wasm||"Not Loaded"})`}},_bufferToCanvas:Je,_isPointInPolygon:ct,_saveToFile:T,_toBlob:M,_toCanvas:S,_toImage:D,get bDebug(){return Re},beep:Ye,blobToDsImage:A,checkIsLink:C,compareVersion:w,createImageData:L,d:async(e,t)=>{const i=atob(e),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const s=n.slice(0,12),r=n.slice(12),a=new TextEncoder,o=await crypto.subtle.importKey("raw",a.encode(t),"PBKDF2",!1,["deriveKey"]),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:128},l,r);return(new TextDecoder).decode(c)},doOrWaitAsyncDependency:me,e:async(e,t)=>{const i=new TextEncoder,n=await crypto.subtle.importKey("raw",i.encode(t),"PBKDF2",!1,["deriveKey"]),s=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},s,i.encode(e)),o=new Uint8Array(r.length+a.byteLength);return o.set(r),o.set(new Uint8Array(a),r.length),btoa(String.fromCharCode.apply(null,o))},encodeBMP:b,getNextTaskID:_e,handleEngineResourcePaths:v,imagePtrToUint8Array:async e=>await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.u8);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},pe.postMessage({type:"imagePtrToUint8Array",id:n,body:{data:e}})}),innerVersions:we,isArc:e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.radius)||e.radius<0||!p(e.startAngle)||!p(e.endAngle)),isContour:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&!e.points.some(e=>!I(e)),isDSImageData:E,isDSRect:e=>!(!f(e)||!p(e.left)||e.left<0||!p(e.top)||e.top<0||!p(e.right)||e.right<0||!p(e.bottom)||e.bottom<0||e.left>=e.right||e.top>=e.bottom),isDsImageKeyValue:(e,t)=>"bytes"===e&&"object"==typeof t&&"number"==typeof t.ptr&&"number"==typeof t.length,isImageTag:y,isLineSegment:e=>!(!f(e)||!I(e.startPoint)||!I(e.endPoint)||e.startPoint.x==e.endPoint.x&&e.startPoint.y==e.endPoint.y),isObject:f,isOriginalDsImageData:e=>!(!_(e)||!p(e.bytes.length)&&!p(e.bytes.ptr)),isPoint:I,isPolygon:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&!e.points.some(e=>!I(e)),isQuad:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some(e=>!I(e)),isRect:e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.width)||e.width<0||!p(e.height)||e.height<0),isSimdSupported:()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),mapAsyncDependency:ue,mapPackageRegister:ve,mapTaskCallBack:Ee,get onLog(){return ye},productNameMap:O,requestResource:R,resolveDsImageData:async e=>await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},pe.postMessage({type:"resolveDsImageData",id:n,body:{point:e}})}),setBDebug:Ce,setOnLog:Ie,stringToHtml:Ne,utilsFuncs:mn,vibrate:$e,waitAsyncDependency:ge,get worker(){return pe},workerAutoResources:Te});e.EnumDocumentSide=void 0,(Ns=e.EnumDocumentSide||(e.EnumDocumentSide={})).MRZ="mrz",Ns.Opposite="opposite",e.EnumMRZScanMode=void 0,(Ps=e.EnumMRZScanMode||(e.EnumMRZScanMode={})).Passport="passport",Ps.TD1="td1",Ps.TD2="td2",Ps.PassportAndTD1="passportAndTd1",Ps.PassportAndTD2="passportAndTd2",Ps.TD1AndTD2="td1AndTd2",Ps.All="all",e.EnumMRZDocumentType=void 0,(ks=e.EnumMRZDocumentType||(e.EnumMRZDocumentType={})).Passport="passport",ks.TD1="td1",ks.TD2="td2",e.EnumMRZScannerViews=void 0,(Bs=e.EnumMRZScannerViews||(e.EnumMRZScannerViews={})).Scanner="scanner",Bs.Result="scan-result";const Vs={[e.EnumMRZScanMode.Passport]:"ReadPassport",[e.EnumMRZScanMode.TD1]:"ReadId-TD1",[e.EnumMRZScanMode.TD2]:"ReadId-TD2",[e.EnumMRZScanMode.PassportAndTD1]:"ReadPassportAndId-TD1",[e.EnumMRZScanMode.PassportAndTD2]:"ReadPassportAndId-TD2",[e.EnumMRZScanMode.TD1AndTD2]:"ReadId",[e.EnumMRZScanMode.All]:"ReadPassportAndId"};var Us;function Zs(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}e.EnumResultStatus=void 0,(Us=e.EnumResultStatus||(e.EnumResultStatus={}))[Us.RS_SUCCESS=0]="RS_SUCCESS",Us[Us.RS_CANCELLED=1]="RS_CANCELLED",Us[Us.RS_FAILED=2]="RS_FAILED";function Gs(e,t){const i=document.getElementById(e);if(i)return void(i.textContent=t);const n=document.createElement("style");n.id=e,n.textContent=t,document.head.appendChild(n)}const Hs=e=>!e||0===Object.keys(e).length;function Ws(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function zs(e,t={}){const{message:i,spinnerSize:n=32}=t,s=document.createElement("div");s.className="dynamsoft-mrz-loading-screen";const r=document.createElement("div");r.className="dynamsoft-mrz-loading";const a=document.createElement("div");a.className="dynamsoft-mrz-loading-content";const o=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(a.innerHTML=o,i){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=i,a.appendChild(e)}return r.appendChild(a),s.appendChild(r),e.appendChild(s),{element:s,updateMessage:e=>{let t=r.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,a.appendChild(t)):null==t||t.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout(()=>{var e;null===(e=s.parentNode)||void 0===e||e.removeChild(s)},200))}}}const js='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var Ys;e.EnumMRZData=void 0,(Ys=e.EnumMRZData||(e.EnumMRZData={})).InvalidFields="invalidFields",Ys.DocumentType="documentType",Ys.DocumentNumber="documentNumber",Ys.MRZText="mrzText",Ys.FirstName="firstName",Ys.LastName="lastName",Ys.Age="age",Ys.Sex="sex",Ys.IssuingState="issuingState",Ys.IssuingStateRaw="issuingStateRaw",Ys.Nationality="nationality",Ys.NationalityRaw="nationalityRaw",Ys.DateOfBirth="dateOfBirth",Ys.DateOfExpiry="dateOfExpiry",Ys.OptionalData1="optionalData1",Ys.OptionalData2="optionalData2";const $s={[e.EnumMRZData.InvalidFields]:"Invalid Fields",[e.EnumMRZData.DocumentType]:"Document Type",[e.EnumMRZData.DocumentNumber]:"Document Number",[e.EnumMRZData.MRZText]:"MRZ Text",[e.EnumMRZData.FirstName]:"Given Name(s)",[e.EnumMRZData.LastName]:"Surname",[e.EnumMRZData.Age]:"Age",[e.EnumMRZData.Sex]:"Sex",[e.EnumMRZData.IssuingState]:"Issuing State",[e.EnumMRZData.IssuingStateRaw]:"Issuing State (Raw Value)",[e.EnumMRZData.Nationality]:"Nationality",[e.EnumMRZData.NationalityRaw]:"Nationality State (Raw Value)",[e.EnumMRZData.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[e.EnumMRZData.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)",[e.EnumMRZData.OptionalData1]:"Optional Data 1",[e.EnumMRZData.OptionalData2]:"Optional Data 2"};function qs(e,t,i,n=!1){const s=parseInt(e,10);let r;if(n)r=s>=60?1900+s:2e3+s;else{r=s>(new Date).getFullYear()%100?1900+s:2e3+s}return{year:r,month:parseInt(t,10),day:parseInt(i,10)}}function Xs(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function Qs(e){return"D<<"===e?"D":e}function Ks(t,i){const n=[],s=e=>i.getFieldValidationStatus(e)===_n.VS_FAILED,r=i.codeType,a=function(t){switch(t){case"MRTD_TD1_ID":return e.EnumMRZDocumentType.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return e.EnumMRZDocumentType.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return e.EnumMRZDocumentType.Passport;default:throw new Error(`Unknown document type: ${t}`)}}(r),o=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(r),l=a===e.EnumMRZDocumentType.Passport&&"MRTD_TD3_PASSPORT"===r?"passportNumber":"documentNumber",c=qs(i.getFieldValue("birthYear"),i.getFieldValue("birthMonth"),i.getFieldValue("birthDay")),d=qs(i.getFieldValue("expiryYear"),i.getFieldValue("expiryMonth"),i.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach(t=>{s(t)&&n.push(e.EnumMRZData.DateOfBirth)}),["expiryYear","expiryMonth","expiryDay"].forEach(t=>{s(t)&&n.push(e.EnumMRZData.DateOfExpiry)});const h={[e.EnumMRZData.LastName]:i.getFieldValue("primaryIdentifier"),[e.EnumMRZData.FirstName]:i.getFieldValue("secondaryIdentifier"),[e.EnumMRZData.Nationality]:i.getFieldValue("nationality"),[e.EnumMRZData.NationalityRaw]:Qs(i.getFieldRawValue("nationality")),[e.EnumMRZData.DocumentNumber]:i.getFieldValue(l)||i.getFieldValue("longDocumentNumber"),[e.EnumMRZData.IssuingState]:i.getFieldValue("issuingState"),[e.EnumMRZData.IssuingStateRaw]:Qs(i.getFieldRawValue("issuingState")),[e.EnumMRZData.Sex]:Ws(i.getFieldValue("sex"))};Object.keys(h).forEach(t=>{let i=!1;switch(t){case e.EnumMRZData.FirstName:i=s("secondaryIdentifier");break;case e.EnumMRZData.LastName:i=s("primaryIdentifier");break;case e.EnumMRZData.DocumentNumber:i=s(l)||s("longDocumentNumber");break;default:i=s(t)}i&&n.push(t)});const u=function(e){const t=new Date,i=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(i?0:1)}(c);u<1&&n.push(e.EnumMRZData.Age);return{[e.EnumMRZData.InvalidFields]:n,[e.EnumMRZData.FirstName]:h[e.EnumMRZData.FirstName],[e.EnumMRZData.LastName]:h[e.EnumMRZData.LastName],[e.EnumMRZData.Age]:u,[e.EnumMRZData.DateOfBirth]:c,[e.EnumMRZData.Sex]:h[e.EnumMRZData.Sex],[e.EnumMRZData.Nationality]:h[e.EnumMRZData.Nationality],[e.EnumMRZData.NationalityRaw]:h[e.EnumMRZData.NationalityRaw],[e.EnumMRZData.DocumentNumber]:h[e.EnumMRZData.DocumentNumber],[e.EnumMRZData.DateOfExpiry]:d,[e.EnumMRZData.IssuingState]:h[e.EnumMRZData.IssuingState],[e.EnumMRZData.IssuingStateRaw]:h[e.EnumMRZData.IssuingStateRaw],[e.EnumMRZData.DocumentType]:Ws(o),[e.EnumMRZData.MRZText]:t}}class Js{constructor(e){var t,i,n,s,r;this._primaryOriginalImage=null,this._secondaryOriginalImage=null,this._primaryDocumentImage=null,this._secondaryDocumentImage=null,this._portraitImage=null,this.status=e.status,this.data=e.data,this._primaryOriginalImage=null!==(t=e.primaryOriginalImage)&&void 0!==t?t:null,this._secondaryOriginalImage=null!==(i=e.secondaryOriginalImage)&&void 0!==i?i:null,this._primaryDocumentImage=null!==(n=e.primaryDocumentImage)&&void 0!==n?n:null,this._secondaryDocumentImage=null!==(s=e.secondaryDocumentImage)&&void 0!==s?s:null,this._portraitImage=null!==(r=e.portraitImage)&&void 0!==r?r:null}getDocumentImage(t){return t===e.EnumDocumentSide.MRZ?this._primaryDocumentImage:this._secondaryDocumentImage}getOriginalImage(t){return t===e.EnumDocumentSide.MRZ?this._primaryOriginalImage:this._secondaryOriginalImage}getPortraitImage(){return this._portraitImage}}const er='<svg width="354" height="221" viewBox="0 0 354 221" fill="none" xmlns="http://www.w3.org/2000/svg">\n<rect x="1" y="1" width="352" height="219" rx="15" stroke="currentColor" stroke-width="2"/>\n<rect width="338" height="42.4805" transform="translate(8 170.52)" fill="black" fill-opacity="0.1"/>\n<path d="M332.647 202.684L338.8 206.703V208.754L330.159 202.984V202.369L338.8 196.709V198.787L332.647 202.684Z" fill="white"/>\n<path d="M320.534 202.684L326.687 206.703V208.754L318.046 202.984V202.369L326.687 196.709V198.787L320.534 202.684Z" fill="white"/>\n<path d="M308.421 202.684L314.573 206.703V208.754L305.933 202.984V202.369L314.573 196.709V198.787L308.421 202.684Z" fill="white"/>\n<path d="M296.308 202.684L302.46 206.703V208.754L293.819 202.984V202.369L302.46 196.709V198.787L296.308 202.684Z" fill="white"/>\n<path d="M284.194 202.684L290.347 206.703V208.754L281.706 202.984V202.369L290.347 196.709V198.787L284.194 202.684Z" fill="white"/>\n<path d="M272.081 202.684L278.233 206.703V208.754L269.593 202.984V202.369L278.233 196.709V198.787L272.081 202.684Z" fill="white"/>\n<path d="M259.968 202.684L266.12 206.703V208.754L257.479 202.984V202.369L266.12 196.709V198.787L259.968 202.684Z" fill="white"/>\n<path d="M247.854 202.684L254.007 206.703V208.754L245.366 202.984V202.369L254.007 196.709V198.787L247.854 202.684Z" fill="white"/>\n<path d="M235.741 202.684L241.894 206.703V208.754L233.253 202.984V202.369L241.894 196.709V198.787L235.741 202.684Z" fill="white"/>\n<path d="M223.628 202.684L229.78 206.703V208.754L221.14 202.984V202.369L229.78 196.709V198.787L223.628 202.684Z" fill="white"/>\n<path d="M211.515 202.684L217.667 206.703V208.754L209.026 202.984V202.369L217.667 196.709V198.787L211.515 202.684Z" fill="white"/>\n<path d="M199.401 202.684L205.554 206.703V208.754L196.913 202.984V202.369L205.554 196.709V198.787L199.401 202.684Z" fill="white"/>\n<path d="M187.288 202.684L193.44 206.703V208.754L184.8 202.984V202.369L193.44 196.709V198.787L187.288 202.684Z" fill="white"/>\n<path d="M175.175 202.684L181.327 206.703V208.754L172.687 202.984V202.369L181.327 196.709V198.787L175.175 202.684Z" fill="white"/>\n<path d="M163.062 202.684L169.214 206.703V208.754L160.573 202.984V202.369L169.214 196.709V198.787L163.062 202.684Z" fill="white"/>\n<path d="M150.948 202.684L157.101 206.703V208.754L148.46 202.984V202.369L157.101 196.709V198.787L150.948 202.684Z" fill="white"/>\n<path d="M138.835 202.684L144.987 206.703V208.754L136.347 202.984V202.369L144.987 196.709V198.787L138.835 202.684Z" fill="white"/>\n<path d="M126.722 202.684L132.874 206.703V208.754L124.233 202.984V202.369L132.874 196.709V198.787L126.722 202.684Z" fill="white"/>\n<path d="M114.608 202.684L120.761 206.703V208.754L112.12 202.984V202.369L120.761 196.709V198.787L114.608 202.684Z" fill="white"/>\n<path d="M102.495 202.684L108.647 206.703V208.754L100.007 202.984V202.369L108.647 196.709V198.787L102.495 202.684Z" fill="white"/>\n<path d="M90.3818 202.684L96.5342 206.703V208.754L87.8936 202.984V202.369L96.5342 196.709V198.787L90.3818 202.684Z" fill="white"/>\n<path d="M80.415 200.729L81.1396 200.865C81.8096 201.016 82.3428 201.303 82.7529 201.727C83.6143 202.561 84.0518 203.559 84.0518 204.707V204.748C84.0518 205.91 83.71 206.826 83.04 207.496C82.1787 208.357 81.0986 208.85 79.7861 208.973C79.5811 208.986 79.3896 209 79.1846 209C78.0771 209 76.9561 208.727 75.8486 208.166V206.361L76.9561 206.936C77.5713 207.195 78.2275 207.318 78.9385 207.318C79.1299 207.318 79.335 207.305 79.54 207.291C80.4424 207.195 81.1533 206.881 81.6865 206.361C82.1787 205.896 82.4248 205.391 82.4248 204.844V204.762C82.4248 204.051 82.2061 203.477 81.7686 203.025C81.29 202.506 80.6338 202.246 79.7861 202.246H77.9951V200.893L81.5498 197.297H75.8486V195.656H83.6006V197.502L80.415 200.729Z" fill="white"/>\n<path d="M63.8994 208.891C63.8994 206.908 64.0498 205.664 64.3506 205.131C64.8154 204.133 65.8135 203.148 67.3447 202.164C68.5615 201.385 69.3818 200.674 69.8193 200.031C69.9834 199.799 70.0654 199.512 70.0654 199.17C70.0654 198.951 70.0381 198.719 69.9697 198.459C69.874 198.09 69.5732 197.762 69.0811 197.475C68.7529 197.27 68.3701 197.16 67.9189 197.16C66.8662 197.16 65.8955 197.42 65.0068 197.939C64.4053 198.295 64.1045 198.473 64.1045 198.486C64.0908 198.062 64.0908 197.68 64.0908 197.352C64.0908 197.01 64.0908 196.736 64.1045 196.504C65.4033 195.861 66.6748 195.533 67.9189 195.52C69.04 195.52 69.9697 195.848 70.708 196.49C71.46 197.133 71.8291 198.008 71.8291 199.143C71.8291 200.1 71.5146 200.906 70.8857 201.549C70.1885 202.273 69.4229 202.889 68.5889 203.395C67.249 204.215 66.4561 204.926 66.1963 205.514C65.9639 206.074 65.8408 206.648 65.8271 207.25H71.624V208.891H63.8994Z" fill="white"/>\n<path d="M56.7354 208.877V197.939L53.5908 200.646V198.268L56.708 195.725H58.6221V208.877H56.7354Z" fill="white"/>\n<path d="M45.7021 185.088H47.3701C47.3701 185.908 47.0967 186.578 46.5498 187.111C46.0029 187.631 45.2783 187.918 44.376 187.973H44.1709C43.4736 187.973 42.8447 187.768 42.2842 187.357C41.6416 186.879 41.1768 186.209 40.8623 185.348C40.4932 184.309 40.3154 183.119 40.3154 181.766C40.3154 180.412 40.4932 179.223 40.8486 178.197C41.1357 177.391 41.6006 176.748 42.2432 176.27C42.8721 175.805 43.583 175.572 44.376 175.572C45.251 175.572 45.8799 175.764 46.2627 176.146C46.9873 176.871 47.3428 177.596 47.3428 178.334H45.7842L45.7568 178.047C45.7158 177.883 45.5928 177.691 45.4014 177.473C45.2236 177.254 44.8408 177.145 44.2803 177.145C43.6104 177.145 43.0635 177.473 42.6533 178.129C42.2432 178.826 42.0381 179.934 42.0381 181.479V181.766C42.0791 183.475 42.3252 184.678 42.7764 185.389C43.2002 186.059 43.6924 186.4 44.2803 186.4C44.7725 186.4 45.1553 186.25 45.4287 185.949C45.5518 185.812 45.6338 185.607 45.6748 185.334L45.7021 185.088Z" fill="white"/>\n<path d="M45.7021 206.088H47.3701C47.3701 206.908 47.0967 207.578 46.5498 208.111C46.0029 208.631 45.2783 208.918 44.376 208.973H44.1709C43.4736 208.973 42.8447 208.768 42.2842 208.357C41.6416 207.879 41.1768 207.209 40.8623 206.348C40.4932 205.309 40.3154 204.119 40.3154 202.766C40.3154 201.412 40.4932 200.223 40.8486 199.197C41.1357 198.391 41.6006 197.748 42.2432 197.27C42.8721 196.805 43.583 196.572 44.376 196.572C45.251 196.572 45.8799 196.764 46.2627 197.146C46.9873 197.871 47.3428 198.596 47.3428 199.334H45.7842L45.7568 199.047C45.7158 198.883 45.5928 198.691 45.4014 198.473C45.2236 198.254 44.8408 198.145 44.2803 198.145C43.6104 198.145 43.0635 198.473 42.6533 199.129C42.2432 199.826 42.0381 200.934 42.0381 202.479V202.766C42.0791 204.475 42.3252 205.678 42.7764 206.389C43.2002 207.059 43.6924 207.4 44.2803 207.4C44.7725 207.4 45.1553 207.25 45.4287 206.949C45.5518 206.812 45.6338 206.607 45.6748 206.334L45.7021 206.088Z" fill="white"/>\n<path d="M29.1318 180.795H31.8115C32.4404 180.795 33.001 180.658 33.4795 180.371C33.9033 180.111 34.1084 179.701 34.1084 179.141V179.072C34.1084 178.594 33.8486 178.211 33.3428 177.896C32.9053 177.623 32.3994 177.486 31.8115 177.486H29.1318V180.795ZM29.1318 186.291H31.8115C32.4814 186.291 33.042 186.154 33.4795 185.881C34.0127 185.566 34.2725 185.102 34.2725 184.486C34.2725 183.871 34.04 183.365 33.5889 182.982C33.1514 182.586 32.5635 182.381 31.8115 182.381H29.1318V186.291ZM27.4365 187.877V175.9H31.8115C33.1514 175.9 34.1768 176.215 34.9014 176.857C35.5166 177.404 35.8311 178.102 35.8311 178.963C35.8311 179.797 35.667 180.412 35.3389 180.795C35.1475 181.027 34.915 181.246 34.6553 181.438L34.3271 181.643L34.6279 181.779C34.9697 181.984 35.2568 182.23 35.4756 182.518C35.8447 182.941 36.0225 183.557 36.0225 184.377C36.0088 185.457 35.6807 186.25 35.0518 186.77C34.1631 187.508 33.083 187.877 31.8115 187.877H27.4365Z" fill="white"/>\n<path d="M29.1318 201.795H31.8115C32.4404 201.795 33.001 201.658 33.4795 201.371C33.9033 201.111 34.1084 200.701 34.1084 200.141V200.072C34.1084 199.594 33.8486 199.211 33.3428 198.896C32.9053 198.623 32.3994 198.486 31.8115 198.486H29.1318V201.795ZM29.1318 207.291H31.8115C32.4814 207.291 33.042 207.154 33.4795 206.881C34.0127 206.566 34.2725 206.102 34.2725 205.486C34.2725 204.871 34.04 204.365 33.5889 203.982C33.1514 203.586 32.5635 203.381 31.8115 203.381H29.1318V207.291ZM27.4365 208.877V196.9H31.8115C33.1514 196.9 34.1768 197.215 34.9014 197.857C35.5166 198.404 35.8311 199.102 35.8311 199.963C35.8311 200.797 35.667 201.412 35.3389 201.795C35.1475 202.027 34.915 202.246 34.6553 202.438L34.3271 202.643L34.6279 202.779C34.9697 202.984 35.2568 203.23 35.4756 203.518C35.8447 203.941 36.0225 204.557 36.0225 205.377C36.0088 206.457 35.6807 207.25 35.0518 207.77C34.1631 208.508 33.083 208.877 31.8115 208.877H27.4365Z" fill="white"/>\n<path d="M18.167 182.777H21.1475L19.6709 177.322L18.167 182.777ZM15.2002 187.877L18.6045 175.559H20.9014L24.0322 187.877H22.3096L21.4072 184.432H17.7568L16.7725 187.877H15.2002Z" fill="white"/>\n<path d="M18.167 203.777H21.1475L19.6709 198.322L18.167 203.777ZM15.2002 208.877L18.6045 196.559H20.9014L24.0322 208.877H22.3096L21.4072 205.432H17.7568L16.7725 208.877H15.2002Z" fill="white"/>\n<path d="M56.7354 187.877V176.939L53.5908 179.646V177.268L56.708 174.725H58.6221V187.877H56.7354Z" fill="white"/>\n<path d="M63.8994 187.891C63.8994 185.908 64.0498 184.664 64.3506 184.131C64.8154 183.133 65.8135 182.148 67.3447 181.164C68.5615 180.385 69.3818 179.674 69.8193 179.031C69.9834 178.799 70.0654 178.512 70.0654 178.17C70.0654 177.951 70.0381 177.719 69.9697 177.459C69.874 177.09 69.5732 176.762 69.0811 176.475C68.7529 176.27 68.3701 176.16 67.9189 176.16C66.8662 176.16 65.8955 176.42 65.0068 176.939C64.4053 177.295 64.1045 177.473 64.1045 177.486C64.0908 177.062 64.0908 176.68 64.0908 176.352C64.0908 176.01 64.0908 175.736 64.1045 175.504C65.4033 174.861 66.6748 174.533 67.9189 174.52C69.04 174.52 69.9697 174.848 70.708 175.49C71.46 176.133 71.8291 177.008 71.8291 178.143C71.8291 179.1 71.5146 179.906 70.8857 180.549C70.1885 181.273 69.4229 181.889 68.5889 182.395C67.249 183.215 66.4561 183.926 66.1963 184.514C65.9639 185.074 65.8408 185.648 65.8271 186.25H71.624V187.891H63.8994Z" fill="white"/>\n<path d="M80.415 179.729L81.1396 179.865C81.8096 180.016 82.3428 180.303 82.7529 180.727C83.6143 181.561 84.0518 182.559 84.0518 183.707V183.748C84.0518 184.91 83.71 185.826 83.04 186.496C82.1787 187.357 81.0986 187.85 79.7861 187.973C79.5811 187.986 79.3896 188 79.1846 188C78.0771 188 76.9561 187.727 75.8486 187.166V185.361L76.9561 185.936C77.5713 186.195 78.2275 186.318 78.9385 186.318C79.1299 186.318 79.335 186.305 79.54 186.291C80.4424 186.195 81.1533 185.881 81.6865 185.361C82.1787 184.896 82.4248 184.391 82.4248 183.844V183.762C82.4248 183.051 82.2061 182.477 81.7686 182.025C81.29 181.506 80.6338 181.246 79.7861 181.246H77.9951V179.893L81.5498 176.297H75.8486V174.656H83.6006V176.502L80.415 179.729Z" fill="white"/>\n<path d="M332.647 181.684L338.8 185.703V187.754L330.159 181.984V181.369L338.8 175.709V177.787L332.647 181.684Z" fill="white"/>\n<path d="M320.534 181.684L326.687 185.703V187.754L318.046 181.984V181.369L326.687 175.709V177.787L320.534 181.684Z" fill="white"/>\n<path d="M308.421 181.684L314.573 185.703V187.754L305.933 181.984V181.369L314.573 175.709V177.787L308.421 181.684Z" fill="white"/>\n<path d="M296.308 181.684L302.46 185.703V187.754L293.819 181.984V181.369L302.46 175.709V177.787L296.308 181.684Z" fill="white"/>\n<path d="M284.194 181.684L290.347 185.703V187.754L281.706 181.984V181.369L290.347 175.709V177.787L284.194 181.684Z" fill="white"/>\n<path d="M272.081 181.684L278.233 185.703V187.754L269.593 181.984V181.369L278.233 175.709V177.787L272.081 181.684Z" fill="white"/>\n<path d="M259.968 181.684L266.12 185.703V187.754L257.479 181.984V181.369L266.12 175.709V177.787L259.968 181.684Z" fill="white"/>\n<path d="M247.854 181.684L254.007 185.703V187.754L245.366 181.984V181.369L254.007 175.709V177.787L247.854 181.684Z" fill="white"/>\n<path d="M235.741 181.684L241.894 185.703V187.754L233.253 181.984V181.369L241.894 175.709V177.787L235.741 181.684Z" fill="white"/>\n<path d="M223.628 181.684L229.78 185.703V187.754L221.14 181.984V181.369L229.78 175.709V177.787L223.628 181.684Z" fill="white"/>\n<path d="M211.515 181.684L217.667 185.703V187.754L209.026 181.984V181.369L217.667 175.709V177.787L211.515 181.684Z" fill="white"/>\n<path d="M199.401 181.684L205.554 185.703V187.754L196.913 181.984V181.369L205.554 175.709V177.787L199.401 181.684Z" fill="white"/>\n<path d="M187.288 181.684L193.44 185.703V187.754L184.8 181.984V181.369L193.44 175.709V177.787L187.288 181.684Z" fill="white"/>\n<path d="M175.175 181.684L181.327 185.703V187.754L172.687 181.984V181.369L181.327 175.709V177.787L175.175 181.684Z" fill="white"/>\n<path d="M163.062 181.684L169.214 185.703V187.754L160.573 181.984V181.369L169.214 175.709V177.787L163.062 181.684Z" fill="white"/>\n<path d="M150.948 181.684L157.101 185.703V187.754L148.46 181.984V181.369L157.101 175.709V177.787L150.948 181.684Z" fill="white"/>\n<path d="M138.835 181.684L144.987 185.703V187.754L136.347 181.984V181.369L144.987 175.709V177.787L138.835 181.684Z" fill="white"/>\n<path d="M126.722 181.684L132.874 185.703V187.754L124.233 181.984V181.369L132.874 175.709V177.787L126.722 181.684Z" fill="white"/>\n<path d="M114.608 181.684L120.761 185.703V187.754L112.12 181.984V181.369L120.761 175.709V177.787L114.608 181.684Z" fill="white"/>\n<path d="M102.495 181.684L108.647 185.703V187.754L100.007 181.984V181.369L108.647 175.709V177.787L102.495 181.684Z" fill="white"/>\n<path d="M90.3818 181.684L96.5342 185.703V187.754L87.8936 181.984V181.369L96.5342 175.709V177.787L90.3818 181.684Z" fill="white"/>\n</svg>';function tr(e){e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})}function ir(e,t,i){const n=document.createElement("div");return n.className=`mrz-icon-btn ${e}`,n.setAttribute("role","button"),n.setAttribute("aria-label",t),n.setAttribute("tabindex","0"),n.innerHTML=i,tr(n),n}const nr={[e.EnumMRZDocumentType.TD1]:{width:85.6,height:53.98},[e.EnumMRZDocumentType.TD2]:{width:105,height:74},[e.EnumMRZDocumentType.Passport]:{width:125,height:88}};class sr{showScannerLoadingOverlay(e){const t=Zs(this.config.container);this.loadingScreen=zs(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(Zs(this.config.container).style.display="none"))}constructor(t,i){this.resources=t,this.config=i,this.isSoundFeedbackOn=!1,this.isFlashOn=!1,this.scanModeManager={[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},this.currentScanMode=e.EnumMRZScanMode.All,this.resizeTimer=null,this.defaultBackCameraId=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedUI=!1,this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.flipTimeoutHandle=null,this.flipCountdownHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null},this.ui=null,this.loadingScreen=null,this.handleResize=()=>{this.setGuideFrameVisible(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.setGuideFrameVisible(!0),this.updateScanRegion()},500)},this.firstFrame=!0}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),Gs("dynamsoft-mrz-loading-screen-style",js),Gs("dynamsoft-mrz-scanner-view-style",'\n  .mrz-scanner-overlay {\n    position: absolute;\n    top: 0; left: 0; right: 0; bottom: 0;\n    pointer-events: none;\n    z-index: 100;\n    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;\n    box-sizing: border-box;\n  }\n\n  /* ── Top bar ── */\n  .mrz-top-bar {\n    position: absolute;\n    top: 0; left: 0; right: 0;\n    height: calc(56px + env(safe-area-inset-top, 0px));\n    background: #000;\n    display: flex;\n    flex-direction: column;\n    pointer-events: auto;\n  }\n\n  /* Absorbs the notch / Dynamic Island zone — no buttons ever live here */\n  .mrz-top-safe-spacer {\n    height: env(safe-area-inset-top, 0px);\n    flex-shrink: 0;\n  }\n\n  /* Fixed-height row that always holds the buttons — centred unconditionally */\n  .mrz-top-bar-inner {\n    flex: 0 0 56px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 12px 0 8px;\n  }\n\n  .mrz-top-controls {\n    display: flex;\n    align-items: center;\n    gap: 2px;\n  }\n\n  .mrz-icon-btn {\n    background: none;\n    border: none;\n    outline: none;\n    box-shadow: none;\n    cursor: pointer;\n    color: #fff;\n    padding: 0 10px;\n    align-self: center;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .mrz-icon-btn:active {\n    opacity: 0.6;\n  }\n\n  /* Close button — tight 20×20 viewBox (~90% coverage), keep visually small */\n  .mrz-close-btn svg {\n    width: 22px;\n    height: 22px;\n    display: block;\n  }\n\n  /*\n   * Top-controls action icons — 24×24 viewBox rendered at 24 px.\n   */\n  .mrz-top-controls .mrz-icon-btn svg {\n    width: 24px;\n    height: 24px;\n    display: block;\n  }\n\n  /*\n   * Flash / sound buttons wrap their SVGs in <span> elements for dual-state\n   * toggling. Spans are inline by default which adds a descender gap below\n   * the SVG and shifts it off-centre. Make them flex containers to match the\n   * layout of buttons whose SVG is a direct child.\n   */\n  .mrz-icon-btn span {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .mrz-icon-btn.mrz-hidden {\n    display: none;\n  }\n\n  /* Hide a divider whose preceding button is hidden (prevents orphan / double dividers) */\n  .mrz-icon-btn.mrz-hidden + .mrz-top-divider {\n    display: none;\n  }\n\n  .mrz-top-divider {\n    width: 1px;\n    height: 24px;\n    background: rgba(255, 255, 255, 0.3);\n    margin: 0 4px;\n    flex-shrink: 0;\n    align-self: center;\n  }\n\n  /* ── Guide wrapper (positions frame + badge together) ── */\n  .mrz-guide-wrapper {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -46%);\n    width: min(88vw, 520px);\n    pointer-events: none;\n  }\n\n  /* ── Badge — floats just above the guide frame ── */\n  .mrz-badge {\n    position: absolute;\n    bottom: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    margin-bottom: 8px;\n    background: rgba(0, 0, 0, 0.72);\n    border-radius: 20px;\n    padding: 10px 20px;\n    text-align: center;\n    white-space: nowrap;\n    pointer-events: none;\n    display: none;\n    flex-direction: column;\n    gap: 3px;\n  }\n\n  .mrz-badge.mrz-badge-visible {\n    display: flex;\n  }\n\n  .mrz-badge-line {\n    font-size: 14px;\n    font-weight: 500;\n    color: #fff;\n    line-height: 1.4;\n    letter-spacing: 0.1px;\n  }\n\n  .mrz-badge-line.mrz-success {\n    color: #FF9F40;\n  }\n\n  /* ── Guide frame ── */\n  .mrz-guide-frame {\n    width: 100%;\n    color: #fff;\n    transition: color 0.35s ease;\n    pointer-events: none;\n  }\n\n  .mrz-guide-frame.mrz-guide-success {\n    color: #4CAF50;\n  }\n\n  .mrz-guide-frame svg {\n    width: 100%;\n    height: auto;\n    display: block;\n  }\n\n  /* ── Bottom bar / Format selector ── */\n  .mrz-format-selector {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 16px 16px 0 0;\n    padding: 10px 0 calc(20px + env(safe-area-inset-bottom, 0px));\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    pointer-events: auto;\n  }\n\n  /* Row that holds the three format buttons plus the sliding indicator */\n  .mrz-format-buttons-row {\n    position: relative;\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding-top: 10px;\n  }\n\n  /* Sliding selection indicator (thin bar above the active button\'s text) */\n  .mrz-format-indicator {\n    position: absolute;\n    top: 0;\n    height: 3px;\n    width: 32px;\n    background: #fff;\n    border-radius: 2px;\n    pointer-events: none;\n    transition: left 0.25s ease;\n  }\n\n  .mrz-format-btn {\n    flex: 1;\n    text-align: center;\n    background: none;\n    border: none;\n    outline: none;\n    box-shadow: none;\n    color: rgba(255, 255, 255, 0.8);\n    font-size: 15px;\n    font-weight: 400;\n    padding: 8px 0;\n    cursor: pointer;\n    letter-spacing: 0.2px;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    user-select: none;\n    -webkit-user-select: none;\n    transition: color 0.15s ease, font-weight 0.15s ease;\n    font-family: inherit;\n  }\n\n  .mrz-format-btn.mrz-format-active {\n    color: #fff;\n    font-weight: 700;\n  }\n\n  @media (max-width: 400px) {\n    .mrz-format-btn {\n      padding: 8px 14px;\n      font-size: 14px;\n    }\n  }\n\n  @media (min-width: 1024px) {\n    .mrz-top-bar {\n      height: calc(60px + env(safe-area-inset-top, 0px));\n    }\n    .mrz-top-bar-inner {\n      flex-basis: 60px;\n    }\n    .mrz-badge {\n      font-size: 15px;\n    }\n    .mrz-guide-wrapper {\n      width: min(60vw, 600px);\n    }\n  }\n');try{const{cameraView:e,cameraEnhancer:t,cvRouter:i}=this.resources;if(e.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),e.setVideoFit("cover"),i.setInput(t),!0===this.config.enableMultiFrameCrossFilter){const e=new Ss;e.enableResultCrossVerification(Q.CRIT_TEXT_LINE,!0),await i.addResultFilter(e)}const n=new wi;n.onCapturedResultReceived=e=>this.handleMRZResult(e),i.addResultReceiver(n),this.initialized=!0}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera();const n=new Js({status:e.EnumResultStatus.RS_FAILED});this.currentScanResolver(n)}}}initializeUI(){const e=Zs(this.config.container),t=e.children[e.children.length-1];if((null==t?void 0:t.shadowRoot)&&!t.shadowRoot.querySelector("#mrz-dce-hide-style")){const e=document.createElement("style");e.id="mrz-dce-hide-style",e.textContent="\n  .dce-header,\n  .dce-footer,\n  .dce-mn-footer,\n  .dce-mn-resolution-box,\n  .dce-mn-select-camera-icon,\n  .dce-mn-camera-and-resolution-settings,\n  .dce-mn-upload-image-icon,\n  .dce-mn-sound-feedback,\n  .dce-mn-torch,\n  .dce-mn-close,\n  .dce-mn-scan-mode-select,\n  .dce-mn-zoom,\n  .dce-mn-toast,\n  .dce-mn-msg-poweredby,\n  .dce-mn-setting,\n  .dce-mn-settings,\n  .dce-mn-cog,\n  .dce-mn-camera-setting,\n  .dce-scanguide-passport,\n  .dce-scanguide-td1,\n  .dce-scanguide-td2,\n  .dce-mn-bg-mrz-passport,\n  .dce-mn-bg-mrz-td1,\n  .dce-mn-bg-mrz-td2 {\n    display: none !important;\n  }\n",t.shadowRoot.appendChild(e)}const i=!1!==this.config.showUploadImage,n=!1!==this.config.showFormatSelector&&this.shouldShowFormatSelector(),s=!1!==this.config.showSoundToggle;this.ui=function(e){const{showUpload:t,showFormatSelector:i,showSoundToggle:n}=e,s=document.createElement("div");s.className="mrz-scanner-overlay";const r=document.createElement("div");r.className="mrz-top-bar";const a=document.createElement("div");a.className="mrz-top-safe-spacer";const o=document.createElement("div");o.className="mrz-top-bar-inner";const l=ir("mrz-close-btn","Close scanner",'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="2" y1="2" x2="18" y2="18"/><line x1="18" y1="2" x2="2" y2="18"/></svg>'),c=document.createElement("div");c.className="mrz-top-controls";const d=ir("mrz-upload-btn","Upload image",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.25 3.75H6.75C6.35218 3.75 5.97064 3.90804 5.68934 4.18934C5.40804 4.47064 5.25 4.85218 5.25 5.25V6.75H3.75C3.35218 6.75 2.97064 6.90804 2.68934 7.18934C2.40804 7.47064 2.25 7.85218 2.25 8.25V18.75C2.25 19.1478 2.40804 19.5294 2.68934 19.8107C2.97064 20.092 3.35218 20.25 3.75 20.25H17.25C17.6478 20.25 18.0294 20.092 18.3107 19.8107C18.592 19.5294 18.75 19.1478 18.75 18.75V17.25H20.25C20.6478 17.25 21.0294 17.092 21.3107 16.8107C21.592 16.5294 21.75 16.1478 21.75 15.75V5.25C21.75 4.85218 21.592 4.47064 21.3107 4.18934C21.0294 3.90804 20.6478 3.75 20.25 3.75ZM16.125 6.75C16.3475 6.75 16.565 6.81598 16.75 6.9396C16.935 7.06321 17.0792 7.23891 17.1644 7.44448C17.2495 7.65005 17.2718 7.87625 17.2284 8.09448C17.185 8.31271 17.0778 8.51316 16.9205 8.6705C16.7632 8.82783 16.5627 8.93498 16.3445 8.97838C16.1262 9.02179 15.9 8.99951 15.6945 8.91436C15.4889 8.82922 15.3132 8.68502 15.1896 8.50002C15.066 8.31501 15 8.0975 15 7.875C15 7.57663 15.1185 7.29048 15.3295 7.0795C15.5405 6.86853 15.8266 6.75 16.125 6.75ZM17.25 18.75H3.75V8.25H5.25V15.75C5.25 16.1478 5.40804 16.5294 5.68934 16.8107C5.97064 17.092 6.35218 17.25 6.75 17.25H17.25V18.75ZM20.25 15.75H6.75V11.3147L9.59437 8.46937C9.66403 8.39964 9.74675 8.34432 9.83779 8.30658C9.92884 8.26884 10.0264 8.24941 10.125 8.24941C10.2236 8.24941 10.3212 8.26884 10.4122 8.30658C10.5033 8.34432 10.586 8.39964 10.6556 8.46937L15.3103 13.125L17.7188 10.7194C17.8594 10.5788 18.0501 10.4999 18.2489 10.4999C18.4477 10.4999 18.6384 10.5788 18.7791 10.7194L20.25 12.1941V15.75Z" fill="white"/></svg>');t||d.classList.add("mrz-hidden");const h=document.createElement("span");h.className="mrz-top-divider",t||h.classList.add("mrz-hidden");const u=ir("mrz-camera-btn","Switch camera",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.5 5.25H16.9012L15.6234 3.33375C15.555 3.23114 15.4623 3.147 15.3535 3.08879C15.2448 3.03057 15.1233 3.00007 15 3H9C8.87665 3.00007 8.75522 3.03057 8.64648 3.08879C8.53773 3.147 8.44502 3.23114 8.37656 3.33375L7.09781 5.25H4.5C3.90326 5.25 3.33097 5.48705 2.90901 5.90901C2.48705 6.33097 2.25 6.90326 2.25 7.5V18C2.25 18.5967 2.48705 19.169 2.90901 19.591C3.33097 20.0129 3.90326 20.25 4.5 20.25H19.5C20.0967 20.25 20.669 20.0129 21.091 19.591C21.5129 19.169 21.75 18.5967 21.75 18V7.5C21.75 6.90326 21.5129 6.33097 21.091 5.90901C20.669 5.48705 20.0967 5.25 19.5 5.25ZM14.7009 15.6C13.8672 16.2207 12.8451 16.5351 11.8066 16.4901C10.7682 16.4452 9.77701 16.0438 9 15.3534V15.75C9 15.9489 8.92098 16.1397 8.78033 16.2803C8.63968 16.421 8.44891 16.5 8.25 16.5C8.05109 16.5 7.86032 16.421 7.71967 16.2803C7.57902 16.1397 7.5 15.9489 7.5 15.75V13.5C7.5 13.3011 7.57902 13.1103 7.71967 12.9697C7.86032 12.829 8.05109 12.75 8.25 12.75H10.5C10.6989 12.75 10.8897 12.829 11.0303 12.9697C11.171 13.1103 11.25 13.3011 11.25 13.5C11.25 13.6989 11.171 13.8897 11.0303 14.0303C10.8897 14.171 10.6989 14.25 10.5 14.25H10.0172C10.5352 14.7039 11.1932 14.9664 11.8814 14.9939C12.5697 15.0214 13.2465 14.8121 13.7991 14.4009C13.9581 14.2813 14.1581 14.2298 14.3551 14.2577C14.5521 14.2855 14.7299 14.3905 14.8495 14.5495C14.9691 14.7085 15.0207 14.9085 14.9928 15.1055C14.9649 15.3025 14.8599 15.4804 14.7009 15.6ZM16.5 11.25C16.5 11.4489 16.421 11.6397 16.2803 11.7803C16.1397 11.921 15.9489 12 15.75 12H13.5C13.3011 12 13.1103 11.921 12.9697 11.7803C12.829 11.6397 12.75 11.4489 12.75 11.25C12.75 11.0511 12.829 10.8603 12.9697 10.7197C13.1103 10.579 13.3011 10.5 13.5 10.5H13.9828C13.4648 10.0461 12.8068 9.78356 12.1186 9.7561C11.4303 9.72863 10.7535 9.93792 10.2009 10.3491C10.0419 10.4687 9.84193 10.5202 9.64493 10.4923C9.44793 10.4645 9.27007 10.3595 9.15047 10.2005C9.03087 10.0415 8.97934 9.84146 9.00721 9.64446C9.03507 9.44746 9.14006 9.2696 9.29906 9.15C10.1328 8.52931 11.1549 8.21494 12.1934 8.25985C13.2318 8.30476 14.223 8.70621 15 9.39656V9C15 8.80109 15.079 8.61032 15.2197 8.46967C15.3603 8.32902 15.5511 8.25 15.75 8.25C15.9489 8.25 16.1397 8.32902 16.2803 8.46967C16.421 8.61032 16.5 8.80109 16.5 9V11.25Z" fill="white"/></svg>'),g=document.createElement("span");g.className="mrz-top-divider";const m=ir("mrz-flash-btn","Toggle flash",""),p=document.createElement("span");p.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.25 1.5H6.75C6.35218 1.5 5.97064 1.65804 5.68934 1.93934C5.40804 2.22064 5.25 2.60218 5.25 3V7.24969C5.2508 7.57411 5.35599 7.88967 5.55 8.14969L7.5 10.7503V21C7.5 21.3978 7.65804 21.7794 7.93934 22.0607C8.22064 22.342 8.60218 22.5 9 22.5H15C15.3978 22.5 15.7794 22.342 16.0607 22.0607C16.342 21.7794 16.5 21.3978 16.5 21V10.7503L18.45 8.14969C18.644 7.88967 18.7492 7.57411 18.75 7.24969V3C18.75 2.60218 18.592 2.22064 18.3107 1.93934C18.0294 1.65804 17.6478 1.5 17.25 1.5ZM12.75 14.25C12.75 14.4489 12.671 14.6397 12.5303 14.7803C12.3897 14.921 12.1989 15 12 15C11.8011 15 11.6103 14.921 11.4697 14.7803C11.329 14.6397 11.25 14.4489 11.25 14.25V11.25C11.25 11.0511 11.329 10.8603 11.4697 10.7197C11.6103 10.579 11.8011 10.5 12 10.5C12.1989 10.5 12.3897 10.579 12.5303 10.7197C12.671 10.8603 12.75 11.0511 12.75 11.25V14.25ZM6.75 5.25V3H17.25V5.25H6.75Z" fill="white"/></svg>';const f=document.createElement("span");f.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.25 6.5H6.75C6.35218 6.5 5.97064 6.65804 5.68934 6.93934C5.40804 7.22064 5.25 7.60218 5.25 8V10.2497C5.2508 10.5741 5.35599 10.8897 5.55 11.1497L7.5 13.7503V21C7.5 21.3978 7.65804 21.7794 7.93934 22.0607C8.22064 22.342 8.60218 22.5 9 22.5H15C15.3978 22.5 15.7794 22.342 16.0607 22.0607C16.342 21.7794 16.5 21.3978 16.5 21V13.7503L18.45 11.1497C18.644 10.8897 18.7492 10.5741 18.75 10.2497V8C18.75 7.60218 18.592 7.22064 18.3107 6.93934C18.0294 6.65804 17.6478 6.5 17.25 6.5ZM12.75 17.25C12.75 17.4489 12.671 17.6397 12.5303 17.7803C12.3897 17.921 12.1989 18 12 18C11.8011 18 11.6103 17.921 11.4697 17.7803C11.329 17.6397 11.25 17.4489 11.25 17.25V14.25C11.25 14.0511 11.329 13.8603 11.4697 13.7197C11.6103 13.579 11.8011 13.5 12 13.5C12.1989 13.5 12.3897 13.579 12.5303 13.7197C12.671 13.8603 12.75 14.0511 12.75 14.25V17.25Z" fill="white"/><path d="M11.125 3.7V1.3C11.125 1.08783 11.2172 0.884344 11.3813 0.734315C11.5454 0.584285 11.7679 0.5 12 0.5C12.2321 0.5 12.4546 0.584285 12.6187 0.734315C12.7828 0.884344 12.875 1.08783 12.875 1.3V3.7C12.875 3.91217 12.7828 4.11566 12.6187 4.26569C12.4546 4.41571 12.2321 4.5 12 4.5C11.7679 4.5 11.5454 4.41571 11.3813 4.26569C11.2172 4.11566 11.125 3.91217 11.125 3.7Z" fill="white"/><path d="M6.09231 4.97685L4.89231 2.89839C4.78622 2.71464 4.76432 2.49232 4.83141 2.28035C4.89851 2.06837 5.04911 1.8841 5.25008 1.76807C5.45106 1.65203 5.68594 1.61375 5.90307 1.66163C6.12019 1.70951 6.30177 1.83964 6.40785 2.02339L7.60785 4.10185C7.71394 4.2856 7.73585 4.50791 7.66875 4.71989C7.60166 4.93186 7.45106 5.11614 7.25008 5.23217C7.04911 5.3482 6.81422 5.38649 6.5971 5.3386C6.37997 5.29072 6.1984 5.1606 6.09231 4.97685Z" fill="white"/><path d="M16.3922 4.10185L17.5922 2.02339C17.6983 1.83964 17.8799 1.70951 18.097 1.66163C18.3141 1.61375 18.549 1.65203 18.75 1.76807C18.9509 1.8841 19.1015 2.06837 19.1686 2.28035C19.2357 2.49232 19.2138 2.71464 19.1077 2.89839L17.9077 4.97685C17.8016 5.1606 17.6201 5.29072 17.4029 5.33861C17.1858 5.38649 16.9509 5.3482 16.75 5.23217C16.549 5.11614 16.3984 4.93186 16.3313 4.71989C16.2642 4.50791 16.2861 4.2856 16.3922 4.10185Z" fill="white"/></svg>',f.style.display="none",m.appendChild(p),m.appendChild(f);const _=ir("mrz-sound-btn","Toggle sound","");n||_.classList.add("mrz-hidden");const E=document.createElement("span");E.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.98"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52987 3.47025C4.76321 3.23691 5.11092 3.19215 5.3912 3.3306C5.42654 3.40214 5.47033 3.47125 5.52987 3.5308L21.4703 19.4703C21.5294 19.5292 21.5976 19.5728 21.6685 19.6079C21.8078 19.8885 21.7635 20.2366 21.5299 20.4703C21.237 20.7626 20.7621 20.7627 20.4693 20.4703L12.7496 12.7505V17.2505C12.7503 18.2809 12.3972 19.2801 11.7496 20.0816C11.1021 20.8829 10.1994 21.4381 9.19198 21.6538C8.1844 21.8694 7.13236 21.7333 6.21347 21.2671C5.29459 20.8009 4.56321 20.0328 4.14218 19.0923C3.72122 18.1519 3.6357 17.095 3.89999 16.0992C4.16433 15.1032 4.76337 14.2286 5.5953 13.6206C6.42729 13.0128 7.44312 12.7085 8.47226 12.7593C9.50127 12.8103 10.4816 13.2131 11.2496 13.8999V11.2505L4.52987 4.5308C4.23726 4.23807 4.23753 3.76315 4.52987 3.47025ZM11.8697 3.01127C11.9848 2.99106 12.1035 2.99824 12.2154 3.03178L19.7154 5.28178C19.8697 5.32808 20.0049 5.42317 20.1012 5.55228C20.1974 5.68164 20.2496 5.83929 20.2496 6.00053V10.5005C20.2495 10.6172 20.2219 10.7322 20.1695 10.8365C20.117 10.9408 20.0406 11.0324 19.9469 11.1021C19.8532 11.1716 19.7444 11.2186 19.6295 11.2388C19.5145 11.259 19.3956 11.2519 19.2838 11.2183L13.65 9.52787L11.2496 7.12748V3.75053C11.2496 3.63371 11.2772 3.518 11.3297 3.41361C11.3821 3.30928 11.4587 3.2187 11.5523 3.14896C11.646 3.07929 11.7547 3.03155 11.8697 3.01127Z" fill="white"/></g></svg>';const y=document.createElement("span");y.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.98"><path d="M19.7156 5.28185L12.2156 3.03185C12.1037 2.99824 11.9854 2.99127 11.8702 3.0115C11.7551 3.03173 11.6462 3.0786 11.5524 3.14837C11.4586 3.21813 11.3824 3.30887 11.3299 3.41332C11.2774 3.51778 11.25 3.63306 11.25 3.74997V13.8993C10.4819 13.2123 9.5013 12.8098 8.47206 12.7589C7.44282 12.7081 6.4273 13.012 5.59523 13.62C4.76317 14.2279 4.16496 15.103 3.9006 16.099C3.63624 17.095 3.72173 18.1516 4.14279 19.0922C4.56386 20.0327 5.29498 20.8002 6.21396 21.2665C7.13295 21.7327 8.18412 21.8695 9.1918 21.6538C10.1995 21.4381 11.1026 20.8831 11.7502 20.0816C12.3979 19.28 12.7508 18.2805 12.75 17.25V9.25779L19.2844 11.2181C19.3964 11.2517 19.5146 11.2587 19.6298 11.2384C19.7449 11.2182 19.8538 11.1713 19.9476 11.1016C20.0414 11.0318 20.1176 10.9411 20.1701 10.8366C20.2226 10.7322 20.25 10.6169 20.25 10.5V5.99997C20.25 5.83873 20.198 5.6818 20.1017 5.55245C20.0054 5.42309 19.8701 5.3282 19.7156 5.28185Z" fill="white"/></g></svg>',y.style.display="none",_.appendChild(E),_.appendChild(y),c.append(d,h,u,g,m,_),o.append(l,c),r.append(a,o);const I=document.createElement("div");I.className="mrz-guide-wrapper";const R=document.createElement("div");R.className="mrz-badge";const C=document.createElement("span");C.className="mrz-badge-line";const w=document.createElement("span");w.className="mrz-badge-line",w.style.display="none",R.append(C,w);const v=document.createElement("div");v.className="mrz-guide-frame",v.innerHTML=er,I.append(R,v);let T=null,S=null,D=null,M=null,b=null;if(i){T=document.createElement("div"),T.className="mrz-format-selector";const e=document.createElement("div");e.className="mrz-format-buttons-row",S=document.createElement("div"),S.className="mrz-format-btn",S.setAttribute("role","button"),S.setAttribute("tabindex","0"),S.textContent="ID",tr(S),D=document.createElement("div"),D.className="mrz-format-btn mrz-format-active",D.setAttribute("role","button"),D.setAttribute("tabindex","0"),D.textContent="Both",tr(D),M=document.createElement("div"),M.className="mrz-format-btn",M.setAttribute("role","button"),M.setAttribute("tabindex","0"),M.textContent="Passport",tr(M),b=document.createElement("div"),b.className="mrz-format-indicator",e.append(b,S,D,M),T.append(e)}return s.append(r,I),T&&s.appendChild(T),{overlay:s,closeBtn:l,uploadBtn:d,cameraSwitchBtn:u,flashBtn:m,flashOnIcon:f,flashOffIcon:p,soundBtn:_,soundOnIcon:y,soundOffIcon:E,badge:R,badgeLine1:C,badgeLine2:w,guideFrame:v,formatSelector:T,formatIdBtn:S,formatBothBtn:D,formatPassportBtn:M,formatIndicator:b}}({showUpload:i,showFormatSelector:n,showSoundToggle:s}),e.appendChild(this.ui.overlay),this.ui.closeBtn.addEventListener("click",()=>this.handleCloseBtn()),this.ui.uploadBtn.addEventListener("click",()=>this.uploadFile()),this.ui.cameraSwitchBtn.addEventListener("click",()=>this.switchCamera()),this.ui.flashBtn.addEventListener("click",()=>this.toggleFlash()),this.ui.soundBtn.addEventListener("click",()=>this.toggleSoundFeedback()),this.ui.formatIdBtn&&this.ui.formatIdBtn.addEventListener("click",()=>this.setFormatMode("id")),this.ui.formatBothBtn&&this.ui.formatBothBtn.addEventListener("click",()=>this.setFormatMode("both")),this.ui.formatPassportBtn&&this.ui.formatPassportBtn.addEventListener("click",()=>this.setFormatMode("passport")),this.toggleSoundFeedback(!1),this.syncFormatButtons(),this.ui.flashBtn.classList.add("mrz-hidden"),this.initializedUI=!0}shouldShowFormatSelector(){return Object.values(this.scanModeManager).filter(Boolean).length>1}async toggleFlash(){var e;try{const{cameraEnhancer:e}=this.resources;this.isFlashOn?(await e.turnOffTorch(),this.isFlashOn=!1):(await e.turnOnTorch(),this.isFlashOn=!0),this.syncFlashIcon()}catch(t){null===(e=this.ui)||void 0===e||e.flashBtn.classList.add("mrz-hidden")}}syncFlashIcon(){this.ui&&(this.ui.flashOnIcon.style.display=this.isFlashOn?"inline":"none",this.ui.flashOffIcon.style.display=this.isFlashOn?"none":"inline")}async probeFlashSupport(){var e,t;try{const{cameraEnhancer:t}=this.resources;await t.turnOffTorch(),null===(e=this.ui)||void 0===e||e.flashBtn.classList.remove("mrz-hidden")}catch(e){null===(t=this.ui)||void 0===t||t.flashBtn.classList.add("mrz-hidden")}}async switchCamera(){var e,t;try{const{cameraEnhancer:i}=this.resources,n=await i.getAllCameras();if(n.length<=1)return void(null===(e=this.ui)||void 0===e||e.cameraSwitchBtn.classList.add("mrz-hidden"));const s=i.getSelectedCamera();let r;if(r=(null==s?void 0:s.deviceId)===this.defaultBackCameraId?null!==(t=n.find(e=>/front|user|selfie/i.test(e.label)))&&void 0!==t?t:n.find(e=>e.deviceId!==this.defaultBackCameraId):n.find(e=>e.deviceId===this.defaultBackCameraId),!r)return;await i.selectCamera(r.deviceId),this.setGuideFrameVisible(!1),window.setTimeout(()=>{this.setGuideFrameVisible(!0),this.updateScanRegion()},300)}catch(e){console.warn("Camera switch failed:",(null==e?void 0:e.message)||e)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn,this.ui&&(this.ui.soundOnIcon.style.display=this.isSoundFeedbackOn?"inline":"none",this.ui.soundOffIcon.style.display=this.isSoundFeedbackOn?"none":"inline")}setGuideFrame(e){this.ui&&(this.ui.guideFrame.innerHTML="mrz"===e?er:'<svg width="354" height="221" viewBox="0 0 354 221" fill="none" xmlns="http://www.w3.org/2000/svg">\n<rect x="1" y="1" width="352" height="219" rx="15" stroke="currentColor" stroke-width="2"/>\n</svg>')}setGuideFrameVisible(e){this.ui&&(this.ui.guideFrame.style.visibility=e?"visible":"hidden")}showGuideSuccessBorder(e=1e3){this.ui&&(this.ui.guideFrame.classList.add("mrz-guide-success"),window.setTimeout(()=>{var e;null===(e=this.ui)||void 0===e||e.guideFrame.classList.remove("mrz-guide-success")},e))}showBadge(e,t,i,n){if(!this.ui)return;const{badge:s,badgeLine1:r,badgeLine2:a}=this.ui;r.textContent=e,r.className="mrz-badge-line"+(t?" mrz-success":""),void 0!==i?(a.textContent=i,a.className="mrz-badge-line"+(n?" mrz-success":""),a.style.display="block"):a.style.display="none",s.classList.add("mrz-badge-visible")}async setFormatMode(t){var i;const n={id:e.EnumMRZScanMode.TD1,both:e.EnumMRZScanMode.All,passport:e.EnumMRZScanMode.Passport},s={id:{[e.EnumMRZDocumentType.Passport]:!1,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},both:{[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},passport:{[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!1,[e.EnumMRZDocumentType.TD2]:!1}};try{this.scanModeManager=s[t],this.currentScanMode=n[t],this.stopCapturing(),this.updateScanRegion(),await this.startCapturing(),this.syncFormatButtons()}catch(t){console.error("MRZ Scanner switch scan mode error:",(null==t?void 0:t.message)||t),this.closeCamera(),null===(i=this.currentScanResolver)||void 0===i||i.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}}syncFormatButtons(){if(!this.ui)return;const{formatIdBtn:t,formatBothBtn:i,formatPassportBtn:n}=this.ui;if(!t||!i||!n)return;const s=this.scanModeManager[e.EnumMRZDocumentType.Passport]&&!this.scanModeManager[e.EnumMRZDocumentType.TD1]&&!this.scanModeManager[e.EnumMRZDocumentType.TD2],r=!this.scanModeManager[e.EnumMRZDocumentType.Passport]&&(this.scanModeManager[e.EnumMRZDocumentType.TD1]||this.scanModeManager[e.EnumMRZDocumentType.TD2]);t.className="mrz-format-btn"+(r?" mrz-format-active":""),n.className="mrz-format-btn"+(s?" mrz-format-active":""),i.className="mrz-format-btn"+(r||s?"":" mrz-format-active"),r?(n.style.order="1",t.style.order="2",i.style.order="3"):s?(i.style.order="1",n.style.order="2",t.style.order="3"):(t.style.order="1",i.style.order="2",n.style.order="3");const{formatIndicator:a}=this.ui;if(a){!function(e,t){const i=e.offsetWidth||32,n=t.offsetLeft+t.offsetWidth/2;e.style.left=n-i/2+"px"}(a,r?t:s?n:i)}}updateScanRegion(){if(!1===this.config.showScanGuide)return;let t=e.EnumMRZDocumentType.Passport;this.currentScanMode===e.EnumMRZScanMode.TD1||this.currentScanMode===e.EnumMRZScanMode.TD1AndTD2?t=e.EnumMRZDocumentType.TD1:this.currentScanMode===e.EnumMRZScanMode.TD2&&(t=e.EnumMRZDocumentType.TD2),this.calculateScanRegion(t)}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:i}=this.resources;if(!t||!t.isOpen())return;const n=nr[e].width/nr[e].height,s=i.getVisibleRegionOfVideo({inPixels:!0});if(!s)return;const{width:r,height:a}=s;let o;if(r>a){const e=.5*a*n,t=Math.round(e/r*100),i=(100-t)/2;o={left:i,right:i+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*r/n,t=Math.round(e/a*100),i=(100-t)/2;o={left:5,right:95,top:i,bottom:i+t,isMeasuredInPercentage:!0}}i.setScanRegionMaskVisible(!0),i.getDrawingLayer(1).setVisible(!1),i.getDrawingLayer(3).setVisible(!1),t.setScanRegion(o)}async openCamera(){var t,i,n;try{const{cameraEnhancer:e,cameraView:n}=this.resources,s=Zs(this.config.container);if(s.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const t=n.getUIElement();t.parentElement||s.append(t),e.setPixelFormat(l.IPF_ABGR_8888),await e.open();const i=e.getSelectedCamera();i&&(this.defaultBackCameraId=i.deviceId);const r=t.shadowRoot;if(r){const e=r.querySelector(".dce-macro-use-mobile-native-like-ui");e&&(e.style.display="block")}}await e.setResolution({width:2560,height:1440}),!this.initializedUI&&e.isOpen()&&this.initializeUI();const r=await e.getAllCameras(),a=r.find(e=>/front|user|selfie/i.test(e.label)),o=r.length>1&&(a||r.some(e=>e.deviceId!==this.defaultBackCameraId));o?null===(t=this.ui)||void 0===t||t.cameraSwitchBtn.classList.remove("mrz-hidden"):null===(i=this.ui)||void 0===i||i.cameraSwitchBtn.classList.add("mrz-hidden"),await this.probeFlashSupport(),window.addEventListener("resize",this.handleResize)}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),null===(n=this.currentScanResolver)||void 0===n||n.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}}async closeCamera(e=!0){var t;try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null),this.defaultBackCameraId=null;const{cameraEnhancer:i,cameraView:n}=this.resources,s=Zs(this.config.container);s.style.display=e?"none":"block",(null==n?void 0:n.getUIElement().parentElement)&&s.removeChild(n.getUIElement()),(null===(t=this.ui)||void 0===t?void 0:t.overlay.parentElement)&&s.removeChild(this.ui.overlay),this.ui=null,this.initializedUI=!1,i.close(),this.stopCapturing()}catch(e){console.error(`Close Camera error: ${(null==e?void 0:e.message)||e}`)}}pauseCamera(){this.resources.cameraEnhancer.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}handleCloseBtn(){if(this.closeCamera(),this.currentScanResolver)if(this.isMRZScanned&&!this.isPortraitScanned&&(this.areSidesDifferent||this.isWaitingForPortraitAfterMRZ)){const t=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:this.mrzSideData.portraitImage});this.currentScanResolver(t),this.resetScanningState()}else this.currentScanResolver(new Js({status:e.EnumResultStatus.RS_CANCELLED})),this.resetScanningState()}async uploadFile(){var t,i,n,s,r,a,o,l;const{cvRouter:c}=this.resources,d=document.createElement("input");d.type="file",d.accept=null!==(t=this.config.uploadAcceptedTypes)&&void 0!==t?t:"image/*",d.style.display="none",document.body.appendChild(d);try{this.showScannerLoadingOverlay("Processing file..."),await this.closeCamera(!1);const t=await new Promise((e,t)=>{d.onchange=i=>{var n;const s=null===(n=i.target.files)||void 0===n?void 0:n[0];s?e(s):t(new Error("No file selected"))},d.addEventListener("cancel",async()=>{this.hideScannerLoadingOverlay(!1),this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.setGuideFrameVisible(!0),this.updateScanRegion(),await this.startCapturing(),this.hideScannerLoadingOverlay()}),d.click()});if(!t)return;let l;if(this.config.uploadFileConverter&&!t.type.startsWith("image/"))try{l=await this.config.uploadFileConverter(t)}catch(e){throw new Error(`Error converting file: ${e.message}`)}else{if(!t.type.startsWith("image/"))throw new Error("Unsupported file type. Please provide a converter function for this file type.");l=t}const h=this.config.utilizedTemplateNames[this.currentScanMode],u=await c.capture(l,h);this.capturedResultItems=u.items;const g=this.capturedResultItems.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(0===g.length)throw new Error("No image data found in the captured result");const m=g[0].imageData;m.toCanvas=()=>S(m),m.toBlob=async()=>await M("image/png",m),this.originalImageData=m;const p=null===(i=null==u?void 0:u.parsedResult)||void 0===i?void 0:i.parsedResultItems;let f={};if(null==p?void 0:p.length){const e=(null===(s=null===(n=p[0])||void 0===n?void 0:n.referenceItem)||void 0===s?void 0:s.text)||"";f=Ks(e,p[0])}let _=null,E=null;if(this.resources.returnDocumentImage)try{const e=u.processedDocumentResult;if((null===(r=null==e?void 0:e.detectedQuadResultItems)||void 0===r?void 0:r.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==re.CVS_FAILED&&(E=t.location,_=await Os.cropAndDeskewImage(this.originalImageData,E),_.toCanvas=()=>S(_),_.toBlob=async()=>await M("image/png",_))}}catch(e){console.warn("Error extracting document image from file upload:",e)}let y=null;if(this.resources.returnPortraitImage)try{const e=await xs.findPortraitZone();if(e&&!e.errorCode){(!E||this.validatePortraitLocation(e,E))&&(y=await Os.cropAndDeskewImage(this.originalImageData,e),y.toCanvas=()=>S(y),y.toBlob=async()=>await M("image/png",y))}}catch(e){console.warn("Error finding portrait zone in file upload:",e)}const I=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:f,primaryOriginalImage:this.originalImageData,primaryDocumentImage:_,portraitImage:y});null===(o=(a=this.resources).onResultUpdated)||void 0===o||o.call(a,I),this.currentScanResolver(I)}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),null===(l=this.currentScanResolver)||void 0===l||l.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}finally{this.hideScannerLoadingOverlay(!0),document.body.removeChild(d)}}initializeScanModeManager(){const{mrzFormatType:t}=this.config;if(this.scanModeManager={[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},!t||Array.isArray(t)&&0===t.length)return;Object.keys(this.scanModeManager).forEach(e=>{this.scanModeManager[e]=!1});(Array.isArray(t)?t:[t]).forEach(e=>{this.scanModeManager[e]=!0})}getScanMode(){const t=Object.entries(this.scanModeManager).filter(([e,t])=>t).map(([e])=>e).sort().join(",");return{[e.EnumMRZDocumentType.Passport]:e.EnumMRZScanMode.Passport,[e.EnumMRZDocumentType.TD1]:e.EnumMRZScanMode.TD1,[e.EnumMRZDocumentType.TD2]:e.EnumMRZScanMode.TD2,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD1}`]:e.EnumMRZScanMode.PassportAndTD1,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.PassportAndTD2,[`${e.EnumMRZDocumentType.TD1},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.TD1AndTD2,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD1},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.All,"":e.EnumMRZScanMode.All}[t]}async startCapturing(){var t;const{cvRouter:i}=this.resources,n=this.config.utilizedTemplateNames[this.currentScanMode];try{this.firstFrame=!0,await i.startCapturing(n)}catch(i){let n=(null==i?void 0:i.message)||i;console.error("Failed to start capturing:",n),this.closeCamera(),null===(t=this.currentScanResolver)||void 0===t||t.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}}async launch(){var t;try{return this.resetScanningState(),await this.initialize(),new Promise(async e=>{this.currentScanResolver=e,this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.setGuideFrame("mrz"),this.setGuideFrameVisible(!0),this.updateScanRegion(),await this.startCapturing(),this.hideScannerLoadingOverlay(),this.resources.returnPortraitImage?this.showBadge("Scan the MRZ side first",!1):this.showBadge("Scan the MRZ side of the document",!1)})}catch(i){let n=(null==i?void 0:i.message)||i;console.error("MRZ Scanner launch error:",n),this.closeCamera(),null===(t=this.currentScanResolver)||void 0===t||t.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}}async handleMRZResult(t){var i,n,s,r,a;if(this.firstFrame)this.firstFrame=!1;else{if(this.isMRZScanned&&!this.isPortraitScanned&&this.isWaitingForPortraitAfterMRZ){const{onResultUpdated:e}=this.resources;return void await this.tryPortraitOnSameSide(t,e)}if(this.isMRZScanned&&!this.isPortraitScanned&&this.areSidesDifferent&&!this.isWaitingForFlip){const e=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(e.length>0){const t=e[0].imageData;t.toCanvas=()=>S(t),t.toBlob=async()=>await M("image/png",t),this.originalImageData=t}return void await this.handlePortraitSideScan(t,this.resources.onResultUpdated)}if(!(t.items.length<=1)){this.capturedResultItems=t.items;try{const{onResultUpdated:e}=this.resources,a=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(a.length>0){const e=a[0].imageData;e.toCanvas=()=>S(e),e.toBlob=async()=>await M("image/png",e),this.originalImageData=e}const o=null===(i=null==t?void 0:t.parsedResult)||void 0===i?void 0:i.parsedResultItems;if(null==o?void 0:o.length){this.isSoundFeedbackOn&&tt.beep();const i=(null===(s=null===(n=o[0])||void 0===n?void 0:n.referenceItem)||void 0===s?void 0:s.text)||"",a=Ks(i,o[0]);let l=null;if(this.resources.returnDocumentImage||this.resources.returnPortraitImage){const e=t.processedDocumentResult;if((null===(r=null==e?void 0:e.detectedQuadResultItems)||void 0===r?void 0:r.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==re.CVS_FAILED&&(l=t.location)}if(this.resources.returnDocumentImage&&!l)return}let c=null;if(this.resources.returnDocumentImage&&l&&this.originalImageData)try{c=await Os.cropAndDeskewImage(this.originalImageData,l),c.toCanvas=()=>S(c),c.toBlob=async()=>await M("image/png",c)}catch(e){console.warn("Error extracting document image:",e)}this.isMRZScanned||await this.handleMRZSideScan(a,c,l,e)}}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),null===(a=this.currentScanResolver)||void 0===a||a.call(this,new Js({status:e.EnumResultStatus.RS_FAILED}))}}}}async handleMRZSideScan(t,i,n,s){let r=null,a=!1;if(this.resources.returnPortraitImage)try{const e=await xs.findPortraitZone();if(e&&!e.errorCode){(!n||this.validatePortraitLocation(e,n))&&this.originalImageData&&(r=await Os.cropAndDeskewImage(this.originalImageData,e),r.toCanvas=()=>S(r),r.toBlob=async()=>await M("image/png",r),a=!0)}}catch(e){console.warn("Error finding portrait zone:",e)}if(this.isMRZScanned=!0,this.mrzSideData={processedData:t,primaryOriginalImage:this.originalImageData,primaryDocumentImage:i,portraitImage:r},this.resources.returnPortraitImage&&!a)this.isWaitingForPortraitAfterMRZ=!0,this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Scanning portrait...",!1),this.flipTimeoutHandle=window.setTimeout(()=>{var e;if(this.flipTimeoutHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isPortraitScanned)return;this.areSidesDifferent=!0,this.isWaitingForFlip=!0;const t=null!==(e=this.config.flipDocumentTimeout)&&void 0!==e?e:3e3;let i=Math.ceil(t/1e3);this.setGuideFrame("portrait"),this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,`Flip and scan the other side (${i}s)`,!1),this.flipCountdownHandle=window.setInterval(()=>{i--,i>0&&this.showBadge("MRZ scanned ✓",!0,`Flip and scan the other side (${i}s)`,!1)},1e3),this.flipTimeoutHandle=window.setTimeout(()=>{window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null,this.flipTimeoutHandle=null,this.isWaitingForFlip=!1,this.showBadge("MRZ scanned ✓",!0,"Now scan the portrait side",!1)},t)},1500);else{this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.showGuideSuccessBorder(1e3);const n=r?"Portrait scanned ✓":void 0;this.showBadge("MRZ scanned ✓",!0,n,!!n),setTimeout(()=>{var n;this.closeCamera();const a=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:t,primaryOriginalImage:this.originalImageData,primaryDocumentImage:i,portraitImage:r});null==s||s(a),null===(n=this.currentScanResolver)||void 0===n||n.call(this,a),this.resetScanningState()},1e3)}}async tryPortraitOnSameSide(t,i){var n;if(!this.isWaitingForPortraitAfterMRZ)return;this.isWaitingForPortraitAfterMRZ=!1;let s=!1;try{const r=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(r.length>0){const e=r[0].imageData;e.toCanvas=()=>S(e),e.toBlob=async()=>await M("image/png",e),this.originalImageData=e}const a=await xs.findPortraitZone();if(this.isPortraitScanned)return;if(a&&!a.errorCode){let r=null;const o=t.processedDocumentResult;if((null===(n=null==o?void 0:o.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const e=o.detectedQuadResultItems[0];e.CrossVerificationStatus!==re.CVS_FAILED&&(r=e.location)}if((!r||this.validatePortraitLocation(a,r))&&this.originalImageData){s=!0;const t=await Os.cropAndDeskewImage(this.originalImageData,a);t.toCanvas=()=>S(t),t.toBlob=async()=>await M("image/png",t),null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.mrzSideData.portraitImage=t,this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Portrait scanned ✓",!0),setTimeout(()=>{var n;this.closeCamera();const s=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:t});null==i||i(s),null===(n=this.currentScanResolver)||void 0===n||n.call(this,s),this.resetScanningState()},1e3)}}}catch(e){console.warn("tryPortraitOnSameSide error:",e)}finally{s||null===this.flipTimeoutHandle||(this.isWaitingForPortraitAfterMRZ=!0)}}async handlePortraitSideScan(t,i){var n;if(this.isProcessingPortraitFrame)return;this.isProcessingPortraitFrame=!0;let s=!1;try{const r=await xs.findPortraitZone();if(r&&!r.errorCode&&this.originalImageData){s=!0,this.isPortraitScanned=!0;let a=this.originalImageData,o=null;if(this.resources.returnDocumentImage)try{const e=t.processedDocumentResult;if((null===(n=null==e?void 0:e.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==re.CVS_FAILED&&(o=await Os.cropAndDeskewImage(this.originalImageData,t.location),o.toCanvas=()=>S(o),o.toBlob=async()=>await M("image/png",o))}}catch(e){console.warn("Error extracting secondary document image:",e)}let l=null;try{l=await Os.cropAndDeskewImage(this.originalImageData,r),l.toCanvas=()=>S(l),l.toBlob=async()=>await M("image/png",l)}catch(e){console.warn("Error cropping portrait image:",e)}this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Both sides scanned ✓",!0),setTimeout(()=>{var t;this.closeCamera();const n=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,secondaryOriginalImage:a,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,secondaryDocumentImage:o,portraitImage:l||this.mrzSideData.portraitImage});null==i||i(n),null===(t=this.currentScanResolver)||void 0===t||t.call(this,n),this.resetScanningState()},1e3)}}catch(e){console.warn("Error finding portrait on second side:",e)}finally{s||(this.isProcessingPortraitFrame=!1)}}resetScanningState(){this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),null!==this.flipCountdownHandle&&(window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null),this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null}}validatePortraitLocation(e,t){return!!e.points.every(e=>this.isPointInQuadrilateral(e,t))&&t.area/e.area>=3}isPointInQuadrilateral(e,t){const i=t.points;let n=!1;for(let t=0,s=i.length-1;t<i.length;s=t++){const r=i[t].x,a=i[t].y,o=i[s].x,l=i[s].y;a>e.y!=l>e.y&&e.x<(o-r)*(e.y-a)/(l-a)+r&&(n=!n)}return n}}const rr={cancel:'\n<svg id="cancel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cancelclip-path">\n      <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_582" data-name="Group 582" clip-path="url(#cancelclip-path)" transform="rotate(180 12 12)">\n    <path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n    <path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n  </g>\n</svg>  \n  ',rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class ar{constructor(e,t,i){this.resources=e,this.config=t,this.scannerView=i,this.editedFields={}}async launch(){try{return Zs(this.config.container).textContent="",await this.initialize(),Zs(this.config.container).style.display="flex",new Promise(e=>{this.currentScanResultViewResolver=e})}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const t=await this.scannerView.launch();if((null==t?void 0:t.status)===e.EnumResultStatus.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(t));this.resources.onResultUpdated&&((null==t?void 0:t.status)===e.EnumResultStatus.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==t?void 0:t.status)===e.EnumResultStatus.RS_SUCCESS&&this.resources.onResultUpdated(t)),this.dispose(!0),await this.initialize(),Zs(this.config.container).style.display="flex"}catch(t){throw console.error("Error in rescan handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Js({status:e.EnumResultStatus.RS_FAILED})),t}}async handleCancel(){var t;try{(null===(t=this.config)||void 0===t?void 0:t.onCancel)&&await this.config.onCancel(this.resources.result),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Js({status:e.EnumResultStatus.RS_CANCELLED})),this.hideView(),this.dispose()}catch(t){throw console.error("Error in cancel handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Js({status:e.EnumResultStatus.RS_FAILED})),t}}async handleDone(){var t,i;try{(null===(t=this.resources.result)||void 0===t?void 0:t.data)&&!Hs(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(i=this.config)||void 0===i?void 0:i.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(t){throw console.error("Error in done handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Js({status:e.EnumResultStatus.RS_FAILED})),t}}createControls(){var e,t,i,n,s,r,a,o,l,c,d,h;const{toolbarButtonsConfig:u}=this.config;return function(e){Gs("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach(e=>{const i=document.createElement("div");i.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const n=document.createElement("div");if(n.className="dynamsoft-mrz-control-icon-wrapper",(s=e.icon).trim().startsWith("<svg")&&s.trim().endsWith("</svg>"))n.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,n.appendChild(t)}var s;const r=document.createElement("div");r.className="dynamsoft-mrz-control-text",r.textContent=e.label,e.isDisabled&&i.classList.add("disabled"),e.isHidden&&i.classList.add("hide"),i.appendChild(n),i.appendChild(r),e.onClick&&!e.isDisabled&&i.addEventListener("click",e.onClick),t.appendChild(i)}),t}([this.config._isFileMode?{id:"dynamsoft-mrz-scanResult-cancel",icon:(null===(e=null==u?void 0:u.cancel)||void 0===e?void 0:e.icon)||rr.cancel,label:(null===(t=null==u?void 0:u.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(i=null==u?void 0:u.cancel)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==u?void 0:u.cancel)||void 0===n?void 0:n.isHidden)||!1}:{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(s=null==u?void 0:u.rescan)||void 0===s?void 0:s.icon)||rr.rescan,label:(null===(r=null==u?void 0:u.rescan)||void 0===r?void 0:r.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(a=null==u?void 0:u.rescan)||void 0===a?void 0:a.className)||""}`,isHidden:(null===(o=null==u?void 0:u.rescan)||void 0===o?void 0:o.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(l=null==u?void 0:u.done)||void 0===l?void 0:l.icon)||rr.complete,label:(null===(c=null==u?void 0:u.done)||void 0===c?void 0:c.label)||"Done",className:`${(null===(d=null==u?void 0:u.done)||void 0===d?void 0:d.className)||""}`,isHidden:(null===(h=null==u?void 0:u.done)||void 0===h?void 0:h.isHidden)||!1,onClick:()=>this.handleDone()}])}getImagesToDisplay(){const t=[],i=this.resources.result;if(!i)return t;if(this.resources.returnOriginalImage){const n=i.getOriginalImage(e.EnumDocumentSide.MRZ);n&&t.push({imageData:n,label:"Original Image (MRZ Side)"});const s=i.getOriginalImage(e.EnumDocumentSide.Opposite);s&&t.push({imageData:s,label:"Original Image (Portrait Side)"})}if(this.resources.returnDocumentImage){const n=i.getDocumentImage(e.EnumDocumentSide.MRZ);n&&t.push({imageData:n,label:"Document Image (MRZ Side)"});const s=i.getDocumentImage(e.EnumDocumentSide.Opposite);s&&t.push({imageData:s,label:"Document Image (Portrait Side)"})}if(this.resources.returnPortraitImage){const e=i.getPortraitImage();e&&t.push({imageData:e,label:"Portrait Image"})}return t}createImagesDisplay(){const e=this.getImagesToDisplay();if(0===e.length)return null;const t=document.createElement("div");return t.className="dynamsoft-mrz-images-container",e.forEach(({imageData:e,label:i})=>{const n=document.createElement("div");n.className="dynamsoft-mrz-image-wrapper";const s=document.createElement("div");let r;s.className="dynamsoft-mrz-image-label",s.textContent=i,n.appendChild(s),(null==e?void 0:e.toCanvas)&&(r=e.toCanvas()),r&&(Object.assign(r.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),n.appendChild(r)),t.appendChild(n)}),t}handleFieldEdit(t,i){if(t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry)try{const[e,n,s]=i.split(/[\/\-\.]/);s&&n&&e&&(this.editedFields[t]={day:parseInt(s,10),month:parseInt(n,10),year:parseInt(e,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[t]=i}createMRZDataDisplay(){var t,i,n,s;const r=(null===(t=this.resources.result)||void 0===t?void 0:t.data)||{},a=!!this.config.allowResultEditing,o=r.invalidFields||[],l=[e.EnumMRZData.InvalidFields,e.EnumMRZData.IssuingStateRaw,e.EnumMRZData.NationalityRaw];!1===(null===(i=this.config)||void 0===i?void 0:i.showMRZText)&&l.push(e.EnumMRZData.MRZText);const c=document.createElement("div");if(c.className="dynamsoft-mrz-data-container",Hs(r)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText=null!==(s=null===(n=this.config)||void 0===n?void 0:n.emptyResultMessage)&&void 0!==s?s:"The necessary information could not be detected. Please try again.",c.appendChild(e),c}if(o.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${rr.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${a?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,c.appendChild(e)}else if(0===o.length&&a){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${rr.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,c.appendChild(e)}return Object.entries(r).forEach(([t,i])=>{if(l.includes(t)||!i)return;const n=document.createElement("div");n.className="dynamsoft-mrz-data-row";const s=o.includes(t);s&&n.classList.add("invalid-field");const r=[e.EnumMRZData.MRZText,e.EnumMRZData.DocumentType,e.EnumMRZData.IssuingStateRaw,e.EnumMRZData.NationalityRaw],d=document.createElement("span");if(d.className="dynamsoft-mrz-data-label",d.innerText=$s[t]||t,s){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=rr.failed,d.appendChild(e),a){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",d.appendChild(e)}}const h=document.createElement("div");if(h.className="dynamsoft-mrz-data-value",a&&!r.includes(t)){const r=document.createElement("input");r.className="dynamsoft-mrz-data-input",s&&r.classList.add("invalid"),t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry?(r.value=Xs(i),r.setAttribute("placeholder","YYYY-MM-DD")):r.value=i,r.addEventListener("input",e=>{if(this.handleFieldEdit(t,e.target.value),s){r.classList.remove("invalid"),n.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...o]);const e=this.editedFields.invalidFields.indexOf(t);e>-1&&this.editedFields.invalidFields.splice(e,1)}}),h.appendChild(r)}else t===e.EnumMRZData.MRZText?(h.classList.add("code"),h.innerText=i):t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry?h.innerText=Xs(i):h.innerText=i,s&&h.classList.add("invalid-value");n.appendChild(d),n.appendChild(h),c.appendChild(n)}),c}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");Gs("dynamsoft-mrz-result-view-style",or);const e=document.createElement("div");e.className="dynamsoft-mrz-result-view-container";const t=this.createImagesDisplay();t&&e.appendChild(t);const i=this.createMRZDataDisplay();e.appendChild(i);const n=this.createControls();e.appendChild(n),Zs(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){Zs(this.config.container).style.display="none"}dispose(e=!1){Zs(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const or="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-images-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    width: 100%;\n    max-height: 300px;\n    overflow-y: auto;\n    padding: 1rem;\n    background-color: #323234;\n  }\n\n  .dynamsoft-mrz-image-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    background: #2a2a2c;\n    padding: 0.75rem;\n    border-radius: 6px;\n    border: 1px solid #404042;\n  }\n\n  .dynamsoft-mrz-image-label {\n    font-size: 0.85rem;\n    color: #aaa;\n    text-align: center;\n    font-weight: 500;\n    margin-bottom: 0.25rem;\n  }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: #fe8e14;\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-images-container{\n      flex: 1;\n      height: 100%;\n      max-height: none;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",lr={rootDirectory:"./resources/",dcvBundle:"./resources/dynamsoft-capture-vision-bundle@3.4.1000-dev-20260214095351/dist/",dcvData:"./resources/dynamsoft-capture-vision-data@1.2.0-dev-20260121170704/"};class cr{showLoadingOverlay(e){var t,i;const n=Zs(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||Zs(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen=zs(n,{message:e}),n.style.display="block",n.style.position="relative"}hideLoadingOverlay(e=!1){var t,i,n;const s=Zs(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||Zs(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,s.style.display="none",e&&(null===(n=this.config)||void 0===n?void 0:n.container)&&(Zs(this.config.container).style.display="none"))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources()}async initialize(){var e,t,i;if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};Gs("dynamsoft-mrz-loading-screen-style",js),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e},this.resources.returnOriginalImage=null!==(e=this.config.returnOriginalImage)&&void 0!==e&&e,this.resources.returnDocumentImage=null===(t=this.config.returnDocumentImage)||void 0===t||t,this.resources.returnPortraitImage=null===(i=this.config.returnPortraitImage)||void 0===i||i;const n={};return!this.isFileMode&&this.config.scannerViewConfig&&(this.scannerView=new sr(this.resources,this.config.scannerViewConfig),n.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new ar(this.resources,this.config.resultViewConfig,this.scannerView),n.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:n}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;throw console.error(t),new Error(t)}finally{this.hideLoadingOverlay(!0)}}initializeDynamsoftResources(){var e;Me.engineResourcePaths=Hs(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?lr:this.config.engineResourcePaths,Me.loadWasm(),Ln.loadSpec("MRTD"),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t,i,n;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),zi._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=mrz&deploymenttype=web)"),await zi.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await Xe.createInstance((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath)||(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath)),this.resources.cameraEnhancer=await qe.createInstance(this.resources.cameraView)),this.resources.cvRouter=await Ci.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath)}catch(e){let t="string"==typeof e?e:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"object"==typeof e?JSON.stringify(e):String(e);const i=(null==t?void 0:t.toLowerCase().includes("license"))?"The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(i),new Error(i)}}shouldCreateDefaultContainer(){var e,t;const i=!this.config.container,n=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return i&&n}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,i,n,s,r,a,o;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)&&(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!Zs(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)&&!Zs(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.resultViewConfig)||void 0===a?void 0:a.container)&&!Zs(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var t,i,n,s,r,a,o,l;this.config=null!==(t=this.config)&&void 0!==t?t:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=Zs(this.config.container));const c=this.config.container?this.createViewContainers(Zs(this.config.container)):{},d={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(e.EnumMRZScanMode).map(e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||Vs[e]]})),templateFilePath:(null===(i=this.config)||void 0===i?void 0:i.templateFilePath)||"./dist/mrz-scanner.template.json"},h=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:c[e.EnumMRZScannerViews.Scanner]||Zs(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.uiPath)||(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.cameraEnhancerUIPath)||"./dist/mrz-scanner.ui.html",templateFilePath:d.templateFilePath,utilizedTemplateNames:d.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(o=null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.enableMultiFrameCrossFilter)||void 0===o||o,mrzFormatType:this.config.mrzFormatType}),u=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{_isFileMode:this.isFileMode,container:c[e.EnumMRZScannerViews.Result]||Zs(null===(l=this.config.resultViewConfig)||void 0===l?void 0:l.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},d),{scannerViewConfig:h,resultViewConfig:u})),!0}createViewContainers(t){t.textContent="";const i=[e.EnumMRZScannerViews.Scanner];return this.showResultView()&&i.push(e.EnumMRZScannerViews.Result),i.reduce((e,i)=>{const n=document.createElement("div");return n.className=`mrz-scanner-${i}-view-container`,Object.assign(n.style,{height:"100%",width:"100%",display:"none",position:"relative"}),t.append(n),e[i]=n,e},{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const i=e=>{const t=Zs(e);t&&(t.style.display="none",t.textContent="")};i(this.config.container),i(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),i(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async processUploadedFile(t){var i,n,s,r,a,o,l;try{this.showLoadingOverlay("Processing File...");const{cvRouter:c}=this.resources,d=null===(i=this.config.utilizedTemplateNames)||void 0===i?void 0:i.all,h=await c.getSimplifiedSettings(d);h.roiMeasuredInPercentage=!0,h.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await c.updateSettings(d,h);const u=await c.capture(t,d),g=u.items,m=g.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE)[0].imageData;m.toCanvas=()=>S(m),m.toBlob=async()=>await M("image/png",m);const p=null===(n=null==u?void 0:u.parsedResult)||void 0===n?void 0:n.parsedResultItems;let f={};if(null==p?void 0:p.length){const e=(null===(r=null===(s=p[0])||void 0===s?void 0:s.referenceItem)||void 0===r?void 0:r.text)||"";f=Ks(e,p[0])}let _=null,E=null;if(this.resources.returnDocumentImage)try{const e=u.processedDocumentResult;if((null===(a=null==e?void 0:e.detectedQuadResultItems)||void 0===a?void 0:a.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==re.CVS_FAILED&&(E=t.location,_=await Os.cropAndDeskewImage(m,E),_.toCanvas=()=>S(_),_.toBlob=async()=>await M("image/png",_))}}catch(e){console.warn("Error extracting document image from static file:",e)}let y=null;if(this.resources.returnPortraitImage)try{const e=await xs.findPortraitZone();if(e&&!e.errorCode){let t=!0;if(E){const i=E.points,n=e.points.every(e=>{let t=!1;for(let n=0,s=i.length-1;n<i.length;s=n++){const r=i[n].x,a=i[n].y,o=i[s].x,l=i[s].y;a>e.y!=l>e.y&&e.x<(o-r)*(e.y-a)/(l-a)+r&&(t=!t)}return t});t=n&&E.area/e.area>=3}t&&(y=await Os.cropAndDeskewImage(m,e),y.toCanvas=()=>S(y),y.toBlob=async()=>await M("image/png",y))}}catch(e){console.warn("Error finding portrait zone in static file:",e)}const I=new Js({status:e.EnumResultStatus.RS_SUCCESS,data:f,primaryOriginalImage:m,primaryDocumentImage:_,portraitImage:y});null===(l=(o=this.resources).onResultUpdated)||void 0===l||l.call(o,I)}catch(t){return console.error("Failed to process uploaded file:",t),new Js({status:e.EnumResultStatus.RS_FAILED})}finally{this.hideLoadingOverlay(!1)}}async launch(t){var i;if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0,this.isFileMode=!!t;const{components:n}=await this.initialize();if(this.config.container&&(Zs(this.config.container).style.display="block"),this.isFileMode)return await this.processUploadedFile(t),n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView&&this.resources.result)return n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView)throw new Error("Scanner view is required when no previous result exists");const s=await n.scannerView.launch();return(null==s?void 0:s.status)!==e.EnumResultStatus.RS_SUCCESS?new Js({status:null!==(i=null==s?void 0:s.status)&&void 0!==i?i:e.EnumResultStatus.RS_FAILED}):n.resultView?await n.resultView.launch():this.resources.result}catch(t){return alert((null==t?void 0:t.message)||t),console.error((null==t?void 0:t.message)||t),new Js({status:e.EnumResultStatus.RS_FAILED})}finally{this.isCapturing=!1,this.dispose()}}}const dr={MRZScanner:cr,MRZScannerView:sr,MRZResultView:ar};e.DEFAULT_TEMPLATE_NAMES=Vs,e.Dynamsoft=Fs,e.DynamsoftMRZScanner=dr,e.MRZDataLabel=$s,e.MRZResultView=ar,e.MRZScanner=cr,e.MRZScannerView=sr,e.displayMRZDate=Xs});
