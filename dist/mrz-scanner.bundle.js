!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=t.Dynamsoft||{})}(this,function(e){"use strict";const t=e=>e&&"object"==typeof e&&"function"==typeof e.then,i=(async()=>{})().constructor;let n=class extends i{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let n;this._task=e,t(e)?n=e:"function"==typeof e&&(n=new i(e)),n&&(async()=>{try{const t=await n;e===this._task&&this.resolve(t)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let i,n;super((e,t)=>{i=e,n=t}),this._s="pending",this.resolve=e=>{this.isPending&&(t(e)?this.task=e:(this._s="fulfilled",i(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",n(e))},this.task=e}};function s(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function r(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}var a,o,l;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(a||(a={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(o||(o={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(l||(l={}));const c="undefined"==typeof self,d="function"==typeof importScripts,u=(()=>{if(!d){if(!c&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),h=e=>{if(null==e&&(e="./"),c||d);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},g=e=>Object.prototype.toString.call(e),m=e=>Array.isArray?Array.isArray(e):"[object Array]"===g(e),p=e=>"number"==typeof e&&!Number.isNaN(e),f=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),_=e=>!(!f(e)||!p(e.width)||e.width<=0||!p(e.height)||e.height<=0||!p(e.stride)||e.stride<=0||!("format"in e)||"tag"in e&&!y(e.tag)),E=e=>!!_(e)&&e.bytes instanceof Uint8Array,y=e=>null===e||!!f(e)&&!!p(e.imageId)&&"type"in e,R=e=>!!f(e)&&!!p(e.x)&&!!p(e.y),I=async(e,t,i)=>await new Promise((n,s)=>{let r=new XMLHttpRequest;r.responseType=t,r.onloadstart=()=>{i&&i.loadstartCallback&&i.loadstartCallback()},r.onloadend=async e=>{i&&i.loadendCallback&&i.loadendCallback(),r.status<200||r.status>=300?s(r.status):n(r.response)},r.onprogress=e=>{i&&i.progressCallback&&i.progressCallback(e)},r.onerror=e=>{s(e)},r.open("GET",e,!0),r.send()}),w=e=>/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e),v=(e,t)=>{let i=e.split("."),n=t.split(".");for(let e=0;e<i.length&&e<n.length;++e){let t=i[e],s=n[e];if(t===s)continue;let r=parseInt(i[e]),a=parseInt(n[e]);return r===a||Number.isNaN(r)&&Number.isNaN(a)?t<s?-1:1:r<a||Number.isNaN(r)&&Number.isInteger(a)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},T=e=>{const t={};for(let i in e){if("rootDirectory"===i)continue;let n=i,s=e[n],r=s&&"object"==typeof s&&s.path?s.path:s,a=e.rootDirectory;if(a&&!a.endsWith("/")&&(a+="/"),"object"==typeof s&&s.isInternal)a&&(r=e[n].version?`${a}${L[n]}@${e[n].version}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`:`${a}${L[n]}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`);else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof r&&(r=r.replace(i,a||"")),"object"==typeof r&&"dwt"===n){const s=e[n].resourcesPath,r=e[n].serviceInstallerLocation;t[n]={resourcesPath:s.replace(i,a||""),serviceInstallerLocation:r.replace(i,a||"")};continue}}t[n]=h(r)}return t},C=async(e,t,i)=>await new Promise(async(n,s)=>{try{const s=t.split(".");let r=s[s.length-1];const a=await M(`image/${r}`,e);s.length<=1&&(r="png");const o=new File([a],t,{type:`image/${r}`});if(i){const e=URL.createObjectURL(o),i=document.createElement("a");i.href=e,i.download=t,i.click()}n(o)}catch(e){s()}}),S=e=>{E(e)&&(e=b(e));const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t},D=(e,t)=>{E(t)&&(t=b(t));const i=S(t);let n=new Image,s=i.toDataURL(e);return n.src=s,n},M=async(e,t)=>{E(t)&&(t=b(t));const i=S(t);if("image/bmp"===e){const e=i.getContext("2d"),t=A(e.getImageData(0,0,i.width,i.height));return new Blob([t],{type:"image/bmp"})}return new Promise((t,n)=>{i.toBlob(e=>t(e),e)})},A=e=>{const t=e.width,i=e.height,n=e.data,s=4*Math.floor((24*t+31)/32),r=s*i,a=54+r,o=new ArrayBuffer(a),l=new DataView(o);l.setUint16(0,19778,!0),l.setUint32(2,a,!0),l.setUint16(6,0,!0),l.setUint16(8,0,!0),l.setUint32(10,54,!0),l.setUint32(14,40,!0),l.setInt32(18,t,!0),l.setInt32(22,-i,!0),l.setUint16(26,1,!0),l.setUint16(28,24,!0),l.setUint32(30,0,!0),l.setUint32(34,r,!0),l.setInt32(38,2835,!0),l.setInt32(42,2835,!0),l.setUint32(46,0,!0),l.setUint32(50,0,!0);let c=54;const d=s-3*t;for(let e=0;e<i;e++){for(let i=0;i<t;i++){const s=4*(e*t+i),r=n[s],a=n[s+1],o=n[s+2];l.setUint8(c++,o),l.setUint8(c++,a),l.setUint8(c++,r)}for(let e=0;e<d;e++)l.setUint8(c++,0)}return o},b=e=>{let t,i=e.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===l.IPF_BGR_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n+2],t[4*n+3]=255}else if(Number(e.format)===l.IPF_RGB_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n+2],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n],t[4*n+3]=255}else if(Number(e.format)===l.IPF_GRAYSCALED){const e=i.length;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;n++)t[4*n]=t[4*n+1]=t[4*n+2]=i[n],t[4*n+3]=255}else if(Number(e.format)===l.IPF_BINARY_8||Number(e.format)===l.IPF_BINARY_8_INVERTED){const n=i.length,s=e.width,r=e.height,a=e.stride;t=new Uint8ClampedArray(s*r*4);for(let e=0;e<n;e++){let n=i[e],r=e%a,o=Math.floor(e/a);for(let e=0;e<8;e++){let i=r+e,a=4*(o*s+i);if(i>=s)break;t[a]=t[a+1]=t[a+2]=(128&n)/128*255,t[a+3]=255,n<<=1}}}else if(Number(e.format)===l.IPF_ABGR_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}else if(Number(e.format)===l.IPF_ARGB_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n+2],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n],t[4*n+3]=i[4*n+3]}else Number(e.format),l.IPF_BINARY_8_INVERTED;return new ImageData(t,e.width,e.height)},O=async e=>{let t=URL.createObjectURL(e);try{const e=await new Promise((e,i)=>{const n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=t}),i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e.width,i.height=e.height,n.drawImage(e,0,0),{bytes:Uint8Array.from(n.getImageData(0,0,i.width,i.height).data),width:i.width,height:i.height,stride:4*i.width,format:l.IPF_ABGR_8888}}finally{URL.revokeObjectURL(t)}},L={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcvData:"dynamsoft-capture-vision-data",dce:"dynamsoft-camera-enhancer",identityutility:"dynamsoft-identity-utility",ddv:"dynamsoft-document-viewer",dwt:"dwt",dbrBundle:"dynamsoft-barcode-reader-bundle",dcvBundle:"dynamsoft-capture-vision-bundle"};var N,P,x,k,B,F,U,V;let G,W,Z,H,z,j=class e{get _isFetchingStarted(){return s(this,B,"f")}constructor(){N.add(this),P.set(this,[]),x.set(this,1),k.set(this,a.BOPM_BLOCK),B.set(this,!1),F.set(this,void 0),U.set(this,o.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var t;if(!E(e))throw new TypeError("Invalid 'image'.");if((null===(t=e.imageTag)||void 0===t?void 0:t.hasOwnProperty("imageId"))&&"number"==typeof e.imageTag.imageId&&this.hasImage(e.imageTag.imageId))throw new Error("Existed imageId.");if(s(this,P,"f").length>=s(this,x,"f"))switch(s(this,k,"f")){case a.BOPM_BLOCK:break;case a.BOPM_UPDATE:if(s(this,P,"f").push(e),f(s(this,F,"f"))&&p(s(this,F,"f").imageId)&&1==s(this,F,"f").keepInBuffer)for(;s(this,P,"f").length>s(this,x,"f");){const e=s(this,P,"f").findIndex(e=>{var t;return(null===(t=e.imageTag)||void 0===t?void 0:t.imageId)!==s(this,F,"f").imageId});s(this,P,"f").splice(e,1)}else s(this,P,"f").splice(0,s(this,P,"f").length-s(this,x,"f"))}else s(this,P,"f").push(e)}getImage(){if(0===s(this,P,"f").length)return null;let t;if(s(this,F,"f")&&p(s(this,F,"f").imageId)){const e=s(this,N,"m",V).call(this,s(this,F,"f").imageId);if(e<0)throw new Error(`Image with id ${s(this,F,"f").imageId} doesn't exist.`);t=s(this,P,"f").slice(e,e+1)[0]}else t=s(this,P,"f").pop();if([l.IPF_RGB_565,l.IPF_RGB_555,l.IPF_RGB_888,l.IPF_ARGB_8888,l.IPF_RGB_161616,l.IPF_ARGB_16161616,l.IPF_ABGR_8888,l.IPF_ABGR_16161616,l.IPF_BGR_888].includes(t.format)){if(s(this,U,"f")===o.CCUT_RGB_R_CHANNEL_ONLY){e._onLog&&e._onLog("only get R channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:i[e]=t.bytes[3*e+2];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:i[e]=t.bytes[4*e+2];break;case l.IPF_BGR_888:i[e]=t.bytes[3*e];break;case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}else if(s(this,U,"f")===o.CCUT_RGB_G_CHANNEL_ONLY){e._onLog&&e._onLog("only get G channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:case l.IPF_BGR_888:i[e]=t.bytes[3*e+1];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e+1]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}else if(s(this,U,"f")===o.CCUT_RGB_B_CHANNEL_ONLY){e._onLog&&e._onLog("only get B channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case l.IPF_RGB_565:case l.IPF_RGB_555:case l.IPF_RGB_888:case l.IPF_RGB_161616:i[e]=t.bytes[3*e];break;case l.IPF_ARGB_8888:case l.IPF_ARGB_16161616:i[e]=t.bytes[4*e];break;case l.IPF_BGR_888:i[e]=t.bytes[3*e+2];break;case l.IPF_ABGR_8888:case l.IPF_ABGR_16161616:i[e]=t.bytes[4*e+2]}t.bytes=i,t.stride=t.width,t.format=l.IPF_GRAYSCALED}}else[l.IPF_NV21,l.IPF_NV12].includes(t.format)&&e._onLog&&e._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(e,t){if(!((...e)=>0!==e.length&&e.every(e=>p(e)))(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&"[object Boolean]"!==g(t))throw new TypeError("Invalid 'keepInBuffer'.");r(this,F,{imageId:e,keepInBuffer:t})}_resetNextReturnedImage(){r(this,F,null)}hasImage(e){return s(this,N,"m",V).call(this,e)>=0}startFetching(){r(this,B,!0)}stopFetching(){r(this,B,!1)}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(r(this,x,e);s(this,P,"f")&&s(this,P,"f").length>e;)s(this,P,"f").shift()}getMaxImageCount(){return s(this,x,"f")}getImageCount(){return s(this,P,"f").length}clearBuffer(){s(this,P,"f").length=0}isBufferEmpty(){return 0===s(this,P,"f").length}setBufferOverflowProtectionMode(e){r(this,k,e)}getBufferOverflowProtectionMode(){return s(this,k,"f")}setColourChannelUsageType(e){r(this,U,e)}getColourChannelUsageType(){return s(this,U,"f")}};P=new WeakMap,x=new WeakMap,k=new WeakMap,B=new WeakMap,F=new WeakMap,U=new WeakMap,N=new WeakSet,V=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return s(this,P,"f").findIndex(t=>{var i;return(null===(i=t.imageTag)||void 0===i?void 0:i.imageId)===e})},"undefined"!=typeof navigator&&(G=navigator,W=G.userAgent,Z=G.platform,H=G.mediaDevices),function(){if(!c){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:G.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Z,search:"Win"},Mac:{str:Z},Linux:{str:Z}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||W,a=s.search||t,o=s.verStr||W,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||W,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=W.indexOf("Windows NT")&&(s="HarmonyOS"),z={browser:i,version:n,OS:s}}c&&(z={browser:"ssr",version:0,OS:"ssr"})}();const Y="undefined"!=typeof WebAssembly&&W&&!(/Safari/.test(W)&&!/Chrome/.test(W)&&/\(.+\s11_2_([2-6]).*\)/.test(W)),q=!("undefined"==typeof Worker),$=!(!H||!H.getUserMedia),X=async()=>{let e=!1;if($)try{(await H.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),e=!0}catch(e){}return e};var Q,K,J,ee,te,ie,ne,se,re;"Chrome"===z.browser&&z.version>66||"Safari"===z.browser&&z.version>13||"OPR"===z.browser&&z.version>43||"Edge"===z.browser&&z.version,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_DESKEWED_IMAGE=16]="CRIT_DESKEWED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT",e[e.CRIT_ENHANCED_IMAGE=64]="CRIT_ENHANCED_IMAGE"}(Q||(Q={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(K||(K={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_UNSUPPORTED_JSON_KEY_WARNING=-10077]="EC_UNSUPPORTED_JSON_KEY_WARNING",e[e.EC_MODEL_FILE_NOT_FOUND=-10078]="EC_MODEL_FILE_NOT_FOUND",e[e.EC_PDF_LICENSE_NOT_FOUND=-10079]="EC_PDF_LICENSE_NOT_FOUND",e[e.EC_RECT_INVALID=-10080]="EC_RECT_INVALID",e[e.EC_TEMPLATE_VERSION_INCOMPATIBLE=-10081]="EC_TEMPLATE_VERSION_INCOMPATIBLE",e[e.EC_PORTRAIT_ZONE_NOT_FOUND=-10082]="EC_PORTRAIT_ZONE_NOT_FOUND",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_LICENSE_AUTH_QUOTA_EXCEEDED=-20013]="EC_LICENSE_AUTH_QUOTA_EXCEEDED",e[e.EC_LICENSE_RESULTS_LIMIT_EXCEEDED=-20014]="EC_LICENSE_RESULTS_LIMIT_EXCEEDED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(J||(J={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV",e[e.GEM_END=-1]="GEM_END"}(ee||(ee={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV",e[e.GTM_END=-1]="GTM_END"}(te||(te={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ie||(ie={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(ne||(ne={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(se||(se={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(re||(re={}));const ae={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_DESKEWED_IMAGE:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ENHANCED_IMAGE:BigInt(Math.pow(2,30)),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var oe,le,ce,de,ue;!function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_DESKEWED_IMAGE=6]="ROET_DESKEWED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI",e[e.ROET_ENHANCED_IMAGE=9]="ROET_ENHANCED_IMAGE",e[e.ROET_AUXILIARY_REGION=10]="ROET_AUXILIARY_REGION"}(oe||(oe={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_DESKEWING=7]="ST_DOCUMENT_DESKEWING",e[e.ST_IMAGE_ENHANCEMENT=8]="ST_IMAGE_ENHANCEMENT"}(le||(le={})),function(e){e[e.IFF_JPEG=0]="IFF_JPEG",e[e.IFF_PNG=1]="IFF_PNG",e[e.IFF_BMP=2]="IFF_BMP",e[e.IFF_PDF=3]="IFF_PDF"}(ce||(ce={})),function(e){e[e.ICDM_NEAR=0]="ICDM_NEAR",e[e.ICDM_FAR=1]="ICDM_FAR"}(de||(de={})),function(e){e.MN_DYNAMSOFT_CAPTURE_VISION_ROUTER="cvr",e.MN_DYNAMSOFT_CORE="core",e.MN_DYNAMSOFT_LICENSE="license",e.MN_DYNAMSOFT_IMAGE_PROCESSING="dip",e.MN_DYNAMSOFT_UTILITY="utility",e.MN_DYNAMSOFT_BARCODE_READER="dbr",e.MN_DYNAMSOFT_DOCUMENT_NORMALIZER="ddn",e.MN_DYNAMSOFT_LABEL_RECOGNIZER="dlr",e.MN_DYNAMSOFT_CAPTURE_VISION_DATA="dcvData",e.MN_DYNAMSOFT_NEURAL_NETWORK="dnn",e.MN_DYNAMSOFT_CODE_PARSER="dcp",e.MN_DYNAMSOFT_CAMERA_ENHANCER="dce",e.MN_DYNAMSOFT_CAPTURE_VISION_STD="std"}(ue||(ue={}));const he={},ge=async e=>{let t="string"==typeof e?[e]:e,i=[];for(let e of t)i.push(he[e]=he[e]||new n);await Promise.all(i)},me=async(e,t)=>{let i,s="string"==typeof e?[e]:e,r=[];for(let e of s){let s;r.push(s=he[e]=he[e]||new n(i=i||t())),s.isEmpty&&(s.task=i=i||t())}await Promise.all(r)};let pe,fe=0;const _e=()=>fe++,Ee={};let ye;const Re=e=>{ye=e,pe&&pe.postMessage({type:"setBLog",body:{value:!!e}})};let Ie=!1;const we=e=>{Ie=e,pe&&pe.postMessage({type:"setBDebug",body:{value:!!e}})},ve={},Te={},Ce={dip:{wasm:!0}},Se={std:{version:"2.0.0",path:h(u+"../../dynamsoft-capture-vision-std@2.0.0/dist/"),isInternal:!0},core:{version:"4.4.10-dev-20260129110706",path:u,isInternal:!0}};let De=5;"undefined"!=typeof navigator&&(De=navigator.hardwareConcurrency?navigator.hardwareConcurrency-1:5),Ee[-3]=async e=>{Me.onWasmLoadProgressChanged&&Me.onWasmLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Me{static get engineResourcePaths(){return Se}static set engineResourcePaths(e){Object.assign(Se,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return ye}static set _onLog(e){Re(e)}static get _bDebug(){return Ie}static set _bDebug(e){we(e)}static get _workerName(){return`${Me._bundleEnv.toLowerCase()}.bundle.worker.js`}static get wasmLoadOptions(){return Me._wasmLoadOptions}static set wasmLoadOptions(e){Object.assign(Me._wasmLoadOptions,e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!he[e]&&he[e].isFulfilled}static async loadWasm(){return await(async()=>{let e,t;e instanceof Array||(e=e?[e]:[]);let i=he.core;t=!i||i.isEmpty,t||await ge("core");let s=new Map;const r=e=>{if(e=e.toLowerCase(),ue.MN_DYNAMSOFT_CAPTURE_VISION_STD==e||ue.MN_DYNAMSOFT_CORE==e)return;let t=Ce[e].deps;if(null==t?void 0:t.length)for(let e of t)r(e);let i=he[e];s.has(e)||s.set(e,!i||i.isEmpty)};for(let t of e)r(t);let a=[];t&&a.push("core"),a.push(...s.keys());const o=[...s.entries()].filter(e=>!e[1]).map(e=>e[0]);await me(a,async()=>{const e=[...s.entries()].filter(e=>e[1]).map(e=>e[0]);await ge(o);const i=T(Se),r={};for(let t of e)r[t]=Ce[t];const a={engineResourcePaths:i,autoResources:r,names:e,_bundleEnv:Me._bundleEnv,wasmLoadOptions:Me.wasmLoadOptions};let l=new n;if(t){a.needLoadCore=!0;let e=i[`${Me._bundleEnv.toLowerCase()}Bundle`]+Me._workerName;e.startsWith(location.origin)||(e=await fetch(e).then(e=>e.blob()).then(e=>URL.createObjectURL(e))),pe=new Worker(e),pe.onerror=e=>{let t=new Error(e.message);l.reject(t)},pe.addEventListener("message",e=>{let t=e.data?e.data:e,i=t.type,n=t.id,s=t.body;switch(i){case"log":ye&&ye(t.message);break;case"warning":console.warn(t.message);break;case"task":try{Ee[n](s),delete Ee[n]}catch(e){throw delete Ee[n],e}break;case"event":try{Ee[n](s)}catch(e){throw e}break;default:console.log(e)}}),a.bLog=!!ye,a.bd=Ie,a.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await ge("core");let c=fe++;Ee[c]=e=>{if(e.success)Object.assign(ve,e.versions),"{}"!==JSON.stringify(e.versions)&&(Me._versions=e.versions),Me.loadedWasmType=e.loadedWasmType,l.resolve(void 0);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),l.reject(t)}},pe.postMessage({type:"loadWasm",id:c,body:a}),await l})})()}static async detectEnvironment(){return await(async()=>({wasm:Y,worker:q,getUserMedia:$,camera:await X(),browser:z.browser,version:z.version,OS:z.OS}))()}static async getModuleVersion(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"getModuleVersion",id:i})})}static getVersion(){return`4.4.10-dev-20260129110706(Worker: ${ve.core&&ve.core.worker||"Not Loaded"}, Wasm: ${ve.core&&ve.core.wasm||"Not Loaded"})`}static enableLogging(){j._onLog=console.log,Me._onLog=console.log}static disableLogging(){j._onLog=null,Me._onLog=null}static async cfd(e){return await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"cfd",id:n,body:{count:e}})})}}Me._bSupportDce4Module=-1,Me._bSupportIRTModule=-1,Me._versions=null,Me._bundleEnv="DCV",Me._wasmLoadOptions={wasmType:"auto",pthreadPoolSize:De},Me.loadedWasmType="ml-simd-pthread",Me.browserInfo=z;const Ae="undefined"==typeof self,be="function"==typeof importScripts,Oe=(()=>{if(!be){if(!Ae&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Le=/<style>([\s\S]*?)<\/style>/g,Ne=/style="([\s\S]*?)"/g,Pe=(e,t)=>{const{inlineScript2Blob:i,internalCss2Blob:n,insertInternalCss2ExistedSheet:s}=t||{};if(s){let t,i;for(let n=0;n<document.styleSheets.length;++n){const s=document.styleSheets[n];try{i=s.cssRules,t=s;break}catch(e){}}t&&(e=e.replace(Le,(e,n,s,r)=>{let a=n.split("}");const o=a.length-1;let l=[],c=null,d=0;for(let e=0;e<o;++e){let t=0;for(;-1!==(t=a[e].indexOf("{",t));)d+=1,t+=1;if(c)1===d?(l.push(c+a[e]+"}"),c=null,d=0):(c+=a[e]+"}",--d);else{if(d<1)throw new Error("invalid style");1===d?(l.push(a[e].trimStart()+"}"),d=0):(c=a[e].trimStart()+"}",--d)}}if(c||d)throw new Error("invalid style");for(let e of l)t.insertRule(e,i.length);return""}))}const r=[];n&&(e=e.replace(Le,(e,t,i,n)=>(r.push(new Blob([t],{type:"text/css"})),"<HasStyle></HasStyle>")));const a=[];e=e.replace(Ne,(e,t,i,n)=>(a.push(t),"hasstyle"));const o=document.createElement("div");if(o.insertAdjacentHTML("beforeend",e),o.normalize(),n){const e=o.querySelectorAll("HasStyle");for(let t=0;t<r.length;t++){const i=r[t],n=e[t],s=document.createElement("link");s.rel="stylesheet",s.href=URL.createObjectURL(i),n.replaceWith(s)}}const l=o.querySelectorAll("[hasstyle]");for(let e=0;e<a.length;e++){const t=a[e],i=l[e];i.removeAttribute("hasstyle");const n=t.split(";").map(e=>e.trim()).filter(e=>e);if(i.style)for(let e of n){const t=e.split(":");i.style[t[0].trim()]=t[1].trim()}}for(let e of o.querySelectorAll("script")){const t=document.createElement("script");e.textContent&&(i&&!e.src?(t.src=URL.createObjectURL(new Blob([e.textContent],{type:"text/javascript"})),t.addEventListener("load",()=>URL.revokeObjectURL(t.src))):t.textContent=e.textContent);for(let i of e.attributes)t.setAttribute(i.name,i.value);e.replaceWith(t)}let c=new DocumentFragment;return c.append(...o.childNodes),1===c.childNodes.length?c.firstChild:c},xe=[["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],["camera2 0,"],["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"]],ke=e=>e&&"object"==typeof e&&"function"==typeof e.then,Be=(async()=>{})().constructor;class Fe extends Be{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,ke(e)?t=e:"function"==typeof e&&(t=new Be(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(ke(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const Ue={width:1280,height:720},Ve=function(){const e=this,t=MediaDeviceInfo.prototype.toJSON.apply(e);return t.trackLabel=e.trackLabel,t.capabilities=e.capabilities,t},Ge="The camera feature is available only in secure contexts (HTTPS)";let We=class e{static _cameraNameMatcher=xe;static _mapDeviceInfo;_coreShell;_video;_coreInnerLayer;_coreOuterLayer;_regionBoxWrapper;_regionBoxMask;_regionBoxBorder;_objectFit="contain";_uiInlineScript2Blob=!0;_uiInternalCss2Blob=!0;_uiInternalCss2ExistedSheet=!1;_ui;_pOpen;_paused=!1;_shouldClose=!1;_cameraChangedWhenPaused=!1;_resolutionChangedWhenPaused=!1;_requestedCamera="back";_requestedResolution=Ue;_regionBox={unit:"view-size",center:{x:0,y:0},maskStyle:{background:"rgba(0, 0, 0, 0.5)"},borderStyle:{border:"1px solid #00ff7f"}};_eventListeners={};static _arrConstructors=[];static _arrOnOpen=[];static _arrBeforeClose=[];static _arrOnClose=[];constructor(){const t=this._coreShell=document.createElement("div");Object.assign(t.style,{width:"100%",height:"100%",minWidth:"100px",minHeight:"100px",backgroundColor:"black",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative"});const i=this._coreOuterLayer=document.createElement("div");Object.assign(i.style,{width:"auto",height:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"relative",overflow:"hidden"});const n=this._coreInnerLayer=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%",position:"relative",transformOrigin:"center"});const s=this._video=document.createElement("video");Object.assign(s.style,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",objectFit:"fill"}),s.muted=!0,s.playsInline=!0,n.append(s),i.append(n),t.append(i),new ResizeObserver(()=>{this._updateObjectFit()}).observe(t);for(let t of e._arrConstructors)t.call(this)}_updateObjectFit(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video,t=this._coreOuterLayer.style,i=this._regionBoxWrapper?.style;if("fill"===this._objectFit)return"100%"!==t.width&&(t.width="100%"),"100%"!==t.height&&(t.height="100%"),void(i&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%")));const{width:n,height:s}=this._coreShell.getBoundingClientRect(),r=`${e.videoWidth} / ${e.videoHeight}`;r!=t.aspectRatio&&(t.aspectRatio=r),i&&r!=i.aspectRatio&&(i.aspectRatio=r);let a=!1;n/s>e.videoWidth/e.videoHeight&&(a=!a),"cover"===this._objectFit&&(a=!a);const o=i&&"contain"===this._objectFit,l=i&&"cover"===this._objectFit;a?("auto"!=t.width&&(t.width="auto"),"100%"!=t.height&&(t.height="100%"),o&&("auto"!=i.width&&(i.width="auto"),"100%"!=i.height&&(i.height="100%"))):("100%"!=t.width&&(t.width="100%"),"auto"!=t.height&&(t.height="auto"),o&&("100%"!=i.width&&(i.width="100%"),"auto"!=i.height&&(i.height="auto"))),l&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%"))}get video(){return this._video}get track(){return this._video?.srcObject?.getTracks()[0]}get objectFit(){return this._objectFit}set objectFit(e){this._objectFit=e,this._updateObjectFit()}get ui(){return this._ui||this._coreShell}set ui(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if("string"==typeof e){if(!e.trim().startsWith("<"))throw Error("Invalid html string.");e=Pe(e,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet})}let t;if(e instanceof HTMLElement)t=e;else{if(!(e instanceof DocumentFragment))throw Error("Seems no HTMLElement.");t=document.createElement("div"),Object.assign(t.style,{width:"100%",height:"100%"}),t.append(e)}const i="dm-camera-core-container",n=t.classList.contains(i)?t:t.querySelector(`.${i}`);if(!n)throw Error(`Can't find element with class \`${i}\`.`);this._ui=t;for(let e of t.querySelectorAll("script"))e.currentDMCamera=this;n.append(this._coreShell)}get status(){return this._pOpen?this._pOpen.isPending?this._shouldClose?"closing":"opening":this._paused?"paused":"opened":"closed"}get requestedCamera(){return this._requestedCamera}get requestedResolution(){return this._requestedResolution}get currentCamera(){return"opened"!==this.status&&"paused"!==this.status?null:e._mapDeviceInfo?.[this.track?.getSettings()?.deviceId]}get currentResolution(){return{width:this.video?.videoWidth,height:this.video?.videoHeight}}get regionBox(){return this._regionBox}onOpened;static async hasCamera(){return!!navigator?.mediaDevices&&!!(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length}static async hasMacroCamera(){return!!navigator?.mediaDevices&&!!(await e.getDeviceInfos()).find(e=>e.capabilities?.facingMode?.includes("environment")&&e.capabilities?.focusDistance?.min<.061)}static async getDeviceInfos(){if(!navigator?.mediaDevices)throw Error(Ge);let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);if(!t.length)return[];if(t.some(e=>!e.deviceId)){let e;try{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind),t.some(e=>!e.deviceId)&&console.warn("Some camera does not have deviceId.")}catch(t){console.warn("Failed to get device ID by opening camera.",t)}if(e){const i=e.getTracks().filter(e=>"video"===e.kind)[0],n=i.getSettings().deviceId;let s=t.find(e=>e.deviceId===n);s?(s.trackLabel=i.label,s.capabilities=i.getCapabilities?.(),s.toJSON=Ve):console.warn("Can't find current device by `track.getSettings().deviceId`."),e.getTracks().forEach(e=>e.stop())}}await e._setCapabilities(t);const i=t.reduce((e,t)=>(e[t.deviceId]=t,e),{});return e._mapDeviceInfo=i,[...t]}static async _setCapabilities(t){for(let i of t){if(!i.deviceId)continue;if(Ve===i.toJSON)continue;let n=e._mapDeviceInfo?.[i.deviceId];if(n)i.trackLabel=n.trackLabel,i.capabilities=n.capabilities;else try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:i.deviceId},audio:!1}),t=e.getTracks().filter(e=>"video"===e.kind)[0];i.trackLabel=t.label,i.capabilities=t.getCapabilities?.(),e.getTracks().forEach(e=>e.stop())}catch(t){console.warn("Failed to get `trackLabel` and `capabilities`, by opening camera.",t)}i.toJSON=Ve}}async open(){if("opened"!==this.status)if("closed"===this.status||"paused"===this.status)try{if("paused"===this.status&&this._cameraChangedWhenPaused&&(await this.close(),this._cameraChangedWhenPaused=!1),"closed"===this.status){if(this._pOpen=new Fe,"customized-video"!==this._requestedCamera){let t;if("string"==typeof this._requestedCamera){switch(this._requestedCamera){case"front":t={facingMode:"user"};break;case"quick-back":t={facingMode:"environment"};break;case"back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");for(let n of e._cameraNameMatcher){for(let e of i){const i=(e.trackLabel||e.label)?.toLowerCase();for(let s of n)if(i.includes(s)){t={deviceId:e.deviceId};break}if(t)break}if(t)break}if(t)break;i.reverse();for(let e of i)if(e.capabilities?.facingMode?.includes("environment")){t={deviceId:e.deviceId};break}if(t)break;t={deviceId:i[0].deviceId};break}case"macro-back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");const n=i.reduce((e,t)=>t?.capabilities?.facingMode?.includes("environment")?e&&e?.capabilities?.focusDistance?.min?t?.capabilities?.focusDistance?.min<e?.capabilities?.focusDistance?.min?t:e:t:e);t={deviceId:n?.deviceId||i[i.length-1].deviceId};break}default:throw Error(`Unknown camera preset: ${this._requestedCamera}`)}this._requestedCamera=t}else t=this._requestedCamera;const i={video:Object.assign({},t,this._requestedResolution),audio:!1};if(!navigator?.mediaDevices)throw Error(Ge);const n=await navigator.mediaDevices.getUserMedia(i);if("closing"===this.status)throw Error("Camera closed.");this._video.srcObject=n}if(await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this.track){const e=this.track.getSettings();let t=0;for(;++t<10&&(e.width!==this.video.videoWidth||e.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));if("closing"===this.status)throw Error("Camera closed.")}this._pOpen.resolve();try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}}else{if(this._pOpen=new Fe,await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this._paused=!1,this._pOpen.resolve(),this._resolutionChangedWhenPaused){try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._resolutionChangedWhenPaused=!1}}for(let t of e._arrOnOpen)t.call(this);this._callOpenedListeners()}catch(e){let t=this._video?.srcObject?.getTracks?.();if(t)for(let e of t)e?.stop();this._video.srcObject=null;const i=this._pOpen;throw this._pOpen=null,this._shouldClose=!1,i.reject(),Error(`Error opening camera: ${e?.message}`,{cause:e})}else{if("opening"!==this.status&&"closing"!==this.status)throw Error("Never");await this._pOpen}}async pause(){try{await this._pOpen}catch(e){}"opened"===this.status&&(this._video.pause(),this._paused=!0)}async close(){for(let t of e._arrBeforeClose)t.call(this);if("closed"===this.status)return;if("opening"===this.status&&(this._shouldClose=!0),"closing"===this.status){try{await this._pOpen}catch(t){}return}let t=this._video?.srcObject?.getTracks?.();if(t){for(let e of t)e?.stop();this._video.srcObject=null}this._pOpen=null,this._paused=!1;for(let t of e._arrOnClose)t.call(this);this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility="hidden"),this._eventListeners.closed?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}async requestCamera(e){if("string"==typeof e)Ze.includes(e)?this._requestedCamera=e:this._requestedCamera={deviceId:e};else if(e)if("videoinput"===e.kind)e.deviceId?this._requestedCamera={deviceId:e.deviceId}:this._requestedCamera="back";else{const t=this._requestedCamera=JSON.parse(JSON.stringify(e));if(t.width||t.height||t.aspectRatio){const e=this._requestedResolution={};t.width&&(e.width=t.width,delete t.width),t.height&&(e.height=t.height,delete t.height),t.aspectRatio&&(e.aspectRatio=t.aspectRatio,delete t.aspectRatio)}}else null===e?this._requestedCamera=null:void 0===e&&(this._requestedCamera="back");"opened"===this.status?(await this.close(),await this.open()):"paused"===this.status&&(this._cameraChangedWhenPaused=!0)}async requestResolution(e,t){let i={};if("number"==typeof e?(i.width=e,"number"==typeof t&&(i.height=t)):Array.isArray(e)?(e[0]&&(i.width=e[0]),e[1]&&(i.height=e[1])):e?((e=JSON.parse(JSON.stringify(e))).width&&(i.width=e.width),e.height&&(i.height=e.height),e.aspectRatio&&(i.aspectRatio=e.aspectRatio)):null===e?i=null:void 0===e&&(i=Ue),this._requestedResolution=i,"opened"===this.status){await this.track.applyConstraints({...i});const t=this.track.getSettings();let n=0;for(;++n<10&&(t.width!==this.video.videoWidth||t.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._callOpenedListeners()}else"paused"===this.status&&(this._resolutionChangedWhenPaused=!0,await this.track.applyConstraints({...i}))}getFrame(e){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");let{x:t=0,y:i=0,width:n=this._video.videoWidth,height:s=this._video.videoHeight,reusedContext:r}=e||{};n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const a=r?.canvas||document.createElement("canvas");return a.width!=n&&(a.width=n),a.height!=s&&(a.height=s),(r||a.getContext("2d")).drawImage(this._video,t,i,n,s,0,0,n,s),a}setRegionBox(e){if(!(e=Object.assign(this._regionBox,e)).width||!e.height){if(!e.innerUi)return this._regionBoxWrapper?.remove(),this._regionBoxWrapper=null,this._regionBoxMask=null,void(this._regionBoxBorder=null);Object.assign(e,{width:1,height:1,unit:"view-size",center:{x:0,y:0}})}this._regionBoxWrapper||(this._regionBoxWrapper=document.createElement("div"),Object.assign(this._regionBoxWrapper.style,{width:"auto",height:"100%",maxWidth:"100%",maxHeight:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",containerType:"size",visibility:"opened"===this.status?"":"hidden"}),this._regionBoxMask=document.createElement("div"),Object.assign(this._regionBoxMask.style,{width:"100%",height:"100%",flex:"none"}),this._regionBoxWrapper.append(this._regionBoxMask),this._regionBoxBorder=document.createElement("div"),Object.assign(this._regionBoxBorder.style,{flex:"none",boxSizing:"content-box",position:"absolute",transform:"translate(-50%,-50%)"}),this._regionBoxWrapper.append(this._regionBoxBorder),this._coreShell.append(this._regionBoxWrapper)),"string"==typeof e.innerUi&&(e.innerUi=Pe(e.innerUi)),e.innerUi instanceof DocumentFragment?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Node?1==this._regionBoxBorder.childNodes.length&&this._regionBoxBorder.firstChild==e.innerUi||(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi)):e.innerUi instanceof NodeList?this._regionBoxBorder.childNodes!==e.innerUi&&(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Array?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):this._regionBoxBorder.innerHTML="";let t=100*e.center.y-50*e.height+50+"%",i=100*e.center.x+50*e.width+50+"%",n=100*e.center.y+50*e.height+50+"%",s=100*e.center.x-50*e.width+50+"%";Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`}),"view-min"===e.unit&&(t=`calc(${100*e.center.y+50}% + max(-${50*e.height}cqmin, -${50*e.height}cqmax))`,i=`calc(${100*e.center.x+50}% + ${50*e.width}cqmin)`,n=`calc(${100*e.center.y+50}% + ${50*e.height}cqmin)`,s=`calc(${100*e.center.x+50}% + max(-${50*e.width}cqmin, -${50*e.width}cqmax))`,Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`})),Object.assign(this._regionBoxMask.style,{...e.maskStyle}),Object.assign(this._regionBoxBorder.style,{width:100*e.width+"%",height:100*e.height+"%"}),"view-min"===e.unit&&Object.assign(this._regionBoxBorder.style,{width:100*e.width+"cqmin",height:100*e.height+"cqmin"}),Object.assign(this._regionBoxBorder.style,{top:100*e.center.y+50+"%",left:100*e.center.x+50+"%",...e.borderStyle}),"view-size"===e.unit&&1===e.width&&1===e.height&&(this._regionBoxBorder.style.borderWidth="0"),this._updateObjectFit()}addCanvas(){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),"opened"!==this.status&&"paused"!==this.status||(e.width=this._video.videoWidth,e.height=this._video.videoHeight),this._video.parentElement.append(e),e}_updateCanvasSize(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video;this._video.parentElement.querySelectorAll("canvas").forEach(t=>{t.width!==e.videoWidth&&(t.width=e.videoWidth),t.height!==e.videoHeight&&(t.height=e.videoHeight)})}addEventListener(e,t){(this._eventListeners[e]??=new Set).add(t)}removeEventListener(e,t){this._eventListeners[e]?.delete(t)}_callOpenedListeners(){try{this.onOpened?.(this)}catch(e){console.error(e)}this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility=""),this._eventListeners.opened?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}videoXY2AbsoluteLT(e){const t=this._video,i=t.getBoundingClientRect(),n=getComputedStyle(document.body);if("static"===n.position){const n=document.documentElement.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-n.x,top:e.y/t.videoHeight*i.height+i.y-n.y}))}{const s=document.body.getBoundingClientRect(),r=parseFloat(n.borderLeftWidth),a=parseFloat(n.borderTopWidth);return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-s.x-r,top:e.y/t.videoHeight*i.height+i.y-s.y-a}))}}videoXY2FixedLT(e){const t=this._video,i=t.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x,top:e.y/t.videoHeight*i.height+i.y}))}getVisibleAreaInVideoXY(e){const{isConsiderRegionBox:t=!1,rounded:i=!1}=e||{};let n;if(t&&this._regionBoxBorder){const e=this._regionBoxBorder.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height};const t=getComputedStyle(this._regionBoxBorder),i=parseFloat(t.borderLeftWidth),s=parseFloat(t.borderTopWidth),r=parseFloat(t.borderRightWidth),a=parseFloat(t.borderBottomWidth);n.x+=i,n.y+=s,n.width-=i+r,n.height-=s+a}else{const e=this._coreShell.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height}}const s=this._video.getBoundingClientRect(),r={x:(n.x-s.x)/s.width,y:(n.y-s.y)/s.height,width:n.width/s.width,height:n.height/s.height};r.x<0&&(r.width+=r.x,r.x=0),r.x>1&&(r.width-=r.x-1,r.x=1),r.y<0&&(r.height+=r.y,r.y=0),r.y>1&&(r.height-=r.y-1,r.y=1),r.x+r.width>1&&(r.width=1-r.x),r.x+r.width<0&&(r.width=-r.x),r.y+r.height>1&&(r.height=1-r.y),r.y+r.height<0&&(r.height=-r.y);const a=this._video.videoWidth,o=this._video.videoHeight;let l=(this.isMirrored?1-r.x-r.width:r.x)*a,c=r.y*o,d=r.width*a,u=r.height*o;return i&&(d=Math.round(d+l)-Math.round(l),u=Math.round(u+c)-Math.round(c),l=Math.round(l),c=Math.round(c)),{x:l,y:c,width:d,height:u}}};const Ze=["back","front","macro-back","quick-back","customized-video"];We._arrConstructors.push(function(){const e=this;e._softZoom={zoom:1,center:{x:0,y:0}},e.maxZoom4GestureWheel=20,e._lastZoomTime=-1/0,e._mapZoomTouchs=new Map,e.enableGestureZoom=!0,e.enableWheelZoom=!1}),Object.defineProperty(We.prototype,"softZoom",{get(){return this._softZoom}}),Object.defineProperty(We.prototype,"isMirrored",{get(){return this._isMirrored},set(e){const t=this;t._isMirrored=e,t.setSoftZoom(t.softZoom.zoom,{center:t.softZoom.center})}}),Object.defineProperty(We.prototype,"enableGestureZoom",{get(){return!!this._gestureZoomListener},set(e){const t=this;e?t._gestureZoomListener||(t._gestureZoomListener=e=>{t._changeZoomByTouch(e)},t._coreShell.addEventListener("touchstart",t._gestureZoomListener),t._coreShell.addEventListener("touchmove",t._gestureZoomListener),t._coreShell.addEventListener("touchend",t._gestureZoomListener),t._coreShell.addEventListener("touchcancel",t._gestureZoomListener)):t._gestureZoomListener&&(t._coreShell.removeEventListener("touchstart",t._gestureZoomListener),t._coreShell.removeEventListener("touchmove",t._gestureZoomListener),t._coreShell.removeEventListener("touchend",t._gestureZoomListener),t._coreShell.removeEventListener("touchcancel",t._gestureZoomListener),t._gestureZoomListener=null)}}),Object.defineProperty(We.prototype,"enableWheelZoom",{get(){return!!this._wheelZoomListener},set(e){const t=this;e?t._wheelZoomListener||(t._wheelZoomListener=e=>{t._changeZoomByWheel(e)},t._coreShell.addEventListener("wheel",t._wheelZoomListener)):t._wheelZoomListener&&(t._coreShell.removeEventListener("wheel",t._wheelZoomListener),t._wheelZoomListener=null)}}),We.prototype.getZoomRange=function(){if("opened"!==this.status)throw Error("Camera is not opened");return this.track.getCapabilities?.()?.zoom},We.prototype.setZoom=async function(e){if("opened"!==this.status)throw Error("Camera is not opened");await this.track.applyConstraints({advanced:[{zoom:e}]})},We.prototype.setSoftZoom=function(e,t){const i=this;let{center:n,limit:s}=t||{},{x:r=0,y:a=0}=n||{};s&&e<1&&(e=1);let o=i._isMirrored?`scale(${-e},${e})`:`scale(${e})`;if(n){if(s){const t=.5-.5/e;r<-t?r=-t:r>t&&(r=t),a<-t?a=-t:a>t&&(a=t)}o+=` translate(${r*=-100}%, ${a*=-100}%)`}i._softZoom={zoom:e,center:{x:r,y:a}},i._coreInnerLayer.style.transform=o},We.prototype._changeZoomByWheel=function(e){const t=this,i=Date.now();let n=t._softZoom.zoom,s=n-e.deltaY/200;s>t.maxZoom4GestureWheel&&(s=t.maxZoom4GestureWheel),s<1&&(s=1),s!==n&&(t.setSoftZoom(s,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,e.preventDefault(),t._eventListeners.zoom?.forEach(e=>{try{e.call(t,JSON.parse(JSON.stringify(t._softZoom)))}catch(e){console.error(e)}}))},We.prototype._changeZoomByTouch=function(e){const t=this;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=Date.now();if(i-t._lastZoomTime<100)return;let n=e.touches[0],s=e.touches[1],r=t._mapZoomTouchs.get(n.identifier),a=t._mapZoomTouchs.get(s.identifier);if(!r||!a)break;let o=Math.pow(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2),.5),l=Math.pow(Math.pow(n.clientX-s.clientX,2)+Math.pow(n.clientY-s.clientY,2),.5),c=t._softZoom.zoom;c*=l/o,c>t.maxZoom4GestureWheel&&(c=t.maxZoom4GestureWheel),c<1&&(c=1),t.setSoftZoom(c,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,t._eventListeners.zoom?.forEach(e=>{try{e(t)}catch(e){console.error(e)}});break}t._mapZoomTouchs.clear();for(let i of e.touches)t._mapZoomTouchs.set(i.identifier,{x:i.clientX,y:i.clientY})},We._arrConstructors.push(function(){const e=this;e._isFocusing=!1,e._advancedFocusParameters={minFocusDistanceLimit:.01,maxFocusDistanceLimit:10,firstStepWaitDuration:500,coarseStepWaitDuration:350,switchStepWaitDuration:400,fineStepWaitDuration:350,maxStepCount:30,backToContinousDuration:5e3,focusWH:.2,coarseTuneRate:.5,coarseTuneTolerance:.5,fineTuneRate:1.1},e._advancedFocusTaskId=0,e.enableTapToFocus="simple"}),We._getImageContrast=(e,t,i)=>{let n=0;for(let s=0;s<i-1;s++)for(let i=0;i<t-1;i++){const r=4*(s*t+i),a=r+4,o=r+4*t,l=e[r]-e[a],c=e[r+1]-e[a+1],d=e[r+2]-e[a+2],u=e[r]-e[o],h=e[r+1]-e[o+1],g=e[r+2]-e[o+2];n+=l*l+c*c+d*d+u*u+h*h+g*g}return n},We.prototype._simpleFocus=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(e._isFocusing)return;const t=e.currentCamera?.capabilities;let i,n;if(t?.focusMode?.includes("manual"))if(t?.focusMode?.includes("continuous"))i="manual",n="continuous";else{if(!t?.focusMode?.includes("single-shot"))return void e._advancedFocus();i="manual",n="single-shot"}else if(t?.focusMode?.includes("single-shot"))t?.focusMode?.includes("continuous")?(i="continuous",n="single-shot"):(i=null,n="single-shot");else{if(!t?.focusMode?.includes("continuous"))return;i=null,n="continuous"}e._isFocusing=!0;try{i&&("manual"===i?await e.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t?.focusDistance?.max||10}]}):await e.track.applyConstraints({advanced:[{focusMode:i}]}),await new Promise(e=>setTimeout(e,500))),await e.track.applyConstraints({advanced:[{focusMode:n}]}),await new Promise(e=>setTimeout(e,500))}catch(t){"opened"===e.status&&console.warn("Error while do simple focus",t)}e._isFocusing=!1},We.prototype._advancedFocus=async function(e,t,i){const n=this;if("opened"!==n.status)throw Error("Camera is not opened");if(n._isFocusing)return;const s=n.currentCamera?.capabilities;if(!s?.focusMode?.includes("manual"))return void n._simpleFocus();const r=n._advancedFocusParameters,a=n._video.videoWidth,o=n._video.videoHeight;if(a<2||o<2)return;let l,c=0;e?(e.x=Math.round(e.x),e.y=Math.round(e.y),t||(t=Math.min(a,o)*r.focusWH),t<2&&(t=2),t>a&&(t=a),t=2*Math.round(t/2),i||(i=t),i<2&&(i=2),i>o&&(i=o),i=2*Math.round(i/2),e.x<t/2&&(e.x=t/2),e.x>a-t/2&&(e.x=a-t/2),e.y<i/2&&(e.y=i/2),e.y>o-i/2&&(e.y=o-i/2),c=e.x-t/2,l=e.y-i/2):(t=a,i=o),n._isFocusing=!0;const d=++n._advancedFocusTaskId;let u=s?.focusDistance?.min;(!u||u<r.minFocusDistanceLimit)&&(u=r.minFocusDistanceLimit);let h=s?.focusDistance?.max;(!h||h>r.maxFocusDistanceLimit)&&(h=r.maxFocusDistanceLimit);let g=-1/0,m=-1/0,p=1/0,f=h,_=!1,E=!0;const y=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});let R=0;try{for(;++R<r.maxStepCount;){let e;await n.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),_?E?(E=!1,e=r.switchStepWaitDuration):e=r.fineStepWaitDuration:E?(E=!1,e=r.firstStepWaitDuration):e=r.coarseStepWaitDuration,await new Promise(t=>setTimeout(t,e)),n.getFrame({x:c,y:l,width:t,height:i,reusedContext:y});const s=y.getImageData(0,0,t,i).data,a=We._getImageContrast(s,t,i);if(_){if(a<=g){await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]}),await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]});break}if(h===f)break;g=a,a>m&&(m=a,p=f),f*=r.fineTuneRate,f>h&&(f=h)}else(a<=m*r.coarseTuneTolerance||u===f)&&(_=!0),g=a,a>m&&(m=a,p=f),_?(f=Math.sqrt(f*p),E=!0):(f*=r.coarseTuneRate,f<u&&(f=u))}}catch(e){"opened"===n.status&&console.warn("Error while do advanced focus",e)}n._isFocusing=!1,r.backToContinousDuration>0&&setTimeout(async()=>{if(n._advancedFocusTaskId===d)try{await n.track.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(e){}},r.backToContinousDuration)},Object.defineProperty(We.prototype,"enableTapToFocus",{get(){return this._enableTapToFocus},set(e){const t=this;t._enableTapToFocus=e,e?t._tapToFocusListner||(t._tapToFocusListner=async e=>{if(!("opened"!==t.status||!t._enableTapToFocus||!e.isPrimary||e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||"touch"===e.pointerType&&t.enableGestureZoom&&(await new Promise(e=>setTimeout(e,300)),"opened"!==t.status||!t._enableTapToFocus||t._lastZoomTime>Date.now()-1e3||t._mapZoomTouchs.size>1)))if("experimental-advanced"===t._enableTapToFocus){const[{left:i,top:n},{left:s,top:r}]=t.videoXY2FixedLT([{x:0,y:0},{x:t._video.videoWidth,y:t._video.videoHeight}]);t._advancedFocus({x:(e.clientX-i)/(s-i)*t._video.videoWidth,y:(e.clientY-n)/(r-n)*t._video.videoHeight})}else t._simpleFocus()},t._coreShell.addEventListener("pointerdown",t._tapToFocusListner)):t._tapToFocusListner&&(t._coreShell.removeEventListener("pointerdown",t._tapToFocusListner),t._tapToFocusListner=null)}}),We._arrConstructors.push(function(){this._isTorchOn=!1,this._autoTorchParameters={shortDelay:250,longDelay:1e3,shortLongDelaySwitchCount:10,maxErrorCount:10,grayThreshold:20,maxDarkCount:3}}),We._arrOnClose.push(function(){this._isTorchOn=!1}),Object.defineProperty(We.prototype,"isSupportTorch",{get(){return!!this.currentCamera?.capabilities?.torch}}),Object.defineProperty(We.prototype,"isTorchOn",{get(){return this._isTorchOn}}),We.prototype.turnOnTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");try{await e.track.applyConstraints({advanced:[{torch:!0}]})}catch(t){throw e._isTorchOn=!1,t}e._isTorchOn=!0},We.prototype.turnOffTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");await e.track.applyConstraints({advanced:[{torch:!1}]}),e._isTorchOn=!1},We.prototype.turnAutoTorch=function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(null==e._isTorchOn)return;e._isTorchOn=void 0;const t=e._autoTorchParameters,i=document.createElement("canvas"),n=i.getContext("2d",{willReadFrequently:!0});let s=0,r=0,a=0;(async()=>{for(;null==e._isTorchOn;){try{e.getFrame({reusedContext:n})}catch(i){if("opened"===e.status&&++s<t.maxErrorCount){await new Promise(e=>setTimeout(e,1e3));continue}e._isTorchOn=!1;break}const o=n.getImageData(0,0,i.width,i.height).data;let l=0;for(let e=0;e<o.length;e+=4)l+=o[e]+o[e+1]+o[e+2];if(l/=o.length/4*3,l<t.grayThreshold&&++r>=t.maxDarkCount){try{await e.turnOnTorch(),e._eventListeners.torchAutoOn?.forEach(t=>{try{t.call(e)}catch(e){console.error(e)}})}catch(e){}break}await new Promise(e=>setTimeout(e,a<t.shortLongDelaySwitchCount?t.shortDelay:t.longDelay)),++a}})()},We._arrConstructors.push(function(){this._shouldCloseWhenHide=!0,this._maxReopenTry4CloseWhenHide=4}),We._arrOnOpen.push(function(){const e=this;e._shouldCloseWhenHide&&(e._closeWhenHideListener||(e._closeWhenHideListener=()=>{e._closeWhenHide()},document.addEventListener("visibilitychange",e._closeWhenHideListener)))}),We._arrBeforeClose.push(function(){const e=this;e._closeWhenHideListener&&!e._isDuringCloseWhenHide&&(document.removeEventListener("visibilitychange",e._closeWhenHideListener),e._closeWhenHideListener=null,e._isOpenBeforeHide=!1)}),Object.defineProperty(We.prototype,"shouldCloseWhenHide",{get(){return this._shouldCloseWhenHide},set(e){const t=this;t._shouldCloseWhenHide=e,"opened"===t.status&&(e?t._closeWhenHideListener||(t._closeWhenHideListener=()=>{t._closeWhenHide()},document.addEventListener("visibilitychange",t._closeWhenHideListener)):t._closeWhenHideListener&&(document.removeEventListener("visibilitychange",t._closeWhenHideListener),t._closeWhenHideListener=null,t._isOpenBeforeHide=!1))}}),We.prototype._closeWhenHide=async function(){const e=this;if("hidden"===document.visibilityState)"opened"===e.status&&(e._isDuringCloseWhenHide=!0,e._isOpenBeforeHide=!0,await e.close(),e._isDuringCloseWhenHide=!1);else if(e._isOpenBeforeHide){let t=0;for(;t++<e._maxReopenTry4CloseWhenHide&&"visible"===document.visibilityState;){try{await e.open()}catch(e){await new Promise(e=>setTimeout(e,300));continue}e._isOpenBeforeHide=!1;break}}},We.showFilePicker=async function(e){let t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff",t.multiple=!0;let i=new Promise(function(e){t.addEventListener("change",function(){e(Array.from(t.files))})});Object.assign(t,e);let n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});return t.dispatchEvent(n),i};let He,ze=class{camera;_ctx;_data;_dataTime=-1/0;_x;_y;_w;_h;_type;maxTimeout=500;_pipeTaskId;isSaveOriginalRgba=!1;originalRgba;constructor(e){this.camera=e;const t=document.createElement("canvas");this._ctx=t.getContext("2d",{willReadFrequently:!0})}_getData(){if("opened"!==this.camera.status)return null;this.camera.getFrame({x:this._x,y:this._y,width:this._w,height:this._h,reusedContext:this._ctx});const e=this._ctx.getImageData(0,0,this._w,this._h).data;if(this.originalRgba=this.isSaveOriginalRgba?e:null,"rgba"===this._type)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const t=new Uint8Array(e.length/4);for(let i=0;i<e.length;i+=4)t[i/4]=.3*e[i]+.59*e[i+1]+.11*e[i+2];return t}getData(e){let{x:t=0,y:i=0,width:n=this.camera._video.videoWidth,height:s=this.camera._video.videoHeight,type:r="rgba"}=e||{};if(n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i),0===n||0===s||isNaN(n)||isNaN(s))return null;const a=t!==this._x||i!==this._y||n!==this._w||s!==this._h||r!==this._type;let o;return a&&(this._x=t,this._y=i,this._w=n,this._h=s,this._type=r),!a&&this._dataTime+this.maxTimeout>Date.now()&&this._data?(o=this._data,this._data=null):o=this._getData(),this._pipeTaskId||(this._pipeTaskId=setTimeout(()=>{this._pipeTaskId=null,this._data=this._getData(),this._dataTime=Date.now()},0)),o}},je=class{_stAudioFree=new Set;_stAudioPlaying=new Set;_timeLastPlay=0;_bWarnedMaxTrack=!1;maxPlayingBeep=16;beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";beep(){if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-this._timeLastPlay<100)){if(this._timeLastPlay=t,this._stAudioFree.size&&(e=this._stAudioFree.values().next().value,this.beepSoundSource==e.src?(this._stAudioFree.delete(e),e.play()):e=null),!e)if(this._stAudioPlaying.size<this.maxPlayingBeep){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout(()=>{this._stAudioPlaying.delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,this._stAudioPlaying.delete(e),this._stAudioFree.add(e)})}else this._bWarnedMaxTrack||(this._bWarnedMaxTrack=!0,console.warn(`The requested audio tracks exceed ${this.maxPlayingBeep} and will not be played.`));e&&this._stAudioPlaying.add(e)}}};const Ye=()=>{(He??=new je).beep()},qe=(e=300)=>{if(!navigator?.vibrate)throw new Error("Not supported.");navigator.vibrate(e)},$e=We,Xe=We;if(document?.head){const e=new Blob(["@keyframes dce-scanlight{from{top:0;}to{top:97%;}}"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}$e.createInstance=async function(e){let t;if(e instanceof We?(t=e,e=void 0):t=new We,void 0===t.disposed){if(t.disposed=!1,t._cameraEnhancer=t._cameraView=t,t._framePipeline=new ze(t),t._dceScanRegion={x:0,y:0,width:100,height:100,isMeasuredInPercentage:!0},t._dceEventListeners={},t._oriOpen=t.open,t.open=Qe,t._dceZoom=1,t._dceEnhancedFeatures=0,t._dceAutoZoomRange={min:1,max:10},t._oriSetZoom=t.setZoom,t.setZoom=Ke,t.singleFrameMode="disabled",t.addImageToBuffer=t.clearBuffer=t.getBufferOverflowProtectionMode=t.getColourChannelUsageType=t.getImageCount=t.getImageFetchInterval=t.getMaxImageCount=t.hasImage=t.setBufferOverflowProtectionMode=t.setErrorListener=t.setImageFetchInterval=t.setMaxImageCount=t.setNextImageToReturn=()=>{},e??=Xe.defaultUIElementURL,e&&await t.setUIElement(e),t._dceRegionMaskStyle={lineWidth:parseFloat(t.regionBox.borderStyle.border?.split(" ")[0]),strokeStyle:t.regionBox.borderStyle.border?.split(" ")[2],fillStyle:t.regionBox.maskStyle.background},t._dceRegionMaskVisible=!0,t._dceTipDuration=3e3,t._drawingLayers=[],t._drawingLayers.length=4,t._capturedResultReceiver={onCapturedResultReceived:ft.bind(t)},!t.regionBox.innerUi){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",width:"100%",height:"3%",borderRadius:"50%",boxShadow:"0px 0px 2vw 1px #00e5ff",background:"#fff",animation:"3s infinite dce-scanlight",pointerEvents:"none",userSelect:"none",display:"none"}),t.setRegionBox({innerUi:e})}t.addEventListener("opened",function(){this._dceEventListeners.cameraOpen?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}),this._dceEventListeners.played?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});const e=t.currentCamera?.deviceId;e!==t._dceLastDeviceId&&(t._dceLastDeviceId=e,this._dceEventListeners.cameraChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}));const i=t.currentResolution;i.width===t._dceLastResolution?.width&&i.height===t._dceLastResolution?.height||(t._dceLastResolution=i,this._dceEventListeners.resolutionChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}))}),t.addEventListener("closed",function(){this._dceEventListeners.cameraClose?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}),["mousedown","mouseup","dblclick"].forEach(e=>{t._coreShell.addEventListener(e,function(e){const i=[e.clientX,e.clientY],n=t._drawingLayers.filter(e=>e?._visible).map(e=>e._drawingItems).flat(),s=t.videoXY2AbsoluteLT(n.map(e=>{if(e instanceof ht)return e.quad.points;if(e instanceof gt||e instanceof mt||e instanceof mt){let{x:t,y:i,width:n,height:s}=e.rect,r=t+n,a=i+s;return[{x:t,y:i},{x:t,y:a},{x:r,y:a},{x:r,y:i}]}return e instanceof ut?[e.line.startPoint,e.line.endPoint]:void 0}).flat()).map(e=>[e.left,e.top]);let r=0;n.forEach(t=>{let n=!1;t instanceof ht||t instanceof gt||t instanceof mt||t instanceof mt?(n=ct(i,[s[r],s[r+1],s[r+2],s[r+3]]),r+=4):t instanceof ut&&(n=ct(i,[s[r],s[r+1]]),r+=2),n&&t._dceEventListeners[e.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})})})})}return t},$e.defaultUIElementURL="@engineResourcePath/ui/dce.ui.xml";const Qe=async function(){const e=this;if("camera"===e.singleFrameMode||"image"===e.singleFrameMode){const t={multiple:!1};"camera"===e.singleFrameMode&&(t.capture="environment");const i=(await We.showFilePicker(t))[0],n=document.createElement("canvas"),s=n.getContext("2d"),r=URL.createObjectURL(i),a=new Image;a.src=r,await a.decode(),n.width=a.width,n.height=a.height,s.drawImage(a,0,0),URL.revokeObjectURL(r);const o=s.getImageData(0,0,n.width,n.height).data,l={bytes:new Uint8Array(o.buffer,o.byteOffset,o.length),width:n.width,height:n.height,stride:4*n.width,format:10,toCanvas:()=>n,imageTag:{imageId:++et,type:0}};return void e._dceEventListeners.singleFrameAcquired?.forEach(e=>{try{e.call(this,l)}catch(e){console.error(e)}})}const t=e.ui.querySelector(".dce-bg-loading");t&&(t.style.display="");try{await e._oriOpen()}catch(e){throw $e.onWarning&&$e.onWarning(e?.message),e}return t&&(t.style.display="none"),await new Promise(e=>setTimeout(e,0)),{deviceId:e.currentCamera?.deviceId,...e.currentResolution}};$e.prototype.dispose=function(){this.disposed=!0,this.close(),this.setScanLaserVisible(!1)},$e.prototype.getAllCameras=async function(){return(await We.getDeviceInfos()).map(e=>({deviceId:e.deviceId,label:e.label}))},$e.prototype.getAvailableResolutions=async function(){const e=this,t=[];await e._oriOpen();for(let i of[[160,120],[320,240],[480,360],[640,480],[800,600],[960,720],[1280,720],[1920,1080],[2560,1440],[3840,2160]])await e.requestResolution(i),(e.currentResolution?.width===i[0]&&e.currentResolution?.height===i[1]||e.currentResolution?.width===i[1]&&e.currentResolution?.height===i[0])&&t.push({width:i[0],height:i[1]});return await e.close(),t},$e.prototype.getCameraStatus=function(){let e=this.status;return"closing"!==e&&"paused"!==e||(e="closed"),e},$e.prototype.getResolution=function(){return"opened"===this.status?this.currentResolution:this.requestedResolution},$e.prototype.getSelectedCamera=function(){return"opened"===this.status?{deviceId:this.currentCamera?.deviceId,label:this.currentCamera?.label}:null},$e.prototype.getVideoSettings=function(){let e="string"==typeof this.requestedCamera?{video:!0}:this.requestedCamera;return Object.assign(e,this.requestedResolution),e},Object.defineProperty($e.prototype,"ifSkipCameraInspection",{get(){return"quick-back"===this.requestedCamera},set(e){e?this.requestCamera("quick-back"):this.requestCamera("back")}}),$e.prototype.isOpen=function(){return"opened"===this.status},$e.prototype.isPaused=function(){return"paused"===this.status},$e.prototype.resume=async function(){await this._oriOpen()},$e.prototype.selectCamera=async function(e){return await this.requestCamera("string"==typeof e?e:e.deviceId),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},$e.prototype.setResolution=async function(e){return await this.requestResolution(e),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},$e.testCameraAccess=async function(){let e,t=!0;try{await We.getDeviceInfos()}catch(i){t=!1,e=i.message||i}return{ok:t,message:e}},$e.prototype.updateVideoSettings=async function(e){await this.requestCamera(e)},Object.defineProperty($e.prototype,"videoSrc",{get(){return this._dceVideoSrc},set(e){const t=this;t._dceVideoSrc=e,e?(t.video.src=e,t.requestCamera("customized-video")):(t.video.src="",t.requestCamera(void 0))}}),$e.prototype.disableEnhancedFeatures=function(e){this._dceEnhancedFeatures=this._dceEnhancedFeatures-(this._dceEnhancedFeatures&e)},$e.prototype.enableEnhancedFeatures=function(e){this._dceEnhancedFeatures|=e},$e.prototype.getCameraSettings=function(){return this.track.getSettings()},$e.prototype.getCapabilities=function(){return this.track.getCapabilities()},$e.prototype.getColorTemperature=function(){return this.track?.getSettings()?.colorTemperature},$e.prototype.getExposureCompensation=function(){return this.track?.getSettings()?.exposureCompensation},$e.prototype.getFrameRate=function(){return this.track?.getSettings()?.frameRate},$e.prototype.setColorTemperature=function(e){this.track?.applyConstraints?.({advanced:[{colorTemperature:{ideal:e}}]})},$e.prototype.setExposureCompensation=function(e){this.track?.applyConstraints?.({advanced:[{exposureCompensation:{ideal:e}}]})},$e.prototype.setFrameRate=function(e){this.track?.applyConstraints?.({advanced:[{frameRate:{ideal:e}}]})},$e.prototype.getZoomSettings=function(){return{factor:this._dceZoom}};const Ke=async function(e){const t=this;if("number"==typeof e)return void await t._oriSetZoom(e);let i,n=e.factor;try{i=t.getZoomRange().max}catch(e){i=null}i?n<i?(await t._oriSetZoom(n),t.setSoftZoom(1)):(await t._oriSetZoom(i),t.setSoftZoom(n/i)):t.setSoftZoom(n),t._dceZoom=n};function Je(e,t,i,n){const s=document.createElement("canvas");s.width=t,s.height=i;const r=s.getContext("2d");if(10!==n){let n=new Uint8Array(t*i*4);for(let t=0;t<e.length;++t){let i=4*t;n[i+2]=n[i+1]=n[i]=e[t],n[i+3]=255}e=n}const a=new Uint8ClampedArray(e),o=new ImageData(a,t,i);return r.putImageData(o,0,0),s}$e.prototype.resetZoom=function(){this.setZoom(1),this.setSoftZoom(1,{center:{x:0,y:0}})},$e.prototype.getFocusSettings=function(){return this._dceFocusSettings},$e.prototype.setFocus=async function(e){const t=this;if(t._dceFocusSettings=e,"manual"!==e.mode)await t.track.applyConstraints({advanced:[{focusMode:e.mode}]});else if(e.distance)await t.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:e.distance}]});else{let{x:i,y:n}=e.area.centerPoint,s=e.area.width,r=e.area.height,a=t.currentResolution.width,o=t.currentResolution.height;"string"==typeof i&&(i=i.endsWith("%")?parseFloat(i)*a:parseFloat(i)),"string"==typeof n&&(n=n.endsWith("%")?parseFloat(n)*o:parseFloat(n)),"string"==typeof s&&(s=s.endsWith("%")?parseFloat(s)*a:parseFloat(s)),"string"==typeof r&&(r=r.endsWith("%")?parseFloat(r)*o:parseFloat(r)),await t._advancedFocus({x:i,y:n},s,r)}},$e.prototype.setAutoZoomRange=function(e){this._dceAutoZoomRange=e},$e.prototype.getAutoZoomRange=function(){return this._dceAutoZoomRange};let et=0;$e.prototype.fetchImage=$e.prototype.getImage=$e.prototype.takePhoto=function(){const e=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),t=2!=this._pixelFormat,i=this._framePipeline.getData({...e,type:t?"rgba":"gray"});if(!i)return null;this._dceEventListeners.frameAddedToBuffer?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});let{width:n,height:s}=e,r=t?10:2;return{bytes:i,width:n,height:s,stride:e.width*(t?4:1),format:r,toCanvas:()=>Je(i,n,s,r),imageTag:{imageId:++et,type:1}}},Object.defineProperty($e.prototype,"singleFrameMode",{get(){return this._singleFrameMode},set(e){const t=this;t._singleFrameMode=e;const i=t.ui.querySelector(".dce-bg-camera");i&&("disabled"!==e?(t._singleFrameModeClickCallback||(t._singleFrameModeClickCallback=()=>{t.open()},i.addEventListener("click",t._singleFrameModeClickCallback)),i.style.display=""):(t._singleFrameModeClickCallback&&(i.removeEventListener("click",t._singleFrameModeClickCallback),t._singleFrameModeClickCallback=null),i.style.display="none"))}}),$e.prototype.getScanRegion=function(){return this._dceScanRegion},$e.prototype.hasNextImageToFetch=function(){return"opened"===this.status},$e.prototype.isBufferEmpty=function(){return"opened"!==this.status},$e.prototype.setColourChannelUsageType=function(e){},$e.prototype.startFetching=function(){},$e.prototype.setPixelFormat=function(){return this._pixelFormat},$e.prototype.setPixelFormat=function(e){this._pixelFormat=e},$e.prototype.setScanRegion=function(e){this._dceScanRegion=e;const t=this._dceRegionMaskVisible,i=this._dceRegionMaskStyle;if(e.isMeasuredInPercentage)if(void 0!==e.x){let n=e;this.setRegionBox({width:n.width/100,height:n.height/100,center:{x:(n.x+n.width/2-50)/100,y:(n.y+n.height/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=e;this.setRegionBox({width:(n.right-n.left)/100,height:(n.bottom-n.top)/100,center:{x:((n.left+n.right)/2-50)/100,y:((n.top+n.bottom)/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=this.video.videoWidth||720,s=this.video.videoHeight||1280;if(void 0!==e.x){let r=e;this.setRegionBox({width:Math.min(r.width/n,1),height:Math.min(r.height/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let r=e;this.setRegionBox({width:Math.min((r.right-r.left)/n,1),height:Math.min((r.bottom-r.top)/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}}},$e.prototype.stopFetching=function(){},$e.prototype.setCameraView=function(e){if(e===this)return;const t=e.ui.parentElement;e.ui.parentElement&&(e.ui.remove(),t.append(this.ui));let i=[];for(let t in e)"function"==typeof e[t]&&i.push(t);for(let t of i)e[t]=this[t].bind(this)},$e.prototype.getCameraView=function(){return this},$e.prototype.getVideoEl=function(){return this.video},$e.prototype.convertToPageCoordinates=function(e){return this.videoXY2AbsoluteLT([e]).map(e=>({x:e.left,y:e.top}))[0]},$e.prototype.convertToClientCoordinates=function(e){return this.videoXY2FixedLT([e]).map(e=>({x:e.left,y:e.top}))[0]},$e.prototype.convertToScanRegionCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY({isConsiderRegionBox:!0});if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},$e.prototype.convertToContainCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY();if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},$e.prototype.on=function(e,t){(this._dceEventListeners[e]??=new Set).add(t)},$e.prototype.off=function(e,t){this._dceEventListeners[e]?.delete(t)},Xe.prototype.getUIElement=function(){return this.ui},Xe.prototype.setUIElement=async function(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if(e instanceof HTMLElement&&!e.childElementCount)return await this.setUIElement(Xe.defaultUIElementURL),e.append(this.getUIElement()),void(this.ui=e);if("string"==typeof e){let t=e.trim();if(!t.trimStart().startsWith("<")){if(t.includes("@engineResourcePath/")){const e=$e.handleEngineResourcePaths($e.CoreModule.engineResourcePaths);t=t.replace("@engineResourcePath/","DBR"===$e.CoreModule._bundleEnv?e.dbrBundle:e.dcvData)}t=await fetch(t).then(e=>e.text()),t=t.trim()}if(!t.startsWith("<"))throw Error("Invalid html string.");if(t.startsWith("<template>")&&(t=t.substring(10,t.length-11).trim()),!t.startsWith("<"))throw Error("Invalid html string.");let i,n=Pe(t,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet});if(n instanceof HTMLElement)i=n;else{if(!(n instanceof DocumentFragment))throw Error("Seems no HTMLElement.");i=document.createElement("div"),Object.assign(i.style,{width:"100%",height:"100%"}),i.append(n)}e=i,Object.defineProperty(e,"shadowRoot",{value:e,writable:!0})}if(!(e instanceof HTMLElement))throw Error("Invalid html string.");const t="dm-camera-core-container";let i=e.classList.contains(t)?e:e.querySelector(`.${t}`);if(!i){const n="dce-video-container";i=e.classList.contains(n)?e:e.querySelector(`.${n}`),i&&(e.style.overflow="hidden",e.querySelector("select.dce-sel-camera")?.remove(),e.querySelector("select.dce-sel-resolution")?.remove(),i.classList.add(t))}i||e.classList.add(t),this.ui=e},Xe.prototype.getVideoElement=function(){return this.video},Xe.prototype.setVideoFit=function(e){this.objectFit=e},Xe.prototype.getVideoFit=function(){return this.objectFit},Xe.prototype.getVisibleRegionOfVideo=function(e){let{inPixels:t}=e||{inPixels:!1};const i=this.getVisibleAreaInVideoXY();if(t)return{...i,isMeasuredInPercentage:!1};{let{width:e,height:t}=this.currentResolution;return{x:i.x/e*100,y:i.y/t*100,width:i.width/e*100,height:i.height/t*100,isMeasuredInPercentage:!0}}},Xe.prototype.setScanRegionMaskStyle=function(e){const t=this._dceRegionMaskVisible;this._dceRegionMaskStyle={...e},this.setRegionBox({maskStyle:{background:t?e.fillStyle:""},borderStyle:{border:t?`${e.lineWidth}px solid ${e.strokeStyle}`:""}})},Xe.prototype.getScanRegionMaskStyle=function(){return this._dceRegionMaskStyle},Xe.prototype.setScanRegionMaskVisible=function(e){this._dceRegionMaskVisible=e;const t=this._dceRegionMaskStyle;this.setRegionBox({maskStyle:{background:e?t.fillStyle:""},borderStyle:{border:e?`${t.lineWidth}px solid ${t.strokeStyle}`:""}})},Xe.prototype.isScanRegionMaskVisible=function(){return this._dceRegionMaskVisible},Xe.prototype.setScanLaserVisible=function(e){const t=this.regionBox.innerUi.style;t.display=e?"":"none",setTimeout(()=>{t.display="none",e&&(t.display="")},0)},Xe.prototype.isScanLaserVisible=function(){return"none"!==this.regionBox.innerUi.style.display},Xe.prototype.setPowerByMessageVisible=function(e){let t=this.ui.querySelector("dce-msg-poweredby,dm-camera-mn-msg-poweredby");t&&(e?"none"!==t.style.display&&(t.style.display=""):t.style.display="none")},Xe.prototype.isPowerByMessageVisible=function(){let e=this.ui.querySelector("dce-msg-poweredby");return e&&"none"!==e.style.display},Xe.prototype.getTipConfig=function(){return{duration:this._dceTipDuration}},Xe.prototype.setTipConfig=function(e){this._dceTipDuration=e.duration},Xe.prototype.setTipVisible=function(e){if(e)this.funcShowToast?.(this._dceTipMessage,this._dceTipDuration);else{const e=this.ui.querySelector(".dm-camera-mn-toast");e&&(e.style.display="none")}},Xe.prototype.isTipVisible=function(){const e=this.ui.querySelector(".dm-camera-mn-toast");return!!e&&"none"!=e.style.display},Xe.prototype.updateTipMessage=function(e){this._dceTipMessage=e},Xe.prototype.createDrawingLayer=function(){const e=new lt;return e._ctx=this.addCanvas().getContext("2d"),this._drawingLayers.push(e),e},Xe.prototype.getDrawingLayer=function(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=new lt,t._ctx=this.addCanvas().getContext("2d"),this._drawingLayers[e]=t,1===e?t._defaultStyle=ot.STYLE_BLUE_STROKE:2===e?t._defaultStyle=ot.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=ot.STYLE_GREEN_STROKE_FILL)),t},Xe.prototype.getAllDrawingLayers=function(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)},Xe.prototype.clearUserDefinedDrawingLayers=function(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4},Xe.prototype.deleteUserDefinedDrawingLayer=function(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])},Xe.prototype.clearAllInnerDrawingItems=function(){for(let e of this._drawingLayers.slice(1,4))e?.clearDrawingItems()};let tt=class{static _beepInstance;static beep(){null!=this._beepInstance?this._beepInstance.beep():Ye()}static get beepSoundSource(){return this._beepInstance?.beepSoundSource}static set beepSoundSource(e){this._beepInstance??=new je,this._beepInstance.beepSoundSource=e}static vibrate(){null!=this.vibrateDuration?qe(this.vibrateDuration):qe()}static vibrateDuration};const it="73,245,73",nt="73,173,245",st="254,180,32",rt="245,236,73",at=(e,t)=>{let i,n;return"f"===t?(i="strokeAndFill",n="0.3"):"t"===t?(i="fill",n="0.2"):(i="stroke",n="0.3"),{lineWidth:2,fillStyle:`rgba(${e},${n})`,strokeStyle:`rgba(${e},0.9)`,fontFamily:"consolas",fontSize:40,paintMode:i}},ot={STYLE_GREEN_STROKE:at(it),STYLE_GREEN_STROKE_FILL:at(it,"f"),STYLE_GREEN_STROKE_TRANSPARENT:at(it,"t"),STYLE_BLUE_STROKE:at(nt),STYLE_BLUE_STROKE_FILL:at(nt,"f"),STYLE_BLUE_STROKE_TRANSPARENT:at(nt,"t"),STYLE_ORANGE_STROKE:at(st),STYLE_ORANGE_STROKE_FILL:at(st,"f"),STYLE_ORANGE_STROKE_TRANSPARENT:at(st,"t"),STYLE_YELLOW_STROKE:at(rt),STYLE_YELLOW_STROKE_FILL:at(rt,"f"),STYLE_YELLOW_STROKE_TRANSPARENT:at(rt,"t"),createDrawingStyle(e){let t=Object.assign({},this.STYLE_YELLOW_STROKE_FILL,e);return Object.assign(e,t),e},getDrawingStyle(e){return"number"==typeof e?this.STYLE_GREEN_STROKE:e},getAllDrawingStyles:()=>[],updateDrawingStyle(e,t){Object.keys(e).forEach(t=>{delete e[t]}),Object.assign(e,t)}};let lt=class{_visible=!0;_ctx;_defaultStyle=ot.STYLE_YELLOW_STROKE_FILL;_drawingItems=[];_mode="viewer";_renderTask;getId(){return this}isVisible(){return this._visible}setVisible(e){this._visible=e;const t=this._ctx;if(!t)return;const i=t.canvas;t.clearRect(0,0,i.width,i.height)}setDefaultStyle(e,t,i){this._defaultStyle=ot.getDrawingStyle(e),this._delayRenderAll()}addDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=this._drawingItems.concat(e),this._delayRenderAll()}removeDrawingItems(e){this._drawingItems=this._drawingItems.filter(t=>!e.includes(t))}setDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=[...e],this._delayRenderAll()}getDrawingItems(e){return this._drawingItems.filter(t=>!e||e(t))}hasDrawingItem(e){return this._drawingItems.includes(e)}clearDrawingItems(){this._drawingItems=[],this._delayRenderAll()}_delayRenderAll(){this._renderTask||(this._renderTask=setTimeout(()=>{this.renderAll(),this._renderTask=null},0))}renderAll(){if(!this._visible||!this._ctx)return;const e=this._ctx,t=e.canvas;e.clearRect(0,0,t.width,t.height);for(let t of this._drawingItems){const i=ot.getDrawingStyle(t.drawingStyleId||this._defaultStyle);if(t instanceof mt){e.font=`${i.fontSize}px ${i.fontFamily}`;const{x:n,y:s,width:r,height:a}=t.rect;e.fillText(t.text,n,s,r)}else if(t instanceof pt){const i=t.image,n=i.naturalWidth||i.videoWidth||i.width||0,s=i.naturalHeight||i.videoHeight||i.height||0;if(!n||!s)continue;let{x:r,y:a,width:o,height:l}=t.rect;t.maintainAspectRatio&&(l=o/n*s),e.drawImage(i,r,a,o,l)}else{if(e.fillStyle=i.fillStyle,e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,e.setLineDash([]),t._bSelected&&(e.strokeStyle="#0f0",e.lineWidth=4,e.setLineDash([4,4])),e.beginPath(),t instanceof ht){const i=t.quad.points;e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.lineTo(i[3].x,i[3].y)}else if(t instanceof ut){const i=t.line.startPoint,n=t.line.endPoint;e.moveTo(i.x,i.y),e.lineTo(n.x,n.y)}else if(t instanceof gt){const{x:i,y:n,width:s,height:r}=t.rect;e.moveTo(i,n),e.lineTo(i+s,n),e.lineTo(i+s,n+r),e.lineTo(i,n+r)}i.paintMode.toLowerCase().includes("fill")&&e.fill(),e.closePath(),i.paintMode.toLowerCase().includes("stroke")&&e.stroke()}}}getMode(){return this._mode}setMode(e){}};function ct(e,t){const[i,n]=e;let s=!1;for(let e=0,r=t.length-1;e<t.length;r=e++){const[a,o]=t[e],[l,c]=t[r];if((i-a)*(n-o)==(i-l)*(n-c))return!0;o>n!=c>n&&i<(l-a)*(n-o)/(c-o)+a&&(s=!s)}return s}let dt=class{coordinateBase="image";drawingLayerId;drawingStyleId;mediaType;_state=Et.DIS_DEFAULT;_notes=[];_bSelected=!1;_dceEventListeners={};getState(){return this._state}addNote(e,t){if(t){let t=!1;for(let i=0;i<this._notes.length;++i)this._notes[i].name===e.name&&(this._notes.splice(i,1,e),t=!0);t||this._notes.push(e)}else this._notes.push(e)}getNote(e){for(let t of this._notes)if(e===t.name)return t;return null}getNotes(){return[...this._notes]}hasNote(e){for(let t of this._notes)if(e===t.name)return!0;return!1}updateNote(e,t,i){for(let n of this._notes)e===n.name&&(i&&"object"==typeof n.content&&"object"==typeof t?n.content={...n.content,content:t}:n.content=t)}deleteNote(e){this._notes=this._notes.filter(t=>t.name!==e)}clearNotes(){this._notes=[]}_delayRenderAll(){this.drawingLayerId?._delayRenderAll()}_setSelected(e){this._bSelected=e,this._delayRenderAll()}on(e,t){(this._dceEventListeners[e]??=new Set).add(t)}off(e,t){this._dceEventListeners[e]?.delete(t)}},ut=class extends dt{line;constructor(e,t){super(),this.mediaType=_t.DIMT_LINE,this.line=e,this.drawingStyleId=t}getLine(){return this.line}setLine(e){this.line=e,this._delayRenderAll()}},ht=class extends dt{quad;constructor(e,t){super(),this.mediaType=_t.DIMT_QUADRILATERAL,this.quad=e,this.drawingStyleId=t}getQuad(){return this.quad}setQuad(e){this.quad=e,this._delayRenderAll()}},gt=class extends dt{rect;constructor(e,t){super(),this.mediaType=_t.DIMT_RECTANGLE,this.rect=e,this.drawingStyleId=t}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},mt=class extends dt{text;rect;constructor(e,t,i){super(),this.mediaType=_t.DIMT_TEXT,this.text=e,this.rect=t,this.drawingStyleId=i}getText(){return this.text}setText(e){this.text=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},pt=class extends dt{image;rect;maintainAspectRatio;constructor(e,t,i,n){super(),this.mediaType=_t.DIMT_IMAGE,e.bytes&&e.format&&(e=Je(e.bytes,e.width,e.height,e.format)),this.image=e,this.rect=t,this.maintainAspectRatio=i,this.drawingStyleId=n}getImage(){return this.image}setImage(e){this.image=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}};const ft=function(e,t){if(this.disposed)return;this.clearAllInnerDrawingItems();const i=e?.items;if(!i?.length)return;const n=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),s=n.x,r=n.y;for(let e of i){let i,n,a;switch(e.type){case 2:i=this.getDrawingLayer(2),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isBarcodeVerifyOpen&&!e.verified&&(a=ot.STYLE_ORANGE_STROKE_TRANSPARENT);break;case 4:i=this.getDrawingLayer(3),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isLabelVerifyOpen&&!e.verified&&(a=ot.STYLE_GREEN_STROKE_TRANSPARENT);break;case 8:i=this.getDrawingLayer(1),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isDetectVerifyOpen&&1!==e.crossVerificationStatus&&(a=ot.STYLE_BLUE_STROKE_TRANSPARENT);break;case 16:i=this.getDrawingLayer(1),n=e.sourceLocation.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isNormalizeVerifyOpen&&1!==e.crossVerificationStatus&&(a=ot.STYLE_BLUE_STROKE_TRANSPARENT);break;default:continue}i.addDrawingItems([new ht({points:n})],a)}};var _t,Et,yt,Rt;!function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(_t||(_t={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(Et||(Et={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(yt||(yt={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(Rt||(Rt={}));let It=function(){let e=this,t=1e5,i=function(e,t,i){return new Promise(function(n){if(e.toBlob)e.toBlob(function(e){n(e)},t,i);else{let s=e.toDataURL(t,i),r=wt.convertBase64ToBlob(s.substring(s.indexOf(",")+1),t);n(r)}})},n=It._doCallbackNoBreak,s=Pe(['<div style="width:100%;height:100%;border:1px solid #ccc;">','<div class="kPainterBox">','<div class="kPainterImgsDiv">','<canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas>',"</div",'><div class="kPainterCroper" style="width:50px;height:50px;display:none;">','<div class="kPainterCells">',"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","</div",'><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div','><div class="kPainterEdges">','<div data-orient="-1,0"></div','><div data-orient="0,-1"></div','><div data-orient="1,0"></div','><div data-orient="0,1"></div>',"</div",'><div class="kPainterCorners">','<div data-orient="-1,-1"><i></i></div','><div data-orient="1,-1"><i></i></div','><div data-orient="1,1"><i></i></div','><div data-orient="-1,1"><i></i></div>',"</div",'><div class="kPainterMover" data-orient="0,0">',"<div></div>",'<svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg>',"</div>","</div",'><div class="kPainterPerspect" style="display:none;">','<canvas class="kPainterPerspectCvs"></canvas','><div class="kPainterPerspectCorner" data-index="0"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="1"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="2"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="3"><canvas style="display:none"></div>',"</div",'><div class="kPainterGesturePanel"></div>',"</div>","</div>"].join("")),r=s.firstChild,a=r.querySelector(".kPainterImgsDiv > .kPainterCanvas");e.getHtmlElement=function(){return s};let o=-1,l=[],c=null,d=null,u=!1,h="view";e.getCurIndex=function(){return o},e.getCount=function(){return l.length},e.isEditing=function(){return u},e.getMode=function(){return h},e.getImage=function(e,t){if(null==t&&(t=o),isNaN(t))return;if((t=Math.round(t))<0||t>=l.length)return;let i;return e?i=l[t]:(i=document.createElement("img"),i.src=l[t].src,i.setAttribute("style","")),i},e.onStartLoading=null,e.onFinishLoading=null;let g=function(){n(e.onStartLoading)},m=function(){n(e.onFinishLoading)},p=new function(){let s=this,a=new Mt,c=e.addImage=function(e){return new Promise(function(t,i){if(u)return i(Error("`addImage(imgData)`: The function is only valid in `view` mode."));if(e instanceof Blob);else if(e instanceof HTMLCanvasElement);else if("string"==typeof e||e instanceof String);else if(!(e instanceof HTMLImageElement)){if(e instanceof Array||e instanceof FileList){let n=[],s=!1;for(let r=0;r<e.length;++r)c(e[r]).then(function(i){n.push(i),s=!0,n.length==e.length&&t(n)},function(r){n.push(r),n.length==e.length&&(s?t(n):(Error("`addImage(imgData)`: No img added in this array. Get more info in `<this error object>.addImgErrArr`.").addImgErrArr=n,i(Error("`addImage(imgData)`: No img added in this array."))))});return}return i(Error("`addImage(imgData)`: Type of `imgData` should be `Blob`, `HTMLCanvasElement`, `HTMLImageElement`, `String(url)`, `Array(a array of source)`, `FileList`."))}g(),a.push(d,null,[e,function(e){"string"!=typeof e?t(e):i(Error("`addImage(imgData)`: "+e)),a.next(),a.isWorking||m()}])})},d=function(e,t){h(e,function(e,i){e instanceof Blob?n(function(){_(e,i,t)}):t(e)})},h=s.getBlobAndFormatFromAnyImgData=function(e,t){let n=function(e){t(e,"image/png")};if(e instanceof Blob)n(e);else if(e instanceof HTMLCanvasElement)i(e).then(n);else if("string"==typeof e||e instanceof String){let i=e;if("data:"==i.substring(0,5)){let e="";"image/"==i.substring(5,11)&&(e=i.substring(5,i.indexOf(";",11)));let t=wt.convertBase64ToBlob(i.substring(i.indexOf("base64,")+7),e);n(t)}else wt.convertURLToBlob(i,function(e){e?n(e):t("Network error.")})}else if(e instanceof HTMLImageElement){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)return void t("Cors error.");let s=e.src;h(s,function(r,a){if(r instanceof Blob)t(r,a);else{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0);let r,a="",o=s.lastIndexOf("?"),l=-1;-1!=o?(l=s.lastIndexOf(".",o),-1!=l&&o-l<=5&&(a=s.substring(l+1,o))):(l=s.lastIndexOf("."),-1!=l&&(a=s.length-l<=5?s.substring(l+1):s.substring(l+1,l+5))),r=-1!=a.indexOf("webp")?"image/webp":-1!=a.indexOf("png")||-1!=a.indexOf("gif")||-1!=a.indexOf("svg")?"image/png":"image/jpeg",i(t,r).then(n)}})}else t("Type of `imgData` not support.")};e.addedImageMaxWH=4096,e.isShowNewImgWhenAdd=!0;let p,_=function(t,n,s){let a=new Image;a.kPainterOriBlob=a.kPainterBlob=t,a.kPainterSaveFormat=n;let c=URL.createObjectURL(a.kPainterBlob);a.onload=a.onerror=function(){if(e._noAnyUseButForIosSafariBug0=a.naturalWidth,e._noAnyUseButForIosSafariBug1=a.naturalHeight,a.kPainterWidth=a.naturalWidth,a.kPainterHeight=a.naturalHeight,a.kPainterOriWidth=a.kPainterWidth,a.kPainterOriHeight=a.kPainterHeight,a.kPainterWidth>e.addedImageMaxWH||a.kPainterHeight>e.addedImageMaxWH)i(function(e,t,i){t=t||new wt.Matrix(1,0,0,1,0,0);let n=document.createElement("canvas"),s=!1;0!=t.a*t.d&&0==t.b*t.c?(n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height):(s=!0,n.width=e.naturalHeight||e.height,n.height=e.naturalWidth||e.width);let r=1;(n.width>i||n.height>i)&&(r=i/Math.max(n.width,n.height),n.width=Math.min(n.width*r),n.height=Math.min(n.height*r));let a=n.getContext("2d");return a.setTransform(t.a,t.b,t.c,t.d,t.e*n.width,t.f*n.height),s?a.drawImage(e,0,0,n.height,n.width):a.drawImage(e,0,0,n.width,n.height),n}(a,null,e.addedImageMaxWH),n).then(function(e){URL.revokeObjectURL(c),a.kPainterOriBlob=a.kPainterBlob=e,c=URL.createObjectURL(a.kPainterBlob),a.src=c});else{a.onload=a.onerror=null,r.querySelector(".kPainterImgsDiv").append(a),(e.isShowNewImgWhenAdd||-1==o)&&I(l.length-1);try{!function(){for(let e=0;e<d.length;++e){let t=d[e].cvs,i=d[e].mwh,n=Math.min(i/a.naturalWidth,i/a.naturalHeight,1);t.width=Math.round(a.naturalWidth*n),t.height=Math.round(a.naturalHeight*n),t.getContext("2d").drawImage(a,0,0,t.width,t.height)}}()}catch(e){setTimeout(function(){throw e},0)}s&&s(l.length-1)}};let d=[];try{!function(){for(let e=0;e<v.length;++e){let t=v[e],i=t.kPainterFunWrap,n=document.createElement("canvas");n.className="kPainterThumbnailCanvas",d.push({cvs:n,mwh:t.kPainterMaxWH});let s=null;try{s=i?i(n):n}catch(e){setTimeout(function(){throw e},0);break}s&&(s.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(s),t.appendChild(s))}}()}catch(e){setTimeout(function(){throw e},0)}a.style.display="none",l.push(a),a.src=c},E=function(){let i=l[o],s=r;Tt(s);let a=Ct(s),c=i.kPainterZoom=Math.min(a.width/i.kPainterWidth,a.height/i.kPainterHeight);if(i.style.width=(Math.round(i.kPainterWidth*c)||1)+"px",i.style.height=(Math.round(i.kPainterHeight*c)||1)+"px",i.style.left=i.style.right=i.style.top=i.style.bottom="-100000px",l.length>=2){let e=l[(l.length+o-1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.right=t+"px",e.style.left=e.style.top=e.style.bottom="-100000px"}if(l.length>=3){let e=l[(l.length+o+1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.left=t+"px",e.style.right=e.style.top=e.style.bottom="-100000px"}n(e.onUpdateImgPosZoom)},y=null,R=null;e.updateUIOnResize=function(t){if(null!=y&&(clearTimeout(y),y=null,R()),t)return new Promise(function(t,i){p=u,y=setTimeout(function(){if(-1==o)y=null,t();else if(p!=u)y=null,t();else{if(u){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();y=null,t()}},500),R=i});if(-1!=o){if(u){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();return!0}return!1};let I=s.showImg=function(t){let i=l[t];i.parentElement.childNodes.forEach(function(e){e.style.display="none"}),o=t,i.style.display="",l.length>=2&&(t>0||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t-1)%l.length].style.display=""),l.length>=3&&(t<l.length-1||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t+1)%l.length].style.display=""),E(),w()};e.onNumChange=null;let w=function(){let t,i;return function(){t==o&&i==l.length||(t=o,i=l.length,n(e.onNumChange,[o,l.length]))}}();e.changePage=function(e){if(u)return!1;let t;switch(e){case"f":t=0;break;case"p":t=o-1;break;case"n":t=o+1;break;case"l":t=l.length-1;break;default:if(arguments.length<1||isNaN(e))return!1;t=Math.round(e)}return!(t<0||t>=l.length||t==o||(I(t),0))},e.movePage=function(){if(u)return!1;let e,t;if(1==arguments.length?t=arguments[0]:arguments.length>=2&&(e=arguments[0],t=arguments[1]),null==e&&(e=o),isNaN(t))return!1;if(t=Math.round(t),t<0||t>l.length)return!1;if(isNaN(e))return!1;if(e=Math.round(e),e<0||e>=l.length)return!1;if(e==t)return!0;let i=l.splice(e,1)[0];t>e?l.splice(t-1,0,i):l.splice(t,0,i),e==o?o=t>e?t-1:t:e<o&&t>o?--o:e>o&&t<o&&++o,w();try{for(let i=0;i<v.length;++i){let n=v[i],s=n.kPainterThumbBoxArr[e];n.kPainterThumbBoxArr.length==t?n.append(s):n.kPainterThumbBoxArr[t].before(s),n.kPainterThumbBoxArr.splice(e,1),t>e?n.kPainterThumbBoxArr.splice(t-1,0,s):n.kPainterThumbBoxArr.splice(t,0,s)}}catch(e){setTimeout(function(){throw e},0)}return!0},e.del=function(e){if(u)return!1;if(arguments.length<1&&(e=o),isNaN(e))return!1;if((e=Math.round(e))<0||e>=l.length)return!1;URL.revokeObjectURL(l[e].src),l[e].remove(),l.splice(e,1);try{for(let t=0;t<v.length;++t){let i=v[t];i.kPainterThumbBoxArr[e].remove(),i.kPainterThumbBoxArr.splice(e,1)}}catch(e){setTimeout(function(){throw e},0)}return e<o?(--o,w()):e==o?(o==l.length&&--o,o>=0?I(o):w()):w(),!0},e.getWidth=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterWidth},e.getHeight=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterHeight},e.getBlob=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?null:l[e].kPainterBlob};let v=s.thumbnailBoxArr=[];e.bindThumbnailBox=function(t,i,n){if(u)return!1;if(!(t instanceof HTMLElement))return!1;e.unbindThumbnailBox(t),t.innerHTML="",t.kPainterFunWrap=i,t.kPainterMaxWH=n||256,t.kPainterThumbBoxArr=[];for(let n=0;n<l.length;++n){let s=l[n];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r=Math.min(t.kPainterMaxWH/s.naturalWidth,t.kPainterMaxWH/s.naturalHeight,1),a=document.createElement("canvas");a.width=Math.round(s.naturalWidth*r),a.height=Math.round(s.naturalHeight*r),a.getContext("2d").drawImage(s,0,0,a.width,a.height),a.className="kPainterThumbnailCanvas";let o=null;try{o=i?i(a):a}catch(e){return setTimeout(function(){throw e},0),!1}o&&(o.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(o),t.appendChild(o))}return v.push(t),!0},e.unbindThumbnailBox=function(e){if(u)return!1;if(e){for(let t=0;t<v.length;++t)if(v[t]==e)return e.innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0,v.splice(t,1),!0;return!1}for(let t=0;t<v.length;++t)(e=v[t]).innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0;return v.length=0,!0}},f=new function(){let i,s,h,g,m,f=Number.NEGATIVE_INFINITY;e.leftDoubleClickZoomRate=2,e.rightDoubleClickZoomRate=.5;let _,y,R,I,w,v,T,C,S,D,M,A,b,O,L,N,P,x,k=function(t){if(-1==o)return;let n,a=t.targetTouches;if(a){if(a.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";a=[{pageX:t.clientX,pageY:t.clientY}],n=t.buttons}if(1==a.length){_=s=a[0].pageX,y=h=a[0].pageY,F();let t=f;f=(new Date).getTime();let o=i;if(i=n||(Math.abs(N-P)/P<.01?1:2),f-t<1e3&&i==o&&(1==i||2==i)&&Math.abs(a[0].pageX-g)<8&&Math.abs(a[0].pageY-m)<8){f=Number.NEGATIVE_INFINITY;let t=_,n=y,s=N,r=1==i?e.leftDoubleClickZoomRate:e.rightDoubleClickZoomRate;N*=r,N>4&&(N=4,r=4/s),N<P&&(N=P,r=P/s);let a=O+C.pageX0+C.width/2,o=L+C.pageY0+C.height/2;O-=(r-1)*(t-a),L-=(r-1)*(n-o),V()}if(null!=c)return;c="posZoom",r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),x=a[0].identifier}else if(2==a.length){if(_=s=a[0].pageX,y=h=a[0].pageY,null==c&&(c="posZoom"),"posZoom"!=c)return;F(),r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),w=a[1].pageX,v=a[1].pageY,R=(_+w)/2,I=(y+v)/2,T=Math.sqrt(Math.pow(_-w,2)+Math.pow(y-v,2))}else 0==a.length&&(g=_,m=y,B())};e.allowedTouchMoveSwitchImgOverBoundary=!0;let B=function(){if(-1!=o&&"posZoom"==c){if(d=null,c=null,r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="1"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="1"),!u&&1!=l.length){let t,i,n=!1;if(N/P<1.2&&(n=!0,t=Math.sqrt(Math.pow(_-s,2)+Math.pow(y-h,2)),i=t/(((new Date).getTime()-f)/1e3)),O<-(Math.round(A*N)||1)/2||n&&t<-50&&i<-200){if(o+1<l.length||e.allowedTouchMoveSwitchImgOverBoundary)return void p.showImg((l.length+o+1)%l.length)}else if((O>(Math.round(A*N)||1)/2||n&&t>50&&i>200)&&(o-1>=0||e.allowedTouchMoveSwitchImgOverBoundary))return void p.showImg((l.length+o-1)%l.length)}V(),U()}},F=function(e){let i=r;if(u?(D=a,A=D.width,b=D.height):(D=l[o],A=D.kPainterWidth,b=D.kPainterHeight),O=parseFloat(D.style.left)+t,L=parseFloat(D.style.top)+t,M=St(D),0!=M.a*M.d&&0==M.b*M.c);else{let e=A;A=b,b=e}if(N=D.kPainterZoom||1,C=Tt(i),S=Ct(i),P=Math.min(S.width/A,S.height/b),u&&E.isCropRectShowing&&!e){let e=E.getNeededRect();P=Math.max(Math.max(e.width,A*P)/A,Math.max(e.height,b*P)/b)}};e.onUpdateImgPosZoom=null;let U=function(){if(D.style.left=O-t+"px",D.style.right=-O-t+"px",D.style.top=L-t+"px",D.style.bottom=-L-t+"px",D.kPainterZoom=N,0!=M.a*M.d&&0==M.b*M.c?(D.style.width=(Math.round(A*N)||1)+"px",D.style.height=(Math.round(b*N)||1)+"px"):(D.style.height=(Math.round(A*N)||1)+"px",D.style.width=(Math.round(b*N)||1)+"px"),!u&&1!=l.length){let e=Math.max(0,((Math.round(A*N)||1)-C.width)/2);if(l.length>2||O>e){let t=l[(l.length+o-1)%l.length];t.style.left=O-e-C.width+"px",t.style.right=-O+e+C.width+"px"}if(l.length>2||O<=-e){let t=l[(l.length+o+1)%l.length];t.style.left=O+e+C.width+"px",t.style.right=-O-e-C.width+"px"}}n(e.onUpdateImgPosZoom)},V=function(e,t){if(N>4&&(N=4),N<P&&(N=P),!e){let e=Math.round(A*N)||1;if(S.width>e)O=0;else{let t=(e-S.width)/2;O<-t?O=-t:O>t&&(O=t)}}{let e=Math.round(b*N)||1;if(S.height>e)L=0;else{let t=(e-S.height)/2;L<-t?L=-t:L>t&&(L=t)}}};e.getZoom=function(){if(0!=l.length)return F(),N},e.setZoom=function(e,t){return 0==l.length||(e=parseFloat(e))!=e?null:(F(),t?N*=e:N=e,V(),U(),N)},this.setImgStyleFit=function(){F(!0),N=P,V(),U(),e.setCropRectArea()},["touchstart","touchcancel","touchend","mousedown"].forEach(e=>r.addEventListener(e,k)),r.addEventListener("mouseup",function(e){"mouse"==d&&(g=e.clientX,m=e.clientY,B())}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&(g=_,m=y,B())}),r.addEventListener("contextmenu",function(e){e.preventDefault()}),["touchmove","mousemove"].forEach(e=>r.addEventListener(e,function(e){let t=e.targetTouches;if(t){if("touch"!=d)return}else{if("mouse"!=d)return;t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("posZoom"!=c||x!=t[0].identifier)return;let i=_,n=y;_=t[0].pageX,y=t[0].pageY,O+=_-i,L+=y-n,V(!u),U(),e.preventDefault()}else if(2==t.length){if("posZoom"!=c)return;let i=R,n=I,s=T,r=N;_=t[0].pageX,y=t[0].pageY,w=t[1].pageX,v=t[1].pageY,R=(_+w)/2,I=(y+v)/2,T=Math.sqrt(Math.pow(_-w,2)+Math.pow(y-v,2));let a=T/s;N*=a,N>4&&(N=4,a=4/r),N<P&&(N=P,a=P/r);let o=O+C.pageX0+C.width/2,l=L+C.pageY0+C.height/2;O-=(a-1)*(i-o),L-=(a-1)*(n-l),V(),U(),e.preventDefault()}}))},_=new function(){let t,n=this,s=[];e.stepImgsGCThreshold=10;let _=[],R=[];e.addProtectedStep=function(e){return!!u&&(e=parseInt(e))==e&&(-1!=R.indexOf(e)||(R.push(e),R.sort(function(e,t){return e-t})),!0)},e.removeProtectedStep=function(e){if(!u)return!1;if((e=parseInt(e))!=e)return!1;let t=R.indexOf(e);return-1!=t&&(R.splice(t,1),!0)},e.getProtectedSteps=function(){return u?R.concat():null};let I=n.pushStack=function(i){s.length=t+1;for(let e=_.length-1;e>0&&_[e].beginStep>t;--e)--_.length;let n;if(i.srcBlob){n={crop:{left:0,top:0,width:1,height:1},transform:new wt.Matrix(1,0,0,1,0,0),srcBlob:i.srcBlob,saveFormat:i.saveFormat};for(let t=0;_.length>=e.stepImgsGCThreshold;){if(R.filter(function(e){return _[t].beginStep<=e&&e<_[t].endStep}).length){if(++t<_.length)continue;break}{let e=_[t].beginStep,i=_[t].endStep;for(let t=e;t<i;++t)s[t]=null;_.splice(t,1)}}s.push(n),++t;let r={blob:n.srcBlob,beginStep:t,endStep:t+1};_.push(r)}else{let e,r=s[t],a=r.crop,c=i.transform,d=i.crop,u={};e=c||r.transform,u.left=a.left,u.top=a.top,u.width=a.width,u.height=a.height,0!=e.a*e.d&&0==e.b*e.c?(c&&(e=new wt.Matrix(Math.sign(c.a),0,0,Math.sign(c.d),0,0)),d&&(1==e.a?u.left+=d.left*a.width:u.left+=(1-d.left-d.width)*a.width,1==e.d?u.top+=d.top*a.height:u.top+=(1-d.top-d.height)*a.height,u.width*=d.width,u.height*=d.height)):(c&&(e=new wt.Matrix(0,Math.sign(c.b),Math.sign(c.c),0,0,0)),d&&(1==e.b?u.left+=d.top*a.width:u.left+=(1-d.top-d.height)*a.width,1==e.c?u.top+=d.left*a.height:u.top+=(1-d.left-d.width)*a.height,u.width*=d.height,u.height*=d.width));let h=l[o],g=Math.pow(10,Math.ceil(Math.max(h.kPainterWidth,h.kPainterHeight)).toString().length+2);u.left=Math.round(u.left*g)/g,u.top=Math.round(u.top*g)/g,u.width=Math.round(u.width*g)/g,u.height=Math.round(u.height*g)/g,n={crop:u,transform:e,srcBlob:r.srcBlob,saveFormat:r.saveFormat},s.push(n),++t,n.srcBlob&&(_[_.length-1].endStep=t+1)}};e.undo=function(){return new Promise(function(e,i){if(!u)return i(Error("`undo()`: The function is invalid in current mode."));if(t>0){let i=t-1;for(;null==s[i];)--i;v(t,i,function(){return e()})}})},e.redo=function(){return new Promise(function(e,i){if(!u)return i(Error("`undo()`: The function is invalid in current mode."));if(t<s.length-1){let i=t+1;for(;null==s[i];)++i;v(t,i,function(){return e()})}})},e.getStepCount=function(){return u?s.length:NaN},e.getCurStep=function(){return u?t:NaN},e.setCurStep=function(e){return new Promise(function(i,n){return arguments.length<1||isNaN(e)||(e=Math.round(e))<0||e>=s.length||null==s[e]?n(Error("`setCurStep(index)`: The parameter `index` is invalid.")):void v(t,e,function(){return i()})})},n.needAlwaysTrueTransform=!1;let w,v=function(e,i,r){t=i;let o=s[e].crop,l=s[t].crop;o.left==l.left&&o.top==l.top&&o.width==l.width&&o.bottom==l.bottom&&s[e].srcBlob==s[t].srcBlob?(Dt(a,s[t].transform.dot(s[e].transform.inversion()).dot(St(a))),f.setImgStyleFit(),r&&r()):T(n.needAlwaysTrueTransform,!1,r)};!function(){let e=window.devicePixelRatio||1,t=screen.width,i=screen.height;w=Math.min(t,i)*e}();let T=n.updateCvsAsync=function(e,i,n){a.style.display="none";let r=s[t],c=r.srcBlob||l[o].kPainterOriBlob,d=function(){let t=URL.createObjectURL(c),s=new Image;s.onload=s.onerror=function(){s.onload=s.onerror=null,C(s,r,e,i),URL.revokeObjectURL(t),n&&n()},s.src=t};window.createImageBitmap?createImageBitmap(c).then(function(t){C(t,r,e,i),n&&n()}).catch(function(){d()}):d()},C=function(t,i,n,s){e._noAnyUseButForIosSafariBug0=t.naturalWidth,e._noAnyUseButForIosSafariBug1=t.naturalHeight;let r=t.naturalWidth||t.width,o=t.naturalHeight||t.height,l=i.crop,c=i.transform,d=a.getContext("2d"),u=a.fullQualityWidth=Math.round(r*l.width)||1,h=a.fullQualityHeight=Math.round(o*l.height)||1,g=!1;if(0!=c.a*c.d&&0==c.b*c.c?(a.fullQualityWidth=u,a.fullQualityHeight=h):(a.fullQualityWidth=h,a.fullQualityHeight=u,n&&(g=!0)),a.hasCompressed=!1,n){let e,t;g?(e=h,t=u):(e=u,t=h),a.width=e,a.height=t;let i=e/2*(1-c.a-c.c),n=t/2*(1-c.b-c.d);d.setTransform(c.a,c.b,c.c,c.d,i,n)}else if(u>w||h>w){let e=w/Math.max(u,h);a.width=Math.round(u*e)||1,a.height=Math.round(h*e)||1,a.hasCompressed=!0}else a.width=u,a.height=h;let m,p,_=Math.round(r*l.left),E=Math.round(o*l.top);if(_==r&&--_,E==o&&--E,g?(m=a.height,p=a.width):(m=a.width,p=a.height),u/m<=2)d.drawImage(t,_,E,u,h,0,0,m,p);else{let e=document.createElement("canvas");e.width=Math.round(u/2),e.height=Math.round(h/2);let i,n,s=e.getContext("2d"),r=Math.round(u/2),a=Math.round(h/2);for(s.drawImage(t,_,E,u,h,0,0,r,a);i=r,n=a,r=Math.round(i/2),a=Math.round(n/2),!(r<=m||a<=p);)s.drawImage(e,0,0,i,n,0,0,r,a);d.drawImage(e,0,0,i,n,0,0,m,p)}Dt(a,n?new wt.Matrix(1,0,0,1,0,0):c),s||(f.setImgStyleFit(),a.style.display="")};e.enterEdit=function(){return new Promise(function(i,n){if(u)return n(Error("`enterEdit()`: The function is invalid in current mode."));if(-1==o)return n(Error("`enterEdit()`: There is no image in the instance."));h="",g(),u=!0;let r=l[o].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new wt.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};var p;s.push(r),t=0,p=function(){return m(),d=null,c=null,h="basicEdit",i()},a.parentElement.childNodes.forEach(function(e){e!==a&&(e.style.display="none")}),T(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),p()})})};let S=e.cancelEdit=function(){return!!u&&(u=!1,s.length=0,_.length=0,p.showImg(o),a.style.display="none",E.hideCropRect(),y.hideFreeTransformBorderDirectly(),d=null,c=null,h="view",!0)},D=!1;e.saveEdit=function(n){return new Promise(function(f,_){if(!u||D)return _(Error("`saveEdit(isCover)`: The function is invalid in current mode."));h="",D=!0,g(),setTimeout(function(){!function(e,n){let c=s[t].crop,d=s[t].transform,u=s[0].crop,h=s[0].transform,g=l[o];if(s[t].srcBlob||h.a!=d.a||h.b!=d.b||h.c!=d.c||h.d!=d.d||Math.round(g.kPainterOriWidth*c.left)!=Math.round(g.kPainterOriWidth*u.left)||Math.round(g.kPainterOriHeight*c.top)!=Math.round(g.kPainterOriHeight*u.top)||Math.round(g.kPainterOriWidth*(c.left+c.width))!=Math.round(g.kPainterOriWidth*(u.left+u.width))||Math.round(g.kPainterOriHeight*(c.top+c.height))!=Math.round(g.kPainterOriHeight*(u.top+u.height))){URL.revokeObjectURL(g.src);let c=new Image,u=function(){c.onload=c.onerror=function(){c.onload=c.onerror=null,n?(l[o].remove(),l.splice(o,1,c)):l.splice(++o,0,c),r.querySelector(".kPainterImgsDiv").append(c),e()},i(a,s[t].saveFormat||g.kPainterSaveFormat).then(function(e){c.kPainterBlob=e,c.kPainterWidth=a.width,c.kPainterHeight=a.height,s[t].srcBlob?(c.kPainterOriBlob=e,c.kPainterOriWidth=a.width,c.kPainterOriHeight=a.height,c.kPainterSaveFormat=s[t].saveFormat):(c.kPainterOriBlob=g.kPainterOriBlob,c.kPainterOriWidth=g.kPainterOriWidth,c.kPainterOriHeight=g.kPainterOriHeight,c.kPainterProcess=s[t],c.kPainterSaveFormat=g.kPainterSaveFormat);let i=URL.createObjectURL(e);c.src=i})};a.hasCompressed||1!=d.a||0!=d.b||0!=d.c||1!=d.d||0!=d.e||0!=d.f?(a.style.display="none",T(!0,!0,u)):u()}else e()}(function(){S(),m(),D=!1,d=null,c=null;try{!function(){for(let t=0;t<p.thumbnailBoxArr.length;++t){let i=p.thumbnailBoxArr[t],s=l[o];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r,a=Math.min(i.kPainterMaxWH/s.naturalWidth,i.kPainterMaxWH/s.naturalHeight,1);if(n){let e=i.kPainterThumbBoxArr[o];r=e.classList.contains("kPainterThumbnailCanvas")?e:e.querySelector(".kPainterThumbnailCanvas")}else r=document.createElement("canvas"),r.className="kPainterThumbnailCanvas";if(r.width=Math.round(s.naturalWidth*a),r.height=Math.round(s.naturalHeight*a),r.getContext("2d").drawImage(s,0,0,r.width,r.height),!n){let e=i.kPainterFunWrap,t=null;try{t=e?e(r):r}catch(e){return setTimeout(function(){throw e},0),!1}t&&(t.getKPainterIndex=function(){return i.kPainterThumbBoxArr.indexOf(this)},i.kPainterThumbBoxArr.splice(o,0,t),i.kPainterThumbBoxArr[o-1].after(t))}}}()}catch(e){setTimeout(function(){throw e},0)}return h="view",f()},n)},100)})},e.rotateRight=function(){if(!u)return!1;let e=St(a),t=wt.Matrix.dot(new wt.Matrix(0,1,-1,0,0,0),e);Dt(a,t),I({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.rotateLeft=function(){if(!u)return!1;let e=St(a),t=wt.Matrix.dot(new wt.Matrix(0,-1,1,0,0,0),e);Dt(a,t),I({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.mirror=function(){if(!u)return!1;let e=St(a),t=wt.Matrix.dot(new wt.Matrix(-1,0,0,1,0,0),e);return Dt(a,t),I({transform:t}),f.setImgStyleFit(),!0},e.flip=function(){if(!u)return!1;let e=St(a),t=wt.Matrix.dot(new wt.Matrix(1,0,0,-1,0,0),e);return Dt(a,t),I({transform:t}),f.setImgStyleFit(),!0},e.resize=function(e,t){return new Promise(function(s,r){return u?(e=parseInt(e),t=parseInt(t),e!=e||e<1?r(Error("`resize`: The parameter `newWidth` is invaild.")):t!=t||t<1?r(Error("`resize`: The parameter `newHeight` is invaild.")):(g(),void n.updateCvsAsync(!0,!0,function(){n.needAlwaysTrueTransform=!0;let r=e,o=t;for(;2*r<a.width;)r*=2;for(;2*o<a.height;)o*=2;let l,c=a;for(;;){l=document.createElement("canvas"),l.width=r,l.height=o,l.getContext("2d").drawImage(c,0,0,r,o);let i=!1;if(e!=r&&(r/=2,i=!0),t!=o&&(o/=2,i=!0),!i)break}i(l).then(function(e){n.pushStack({srcBlob:e,saveFormat:"image/jpeg"}),n.updateCvs(!1,!1,function(){return n.needAlwaysTrueTransform=!1,m(),s()})})}))):r(Error("`resize`: The function is invaild in this mode."))})},e.getEditWidth=function(){return u?a.fullQualityWidth:NaN},e.getEditHeight=function(){return u?a.fullQualityHeight:NaN}},E=new function(){let i=this;e.isAutoShowCropUI=!0;let s,o,l,h,g,m,p,f,E,y,R,I,w,v,T,C,S,D,M,A,b=r.querySelector(".kPainterCroper");i.isCropRectShowing=!1,e.showCropRect=i.showCropRect=function(){u&&(i.isCropRectShowing=!0,k(),b.style.display="")},e.hideCropRect=i.hideCropRect=function(){i.isCropRectShowing=!1,b.style.display="none"},Object.assign(b.style,{"border-left-width":t+"px","border-top-width":t+"px","border-right-width":t+"px","border-bottom-width":t+"px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"}),e.setCropRectStyle=function(e){switch(parseInt(e)){case 0:return b.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display="none"),b.querySelectorAll(".kPainterMover").forEach(e=>e.style.display=""),!0;case 1:return b.querySelectorAll(".kPainterMover").forEach(e=>e.style.display="none"),b.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display=""),!0;default:return!1}},e.cropRectMinW=50,e.cropRectMinH=50;let O=function(e){e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if(null!=c)return;c="crop",l=t[0].identifier,s=t[0].pageX,o=t[0].pageY;let e=this.getAttribute("data-orient").split(",");h=e[0],g=e[1],N()}else 0==t.length&&L()},L=function(){"crop"==c&&(d=null,c=null)},N=function(){m=Ct(r),P(),T=parseFloat(b.style.width),C=parseFloat(b.style.height),w=parseFloat(b.style.left)-T/2+t,v=parseFloat(b.style.top)-C/2+t,S=Math.max(-m.width/2,p),D=Math.max(-m.height/2,f),M=Math.min(m.width/2,E),A=Math.min(m.height/2,y)},P=function(){let e=St(a),i=parseFloat(a.style.left)+t,n=parseFloat(a.style.top)+t;0!=e.a*e.d&&0==e.b*e.c?(R=parseFloat(a.style.width),I=parseFloat(a.style.height)):(R=parseFloat(a.style.height),I=parseFloat(a.style.width));let s=R/2,r=I/2;p=i-s,f=n-r,E=i+s,y=n+r};r.querySelectorAll(".kPainterCroper > .kPainterEdges > div, .kPainterCroper > .kPainterCorners > div, .kPainterCroper > .kPainterMover, .kPainterCroper > .kPainterBigMover").forEach(e=>{["touchstart","touchcancel","touchend","mousedown"].forEach(t=>e.addEventListener(t,O))}),r.addEventListener("mouseup",function(){"mouse"==d&&L()}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&L()}),e.onCropRectChange=null;let x=function(){b.style.left=w+T/2-t+"px",b.style.right=-w-T/2-t+"px",b.style.top=v+C/2-t+"px",b.style.bottom=-v-C/2-t+"px",b.style.width=T+"px",b.style.height=C+"px",n(e.onCropRectChange)};["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if("crop"!=c||l!=i[0].identifier)return;let n=s,r=o;s=i[0].pageX,o=i[0].pageY;let a=s-n,d=o-r;-1==h?(T-a<e.cropRectMinW&&(a=T-e.cropRectMinW),w+a<S&&(a=S-w),T-=a,w+=a):1==h&&(T+a<e.cropRectMinW&&(a=-T+e.cropRectMinW),w+T+a>M&&(a=M-T-w),T+=a),-1==g?(C-d<e.cropRectMinH&&(d=C-e.cropRectMinH),v+d<D&&(d=D-v),C-=d,v+=d):1==g&&(C+d<e.cropRectMinH&&(d=-C+e.cropRectMinH),v+C+d>A&&(d=A-C-v),C+=d),0==h&&0==g&&(w+a<S?a=S-w:w+T+a>M&&(a=M-T-w),v+d<D?d=D-v:v+C+d>A&&(d=A-C-v),w+=a,v+=d),x(),t.preventDefault()}}));let k=e.setCropRectArea=function(e,t,n,s){if(!i.isCropRectShowing)return!1;e>=-.5||(e=-.5),t>=-.5||(t=-.5),n<=.5||(n=.5),s<=.5||(s=.5),e>n&&(e=n=(e+n)/2),t>s&&(t=s=(t+s)/2),N(),w=p+(e+.5)*R,w<S&&(w=S),v=f+(t+.5)*I,v<D&&(v=D);let r=p+(n+.5)*R;r>M&&(r=M),T=r-w;let a=f+(s+.5)*I;return a>A&&(a=A),C=a-v,x(),!0},B=e.getCropRectArea=function(e){if(!i.isCropRectShowing)return null;!function(){let e,t=St(a);e=0!=t.a*t.d&&0==t.b*t.c?parseFloat(a.style.width):parseFloat(a.style.height),e!=R&&N()}();let t=(w-p)/R-.5,n=(v-f)/I-.5,s=t+T/R,r=n+C/I;return e&&(t=Math.round(t*a.fullQualityWidth*2)/2,n=Math.round(n*a.fullQualityHeight*2)/2,s=Math.round(s*a.fullQualityWidth*2)/2,r=Math.round(r*a.fullQualityHeight*2)/2),[t,n,s,r]};i.getNeededRect=function(){N();let e={};return e.width=2*Math.max(-w,w+T),e.height=2*Math.max(-v,v+C),e},e.crop=function(e){return new Promise(function(t,i){if(!u)return i(Error("crop([ltrb])`: The function is invalid in this mode."));if(N(),!(e=e||B()))return i(Error("crop([ltrb])`: No thing can be cropped."));let n=e[0],s=e[1],r=e[2],o=e[3];if((n+.5)*a.fullQualityWidth<.5&&(.5-r)*a.fullQualityWidth<=.5&&(s+.5)*a.fullQualityHeight<.5&&(.5-o)*a.fullQualityHeight<=.5)return t([n,s,r,o]);_.pushStack({crop:{left:n+.5,top:s+.5,width:r-n,height:o-s}}),_.updateCvsAsync(_.needAlwaysTrueTransform,!1,function(){return t([n,s,r,o])})})}},y=new function(){let t=this;!function(){let i=r.querySelector(".kPainterPerspect");t.hideFreeTransformBorderDirectly=function(){i.style.display="none"};let s=r.querySelector(".kPainterPerspect > .kPainterPerspectCvs");e.onFreeTransformCornerPosChange=null;let o=e.setFreeTransformCornerPos=function(e){if("freeTransform"!=h)return;let t=a.kPainterZoom,n=St(a),s=a.width*t,r=a.height*t;if(0==n.a*n.d||0!=n.b*n.c){let e=s;s=r,r=e}let o=a.width*t/2,l=a.height*t/2;for(let t=0;t<R.length;++t){let i=R[t],n=e[i.getAttribute("data-index")],a=s*n[0],c=r*n[1];a<-o?a=-o:a>o&&(a=o),c<-l?c=-l:c>l&&(c=l),i.style.left=a+"px",i.style.right=-a+"px",i.style.top=c+"px",i.style.bottom=-c+"px"}p(),i.style.display=""},l=e.getFreeTransformCornerPos=function(){let e=a.kPainterZoom,t=St(a),i=a.width*e,n=a.height*e;if(0==t.a*t.d||0!=t.b*t.c){let e=i;i=n,n=e}let s=[];for(let e=0;e<R.length;++e){let t=R[e];s.push([parseFloat(t.style.left)/i,parseFloat(t.style.top)/n])}return s},p=function(){let t=vt(r);s.width=Math.round(t.width),s.height=Math.round(t.height);let i=[];for(let e=0;e<R.length;++e)i.push([Math.round(parseFloat(R[e].style.left)+t.width/2),Math.round(parseFloat(R[e].style.top)+t.height/2)]);let a,o=s.getContext("2d"),l=Number.POSITIVE_INFINITY;for(let e=0;e<4;++e){let t=i[e][0]*i[e][0]+i[e][1]*i[e][1];t<l&&(l=t,a=e)}let c=[];for(let e=0;e<4;++e)c.push([i[(a+e)%4][0],i[(a+e)%4][1]]);o.fillStyle="rgba(0,0,0,0.3)",o.beginPath(),o.moveTo(0,0),o.lineTo(c[0][0],c[0][1]);let d=[];for(let e=0;e<4;++e)d.push((u=c[e][0],h=c[e][1],g=c[(e+1)%4][0],m=c[(e+1)%4][1],p=c[(e+2)%4][0],f=c[(e+2)%4][1],_=c[(e+3)%4][0],E=c[(e+3)%4][1],[Math.sign((m-h)*p+(u-g)*f+g*h-u*m),Math.sign((m-h)*_+(u-g)*E+g*h-u*m)]));var u,h,g,m,p,f,_,E;let y,I=function(e,t,i,n,s,r,a,o){let l=n-t,c=e-i,d=i*t-e*n,u=o-r,h=s-a,g=a*r-s*o,m=c*u-h*l;return[(d*h-g*c)/m,(g*l-d*u)/m]},w=function(){let e,t,i=c[1][0]-c[0][0];i&&(e=(c[1][1]-c[0][1])/i);let n=c[3][0]-c[0][0];return n&&(t=(c[3][1]-c[0][1])/n),i>0?!(n>0)||e<=t:0==i?!(n>0):!(n>=0)&&e<=t}();d[0][0]*d[0][1]<0?d[2][0]*d[2][1]<0&&(y=I(c[0][0],c[0][1],c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]),w?(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1]))):d[1][0]*d[1][1]<0&&d[3][0]*d[3][1]<0&&(y=I(c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1],c[0][0],c[0][1]),w?(o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1])):(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]))),y||(w?(o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]))),o.lineTo(c[0][0],c[0][1]),o.lineTo(0,0),o.lineTo(0,s.height),o.lineTo(s.width,s.height),o.lineTo(s.width,0),o.lineTo(0,0),o.fill(),n(e.onFreeTransformCornerPosChange)};e.isShowMagnifier=!0,e.magnifierZoom=2;let f=function(){if(!e.isShowMagnifier)return;const t=v.querySelector("canvas");100!=t.width&&(t.width=100),100!=t.height&&(t.height=100);const i=t.getContext("2d"),n=parseInt(v.getAttribute("data-index")),[s,r]=l()[n],o=e.magnifierZoom;i.fillStyle="#aaa",i.strokeStyle="#0f0",i.lineWidth=1;let c=a.width*(.5+s)-50/o,d=a.height*(.5+r)-50/o,u=100/o,h=100/o,g=0,m=0,p=100,f=100;{const e=p/u,t=f/h;if(c<0){const t=-c*e;g+=t,p-=t,u+=c,c=0}if(d<0){const e=-d*t;m+=e,f-=e,h+=d,d=0}if(c+u>a.width){const t=c+u-a.width;p-=t*e,u-=t}if(d+h>a.height){const e=d+h-a.height;f-=e*t,h-=e}}i.fillRect(0,0,t.width,t.height),i.drawImage(a,c,d,u,h,g,m,p,f),i.beginPath(),i.moveTo(40,50),i.lineTo(60,50),i.moveTo(50,40),i.lineTo(50,60),i.closePath(),i.stroke();for(let e of T)e!==t&&"none"!==e.style.display&&(e.style.display="none");"none"===t.style.display&&(t.style.display="")},y=function(){e.isShowMagnifier&&T.forEach(e=>{"none"!==e.style.display&&(e.style.display="none")})},R=[...r.querySelectorAll(".kPainterPerspect > .kPainterPerspectCorner")];R.forEach(e=>{e.style.left="0"}),R.forEach(e=>{e.style.top="0"}),R.forEach(e=>{e.style.right="0"}),R.forEach(e=>{e.style.bottom="0"});let I,w,v,T=R.map(e=>e.querySelector("canvas")),C=null,S=function(t){let i,n=a.kPainterZoom,s=a.width*n/2,r=a.height*n/2,o=!1;i=t?R:[v];for(let e=0;e<i.length;++e){let t=i[e],n=parseFloat(t.style.left),a=parseFloat(t.style.top),l=!0,c=!0;n<-s?n=-s:n>s?n=s:l=!1,a<-r?a=-r:a>r?a=r:c=!1,l&&(t.style.left=n+"px",t.style.right=-n+"px"),c&&(t.style.top=a+"px",t.style.bottom=-a+"px"),(l||c)&&(o=!0)}if(o&&p(),e._dceGetQuads){let t,i=e._dceSelectedItemIdxs,n=a.width,s=a.height;t=i.size?[...i.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x<0?t.x=0:t.x>n&&(t.x=n),t.y<0?t.y=0:t.y>s&&(t.y=s);e.setQuad(e.quad)}}};["touchstart","touchcancel","touchend","mousedown"].forEach(e=>R.forEach(t=>t.addEventListener(e,function(e){v=this,e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("perspect"!=c)return;c="perspectCornerMoving",S(),f(),C=t[0].identifier,I=t[0].pageX,w=t[0].pageY}else 0==t.length&&"perspectCornerMoving"==c&&(S(),y(),d=null,c="perspect")}))),["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if(C!=i[0].identifier)return;if("perspectCornerMoving"!=c&&"perspectQuadMoving"!=c)return;let n=I,s=w;I=i[0].pageX,w=i[0].pageY;let r=I-n,o=w-s;if("perspectCornerMoving"===c){let t=parseFloat(v.style.left)+r,i=parseFloat(v.style.top)+o;if(v.style.left=t+"px",v.style.right=-t+"px",v.style.top=i+"px",v.style.bottom=-i+"px",e._dceGetQuads){let t=a.kPainterZoom,i=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(i){let e=parseInt(v.getAttribute("data-index")),n=i.quad.points[e];n.x+=r/t,n.y+=o/t,i.setQuad(i.quad)}}p(),f()}else if("perspectQuadMoving"===c){for(let e=0;e<R.length;++e){let t=R[e],i=parseFloat(t.style.left)+r,n=parseFloat(t.style.top)+o;t.style.left=i+"px",t.style.right=-i+"px",t.style.top=n+"px",t.style.bottom=-n+"px"}if(e._dceGetQuads){let t,i=a.kPainterZoom,n=e._dceSelectedItemIdxs;t=n.size?[...n.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x+=r/i,t.y+=o/i;e.setQuad(e.quad)}}p()}t.preventDefault()}})),["touchstart","touchcancel","touchend","mousedown"].forEach(t=>r.addEventListener(t,function(t){let n=t.targetTouches;if(n){if(n.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";n=[{pageX:t.clientX,pageY:t.clientY}]}if(1==n.length){if("perspect"!=c)return;let s=Ct(i),r=(s.pageX0+s.pageX1)/2,o=(s.pageY0+s.pageY1)/2,d=a.kPainterZoom,u=a.width*d,h=a.height*d,g=(n[0].pageX-r)/u,m=(n[0].pageY-o)/h;if(e._dceGetQuads){(t.shiftKey||t.ctrlKey)&&(e._dceThisClickShouldKeepMultiSelect=!0);const i=e._dceGetQuads(),n=e._dceSelectedItemIdxs;let s=!1;for(let r=i.length-1;r>=0;--r){let a=i[r].quad.points,o=e.getWidth(),l=e.getHeight(),c=a.map(({x:e,y:t})=>[e/o-.5,t/l-.5]);if(ct([g,m],c)){t.shiftKey||t.ctrlKey?(n.add(e._dceSelectedItemIdx),i[e._dceSelectedItemIdx]?._setSelected(!0),n.add(r),i[r]?._setSelected(!0)):n.has(r)&&(e._dceThisClickShouldKeepMultiSelect=!0),e._dceSelectedItemIdx=r,e.setFreeTransformCornerPos(c),s=!0,i[r]._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});break}}if(!s)return}else if(!ct([g,m],l()))return;c="perspectQuadMoving",C=n[0].identifier,I=n[0].pageX,w=n[0].pageY,t.preventDefault()}else 0==n.length&&"perspectQuadMoving"==c&&(S(!0),d=null,c="perspect")})),["mouseup","mouseleave"].forEach(t=>r.addEventListener(t,function(t){if("mouse"==d){if(e._dceGetQuads){if("perspectQuadMoving"==c&&!e._dceThisClickShouldKeepMultiSelect||"perspect"==c){const t=e._dceGetQuads();for(let i of e._dceSelectedItemIdxs)t[i]?._setSelected(!1);e._dceSelectedItemIdxs.clear()}e._dceThisClickShouldKeepMultiSelect=!1}if("perspectCornerMoving"==c)S(),y(),d=null,c="perspect";else if("perspectQuadMoving"==c){if(e._dceGetQuads){const i=e._dceGetQuads();i[e._dceSelectedItemIdx]?._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}S(!0),d=null,c="perspect"}}})),e.enterFreeTransformMode=function(){return new Promise(function(e,t){if(!u)return t(Error("`enterFreeTransformMode`: The function is only valid in edit mode."));h="",d=null,c="perspect",g(),setTimeout(function(){E.hideCropRect(),_.updateCvsAsync(!0,!1,async()=>{_.needAlwaysTrueTransform=!0,h="freeTransform",o([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]),i.style.display="",m(),e()})},0)})},e.exitFreeTransformMode=function(){return new Promise(function(t,n){if("freeTransform"!=h)return n(Error("`exitFreeTransformMode`: It is not in `freeTransform` mode."));h="",i.style.display="none",_.updateCvsAsync(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),d=null,c=null,_.needAlwaysTrueTransform=!1,h="basicEdit",t()})})}}()}};It._doCallbackNoBreak=function(e,t){if(e)try{e.apply(window,t||[])}catch(e){setTimeout(function(){throw e},0)}};let wt={};Math.sign||(Math.sign=function(e){return e>0?1:0==e?1/e<0?-0:0:e<0?-1:NaN}),wt.Matrix=function(e,t,i,n,s,r){this.a=e,this.b=t,this.c=i,this.d=n,this.e=s,this.f=r},wt.Matrix.dot=function(e,t){let i=e,n=t;return new wt.Matrix(i.a*n.a+i.c*n.b,i.b*n.a+i.d*n.b,i.a*n.c+i.c*n.d,i.b*n.c+i.d*n.d,i.a*n.e+i.c*n.f+i.e,i.b*n.e+i.d*n.f+i.f)},wt.Matrix.prototype.dot=function(e){return wt.Matrix.dot(this,e)},wt.Matrix.equals=function(e,t){let i=e,n=t;return i.a==n.a&&i.b==n.b&&i.c==n.c&&i.d==n.d&&i.e==n.e&&i.f==n.f},wt.Matrix.prototype.equals=function(e){return wt.Matrix.equals(this,e)},wt.Matrix.prototype.inversion=function(){let e=this.a,t=this.b,i=this.c,n=this.d,s=this.e,r=this.f,a=e*n-t*i;return new wt.Matrix(n/a,-t/a,-i/a,e/a,(i*r-n*s)/a,(t*s-e*r)/a)},wt.convertURLToBlob=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onloadend=function(){t(this.response)},i.send()},wt.convertBase64ToBlob=function(e,t){let i=atob(e),n=new Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);let s=new Uint8Array(n);return new Blob([s],{type:t})};let vt=function(e){let t=getComputedStyle(e);const i=e.getBoundingClientRect();let n={};return n.pageX0=i.left+window.scrollX,n.pageY0=i.top+window.scrollY,n.width=t?parseFloat(t.width):i.width,n.height=t?parseFloat(t.height):i.height,n.pageX1=n.pageX0+n.width,n.pageY1=n.pageY0+n.height,n},Tt=function(e){let t=vt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("border-left-width"))||0,i.top=parseFloat(t.getPropertyValue("border-top-width"))||0,i.right=parseFloat(t.getPropertyValue("border-right-width"))||0,i.bottom=parseFloat(t.getPropertyValue("border-bottom-width"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Ct=function(e){let t=Tt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("padding-left"))||0,i.top=parseFloat(t.getPropertyValue("padding-top"))||0,i.right=parseFloat(t.getPropertyValue("padding-right"))||0,i.bottom=parseFloat(t.getPropertyValue("padding-bottom"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},St=function(e){let t=e.style.transform,i="matrix(",n=t.indexOf(i);if(-1!=n){n+=i.length;let e=t.substring(n,t.indexOf(")",n)).split(",");for(let t=0;t<e.length;++t)e[t]=parseFloat(e[t]);return new wt.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])}i="scale(";let s=t.indexOf(i);if(-1!=s){s+=i.length;let e=parseFloat(t.substring(s));return new wt.Matrix(e,0,0,e,0,0)}return new wt.Matrix(1,0,0,1,0,0)},Dt=function(e,t){let i=t,n="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";e.style.transform=n},Mt=function(){this._queue=[],this.isWorking=!1,this.timeout=100};if(Mt.prototype.push=function(e,t,i,n){this._queue.push({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Mt.prototype.unshift=function(e,t,i,n){this._queue.unshift({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Mt.prototype.next=function(){if(0==this._queue.length)return void(this.isWorking=!1);this.isWorking=!0;let e=this._queue.shift(),t=e.task,i=e.context?e.context:self,n=e.args?e.args:[],s=e.handleReturn;setTimeout(function(){let e=t.apply(i,n);"function"==typeof s&&s(e)},this.timeout)},document?.head){const e=new Blob(["\n.kPainterBox, .kPainterBox *{box-sizing: border-box;}\n.kPainterBox{width:100%;height:100%;border-bottom:none;position:relative;padding:15px;}\n.kPainterBox > .kPainterImgsDiv{width:100%;height:100%;}\n.kPainterBox > .kPainterImgsDiv > canvas, .kPainterBox > .kPainterImgsDiv > img{position:absolute;margin:auto;/*left:0;top:0;right:0;bottom:0;transform-origin:left top;*/pointer-events:none;}\n/*.kPainterBox > .center{margin:auto;left:0;right:0;top:0;bottom:0;}*/\n.kPainterBox > .kPainterCroper{position:absolute;margin:auto;border-style:solid;border-color:rgba(0,0,0,0.3);/*border-right-width:100vw;border-bottom-width:100vh;*/box-sizing:content-box;}\n.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;line-height:0;position:relative;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div{display:inline-block;width:33.33%;height:33.33%;border-style:solid;border-color:rgba(255,255,255,0.5);position:absolute;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(1){border-width:1px 0 0 1px;left:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(2){border-width:1px 1px 0 1px;left:0;top:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(3){border-width:1px 1px 0 0;right:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(4){border-width:1px 0 1px 1px;left:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(5){border-width:1px 1px 1px 1px;left:0;top:0;right:0;bottom:0;margin:auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(6){border-width:1px 1px 1px 0;right:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(7){border-width:0 0 1px 1px;left:0;bottom:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(8){border-width:0 1px 1px 1px;left:0;bottom:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(9){border-width:0 1px 1px 0;right:0;bottom:0;}\n/*.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;overflow:hidden;}\n.kPainterBox > .kPainterCroper > .kPainterCells > table{width:100%;height:100%;}\n.kPainterBox > .kPainterCroper > .kPainterCells td{border:1px solid white;}*/\n.kPainterBox > .kPainterCroper > .kPainterBigMover{position:absolute;width:100%;height:100%;left:0;top:0;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div{position:absolute;border-color:white;border-style:solid;border:0;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(1){width:30px;height:100%;left:-15px;top:0;z-index:1;cursor:w-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(2){width:100%;height:30px;left:0;top:-15px;z-index:1;cursor:n-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(3){width:30px;height:100%;right:-15px;top:0;z-index:1;cursor:e-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(4){width:100%;height:30px;left:0;bottom:-15px;z-index:1;cursor:s-resize;}\n/*.kPainterBox > .kPainterCroper > .kPainterEdges > div > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterCroper > .kPainterCorners > div{position:absolute;width:16px;height:16px;border-color:white;border-style:solid;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1){left:0;top:0;border-width:2px 0 0 2px;z-index:1;cursor:nw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2){right:0;top:0;border-width:2px 2px 0 0;z-index:1;cursor:ne-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3){right:0;bottom:0;border-width:0 2px 2px 0;z-index:1;cursor:se-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4){left:0;bottom:0;border-width:0 0 2px 2px;z-index:1;cursor:sw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div > i{width:32px;height:32px;position:absolute;display:inline-block;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1) > i{left:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2) > i{right:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3) > i{right:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4) > i{left:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterMover{display:inline-block;position:absolute;border:solid 12px rgba(0,0,0,0.15);border-radius:12px;left: 13px;top:13px;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterMover > div{display:inline-block;position:absolute;border:solid 15px transparent;border-radius:15px;left:-15px;top:-15px;}\n.kPainterBox > .kPainterCroper > .kPainterMover > svg{display:inline-block;position:absolute;left:-10px;top:-10px;}\n/*.kPainterBox > .kPainterCroper > .kPainterCorners > div > i > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterPerspect{position:absolute;width:100%;height:100%;left:0;top:0;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCvs{position:absolute;margin:auto;left:-100000px;top:-100000px;right:-100000px;bottom:-100000px;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner{position:absolute;margin:auto;width:20px;height:20px;border-radius:10px;border:2px solid #0f0;color:#fff;background:rgba(0,0,0,0.3);text-align:center;line-height:16px;font-size:12px;font-family:Arial,sans-serif;z-index:1;cursor:move;}\n.kPainterBox > .kPainterGesturePanel{position:absolute;left:0;top:0;width:100%;height:100%;}\n\n.kPainterVideoMdl, .kPainterVideoMdl *{box-sizing: border-box;}\n.kPainterVideoMdl{position:fixed;left:0px;top:0px;width:100%;height:100%;display:none;background:black;}\n.kPainterVideoMdl > .kPainterVideo{width:100%;height:100%;}\n.kPainterVideoMdl > .kPainterCameraSelect{height:20px;position:absolute;left:4px;top:4px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterResolutionSelect{height:20px;position:absolute;left:4px;top:28px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo{position:absolute;margin:0 auto;left:0;right:0;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo > svg{vertical-align:middle;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo{position:absolute;right:20px;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo > svg{vertical-align:middle;}\n\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner > canvas{position:absolute;left:-43px;top:-113px;border-radius:50px;border:1px solid #0f0;pointer-events:none;user-select:none;z-index:2}\n"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}function At(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function bt(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;const Ot=e=>e&&"object"==typeof e&&"function"==typeof e.then,Lt=(async()=>{})().constructor;let Nt=class extends Lt{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Ot(e)?t=e:"function"==typeof e&&(t=new Lt(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Ot(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}},Pt=class{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.count);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(e){return await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:e}})})}async getBufferedCharacterItemSet(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e(i.itemSet);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})}};var xt={onTaskResultsReceived:!1,onTargetROIResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onDeskewedImageReceived:!1,onEnhancedImageReceived:!1,onColourImageUnitReceived:!1,onScaledColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesUnitReceived:!1};const kt=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet)if(t.isDce||t.isFilter)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])};let Bt=class{constructor(e){this._irrRegistryState=xt,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),kt(this);let t=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");t=e._observedResultUnitTypes,e._observedTaskMap.forEach((e,t)=>{i[t]=e}),e._observedTaskMap.clear()}return await new Promise((e,n)=>{let s=_e();Ee[s]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},pe.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:t.toString(),observedTaskMap:i}})})}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),kt(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr.privideDsImage}};const Ft="undefined"==typeof self,Ut="function"==typeof importScripts,Vt=(()=>{if(!Ut){if(!Ft&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Gt=e=>{if(null==e&&(e="./"),Ft||Ut);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Wt;Me.engineResourcePaths.cvr={version:"3.4.10-dev-20260129110712",path:Vt,isInternal:!0},Ce.cvr={js:!0,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE,ue.MN_DYNAMSOFT_IMAGE_PROCESSING,ue.MN_DYNAMSOFT_NEURAL_NETWORK]},Ce.dnn={wasm:!0,deps:[ue.MN_DYNAMSOFT_IMAGE_PROCESSING]},Te.cvr={};const Zt="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,Zt)<0&&(Me.engineResourcePaths.std={version:Zt,path:Gt(Vt+`../../dynamsoft-capture-vision-std@${Zt}/dist/`),isInternal:!0});const Ht="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,Ht)<0)&&(Me.engineResourcePaths.dip={version:Ht,path:Gt(Vt+`../../dynamsoft-image-processing@${Ht}/dist/`),isInternal:!0});const zt="2.0.10";(!Me.engineResourcePaths.dnn||"string"!=typeof Me.engineResourcePaths.dnn&&v(Me.engineResourcePaths.dnn.version,zt)<0)&&(Me.engineResourcePaths.dnn={version:zt,path:Gt(Vt+`../../dynamsoft-capture-vision-dnn@${zt}/dist/`),isInternal:!0});let jt=class{static getVersion(){return this._version}};var Yt,qt,$t,Xt,Qt,Kt,Jt,ei,ti,ii,ni,si,ri,ai,oi,li,ci,di,ui,hi,gi,mi,pi,fi;function _i(e,t){if(e){if(e.sourceLocation){const i=e.sourceLocation.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}if(e.location){const i=e.location.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}_i(e.referencedItem,t)}}function Ei(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}function yi(e){return{type:Q.CRIT_ORIGINAL_IMAGE,referenceItem:null,targetROIDefName:"",taskName:"",imageData:e,toCanvas:()=>S(e),toImage:t=>D(t,e),toBlob:t=>M(t,e)}}function Ri(e){const t=[J.EC_UNSUPPORTED_JSON_KEY_WARNING,J.EC_LICENSE_AUTH_QUOTA_EXCEEDED,J.EC_LICENSE_RESULTS_LIMIT_EXCEEDED];if(e.errorCode&&t.includes(e.errorCode))return void console.warn(e.message);let i=new Error(e.errorCode?`[${e.functionName}] [${e.errorCode}] ${e.message}`:`[${e.functionName}] ${e.message}`);if(i.stack&&(i.stack=e.stack),e.isShouldThrow)throw i;return e.rj&&e.rj(i),!0}jt._version=`3.4.10-dev-20260129110712(Worker: ${null===(Wt=ve.cvr)||void 0===Wt?void 0:Wt.worker}, Wasm: loading...`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Yt||(Yt={}));const Ii={onTaskResultsReceived:()=>{},isFilter:!0};Ee[-2]=async e=>{wi.onDataLoadProgressChanged&&wi.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class wi{constructor(){qt.add(this),this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(Me.browserInfo.OS)?2048:4096,this.onCaptureError=null,this._instanceID=void 0,this.privideDsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._dynamsoft=!0,$t.set(this,null),Xt.set(this,null),Qt.set(this,null),Kt.set(this,null),Jt.set(this,null),ei.set(this,new Set),ti.set(this,new Set),ii.set(this,new Set),ni.set(this,500),si.set(this,0),ri.set(this,0),ai.set(this,!1),oi.set(this,!1),li.set(this,!1),ci.set(this,null),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return At(this,li,"f")}static async createInstance(e=!0){if(!Te.license)throw Error("The `license` module cannot be found.");return await Te.license.dynamsoft(),await Me.loadWasm(),await new Promise((t,i)=>{const n=new wi;let s=_e();Ee[s]=async e=>{e.success?(n._instanceID=e.instanceID,n._currentSettings=JSON.parse(JSON.parse(e.outputSettings).data),wi._isNoOnnx=e.isNoOnnx,jt._version=`3.4.10-dev-20260129110712(Worker: ${ve.cvr.worker}, Wasm: ${e.version})`,bt(n,oi,!0),bt(n,Kt,n.getIntermediateResultManager()),bt(n,oi,!1),t(n)):Ri({message:e.message,rj:i,stack:e.stack,functionName:"createInstance"})},pe.postMessage({type:"cvr_createInstance",id:s,body:{loadPresetTemplates:e}})})}static async appendDLModelBuffer(e,t){return await Me.loadWasm(),wi._isNoOnnx?Promise.reject("Model not supported in the current environment."):await new Promise((i,n)=>{let s=_e();const r=T(Me.engineResourcePaths);let a;Ee[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Ri({message:t.errorString?t.errorString:"Append Model Buffer Failed.",rj:n,errorCode:t.errorCode,functionName:"appendDLModelBuffer"}),i(t)}Ri({message:e.message,rj:n,stack:e.stack,functionName:"appendDLModelBuffer"})},t?a=t.endsWith("/")?t:t+"/":"DCV"===Me._bundleEnv?a=r.dcvData+"models/":"DBR"===Me._bundleEnv&&(a=r.dbrBundle+"models/");let o=Array.isArray(e)?e:[e];o=o.map(e=>e.replace(/\.data$/i,"")),pe.postMessage({type:"cvr_appendDLModelBuffer",id:s,body:{modelNames:o,path:a}})})}static async clearDLModelBuffers(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();Ri({message:i.message,rj:t,stack:i.stack,functionName:"clearDLModelBuffers"})},pe.postMessage({type:"cvr_clearDLModelBuffers",id:i})})}async _singleFrameModeCallback(e){const t={bytes:e.bytes,width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.imageTag};for(let e of At(this,ei,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(yi(t));this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(t,this._templateName);i.originalImageTag=e.imageTag,At(this,$t,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1}),At(this,qt,"m",hi).call(this,i)}setInput(e){Ei(this),bt(this,$t,e),e||At(this,ci,"f")&&(At(this,Kt,"f").removeResultReceiver(At(this,ci,"f")),bt(this,ci,null))}getInput(){return At(this,$t,"f")}addImageSourceStateListener(e){if(Ei(this),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&At(this,ti,"f").add(e)}removeImageSourceStateListener(e){return Ei(this),At(this,ti,"f").delete(e)}addResultReceiver(e){if(Ei(this),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(At(this,ei,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){Ei(this),At(this,ei,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onProcessedDocumentResultReceived:!1,onParsedResultsReceived:!1};for(let t of At(this,ei,"f"))t.isDce||(e.onCapturedResultReceived=!!t.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!t.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!t.onRecognizedTextLinesReceived,e.onProcessedDocumentResultReceived=!!t.onProcessedDocumentResultReceived,e.onParsedResultsReceived=!!t.onParsedResultsReceived);let t=_e();return await new Promise((i,n)=>{Ee[t]=async e=>{e.success?i():Ri({message:e.message,rj:n,stack:e.stack,functionName:"addResultReceiver"})},pe.postMessage({type:"cvr_setCrrRegistry",id:t,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}})})}async addResultFilter(e){if(Ei(this),!e._dynamsoft)throw new Error("User defined CapturedResultFilter is not supported.");if(!e||"object"!=typeof e||!Object.keys(e).length)return console.warn("Invalid filter.");At(this,ii,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){Ei(this),At(this,ii,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(At(this,Kt,"f").removeResultReceiver(Ii),0===At(this,ii,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1,[Q.CRIT_ENHANCED_IMAGE]:!1},t={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1,[Q.CRIT_ENHANCED_IMAGE]:!1};return await At(this,qt,"m",gi).call(this,e),void await At(this,qt,"m",mi).call(this,t)}for(let e of At(this,ii,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(Q.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(Q.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(Q.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(Q.CRIT_DESKEWED_IMAGE),e.isLatestOverlappingEnabled(Q.CRIT_BARCODE)&&([...At(this,Kt,"f")._intermediateResultReceiverSet.values()].find(e=>e.isFilter)||At(this,Kt,"f").addResultReceiver(Ii)),await At(this,qt,"m",gi).call(this,e.verificationEnabled),await At(this,qt,"m",mi).call(this,e.duplicateFilterEnabled),await At(this,qt,"m",pi).call(this,e.duplicateForgetTime),await At(this,qt,"m",fi).call(this,e.crossVerificationCriteria)}async startCapturing(e){if(Ei(this),!this._isPauseScan)return;if(!At(this,$t,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=wi._defaultTemplate);for(let e of At(this,ii,"f"))await this.addResultFilter(e);const t=T(Me.engineResourcePaths);return void 0!==At(this,$t,"f").singleFrameMode&&"disabled"!==At(this,$t,"f").singleFrameMode?(this._templateName=e,void At(this,$t,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind)):At(this,Qt,"f")&&At(this,Qt,"f").isPending?At(this,Qt,"f"):(bt(this,Qt,new Nt((i,n)=>{if(this.disposed)return;let s=_e();Ee[s]=async t=>{At(this,Qt,"f")&&!At(this,Qt,"f").isFulfilled&&(t.success?(this._isPauseScan=!1,this._isOutputOriginalImage=t.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{-1!==this._minImageCaptureInterval&&At(this,$t,"f").startFetching(),this._loopReadVideo(e),i()},0)):Ri({message:t.message,rj:n,stack:t.stack,functionName:"startCapturing"}))},pe.postMessage({type:"cvr_startCapturing",id:s,instanceID:this._instanceID,body:{templateName:e,engineResourcePaths:t}})})),await At(this,Qt,"f"))}stopCapturing(){if(Ei(this),!At(this,$t,"f"))return;At(this,$t,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,bt(this,Qt,null),At(this,$t,"f").setColourChannelUsageType(o.CCUT_AUTO);const e=_e();Ee[e]=()=>{},pe.postMessage({type:"cvr_stopCapturing",id:e,instanceID:this._instanceID})}async containsTask(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));Ri({message:e.message,rj:i,stack:e.stack,functionName:"containsTask"})},pe.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async switchCapturingTemplate(e){this.stopCapturing(),await this.startCapturing(e)}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(bt(this,ai,!0),At(this,$t,"f").isBufferEmpty())if(At(this,$t,"f").hasNextImageToFetch())for(let e of At(this,ti,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(Yt.ISS_BUFFER_EMPTY);else if(!At(this,$t,"f").hasNextImageToFetch())for(let e of At(this,ti,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(Yt.ISS_EXHAUSTED);const t=At(this,$t,"f").getImage();if(t&&t.imageTag&&Date.now()-t.imageTag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!t)return void this._reRunCurrnetFunc(e);for(let e of At(this,ei,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(yi(t));const i=Date.now();this._captureDsimage(t,e).then(async n=>{if(wi._onLog&&wi._onLog("no js handle time: "+(Date.now()-i)),this._isPauseScan)return void this._reRunCurrnetFunc(e);n.originalImageTag=t.imageTag?t.imageTag:null,At(this,$t,"f")._capturedResultReceiver&&At(this,$t,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(n,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify});for(let e of At(this,ii,"f")){const t=e;t.onOriginalImageResultReceived(n),t.onDecodedBarcodesReceived(n),t.onRecognizedTextLinesReceived(n),t.onProcessedDocumentResultReceived(n),t.onParsedResultsReceived(n)}At(this,qt,"m",hi).call(this,n);const s=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-i),this._averageFetchImageTimeArray.push(t&&t.imageTag?t.imageTag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,wi._onLog&&(wi._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),wi._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),wi._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),wi._onLog(`averageTime: ${this._averageTime}`))),wi._onLog){const e=Date.now()-s;e>10&&wi._onLog(`fetch image calculate time: ${e}`)}wi._onLog&&wi._onLog(`time finish decode: ${Date.now()}`),wi._onLog&&wi._onLog("main time: "+(Date.now()-i)),wi._onLog&&wi._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(t=>{At(this,$t,"f").stopFetching(),"platform error"!==t.message&&(t.errorCode&&0===t.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{At(this,$t,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),setTimeout(()=>{if(!this.onCaptureError)throw t;this.onCaptureError(t)},0))})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async getClarity(e,t,i,n,s){const{bytes:r,width:a,height:o,stride:l,format:c}=e;let d=_e();return new Promise((e,u)=>{Ee[d]=async t=>{t.success?e(t.clarity):Ri({message:t.message,rj:u,stack:t.stack,functionName:"getClarity"})},pe.postMessage({type:"cvr_getClarity",id:d,instanceID:this._instanceID,body:{bytes:r,width:a,height:o,stride:l,format:c,bitcount:t,wr:i,hr:n,grayThreshold:s}},[r.buffer])})}async capture(e,t){let i;if(Ei(this),t||(t=wi._defaultTemplate),bt(this,ai,!1),E(e))i=await this._captureDsimage(e,t);else if("string"==typeof e)i="data:image/"==e.substring(0,11)?await this._captureBase64(e,t):await this._captureUrl(e,t);else if(e instanceof Blob)i=await this._captureBlob(e,t);else if(e instanceof HTMLImageElement)i=await this._captureImage(e,t);else if(e instanceof HTMLCanvasElement)i=await this._captureCanvas(e,t);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");i=await this._captureVideo(e,t)}return i}async _captureDsimage(e,t){return await this._captureInWorker(e,t)}async _captureUrl(e,t){let i=await I(e,"blob");return await this._captureBlob(i,t)}async _captureBase64(e,t){e=e.substring(e.indexOf(",")+1);let i=atob(e),n=i.length,s=new Uint8Array(n);for(;n--;)s[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([s]),t)}async _captureBlob(e,t){let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await async function(t){return await new Promise((i,n)=>{let s=URL.createObjectURL(t),r=new Image;r.src=s,r.onload=()=>{URL.revokeObjectURL(r.dbrObjUrl),i(r)},r.onerror=()=>{let t="Unsupported image format. Please upload files in one of the following formats: .jpg,.jpeg,.ico,.gif,.svg,.webp,.png,.bmp";"image/svg+xml"===e.type&&(t="Invalid SVG file. The file appears to be malformed or contains invalid XML."),n(new Error(t))}})}(e));let s=await this._captureImage(i||n,t);return i&&i.close(),s}async _captureImage(e,t){let i,n,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(s,r);a>this.maxImageSideLength?(bt(this,ri,this.maxImageSideLength/a),i=Math.round(s*At(this,ri,"f")),n=Math.round(r*At(this,ri,"f"))):(i=s,n=r),At(this,Xt,"f")||bt(this,Xt,document.createElement("canvas"));const o=At(this,Xt,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(o,t)}async _captureCanvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:l.IPF_ABGR_8888};return await this._captureInWorker(n,t)}async _captureVideo(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,n,s=e.videoWidth,r=e.videoHeight,a=Math.max(s,r);a>this.maxImageSideLength?(bt(this,ri,this.maxImageSideLength/a),i=Math.round(s*At(this,ri,"f")),n=Math.round(r*At(this,ri,"f"))):(i=s,n=r),At(this,Xt,"f")||bt(this,Xt,document.createElement("canvas"));const o=At(this,Xt,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),await this._captureCanvas(o,t)}async _captureInWorker(e,t){let{bytes:i,width:n,height:s,stride:r,format:a,imageTag:o}=e,l=_e();return await new Promise((c,d)=>{this.privideDsImage=e,Ee[l]=t=>{if(t.success){const i=Date.now();wi._onLog&&(wi._onLog(`get result time from worker: ${i}`),wi._onLog("worker to main time consume: "+(i-t.workerReturnMsgTime)));try{At(this,qt,"m",di).call(this,t.captureResult,e),e.bytes=t.bytes,t.isScanner||bt(this,ri,0),At(this,qt,"m",ui).call(this,t.intermediateResult,o);const i=Date.now();return i-At(this,si,"f")>At(this,ni,"f")&&null!==t.mliRecord&&(null===localStorage||void 0===localStorage||localStorage.setItem("dynamsoft",t.mliRecord),bt(this,si,i)),c(t.captureResult)}catch(e){Ri({message:e.message,rj:d,stack:e.stack,functionName:"capture"})}}else Ri({message:t.message,rj:d,stack:t.stack,functionName:"capture"})},wi._onLog&&wi._onLog(`send buffer to worker: ${Date.now()}`),pe.postMessage({type:"cvr_capture",id:l,instanceID:this._instanceID,body:{bytes:i,width:n,height:s,stride:r,format:a,templateName:t||"",isScanner:At(this,ai,"f"),dynamsoft:this._dynamsoft}},[i.buffer])})}async initSettings(e){if(Ei(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await I(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=_e();Ee[n]=async n=>{if(n.success){const s=JSON.parse(n.response);if(0!==s.errorCode&&Ri({message:s.errorString?s.errorString:"Init Settings Failed.",rj:i,errorCode:s.errorCode,functionName:"initSettings"}))return;const r=JSON.parse(e);return this._currentSettings=r,this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,wi._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,t(s)}Ri({message:n.message,rj:i,stack:n.stack,functionName:"initSettings"})},pe.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid template.")}async outputSettings(e,t){return Ei(this),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Ri({message:t.errorString,rj:n,errorCode:t.errorCode,functionName:"outputSettings"}),i(JSON.parse(t.data))}Ri({message:e.message,rj:n,stack:e.stack,functionName:"outputSettings"})},pe.postMessage({type:"cvr_outputSettings",id:s,instanceID:this._instanceID,body:{templateName:e,includeDefaultValues:!!t}})})}async outputSettingsToFile(e,t,i,n){const s=await this.outputSettings(e,n),r=new Blob([JSON.stringify(s,null,2,function(e,t){return t instanceof Array?JSON.stringify(t):t},2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(r),t.endsWith(".json")&&(t=t.replace(".json","")),e.download=`${t}.json`,e.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(e.href)},500)},e.click()}return r}async getTemplateNames(){return Ei(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Ri({message:n.errorString,rj:t,errorCode:n.errorCode,functionName:"getTemplateNames"}),e(JSON.parse(n.data))}Ri({message:i.message,rj:t,stack:i.stack,functionName:"getTemplateNames"})},pe.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})}async getSimplifiedSettings(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success){const n=JSON.parse(e.response);0!==n.errorCode&&Ri({message:n.errorString,rj:i,errorCode:n.errorCode,functionName:"getSimplifiedSettings"});const s=JSON.parse(n.data,(e,t)=>"barcodeFormatIds"===e?BigInt(t):t);return s.minImageCaptureInterval=this._minImageCaptureInterval,t(s)}Ri({message:e.message,rj:i,stack:e.stack,functionName:"getSimplifiedSettings"})},pe.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,t){return Ei(this),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success){const s=JSON.parse(e.response);return t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._isOutputOriginalImage=e.isOutputOriginalImage,0!==s.errorCode&&Ri({message:s.errorString?s.errorString:"Update Settings Failed.",rj:n,errorCode:s.errorCode,functionName:"updateSettings"}),this._currentSettings=await this.outputSettings("*"),i(s)}Ri({message:e.message,rj:n,stack:e.stack,functionName:"updateSettings"})},pe.postMessage({type:"cvr_updateSettings",id:s,instanceID:this._instanceID,body:{settings:t,templateName:e}})})}async resetSettings(){return Ei(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Ri({message:n.errorString?n.errorString:"Reset Settings Failed.",rj:t,errorCode:n.errorCode,functionName:"resetSettings"}),this._currentSettings=await this.outputSettings("*"),e(n)}Ri({message:i.message,rj:t,stack:i.stack,functionName:"resetSettings"})},pe.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})}getBufferedItemsManager(){return At(this,Jt,"f")||bt(this,Jt,new Pt(this)),At(this,Jt,"f")}getIntermediateResultManager(){if(Ei(this),!At(this,oi,"f")&&0!==Me.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return At(this,Kt,"f")||bt(this,Kt,new Bt(this)),At(this,Kt,"f")}static async setGlobalIntraOpNumThreads(e=0){return e>4||e<0?Promise.reject(new RangeError("'intraOpNumThreads' should be between 0 and 4.")):(await Me.loadWasm(),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();Ri({message:e.message,rj:i,stack:e.stack,functionName:"setGlobalIntraOpNumThreads"})},pe.postMessage({type:"cvr_setGlobalIntraOpNumThreads",id:n,body:{intraOpNumThreads:e}})}))}async parseRequiredResources(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));Ri({message:e.message,rj:i,stack:e.stack,functionName:"parseRequiredResources"})},pe.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){Ei(this),At(this,Qt,"f")&&this.stopCapturing(),bt(this,$t,null),At(this,ei,"f").clear(),At(this,ti,"f").clear(),At(this,ii,"f").clear(),At(this,Kt,"f")._intermediateResultReceiverSet.clear(),bt(this,li,!0);let e=_e();Ee[e]=e=>{e.success||Ri({message:e.message,stack:e.stack,isShouldThrow:!0,functionName:"dispose"})},pe.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:At(this,$t,"f"),promiseStartScan:At(this,Qt,"f"),intermediateResultManager:At(this,Kt,"f"),bufferdItemsManager:At(this,Jt,"f"),resultReceiverSet:At(this,ei,"f"),isaStateListenerSet:At(this,ti,"f"),resultFilterSet:At(this,ii,"f"),compressRate:At(this,ri,"f"),canvas:At(this,Xt,"f"),isScanner:At(this,ai,"f"),innerUseTag:At(this,oi,"f"),isDestroyed:At(this,li,"f")}}async _getWasmFilterState(){return await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const t=JSON.parse(i.response);return e(t)}Ri({message:i.message,rj:t,stack:i.stack,functionName:""})},pe.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})}}$t=new WeakMap,Xt=new WeakMap,Qt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,ei=new WeakMap,ti=new WeakMap,ii=new WeakMap,ni=new WeakMap,si=new WeakMap,ri=new WeakMap,ai=new WeakMap,oi=new WeakMap,li=new WeakMap,ci=new WeakMap,qt=new WeakSet,di=function(e,t){var i,n,s,r,a,o,l,c,d,u,h,g;for(let m=0;m<e.items.length;m++){const p=e.items[m];switch(0!==At(this,ri,"f")&&_i(p,At(this,ri,"f")),p.type){case Q.CRIT_ORIGINAL_IMAGE:e.items[m]=yi(t);break;case Q.CRIT_BARCODE:null!==(i=(l=e.decodedBarcodesResult).barcodeResultItems)&&void 0!==i||(l.barcodeResultItems=[]),e.decodedBarcodesResult.barcodeResultItems.push(p);break;case Q.CRIT_TEXT_LINE:null!==(n=(c=e.recognizedTextLinesResult).textLineResultItems)&&void 0!==n||(c.textLineResultItems=[]),e.recognizedTextLinesResult.textLineResultItems.push(p);break;case Q.CRIT_DETECTED_QUAD:null!==(s=(d=e.processedDocumentResult).detectedQuadResultItems)&&void 0!==s||(d.detectedQuadResultItems=[]),e.processedDocumentResult.detectedQuadResultItems.push(p);break;case Q.CRIT_DESKEWED_IMAGE:Te.ddn&&Te.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(r=(u=e.processedDocumentResult).deskewedImageResultItems)&&void 0!==r||(u.deskewedImageResultItems=[]),e.processedDocumentResult.deskewedImageResultItems.push(p);break;case Q.CRIT_ENHANCED_IMAGE:Te.ddn&&Te.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(a=(h=e.processedDocumentResult).enhancedImageResultItems)&&void 0!==a||(h.enhancedImageResultItems=[]),e.processedDocumentResult.enhancedImageResultItems.push(p);break;case Q.CRIT_PARSED_RESULT:Te.dcp&&Te.dcp.handleParsedResultItem(p),null!==(o=(g=e.parsedResult).parsedResultItems)&&void 0!==o||(g.parsedResultItems=[]),e.parsedResult.parsedResultItems.push(p)}}},ui=function(e,t){const i=e;if(i){let e=0;for(let n of At(this,Kt,"f")._intermediateResultReceiverSet){e++;for(let s of i){if(["onTaskResultsReceived","onTargetROIResultsReceived"].includes(s.info.callbackName)){for(let e of s.intermediateResultUnits)e.originalImageTag=t||null;n[s.info.callbackName]&&n[s.info.callbackName]({intermediateResultUnits:s.intermediateResultUnits},s.info)}else n[s.info.callbackName]&&n[s.info.callbackName](s.result,s.info);e===At(this,Kt,"f")._intermediateResultReceiverSet.size&&delete s.info.callbackName}}}},hi=function(e){for(let t of At(this,ei,"f"))e.decodedBarcodesResult&&t.onDecodedBarcodesReceived&&t.onDecodedBarcodesReceived(e.decodedBarcodesResult),e.recognizedTextLinesResult&&t.onRecognizedTextLinesReceived&&t.onRecognizedTextLinesReceived(e.recognizedTextLinesResult),e.processedDocumentResult&&t.onProcessedDocumentResultReceived&&t.onProcessedDocumentResultReceived(e.processedDocumentResult),e.parsedResult&&t.onParsedResultsReceived&&t.onParsedResultsReceived(e.parsedResult),t.onCapturedResultReceived&&t.onCapturedResultReceived(e)},gi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ri({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_enableResultCrossVerification",id:n,instanceID:this._instanceID,body:{verificationEnabled:e}})})},mi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ri({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_enableResultDeduplication",id:n,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})},pi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);Ri({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},pe.postMessage({type:"cvr_setDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})},fi=async function(e){return Ei(this),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t();Ri({message:e.message,rj:i,stack:e.stack,functionName:"setResultCrossVerificationCriteria"})},pe.postMessage({type:"cvr_setResultCrossVerificationCriteria",id:n,instanceID:this._instanceID,body:{criteria:e}})})},wi._defaultTemplate="Default",wi._isNoOnnx=!1;class vi{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}var Ti;!function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadSingleBarcode",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(Ti||(Ti={}));const Ci="undefined"==typeof self,Si=Ci?{}:self,Di="function"==typeof importScripts,Mi=(()=>{if(!Di){if(!Ci&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Ai=e=>e&&"object"==typeof e&&"function"==typeof e.then,bi=(async()=>{})().constructor;let Oi=class extends bi{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Ai(e)?t=e:"function"==typeof e&&(t=new bi(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Ai(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}};const Li=" is not allowed to change after `createInstance` or `loadWasm` is called.",Ni=!Ci&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Pi=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+Li);i._license=t}};!Ci&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const xi=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!Ci){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},ki=(e,t)=>{t=xi(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+Li);i._licenseServer=t}},Bi=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Li);i._deviceFriendlyName=t}};let Fi,Ui,Vi,Gi,Wi;"undefined"!=typeof navigator&&(Fi=navigator,Ui=Fi.userAgent,Vi=Fi.platform,Gi=Fi.mediaDevices),function(){if(!Ci){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Fi.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Vi,search:"Win"},Mac:{str:Vi},Linux:{str:Vi}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||Ui,a=s.search||t,o=s.verStr||Ui,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||Ui,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=Ui.indexOf("Windows NT")&&(s="HarmonyOS"),Wi={browser:i,version:n,OS:s}}Ci&&(Wi={browser:"ssr",version:0,OS:"ssr"})}(),Gi&&Gi.getUserMedia,"Chrome"===Wi.browser&&Wi.version>66||"Safari"===Wi.browser&&Wi.version>13||"OPR"===Wi.browser&&Wi.version>43||"Edge"===Wi.browser&&Wi.version;const Zi=()=>(Me.loadWasm(),me("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:i,sp:n,rmk:s,cv:r}=((e,t=!1)=>{const i=zi;if(i._pLoad.isEmpty){let n,s,r,a=i._license||"",o=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(s=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),o=xi(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(Si.crypto||(r="Please upgrade your browser to support online key."),Si.crypto.subtle||(r="Require https to use online key in this browser."))),r)throw new Error(r);return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:o,sp:l,rmk:n,cv:s}}throw new Error("Can't preprocess license again"+Li)})(),a=new Oi;zi._pLoad.task=a,(async()=>{try{await zi._pLoad}catch(e){}})();let o=_e();Ee[o]=t=>{if(t.message&&zi._onAuthMessage){let e=zi._onAuthMessage(t.message);null!=e&&(t.message=e)}let i,n=!1;if(1===e&&(n=!0),t.success?(ye&&ye("init license success"),t.message&&console.warn(t.message),Me._bSupportIRTModule=t.bSupportIRTModule,Me._bSupportDce4Module=t.bSupportDce4Module,zi.bPassValidation=!0,[0,-10076].includes(t.initLicenseInfo.errorCode)?[-10076].includes(t.initLicenseInfo.errorCode)&&console.warn(t.initLicenseInfo.errorString):a.reject(new Error(t.initLicenseInfo.errorString))):(i=Error(t.message),t.stack&&(i.stack=t.stack),t.ltsErrorCode&&(i.ltsErrorCode=t.ltsErrorCode),n||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const e=T(Me.engineResourcePaths),i=("DCV"===Me._bundleEnv?e.dcvData:e.dbrBundle)+"ui/";(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.insertAdjacentHTML("beforeend",s);let a=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==r.childElementCount?r.children[0]:r;o.remove();let l,c,d,u,h,g=[o],m=o.children;for(let e of m)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}});else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",()=>{o.remove();for(let e of a)e.remove()});else if(!d&&e.classList.contains("dls-license-icon-error"))d=e,"error"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-icon-warn"))u=e,"warn"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-msg-content")){h=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),s=t.indexOf("(",n),r=t.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==r){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),o=t.substring(i+1,n);a.innerText=o;let l=t.substring(s+1,r);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(r+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:zi._bNeverShowDialog,engineResourcePath:i,_onLog:ye},t.success?"warn":"error",t.message)}t.success?a.resolve(void 0):a.reject(i)},await ge("core");const l=await Me.getModuleVersion();pe.postMessage({type:"license_dynamsoft",body:{v:"DCV"===Me._bundleEnv?l.CVR.replace(/\.\d+$/,""):l.DBR.replace(/\.\d+$/,""),brtk:!!e,bptk:1===e,l:t,os:Wi,fn:zi.deviceFriendlyName,ls:i,sp:n,rmk:s,cv:r,_e:zi._e,mliRecord:null===localStorage||void 0===localStorage?void 0:localStorage.getItem("dynamsoft")},id:o}),zi.bCallInitLicense=!0,await a}));let Hi;Te.license={},Te.license.dynamsoft=Zi,Te.license.getAR=async()=>{{let e=he.dynamsoft_inited;e&&e.isRejected&&await e}return pe?new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){delete i.success;{let e=zi.license;e&&(e.startsWith("t")||e.startsWith("f"))&&(i.pk=e)}if(Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null)}else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},pe.postMessage({type:"license_getAR",id:i})}):null};let zi=class e{static setLicenseServer(t){ki(e,t)}static get license(){return this._license}static set license(t){Pi(e,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){ki(e,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Bi(e,t)}static initLicense(t,i){if(Pi(e,t),e.bCallInitLicense=!0,"boolean"==typeof i&&i||"object"==typeof i&&i.executeNow)return Zi()}static setDeviceFriendlyName(t){Bi(e,t)}static getDeviceFriendlyName(){return e._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await me("dynamsoft_uuid",async()=>{await Me.loadWasm();let e=new Oi,t=_e();Ee[t]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},pe.postMessage({type:"license_getDeviceUUID",id:t}),Hi=await e}),Hi))()}};zi._pLoad=new Oi,zi.bPassValidation=!1,zi.bCallInitLicense=!1,zi._license=Ni,zi._licenseServer=[],zi._deviceFriendlyName="",zi._e=!0,Me.engineResourcePaths.license={version:"4.4.10-dev-20260129110719",path:Mi,isInternal:!0},Ce.license={wasm:!0,js:!0},Te.license.LicenseManager=zi;const ji="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,ji)<0&&(Me.engineResourcePaths.std={version:ji,path:(e=>{if(null==e&&(e="./"),Ci||Di);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Mi+`../../dynamsoft-capture-vision-std@${ji}/dist/`),isInternal:!0});const Yi="undefined"==typeof self,qi="function"==typeof importScripts,$i=(()=>{if(!qi){if(!Yi&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Xi=e=>{if(null==e&&(e="./"),Yi||qi);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.dbr={version:"11.4.10-dev-20260129110729",path:$i,isInternal:!0},Ce.dbr={js:!1,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE,ue.MN_DYNAMSOFT_IMAGE_PROCESSING]},Te.dbr={};const Qi="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,Qi)<0&&(Me.engineResourcePaths.std={version:Qi,path:Xi($i+`../../dynamsoft-capture-vision-std@${Qi}/dist/`),isInternal:!0});const Ki="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,Ki)<0)&&(Me.engineResourcePaths.dip={version:Ki,path:Xi($i+`../../dynamsoft-image-processing@${Ki}/dist/`),isInternal:!0});const Ji={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var en,tn,nn,sn;function rn(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(en||(en={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(tn||(tn={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_NEURAL_NETWORK=512]="LM_NEURAL_NETWORK",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=-1]="LM_END"}(nn||(nn={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=-1]="DM_END"}(sn||(sn={})),"function"==typeof SuppressedError&&SuppressedError;const an="undefined"==typeof self,on=(()=>{if(!an&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),ln=e=>{if(null==e&&(e="./"),an);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var cn,dn;Me.engineResourcePaths.dlr={version:"4.4.10-dev-20260129110735",path:on,isInternal:!0},Ce.dlr={js:!0,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE,ue.MN_DYNAMSOFT_IMAGE_PROCESSING]};const un="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,un)<0&&(Me.engineResourcePaths.std={version:un,path:ln(on+`../../dynamsoft-capture-vision-std@${un}/dist/`),isInternal:!0});const hn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,hn)<0)&&(Me.engineResourcePaths.dip={version:hn,path:ln(on+`../../dynamsoft-image-processing@${hn}/dist/`),isInternal:!0});let gn=class e{static getVersion(){const e=ve.dlr&&ve.dlr.wasm;return`4.4.10-dev-20260129110735(Worker: ${ve.dlr&&ve.dlr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadConfusableCharsData(t,i){return rn(e,cn,"m",dn).call(e,"confusable",t,i)}static async loadOverlappingCharsData(t,i){return rn(e,cn,"m",dn).call(e,"overlapping",t,i)}};cn=gn,dn=async function(e,t,i){return await Me.loadWasm(),await new Promise((n,s)=>{let r=_e();Ee[r]=async e=>{if(e.success){const t=JSON.parse(e.result);if(0!==t.errorCode){let e=new Error(t.errorString);return e.errorCode=t.errorCode,s(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},i&&!i.endsWith("/")&&(i+="/");const a=T(Me.engineResourcePaths);pe.postMessage({type:"dlr_loadData",id:r,body:{type:e,dataName:t,dataPath:i||a.dcvData+"char-resources/"}})})},Te.dlr={loadConfusableCharsData:gn.loadConfusableCharsData,loadOverlappingCharsData:gn.loadOverlappingCharsData};const mn={filterVINResult:function(e){let t="";if(18===e.characterResults.length){let t=e.characterResults[9].location.points[0].x-e.characterResults[8].location.points[1].x;t<2&&(t=2);let i=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,n=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,s=2===t?3:t;i-t>=s&&n-t<s?e.characterResults.shift():n-t>=s&&i-t<s||e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[10].location.points[0].x-e.characterResults[9].location.points[1].x;t<2&&(t=2);let i,n,s,r=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,a=e.characterResults[18].location.points[0].x-e.characterResults[17].location.points[1].x,o=e.characterResults[2].location.points[0].x-e.characterResults[1].location.points[1].x,l=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,c=2===t?3:t;if("1"===e.characterResults[1].characterH||"1"===e.characterResults[2].characterH||"1"===e.characterResults[16].characterH||"1"===e.characterResults[17].characterH){for(let t=9;t<e.characterResults.length;t++)if("1"!==e.characterResults[t].characterH){s=e.characterResults[t].location.points[1].x-e.characterResults[t].location.points[0].x;break}"1"===e.characterResults[1].characterH&&(i=s-(e.characterResults[1].location.points[1].x-e.characterResults[1].location.points[0].x)+3),"1"===e.characterResults[2].characterH&&(i=s-(e.characterResults[2].location.points[1].x-e.characterResults[2].location.points[0].x)+3),"1"===e.characterResults[16].characterH&&(n=s-(e.characterResults[16].location.points[1].x-e.characterResults[16].location.points[0].x)+3),"1"===e.characterResults[17].characterH&&(n=s-(e.characterResults[17].location.points[1].x-e.characterResults[17].location.points[0].x)+3)}if(o-t>=(i||c)&&l-t<(n||c))e.characterResults.splice(0,2);else if(l-t>=(n||c)&&o-t<(i||c))e.characterResults.splice(17,2);else if(r>t&&a>t)e.characterResults.pop(),e.characterResults.shift();else{let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,i=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,n=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,s=Math.min(t,i,n);s===t?e.characterResults.splice(0,2):s===i?e.characterResults.splice(17,2):s===n&&(e.characterResults.pop(),e.characterResults.shift())}}for(let i of e.characterResults)t+=i.characterH;return t},checkValidVIN:function(e){return!(!e||17!=e.length)&&(e=>{const t=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let n=0;for(let s=0;s<e.length;s++){let r=t.get(e[s]);r&&(n+=r*i[s])}return n%11})(e).toString()===e[8]},checkValidMRP:function(e){if(!e||44!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),n=t(e,0,8).toString(),s=t(e,13,18).toString(),r=t(e,21,26).toString(),a=t(e,28,41).toString(),o=t(i,0,i.length).toString();return n===e[9]&&s===e[19]&&r===e[27]&&a===e[42]&&o===e[43]},checkValidMRV:function(e){if(!e||44!=e.length&&36!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=t(e,0,8).toString(),n=t(e,13,18).toString(),s=t(e,21,26).toString();return i===e[9]&&n===e[19]&&s===e[27]},checkValidIDCard:function(e,t){if(!e||30!=e.length&&36!=e.length)return!1;const i=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10};if(30===e.length){if(t&&e===t)return i(e,5,13).toString()===e[14];if(t&&e!==t){const n=`${t.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return i(n,0,n.length-1).toString()===e[29]}}else if(36===e.length){const t=i(e,0,8).toString(),n=i(e,13,18).toString(),s=i(e,21,26).toString(),r=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,a=i(r,0,r.length-1).toString();return t===e[9]&&n===e[19]&&s===e[27]&&a===e[35]}}};var pn,fn,_n;function En(e){delete e.moduleId;const t=JSON.parse(e.jsonString).ResultInfo,i=e.fullCodeString;e.getFieldValue=e=>"fullcodestring"===e.toLowerCase()?i:yn(t,e,"map"),e.getFieldRawValue=e=>"fullcodestring"===e.toLowerCase()?i:yn(t,e,"raw"),e.getFieldMappingStatus=e=>Rn(t,e),e.getFieldValidationStatus=e=>In(t,e),e.getAllFieldNames=()=>function(e){const t=[],i=e=>{const t=[];for(let n of e)for(let e of n)e.FieldName&&t.push(e.FieldName),e.ChildFields&&e.ChildFields.length>0&&t.push(...i(e.ChildFields));return t};for(let n of e)n.FieldName&&t.push(n.FieldName),n.ChildFields&&n.ChildFields.length>0&&t.push(...i(n.ChildFields));return t}(t),delete e.fullCodeString}function yn(e,t,i){for(let n of e){if(n.FieldName===t)return"raw"===i&&n.RawValue?n.RawValue:n.Value;if(n.ChildFields&&n.ChildFields.length>0){let e;for(let s of n.ChildFields)e=yn(s,t,i);if(void 0!==e)return e}}}function Rn(e,t){for(let i of e){if(i.FieldName===t)return i.MappingStatus?Number(fn[i.MappingStatus]):fn.MS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=Rn(n,t);if(void 0!==e)return e}}return fn.MS_NONE}function In(e,t){for(let i of e){if(i.FieldName===t&&i.ValidationStatus)return i.ValidationStatus?Number(_n[i.ValidationStatus]):_n.VS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=In(n,t);if(void 0!==e)return e}}return _n.VS_NONE}function wn(e){if(e.disposed)throw new Error('"CodeParser" instance has been disposed')}!function(e){e[e.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",e[e.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",e[e.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED"}(pn||(pn={})),Ee[-1]=async e=>{gn.onDataLoadProgressChanged&&gn.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})},function(e){e[e.MS_NONE=0]="MS_NONE",e[e.MS_SUCCEEDED=1]="MS_SUCCEEDED",e[e.MS_FAILED=2]="MS_FAILED"}(fn||(fn={})),function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_SUCCEEDED=1]="VS_SUCCEEDED",e[e.VS_FAILED=2]="VS_FAILED"}(_n||(_n={}));const vn=e=>e&&"object"==typeof e&&"function"==typeof e.then,Tn=(async()=>{})().constructor;class Cn extends Tn{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,vn(e)?t=e:"function"==typeof e&&(t=new Tn(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(vn(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const Sn="undefined"==typeof self,Dn="function"==typeof importScripts,Mn=(()=>{if(!Dn){if(!Sn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();Me.engineResourcePaths.dcp={version:"3.4.10-dev-20260129110745",path:Mn,isInternal:!0},Ce.dcp={js:!0,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE]},Te.dcp={handleParsedResultItem:En};const An="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,An)<0&&(Me.engineResourcePaths.std={version:An,path:(e=>{if(null==e&&(e="./"),Sn||Dn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Mn+`../../dynamsoft-capture-vision-std@${An}/dist/`),isInternal:!0}),Ee[-4]=async e=>{bn.onSpecLoadProgressChanged&&bn.onSpecLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};let bn=class{static getVersion(){const e=ve.dcp&&ve.dcp.wasm;return`3.4.10-dev-20260129110745(Worker: ${ve.dcp&&ve.dcp.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadSpec(e,t){return await Me.loadWasm(),await new Promise((i,n)=>{let s=_e();Ee[s]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},t&&!t.endsWith("/")&&(t+="/");let r=(e instanceof Array?e:[e]).map(e=>e.replace(/^MRTD.*$/,"MRTD"));r=r.map(e=>e.replace(/\.data$/i,""));let a=T(Me.engineResourcePaths);pe.postMessage({type:"dcp_appendResourceBuffer",id:s,body:{specificationPath:t||`${"DBR"===Me._bundleEnv?a.dbrBundle:a.dcvData}parser-resources/`,specificationNames:r}})})}};const On="undefined"==typeof self,Ln="function"==typeof importScripts,Nn=(()=>{if(!Ln){if(!On&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Pn=e=>{if(null==e&&(e="./"),On||Ln);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.ddn={version:"3.4.10-dev-20260129110740",path:Nn,isInternal:!0},Ce.ddn={js:!0,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE,ue.MN_DYNAMSOFT_IMAGE_PROCESSING]},Te.ddn={handleDeskewedAndEnhancedImageResultItem:function(e){let t=e,i=b(t.imageData);t.toCanvas=()=>S(i),t.toImage=e=>D(e,i),t.toBlob=e=>M(e,i)}};const xn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,xn)<0&&(Me.engineResourcePaths.std={version:xn,path:Pn(Nn+`../../dynamsoft-capture-vision-std@${xn}/dist/`),isInternal:!0});const kn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,kn)<0)&&(Me.engineResourcePaths.dip={version:kn,path:Pn(Nn+`../../dynamsoft-image-processing@${kn}/dist/`),isInternal:!0});var Bn;!function(e){e[e.ICM_COLOUR=0]="ICM_COLOUR",e[e.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",e[e.ICM_BINARY=2]="ICM_BINARY"}(Bn||(Bn={}));const Fn="undefined"==typeof self,Un="function"==typeof importScripts,Vn=(()=>{if(!Un){if(!Fn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Gn=e=>{if(null==e&&(e="./"),Fn||Un);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.utility={version:"2.4.10-dev-20260129110724",path:Vn,isInternal:!0},Ce.utility={js:!0,wasm:!0};const Wn="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,Wn)<0&&(Me.engineResourcePaths.std={version:Wn,path:Gn(Vn+`../../dynamsoft-capture-vision-std@${Wn}/dist/`),isInternal:!0});const Zn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,Zn)<0)&&(Me.engineResourcePaths.dip={version:Zn,path:Gn(Vn+`../../dynamsoft-image-processing@${Zn}/dist/`),isInternal:!0});function Hn(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}"function"==typeof SuppressedError&&SuppressedError;const zn="undefined"==typeof self,jn="function"==typeof importScripts,Yn=(()=>{if(!jn){if(!zn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),qn=e=>{if(null==e&&(e="./"),zn||jn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Me.engineResourcePaths.dbr={version:"11.0.30-dev-20250522174049",path:Yn,isInternal:!0},Ce.dbr={js:!1,wasm:!0,deps:[ue.MN_DYNAMSOFT_LICENSE,ue.MN_DYNAMSOFT_IMAGE_PROCESSING]},Te.dbr={};const $n="2.0.0";"string"!=typeof Me.engineResourcePaths.std&&v(Me.engineResourcePaths.std.version,$n)<0&&(Me.engineResourcePaths.std={version:$n,path:qn(Yn+`../../dynamsoft-capture-vision-std@${$n}/dist/`),isInternal:!0});const Xn="3.0.10";(!Me.engineResourcePaths.dip||"string"!=typeof Me.engineResourcePaths.dip&&v(Me.engineResourcePaths.dip.version,Xn)<0)&&(Me.engineResourcePaths.dip={version:Xn,path:qn(Yn+`../../dynamsoft-image-processing@${Xn}/dist/`),isInternal:!0});const Qn={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var Kn,Jn,es,ts,is;(is=Kn||(Kn={}))[is.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",is[is.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",is[is.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT",function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Jn||(Jn={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=4294967295]="LM_END"}(es||(es={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=4294967295]="DM_END"}(ts||(ts={}));const ns=async(e,t)=>{let i,n=document.createElement("canvas"),s=n.getContext("2d"),r=e;try{if(r instanceof Blob){i=URL.createObjectURL(r);const e=await new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.src=i});n.width=e.width,n.height=e.height,s.drawImage(e,0,0),r=s.getImageData(0,0,n.width,n.height)}else n.width=r.width,n.height=r.height,s.putImageData(r,0,0);if("image/bmp"===t){const e=A(r);return new Blob([e],{type:"image/bmp"})}return await new Promise(e=>{n.toBlob(t=>{e(t)},t)})}finally{URL.revokeObjectURL(i)}};function ss(e,t){let i=!0;for(let a=0;a<e.length;a++){const o=(a+1)%e.length;if(n=e[a],r=t,((s=e[o]).x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x)<0){i=!1;break}}var n,s,r;return i}function rs(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function as(e,t){const[i,n]=e,s=i.x,r=i.y,a=n.x,o=n.y,l=t.x,c=t.y,d=(a-s)**2+(o-r)**2;if(0===d)return Math.sqrt((l-s)**2+(c-r)**2);const u=((l-s)*(a-s)+(c-r)*(o-r))/d;if(u<0)return Math.sqrt((l-s)**2+(c-r)**2);if(u>1)return Math.sqrt((l-a)**2+(c-o)**2);{const e=s+u*(a-s),t=r+u*(o-r);return Math.sqrt((l-e)**2+(c-t)**2)}}function os(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],s=e[(i+1)%e.length];t.push([n,s])}return t}function ls(e){const[t,i]=e;return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function cs(e,t,i,n){const s=t.x-e.x,r=t.y-e.y,a=n.x-i.x,o=n.y-i.y,l=(-r*(e.x-i.x)+s*(e.y-i.y))/(-a*r+s*o),c=(a*(e.y-i.y)-o*(e.x-i.x))/(-a*r+s*o);return l>=0&&l<=1&&c>=0&&c<=1?{x:e.x+c*s,y:e.y+c*r}:null}function ds(e){let t=0;for(let i=0;i<e.length;i++){const n=(i+1)%e.length;t+=e[i].x*e[n].y,t-=e[n].x*e[i].y}return Math.abs(t/2)}function us(e,t,i){let n=t.x-e.x,s=t.y-e.y,r=i.x-e.x;return n*(i.y-e.y)-s*r>0}function hs(e,t){for(let i=0;i<4;i++)if(!us(e.points[i],e.points[(i+1)%4],t))return!1;return!0}function gs(e,t,i,n){const s=e.points,r=t.points;let a=8*i;a=Math.max(a,5);const o=os(s)[3],l=os(s)[1],c=os(r)[3],d=os(r)[1];let u,h=0;if(u=Math.max(Math.abs(as(o,t.points[0])),Math.abs(as(o,t.points[3]))),u>h&&(h=u),u=Math.max(Math.abs(as(l,t.points[1])),Math.abs(as(l,t.points[2]))),u>h&&(h=u),u=Math.max(Math.abs(as(c,e.points[0])),Math.abs(as(c,e.points[3]))),u>h&&(h=u),u=Math.max(Math.abs(as(d,e.points[1])),Math.abs(as(d,e.points[2]))),u>h&&(h=u),h>a)return!1;const g=ls(os(s)[0]),m=ls(os(s)[2]),p=ls(os(r)[0]),f=ls(os(r)[2]),_=rs(g,f),E=rs(p,m),y=_>E,R=Math.min(_,E),I=rs(g,m),w=rs(p,f);let v=12*i;return v=Math.max(v,5),v=Math.min(v,I),v=Math.min(v,w),!!(R<v||ss(s,y?p:f)||ss(r,y?m:g))&&(y?(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]):(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]),n.area=ds(n.points),!0)}class ms{constructor(e,t,i,n){this.overlapCount=e,this.verificationCount=t,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const t={x:0,y:0};return e.forEach(({x:e,y:i})=>{t.x+=e,t.y+=i}),t.x/=e.length,t.y/=e.length,t}isProbablySameLocationWithOffset(e,t){const i=this.item.location,n=e.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let s=new Array(4).fill(0),r=new Array(4).fill(0),a=0,o=0;for(let e=0;e<4;++e)s[e]=Math.round(100*(n.points[e].x-i.points[e].x))/100,a+=s[e],r[e]=Math.round(100*(n.points[e].y-i.points[e].y))/100,o+=r[e];a/=4,o/=4;for(let e=0;e<4;++e){if(Math.abs(s[e]-a)>this.strictLimit||Math.abs(a)>.8)return!1;if(Math.abs(r[e]-o)>this.strictLimit||Math.abs(o)>.8)return!1}return t.x=a,t.y=o,!0}isLocationOverlap(e,t){if(this.locationArea>t){for(let t=0;t<4;t++)if(hs(this.location,e.points[t]))return!0;const t=this.getCenterPoint(e.points);if(hs(this.location,t))return!0}else{for(let t=0;t<4;t++)if(hs(e,this.location.points[t]))return!0;if(hs(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,t={x:0,y:0}){if(this.isOneD){const i=Object.assign({},e.location);for(let e=0;e<4;e++)i.points[e].x-=t.x,i.points[e].y-=t.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],s=[this.location.points[1],this.location.points[2]];for(let e=0;e<4;e++){const t=i.points[e],r=0===e||3===e?n:s;if(Math.abs(as(r,t))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=e.location.points[i],s=this.location.points[i];if(!(Math.abs(s.x+t.x-n.x)<this.locationThreshold))return!1;if(Math.abs(s.y+t.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,t,i=!0){const n=Object.assign({},e.location);for(let e=0;e<4;e++)n.points[e].x-=t.x,n.points[e].y-=t.y;if(!this.isLocationOverlap(n,e.location.area))return!1;if(i){const e=.75;return function(e,t){const i=[];for(let n=0;n<4;n++)for(let s=0;s<4;s++){const r=cs(e[n],e[(n+1)%4],t[s],t[(s+1)%4]);r&&i.push(r)}return e.forEach(e=>{ss(t,e)&&i.push(e)}),t.forEach(t=>{ss(e,t)&&i.push(t)}),ds(function(e){if(e.length<=1)return e;e.sort((e,t)=>e.x-t.x||e.y-t.y);const t=e.shift();return e.sort((e,i)=>Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(i.y-t.y,i.x-t.x)),[t,...e]}(i))}([...this.location.points],n.points)>this.locationArea*e}return!0}}var ps,fs,_s,Es,ys,Rs;const Is={barcode:2,text_line:4,detected_quad:8,deskewed_image:16,enhanced_image:64},ws=e=>Object.values(Is).includes(e)||Is.hasOwnProperty(e),vs=(e,t)=>"string"==typeof e?t[Is[e]]:t[e],Ts=(e,t,i)=>{"string"==typeof e?t[Is[e]]=i:t[e]=i},Cs=(e,t,i)=>{const n=[{type:Q.CRIT_BARCODE,resultName:"decodedBarcodesResult",itemNames:["barcodeResultItems"]},{type:Q.CRIT_TEXT_LINE,resultName:"recognizedTextLinesResult",itemNames:["textLineResultItems"]}],s=t.items;if(e.isResultCrossVerificationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type!==i||s[e].verified||s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&e.verified)})}if(e.isResultDeduplicationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type===i&&s[e].duplicate&&s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&!e.duplicate)})}};class Ss{constructor(){this.verificationEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!0,[Q.CRIT_DETECTED_QUAD]:!0,[Q.CRIT_DESKEWED_IMAGE]:!1},this.duplicateFilterEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1},this.duplicateForgetTime={[Q.CRIT_BARCODE]:3e3,[Q.CRIT_TEXT_LINE]:3e3,[Q.CRIT_DETECTED_QUAD]:3e3,[Q.CRIT_DESKEWED_IMAGE]:3e3},this.crossVerificationCriteria={[Q.CRIT_BARCODE]:{frameWindow:5,minConsistentFrames:2},[Q.CRIT_TEXT_LINE]:{frameWindow:5,minConsistentFrames:2},[Q.CRIT_DETECTED_QUAD]:{frameWindow:6,minConsistentFrames:4},[Q.CRIT_DESKEWED_IMAGE]:{frameWindow:6,minConsistentFrames:4}},ps.set(this,new Map),fs.set(this,new Map),_s.set(this,new Map),Es.set(this,new Map),ys.set(this,new Map),Rs.set(this,new Map),this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,this.latestOverlappingEnabled={[Q.CRIT_BARCODE]:!1,[Q.CRIT_TEXT_LINE]:!1,[Q.CRIT_DETECTED_QUAD]:!1,[Q.CRIT_DESKEWED_IMAGE]:!1},this.maxOverlappingFrames={[Q.CRIT_BARCODE]:this.crossVerificationFrames,[Q.CRIT_TEXT_LINE]:this.crossVerificationFrames,[Q.CRIT_DETECTED_QUAD]:this.crossVerificationFrames,[Q.CRIT_DESKEWED_IMAGE]:this.crossVerificationFrames},Object.defineProperties(this,{onOriginalImageResultReceived:{value:e=>{},writable:!1},onDecodedBarcodesReceived:{value:e=>{this.latestOverlappingFilter(e),Cs(this,e,Q.CRIT_BARCODE)},writable:!1},onRecognizedTextLinesReceived:{value:e=>{Cs(this,e,Q.CRIT_TEXT_LINE)},writable:!1},onProcessedDocumentResultReceived:{value:e=>{},writable:!1},onParsedResultsReceived:{value:e=>{},writable:!1}})}_dynamsoft(){Hn(this,ps,"f").forEach((e,t)=>{Ts(t,this.verificationEnabled,e)}),Hn(this,fs,"f").forEach((e,t)=>{Ts(t,this.duplicateFilterEnabled,e)}),Hn(this,_s,"f").forEach((e,t)=>{Ts(t,this.duplicateForgetTime,e)}),Hn(this,Es,"f").forEach((e,t)=>{Ts(t,this.latestOverlappingEnabled,e)}),Hn(this,ys,"f").forEach((e,t)=>{Ts(t,this.maxOverlappingFrames,e)}),Hn(this,Rs,"f").forEach((e,t)=>{Ts(t,this.crossVerificationCriteria,e)})}enableResultCrossVerification(e,t){ws(e)&&Hn(this,ps,"f").set(e,t)}isResultCrossVerificationEnabled(e){return!!ws(e)&&vs(e,this.verificationEnabled)}enableResultDeduplication(e,t){ws(e)&&(t&&this.enableLatestOverlapping(e,!1),Hn(this,fs,"f").set(e,t))}isResultDeduplicationEnabled(e){return!!ws(e)&&vs(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,t){ws(e)&&(t>18e4&&(t=18e4),t<0&&(t=0),Hn(this,_s,"f").set(e,t))}getDuplicateForgetTime(e){return ws(e)?vs(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0;const t=[Q.CRIT_BARCODE,Q.CRIT_TEXT_LINE,Q.CRIT_DETECTED_QUAD,Q.CRIT_DESKEWED_IMAGE,Q.CRIT_ENHANCED_IMAGE];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}setResultCrossVerificationCriteria(e,t,i){t<i&&(t=i),Hn(this,Rs,"f").set(e,{frameWindow:t,minConsistentFrames:i})}getResultCrossVerificationCriteria(e){return vs(e,this.crossVerificationCriteria)}enableLatestOverlapping(e,t){ws(e)&&(t&&this.enableResultDeduplication(e,!1),Hn(this,Es,"f").set(e,t))}isLatestOverlappingEnabled(e){return!!ws(e)&&vs(e,this.latestOverlappingEnabled)}setMaxOverlappingFrames(e,t){ws(e)&&Hn(this,ys,"f").set(e,t)}getMaxOverlappingFrames(e){return ws(e)?vs(e,this.maxOverlappingFrames):-1}latestOverlappingFilter(e){var t,i,n;const s=this.isResultCrossVerificationEnabled(Q.CRIT_BARCODE),r=this.isLatestOverlappingEnabled(Q.CRIT_BARCODE);if(r){const a=this.crossVerificationFrames,o=60,l=r?this.getMaxOverlappingFrames(Q.CRIT_BARCODE):this.crossVerificationFrames,c=e.items.length,d=null===(n=null===(i=null===(t=null==e?void 0:e.intermediateResult)||void 0===t?void 0:t[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,u=d?d.length:0;let h=[];const g=[],m={x:0,y:0};let p=new Array(c).fill(-1),f=0;const _=e.items.map(e=>{if(1!==e.type){const t=(BigInt(e.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0);return new ms(l,t?1:2,t,e)}}).filter(Boolean);if(this.overlapSet.length>0){const e=new Array(c).fill(new Array(this.overlapSet.length).fill(1));let t=0;for(;t<c;){const i={x:0,y:0},n=new Array(c).fill(-1);let s=!1;for(;t<c;t++){if(!_[t])continue;const r=_[t].item;for(let a=0;a<this.overlapSet.length;a++){if(e[t][a]<1)continue;const o=this.overlapSet[a],l=o.item;if(r.format===l.format&&r.text===l.text){if(s=o.isProbablySameLocationWithOffset(_[t],i),s){n[t]=a,e[t][a]=0;break}}else e[t][a]=0}if(s)break}if(s){for(let s=0;s<c;s++){if(s===t||!_[s])continue;const r=_[s].item;for(let t=0;t<this.overlapSet.length;t++){if(e[s][t]<1)continue;if(n.includes(t))continue;const a=this.overlapSet[t],o=a.item;if(r.format===o.format&&r.text===o.text){if(a.isMatchedLocationWithOffset(_[s],i)){n[s]=t,e[s][t]=0;break}}else e[s][t]=0}}const s=n.filter(e=>-1!==e).length;s>f&&(f=s,p=n,m.x=i.x,m.y=i.y)}}if(0===f){for(let t=0;t<c;t++){const i=_[t].item;for(let n=0;n<this.overlapSet.length;n++){if(e[t][n]<1)continue;if(p.includes(n))continue;const s=this.overlapSet[n],r=s.item;if(i.format===r.format&&i.text===r.text){if(s.isMatchedLocationWithOffset(_[t])){p[t]=n,e[t][n]=0;break}}else e[t][n]=0}}f+=p.filter(e=>-1!=e).length}let i=this.overlapSet.length<=3?f>=1:f>=2;if(!i&&r&&u>0){let e=0;for(let t=0;t<this.overlapSet.length;t++){const i=this.overlapSet[t];for(let t=0;t<u;t++)if(i.isOverlappedLocationWithOffset(d[t],m)){e++;break}}i=this.overlapSet.length<=3?e>=1:e>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,e.items.forEach((e,t)=>{if(1!==e.type){const i=Object.assign({},e),n=(BigInt(e.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=e.confidence<o,a=new ms(l,n?1:2,n,i);s&&n&&r&&g.push(t),this.overlapSet.push(a)}});else{let t=!0;r?(Math.abs(m.x)>5||Math.abs(m.y)>5)&&(t=!1):t=!1;for(let i=0;i<e.items.length;i++){const e=p[i];if(e<0&&_[i]){const e=_[i].item;let n={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let i=0;i<4;i++)n.points[i].x=t?e.location.points[i].x-m.x:e.location.points[i].x,n.points[i].y=t?e.location.points[i].y-m.y:e.location.points[i].y;for(let s=0;s<this.overlapSet.length;s++){if(p.includes(s))continue;const r=this.overlapSet[s].item.text,a=this.overlapSet[s].item.format;if(e.format===a&&e.text===r){if(this.overlapSet[s].isOverlappedLocationWithOffset(e,m,!1)){const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new ms(l,r,n,t),p[i]=s;break}if(_[i].isOneD){let r={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let e=0;e<4;e++)r.points[e].x=t?this.overlapSet[s].location.points[e].x:this.overlapSet[s].location.points[e].x+m.x,r.points[e].y=t?this.overlapSet[s].location.points[e].y:this.overlapSet[s].location.points[e].y+m.y;let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(gs(n,r,e.moduleSize,a)){e.location=a;const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new ms(l,r,n,t),p[i]=s;break}}}}}else{if(t)_[i]&&(_[i].item.location=this.overlapSet[e].location);else{const t=Object.assign({},_[i].item),n=(BigInt(t.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[e]=new ms(l,s,n,t)}this.overlapSet[e]&&(this.overlapSet[e].overlapCount=l,this.overlapSet[e].verificationCount=2,this.overlapSet[e].crossVerificationFrame=a)}}t?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const n=this.overlapSet[e];n.overlapCount--,n.crossVerificationFrame--;const s=n.overlapCount+this.stabilityCount;if(r&&s>0){for(let e=0;e<c;e++)if(n.isOverlappedLocationWithOffset(_[e],m,!1)){i=!1;break}if(!i)break;const e=n.item;if(!t){for(let e=0;e<4;e++)n.location.points[e].x+=m.x,n.location.points[e].y+=m.y;e.location=n.location}2===n.verificationCount&&h.push(e)}}if(r&&!i){h=[];for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const t=this.overlapSet[e];t.overlapCount=0-this.stabilityCount,t.crossVerificationFrame=0,t.verificationCount=0}}for(let e=0;e<c;e++){if(-1!==p[e]||!_[e])continue;const i=_[e].item;if(t){for(let t=0;t<4;t++)_[e].location.points[t].x-=m.x,_[e].location.points[t].y-=m.y;i.location=_[e].location}let n=!1;for(let t of this.overlapSet)if(!(t.crossVerificationFrame<=0&&t.verificationCount<=0)&&(n=t.isLocationOverlap(_[e].location,_[e].locationArea),n))break;if(n){g.push(e);continue}const r=Object.assign({},i),a=(BigInt(i.format)&BigInt(Qn.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(Qn.BF_GS1_DATABAR))!=BigInt(0),c=i.confidence<o,d=new ms(l,a?1:2,a,r);s&&a&&c?g.push(e):d.verificationCount=2,this.overlapSet.push(d)}this.overlapSet=this.overlapSet.filter(e=>!(e.overlapCount+this.stabilityCount<=0&&e.crossVerificationFrame<=0))}g.sort((e,t)=>t-e).forEach((t,i)=>{e.items.splice(t,1)}),h.forEach(t=>{e.items.push(Object.assign(Object.assign({},t),{overlapped:!0}))})}}}var Ds,Ms,As,bs;ps=new WeakMap,fs=new WeakMap,_s=new WeakMap,Es=new WeakMap,ys=new WeakMap,Rs=new WeakMap;class Os{static async readFromFile(e){if("string"==typeof e){if(!w(e))return Promise.reject(new TypeError("The input string is not a valid URL."));{const t=await fetch(e);e=await t.blob()}}return await O(e)}static async saveToFile(e,t,i){if(!e||!t)return null;if("string"!=typeof t)throw new TypeError("FileName must be of type string.");const n=b(e);return C(n,t,i)}static async readFromMemory(e){if(!Hn(Os,Ds,"f",Ms).has(e))throw new Error("Image data ID does not exist.");return Hn(Os,Ds,"f",Ms).get(e)}static async saveToMemory(e,t){var i,n,s;const r=await ns(e,t),a=await O(r),o=(function(e,t,i,n,s){if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");s?s.value=i:t.set(e,i)}(i=Os,Ds,(s=Hn(i,Ds,"f",As),n=s++,s),0,As),n);return Hn(Os,Ds,"f",Ms).set(o,a),o}static async readFromBase64String(e){const t=await(async e=>{let t,i="image/png";if(e.includes("base64,")){const n=e.split(","),s=n[0].match(/:(.*?);/);s&&(i=s[1]),t=atob(n[1])}else t=atob(e);const n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new Blob([s],{type:i})})(e);return await O(t)}static async saveToBase64String(e,t){e instanceof Blob&&(e=await O(e));let i=b(e);const n=await ns(i,t);return await(async e=>await new Promise((t,i)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=e=>{i(e)},n.readAsDataURL(e)}))(n)}}Ds=Os,Ms={value:new Map},As={value:0};class Ls{static async cropImage(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await O(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.cropImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_cropImage",id:l,body:{type:"Rect",bytes:i,width:n,height:s,stride:r,format:a,roi:t}})})}static async adjustBrightness(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await O(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.adjustBrightness);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_adjustBrightness",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,brightness:t}})})}static async adjustContrast(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await O(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.adjustContrast);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_adjustContrast",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,contrast:t}})})}static async filterImage(e,t){if(![0,1,2].includes(t))throw new Error("Invalid filterType.");const{bytes:i,width:n,height:s,stride:r,format:a}=E(e)?e:await O(e);return await new Promise((e,o)=>{let l=_e();Ee[l]=async t=>{if(t.success)return e(t.filterImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},pe.postMessage({type:"utility_filterImage",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,filterType:t}})})}static async convertToGray(e,t,i,n){const{bytes:s,width:r,height:a,stride:o,format:l}=E(e)?e:await O(e);return await new Promise((e,c)=>{let d=_e();Ee[d]=async t=>{if(t.success)return e(t.convertToGray);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},pe.postMessage({type:"utility_convertToGray",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,R:t,G:i,B:n}})})}static async convertToBinaryGlobal(e,t=-1,i=!1){const{bytes:n,width:s,height:r,stride:a,format:o}=E(e)?e:await O(e);return await new Promise((e,l)=>{let c=_e();Ee[c]=async t=>{if(t.success)return e(t.convertToBinaryGlobal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},pe.postMessage({type:"utility_convertToBinaryGlobal",id:c,body:{bytes:n,width:s,height:r,stride:a,format:o,threshold:t,invert:i}})})}static async convertToBinaryLocal(e,t=0,i=10,n=!1){const{bytes:s,width:r,height:a,stride:o,format:l}=E(e)?e:await O(e);return await new Promise((e,c)=>{let d=_e();Ee[d]=async t=>{if(t.success)return e(t.convertToBinaryLocal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},pe.postMessage({type:"utility_convertToBinaryLocal",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,blockSize:t,compensation:i,invert:n}})})}static async cropAndDeskewImage(e,t,i=0,n=0,s=0){const{bytes:r,width:a,height:o,stride:l,format:c}=E(e)?e:await O(e);return await new Promise((e,d)=>{let u=_e();Ee[u]=async t=>{if(t.success)return e(t.cropAndDeskewImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,d(e)}},pe.postMessage({type:"utility_cropAndDeskewImage",id:u,body:{bytes:r,width:a,height:o,stride:l,format:c,roi:t,dstWidth:i,dstHeight:n,padding:s}})})}}!function(e){e[e.FT_HIGH_PASS=0]="FT_HIGH_PASS",e[e.FT_SHARPEN=1]="FT_SHARPEN",e[e.FT_SMOOTH=2]="FT_SMOOTH"}(bs||(bs={}));class Ns{static async findPortraitZone(){return await Me.loadWasm(),await Te.license.dynamsoft(),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success){const n=JSON.parse(i.quad);n.errorCode&&0!==n.errorCode&&t(new Error(n.errorString)),e(n)}else{let e=new Error(i.message);e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"identityUtility_findPortraitZone",id:i})})}}Me.engineResourcePaths.rootDirectory=(e=>{if(null==e&&(e="./"),Ae||be);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Oe+"../../"),Me.engineResourcePaths.dcvBundle={version:"3.4.1000-dev-20260214095351",path:Oe,isInternal:!0},Me.engineResourcePaths.dcvData={version:"1.2.0",path:Oe,isInternal:!0},$e.CoreModule=Me,$e.handleEngineResourcePaths=T;var Ps,xs,ks,Bs,Fs=Object.freeze({__proto__:null,BarcodeReaderModule:class{static getVersion(){const e=ve.dbr&&ve.dbr.wasm;return`11.4.10-dev-20260129110729(Worker: ${ve.dbr&&ve.dbr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}},Beep:je,Camera:We,CameraEnhancer:$e,CameraView:Xe,CaptureVisionRouter:wi,CaptureVisionRouterModule:jt,CapturedResultReceiver:vi,CodeParser:class e{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static async createInstance(){await Te.license.dynamsoft(),await Me.loadWasm();const t=new e,i=new Cn;let n=_e();return Ee[n]=async e=>{if(e.success)t._instanceID=e.instanceID,i.resolve(t);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),i.reject(t)}},pe.postMessage({type:"dcp_createInstance",id:n}),i}async dispose(){wn(this);let e=_e();this.bDestroyed=!0,Ee[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},pe.postMessage({type:"dcp_dispose",id:e,instanceID:this._instanceID})}get disposed(){return this.bDestroyed}async initSettings(e){if(wn(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await I(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString?n.errorString:"Init Settings Failed.");return e.errorCode=n.errorCode,i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},pe.postMessage({type:"dcp_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid settings.")}async resetSettings(){return wn(this),await new Promise((e,t)=>{let i=_e();Ee[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},pe.postMessage({type:"dcp_resetSettings",id:i,instanceID:this._instanceID})})}async parse(e,t=""){if(wn(this),!e||!(e instanceof Array||e instanceof Uint8Array||"string"==typeof e))throw new Error("`parse` must pass in an Array or Uint8Array or string");return await new Promise((i,n)=>{let s=_e();e instanceof Array&&(e=Uint8Array.from(e)),"string"==typeof e&&(e=Uint8Array.from(function(e){let t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e))),Ee[s]=async e=>{if(e.success){let t=JSON.parse(e.parseResponse);return t.errorCode?n(new Error(t.errorString)):(En(t),i(t))}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},pe.postMessage({type:"dcp_parse",id:s,instanceID:this._instanceID,body:{source:e,taskSettingName:t}})})}},CodeParserModule:bn,CoreModule:Me,DocumentNormalizerModule:class{static getVersion(){const e=ve.ddn&&ve.ddn.wasm;return`3.4.10-dev-20260129110740(Worker: ${ve.ddn&&ve.ddn.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}},DrawingItem:dt,DrawingLayer:lt,DrawingStyleManager:ot,EnumBarcodeFormat:Ji,get EnumBufferOverflowProtectionMode(){return a},get EnumCapturedResultItemType(){return Q},get EnumColourChannelUsageType(){return o},get EnumCornerType(){return K},get EnumCrossVerificationStatus(){return re},get EnumDeblurMode(){return sn},get EnumDrawingItemMediaType(){return _t},get EnumDrawingItemState(){return Et},get EnumEnhancedFeatures(){return yt},get EnumErrorCode(){return J},get EnumExtendedBarcodeResultType(){return en},get EnumFilterType(){return bs},get EnumGrayscaleEnhancementMode(){return ee},get EnumGrayscaleTransformationMode(){return te},get EnumImageCaptureDistanceMode(){return de},get EnumImageColourMode(){return Bn},get EnumImageFileFormat(){return ce},get EnumImagePixelFormat(){return l},get EnumImageSourceState(){return Yt},get EnumImageTagType(){return ie},EnumIntermediateResultUnitType:ae,get EnumLocalizationMode(){return nn},get EnumMappingStatus(){return fn},get EnumModuleName(){return ue},get EnumPDFReadingMode(){return ne},get EnumPixelFormat(){return Rt},get EnumPresetTemplate(){return Ti},get EnumQRCodeErrorCorrectionLevel(){return tn},get EnumRasterDataSource(){return se},get EnumRawTextLineStatus(){return pn},get EnumRegionObjectElementType(){return oe},get EnumSectionType(){return le},get EnumValidationStatus(){return _n},Feedback:tt,FramePipeline:ze,IdentityProcessor:Ns,IdentityUtilityModule:class{static getVersion(){return`1.0.10-dev-20260129110800(Worker: ${ve.identityutility&&ve.identityutility.worker||"Not Loaded"}, Wasm: ${ve.identityutility&&ve.identityutility.wasm||"Not Loaded"})`}},ImageDrawer:class{static async drawOnImage(e,t,i,n=4294901760,s=1,r="test.png",a){if(!e)throw new Error("Invalid image.");if(!t)throw new Error("Invalid drawingItem.");if(!i)throw new Error("Invalid type.");let o;if(e instanceof Blob)o=await O(e);else if("string"==typeof e){let t=await I(e,"blob");o=await O(t)}else E(e)&&(o=e,"bigint"==typeof o.format&&(o.format=Number(o.format)));return await new Promise((e,l)=>{let c=_e();Ee[c]=async t=>{if(t.success)return a&&Os.saveToFile(t.image,r,a),e(t.image);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},pe.postMessage({type:"utility_drawOnImage",id:c,body:{dsImage:o,drawingItem:Array.isArray(t)?t:[t],color:n,thickness:s,type:i}})})}},ImageEditorView:class e{_painter;_oriImage;_drawingLayers=[];static async createInstance(t){const i=new e,n=i._painter=new It;return n._dceGetQuads=()=>i._drawingLayers.filter(e=>e).map(e=>e._drawingItems.filter(e=>e instanceof ht)).flat(),n._dceSelectedItemIdx=0,n._dceSelectedItemIdxs=new Set,t&&await i.setUIElement(t),i}disposed;dispose(){this.disposed=!0}getUIElement(){const e=this._painter.getHtmlElement();return e.parentElement||e}setUIElement(e){const t=this._painter.getHtmlElement();if(e!==t)return e.append(t),Promise.resolve()}async setOriginalImage(e){this._oriImage=e,e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||(e=Je(e.bytes,e.width,e.height,e.format));const t=this._painter;t.cancelEdit(),t.del(),await t.addImage(e),await t.enterEdit(),await t.enterFreeTransformMode(),this._updateCvsToPainter(),this._updateFreeTransformWhenInitImgOrItem()}_updateCvsToPainter(){const e=this._painter;if("freeTransform"!==e.getMode())return;const t=e.getHtmlElement(),i=t.querySelector(".kPainterCanvas").style,n=e.getWidth(),s=e.getHeight();for(let e of this._drawingLayers){if(!e)continue;const r=e._ctx.canvas;r.width!==n&&(r.width=n),r.height!==s&&(r.height=s);for(let e of["left","top","right","bottom","width","height","transform"])r.style[e]=i[e];r.style.display="",t.querySelector(".kPainterImgsDiv").append(r)}}_updateFreeTransformWhenInitImgOrItem(){const e=this._painter;if("freeTransform"!==e.getMode())return;e._dceSelectedItemIdx=0,e._dceSelectedItemIdxs.clear();let t=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(t){let i=t.quad.points,n=e.getWidth(),s=e.getHeight();e.setFreeTransformCornerPos(i.map(({x:e,y:t})=>[e/n-.5,t/s-.5]))}else e.setFreeTransformCornerPos([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]])}getOriginalImage(){return this._oriImage}_createDrawingLayer(){const e=new lt;return e._ctx=document.createElement("canvas").getContext("2d"),e._mode="editor",e._oriAddDrawingItems=e.addDrawingItems,e.addDrawingItems=t=>{e._oriAddDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e._oriSetDrawingItems=e.setDrawingItems,e.setDrawingItems=t=>{e._oriSetDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e}createDrawingLayer(){const e=this._createDrawingLayer();return this._drawingLayers.push(e),this._updateCvsToPainter(),e}getDrawingLayer(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=this._createDrawingLayer(),1===e?t._defaultStyle=ot.STYLE_BLUE_STROKE:2===e?t._defaultStyle=ot.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=ot.STYLE_GREEN_STROKE_FILL),this._drawingLayers[e]=t,this._updateCvsToPainter()),t}getAllDrawingLayers(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)}clearUserDefinedDrawingLayers(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4}deleteUserDefinedDrawingLayer(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])}getSelectedDrawingItems(){const e=this._painter,t=e._dceGetQuads();let i=e._dceSelectedItemIdxs;if(t.length&&i.size)return t.filter((e,t)=>i.has(t));let n=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(!n){const e=this._painter;if("freeTransform"!==e.getMode())return null;n=new ht({points:null});let t=e.getWidth(),i=e.getHeight();n.quad.points=e.getFreeTransformCornerPos().map(e=>({x:(e[0]+.5)*t,y:(e[1]+.5)*i}))}return[n]}},ImageIO:Os,ImageProcessor:Ls,ImageSourceAdapter:j,IntermediateResultReceiver:class{constructor(){this._observedResultUnitTypes=ae.IRUT_ALL,this._observedTaskMap=new Map,this._parameters={setObservedResultUnitTypes:e=>{this._observedResultUnitTypes=e},getObservedResultUnitTypes:()=>this._observedResultUnitTypes,isResultUnitTypeObserved:e=>!!(e&this._observedResultUnitTypes),addObservedTask:e=>{this._observedTaskMap.set(e,!0)},removeObservedTask:e=>{this._observedTaskMap.set(e,!1)},isTaskObserved:e=>0===this._observedTaskMap.size||!!this._observedTaskMap.get(e)},this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null,this.onShortLinesUnitReceived=null}getObservationParameters(){return this._parameters}},KPainter:It,LabelRecognizerModule:gn,LicenseManager:zi,LicenseModule:class{static getVersion(){return`4.4.10-dev-20260129110719(Worker: ${ve.license&&ve.license.worker||"Not Loaded"}, Wasm: ${ve.license&&ve.license.wasm||"Not Loaded"})`}},MultiFrameResultCrossFilter:Ss,QuadDrawingItem:ht,UtilityModule:class{static getVersion(){return`2.4.10-dev-20260129110724(Worker: ${ve.utility&&ve.utility.worker||"Not Loaded"}, Wasm: ${ve.utility&&ve.utility.wasm||"Not Loaded"})`}},_bufferToCanvas:Je,_isPointInPolygon:ct,_saveToFile:C,_toBlob:M,_toCanvas:S,_toImage:D,get bDebug(){return Ie},beep:Ye,blobToDsImage:O,checkIsLink:w,compareVersion:v,createImageData:b,d:async(e,t)=>{const i=atob(e),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const s=n.slice(0,12),r=n.slice(12),a=new TextEncoder,o=await crypto.subtle.importKey("raw",a.encode(t),"PBKDF2",!1,["deriveKey"]),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:128},l,r);return(new TextDecoder).decode(c)},doOrWaitAsyncDependency:me,e:async(e,t)=>{const i=new TextEncoder,n=await crypto.subtle.importKey("raw",i.encode(t),"PBKDF2",!1,["deriveKey"]),s=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},s,i.encode(e)),o=new Uint8Array(r.length+a.byteLength);return o.set(r),o.set(new Uint8Array(a),r.length),btoa(String.fromCharCode.apply(null,o))},encodeBMP:A,getNextTaskID:_e,handleEngineResourcePaths:T,imagePtrToUint8Array:async e=>await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.u8);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},pe.postMessage({type:"imagePtrToUint8Array",id:n,body:{data:e}})}),innerVersions:ve,isArc:e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.radius)||e.radius<0||!p(e.startAngle)||!p(e.endAngle)),isContour:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&!e.points.some(e=>!R(e)),isDSImageData:E,isDSRect:e=>!(!f(e)||!p(e.left)||e.left<0||!p(e.top)||e.top<0||!p(e.right)||e.right<0||!p(e.bottom)||e.bottom<0||e.left>=e.right||e.top>=e.bottom),isDsImageKeyValue:(e,t)=>"bytes"===e&&"object"==typeof t&&"number"==typeof t.ptr&&"number"==typeof t.length,isImageTag:y,isLineSegment:e=>!(!f(e)||!R(e.startPoint)||!R(e.endPoint)||e.startPoint.x==e.endPoint.x&&e.startPoint.y==e.endPoint.y),isObject:f,isOriginalDsImageData:e=>!(!_(e)||!p(e.bytes.length)&&!p(e.bytes.ptr)),isPoint:R,isPolygon:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&!e.points.some(e=>!R(e)),isQuad:e=>!!f(e)&&!!m(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some(e=>!R(e)),isRect:e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.width)||e.width<0||!p(e.height)||e.height<0),isSimdSupported:()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),mapAsyncDependency:he,mapPackageRegister:Te,mapTaskCallBack:Ee,get onLog(){return ye},productNameMap:L,requestResource:I,resolveDsImageData:async e=>await new Promise((t,i)=>{let n=_e();Ee[n]=async e=>{if(e.success)return t(e.result);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},pe.postMessage({type:"resolveDsImageData",id:n,body:{point:e}})}),setBDebug:we,setOnLog:Re,stringToHtml:Pe,utilsFuncs:mn,vibrate:qe,waitAsyncDependency:ge,get worker(){return pe},workerAutoResources:Ce});e.EnumDocumentSide=void 0,(Ps=e.EnumDocumentSide||(e.EnumDocumentSide={})).MRZ="mrz",Ps.Opposite="opposite",e.EnumMRZScanMode=void 0,(xs=e.EnumMRZScanMode||(e.EnumMRZScanMode={})).Passport="passport",xs.TD1="td1",xs.TD2="td2",xs.PassportAndTD1="passportAndTd1",xs.PassportAndTD2="passportAndTd2",xs.TD1AndTD2="td1AndTd2",xs.All="all",e.EnumMRZDocumentType=void 0,(ks=e.EnumMRZDocumentType||(e.EnumMRZDocumentType={})).Passport="passport",ks.TD1="td1",ks.TD2="td2",e.EnumMRZScannerViews=void 0,(Bs=e.EnumMRZScannerViews||(e.EnumMRZScannerViews={})).Scanner="scanner",Bs.Result="scan-result";const Us={[e.EnumMRZScanMode.Passport]:"ReadPassport",[e.EnumMRZScanMode.TD1]:"ReadId-TD1",[e.EnumMRZScanMode.TD2]:"ReadId-TD2",[e.EnumMRZScanMode.PassportAndTD1]:"ReadPassportAndId-TD1",[e.EnumMRZScanMode.PassportAndTD2]:"ReadPassportAndId-TD2",[e.EnumMRZScanMode.TD1AndTD2]:"ReadId",[e.EnumMRZScanMode.All]:"ReadPassportAndId"};var Vs;function Gs(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}e.EnumResultStatus=void 0,(Vs=e.EnumResultStatus||(e.EnumResultStatus={}))[Vs.RS_SUCCESS=0]="RS_SUCCESS",Vs[Vs.RS_CANCELLED=1]="RS_CANCELLED",Vs[Vs.RS_FAILED=2]="RS_FAILED";function Ws(e,t){if(!document.getElementById(e)){const i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}}const Zs=e=>!e||0===Object.keys(e).length;function Hs(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}const zs={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};function js(e,t={}){const{message:i,spinnerSize:n=32}=t,s=document.createElement("div");s.className="dynamsoft-mrz-loading-screen";const r=document.createElement("div");r.className="dynamsoft-mrz-loading";const a=document.createElement("div");a.className="dynamsoft-mrz-loading-content";const o=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(a.innerHTML=o,i){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=i,a.appendChild(e)}return r.appendChild(a),s.appendChild(r),e.appendChild(s),{element:s,updateMessage:e=>{let t=r.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,a.appendChild(t)):null==t||t.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout(()=>{var e;null===(e=s.parentNode)||void 0===e||e.removeChild(s)},200))}}}const Ys='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var qs;e.EnumMRZData=void 0,(qs=e.EnumMRZData||(e.EnumMRZData={})).InvalidFields="invalidFields",qs.DocumentType="documentType",qs.DocumentNumber="documentNumber",qs.MRZText="mrzText",qs.FirstName="firstName",qs.LastName="lastName",qs.Age="age",qs.Sex="sex",qs.IssuingState="issuingState",qs.IssuingStateRaw="issuingStateRaw",qs.Nationality="nationality",qs.NationalityRaw="nationalityRaw",qs.DateOfBirth="dateOfBirth",qs.DateOfExpiry="dateOfExpiry",qs.OptionalData1="optionalData1",qs.OptionalData2="optionalData2";const $s={[e.EnumMRZData.InvalidFields]:"Invalid Fields",[e.EnumMRZData.DocumentType]:"Document Type",[e.EnumMRZData.DocumentNumber]:"Document Number",[e.EnumMRZData.MRZText]:"MRZ Text",[e.EnumMRZData.FirstName]:"Given Name(s)",[e.EnumMRZData.LastName]:"Surname",[e.EnumMRZData.Age]:"Age",[e.EnumMRZData.Sex]:"Sex",[e.EnumMRZData.IssuingState]:"Issuing State",[e.EnumMRZData.IssuingStateRaw]:"Issuing State (Raw Value)",[e.EnumMRZData.Nationality]:"Nationality",[e.EnumMRZData.NationalityRaw]:"Nationality State (Raw Value)",[e.EnumMRZData.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[e.EnumMRZData.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)",[e.EnumMRZData.OptionalData1]:"Optional Data 1",[e.EnumMRZData.OptionalData2]:"Optional Data 2"};function Xs(e,t,i,n=!1){const s=parseInt(e,10);let r;if(n)r=s>=60?1900+s:2e3+s;else{r=s>(new Date).getFullYear()%100?1900+s:2e3+s}return{year:r,month:parseInt(t,10),day:parseInt(i,10)}}function Qs(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function Ks(e){return"D<<"===e?"D":e}function Js(t,i){const n=[],s=e=>i.getFieldValidationStatus(e)===_n.VS_FAILED,r=i.codeType,a=function(t){switch(t){case"MRTD_TD1_ID":return e.EnumMRZDocumentType.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return e.EnumMRZDocumentType.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return e.EnumMRZDocumentType.Passport;default:throw new Error(`Unknown document type: ${t}`)}}(r),o=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(r),l=a===e.EnumMRZDocumentType.Passport&&"MRTD_TD3_PASSPORT"===r?"passportNumber":"documentNumber",c=Xs(i.getFieldValue("birthYear"),i.getFieldValue("birthMonth"),i.getFieldValue("birthDay")),d=Xs(i.getFieldValue("expiryYear"),i.getFieldValue("expiryMonth"),i.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach(t=>{s(t)&&n.push(e.EnumMRZData.DateOfBirth)}),["expiryYear","expiryMonth","expiryDay"].forEach(t=>{s(t)&&n.push(e.EnumMRZData.DateOfExpiry)});const u={[e.EnumMRZData.LastName]:i.getFieldValue("primaryIdentifier"),[e.EnumMRZData.FirstName]:i.getFieldValue("secondaryIdentifier"),[e.EnumMRZData.Nationality]:i.getFieldValue("nationality"),[e.EnumMRZData.NationalityRaw]:Ks(i.getFieldRawValue("nationality")),[e.EnumMRZData.DocumentNumber]:i.getFieldValue(l)||i.getFieldValue("longDocumentNumber"),[e.EnumMRZData.IssuingState]:i.getFieldValue("issuingState"),[e.EnumMRZData.IssuingStateRaw]:Ks(i.getFieldRawValue("issuingState")),[e.EnumMRZData.Sex]:Hs(i.getFieldValue("sex"))};Object.keys(u).forEach(t=>{let i=!1;switch(t){case e.EnumMRZData.FirstName:i=s("secondaryIdentifier");break;case e.EnumMRZData.LastName:i=s("primaryIdentifier");break;case e.EnumMRZData.DocumentNumber:i=s(l)||s("longDocumentNumber");break;default:i=s(t)}i&&n.push(t)});const h=function(e){const t=new Date,i=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(i?0:1)}(c);h<1&&n.push(e.EnumMRZData.Age);return{[e.EnumMRZData.InvalidFields]:n,[e.EnumMRZData.FirstName]:u[e.EnumMRZData.FirstName],[e.EnumMRZData.LastName]:u[e.EnumMRZData.LastName],[e.EnumMRZData.Age]:h,[e.EnumMRZData.DateOfBirth]:c,[e.EnumMRZData.Sex]:u[e.EnumMRZData.Sex],[e.EnumMRZData.Nationality]:u[e.EnumMRZData.Nationality],[e.EnumMRZData.NationalityRaw]:u[e.EnumMRZData.NationalityRaw],[e.EnumMRZData.DocumentNumber]:u[e.EnumMRZData.DocumentNumber],[e.EnumMRZData.DateOfExpiry]:d,[e.EnumMRZData.IssuingState]:u[e.EnumMRZData.IssuingState],[e.EnumMRZData.IssuingStateRaw]:u[e.EnumMRZData.IssuingStateRaw],[e.EnumMRZData.DocumentType]:Hs(o),[e.EnumMRZData.MRZText]:t}}class er{constructor(e){var t,i,n,s,r;this._primaryOriginalImage=null,this._secondaryOriginalImage=null,this._primaryDocumentImage=null,this._secondaryDocumentImage=null,this._portraitImage=null,this.status=e.status,this.data=e.data,this._primaryOriginalImage=null!==(t=e.primaryOriginalImage)&&void 0!==t?t:null,this._secondaryOriginalImage=null!==(i=e.secondaryOriginalImage)&&void 0!==i?i:null,this._primaryDocumentImage=null!==(n=e.primaryDocumentImage)&&void 0!==n?n:null,this._secondaryDocumentImage=null!==(s=e.secondaryDocumentImage)&&void 0!==s?s:null,this._portraitImage=null!==(r=e.portraitImage)&&void 0!==r?r:null}getDocumentImage(t){return t===e.EnumDocumentSide.MRZ?this._primaryDocumentImage:this._secondaryDocumentImage}getOriginalImage(t){return t===e.EnumDocumentSide.MRZ?this._primaryOriginalImage:this._secondaryOriginalImage}getPortraitImage(){return this._portraitImage}}const tr={[e.EnumMRZDocumentType.TD1]:{width:85.6,height:53.98},[e.EnumMRZDocumentType.TD2]:{width:105,height:74},[e.EnumMRZDocumentType.Passport]:{width:125,height:88}};class ir{showScannerLoadingOverlay(e){const t=Gs(this.config.container);this.loadingScreen=js(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(Gs(this.config.container).style.display="none"))}constructor(t,i){this.resources=t,this.config=i,this.isSoundFeedbackOn=!1,this.scanModeManager={[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},this.currentScanMode=e.EnumMRZScanMode.All,this.resizeTimer=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.flipTimeoutHandle=null,this.flipCountdownHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null},this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,soundFeedbackBtn:null,closeScannerBtn:null,scanModeSelectContainer:null,passportModeOption:null,td1ModeOption:null,td2ModeOption:null,toast:null},this.statusMessageElement=null,this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.toggleScanGuide(!0)},500)},this.firstFrame=!0}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),Ws("dynamsoft-mrz-loading-screen-style",Ys);try{const{cameraView:e,cameraEnhancer:t,cvRouter:i}=this.resources;if(e.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),e.setVideoFit("cover"),i.setInput(t),!0===this.config.enableMultiFrameCrossFilter){const e=new Ss;e.enableResultCrossVerification(Q.CRIT_TEXT_LINE,!0),await i.addResultFilter(e)}const n=new vi;n.onCapturedResultReceived=e=>this.handleMRZResult(e),await i.addResultReceiver(n),this.toggleSoundFeedback(!1),!1===this.config.showScanGuide&&this.toggleScanGuide(!1),this.initialized=!0}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera();const n=new er({status:e.EnumResultStatus.RS_FAILED});this.currentScanResolver(n)}}}initializeElements(){var e;const t=Gs(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))throw new Error("Shadow root not found");if(this.DCE_ELEMENTS={selectCameraBtn:i.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:i.shadowRoot.querySelector(".dce-mn-upload-image-icon"),soundFeedbackBtn:i.shadowRoot.querySelector(".dce-mn-sound-feedback"),closeScannerBtn:i.shadowRoot.querySelector(".dce-mn-close"),scanModeSelectContainer:i.shadowRoot.querySelector(".dce-mn-scan-mode-select"),passportModeOption:i.shadowRoot.querySelector(".scan-mode-option-passport"),td1ModeOption:i.shadowRoot.querySelector(".scan-mode-option-td1"),td2ModeOption:i.shadowRoot.querySelector(".scan-mode-option-td2"),toast:i.shadowRoot.querySelector(".dce-mn-toast")},this.setupScanModeSelector(),this.assignDCEClickEvents(),this.DCE_ELEMENTS.toast.style.display="none",!1===this.config.showUploadImage&&(this.DCE_ELEMENTS.uploadImageBtn.style.visibility="hidden"),!1===this.config.showSoundToggle&&(this.DCE_ELEMENTS.soundFeedbackBtn.style.visibility="hidden"),!1===(null===(e=this.config)||void 0===e?void 0:e.showPoweredByDynamsoft)){i.shadowRoot.querySelector(".dce-mn-msg-poweredby").style.display="none"}this.initializedDCE=!0}setupScanModeSelector(){if(!1!==this.config.showFormatSelector)switch(this.currentScanMode){case e.EnumMRZScanMode.PassportAndTD1:this.DCE_ELEMENTS.td2ModeOption.style.display="none";break;case e.EnumMRZScanMode.PassportAndTD2:this.DCE_ELEMENTS.td1ModeOption.style.display="none";break;case e.EnumMRZScanMode.TD1AndTD2:this.DCE_ELEMENTS.passportModeOption.style.display="none";break;case e.EnumMRZScanMode.All:break;default:this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}else this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.uploadImageBtn.onclick=()=>this.uploadFile(),this.DCE_ELEMENTS.soundFeedbackBtn.onclick=()=>this.toggleSoundFeedback(),this.DCE_ELEMENTS.closeScannerBtn.onclick=()=>this.handleCloseBtn(),this.DCE_ELEMENTS.selectCameraBtn.onclick=e=>{e.stopPropagation(),this.toggleSelectCameraBox()},this.DCE_ELEMENTS.passportModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.passportModeOption.style.display&&await this.toggleScanDocType(e.EnumMRZDocumentType.Passport)},this.DCE_ELEMENTS.td1ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td1ModeOption.style.display&&await this.toggleScanDocType(e.EnumMRZDocumentType.TD1)},this.DCE_ELEMENTS.td2ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td2ModeOption.style.display&&await this.toggleScanDocType(e.EnumMRZDocumentType.TD2)}}handleCloseBtn(){if(this.closeCamera(),this.currentScanResolver)if(this.isMRZScanned&&!this.isPortraitScanned&&(this.areSidesDifferent||this.isWaitingForPortraitAfterMRZ)){const t=new er({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:this.mrzSideData.portraitImage});this.currentScanResolver(t),this.resetScanningState()}else this.currentScanResolver(new er({status:e.EnumResultStatus.RS_CANCELLED})),this.resetScanningState()}attachOptionClickListeners(){const e=Gs(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...t.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...t.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach(e=>{e.addEventListener("click",async t=>{const n=e.getAttribute("data-davice-id"),s=e.getAttribute("data-height"),r=e.getAttribute("data-width");n?this.resources.cameraEnhancer.selectCamera(n).then(()=>{this.toggleScanGuide()}):s&&r&&this.resources.cameraEnhancer.setResolution({width:parseInt(r),height:parseInt(s)}).then(()=>{this.toggleScanGuide()}),"none"!==i.style.display&&this.toggleSelectCameraBox()})})}highlightCameraAndResolutionOption(){const e=Gs(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),n=i.querySelectorAll(".dce-mn-camera-option"),s=i.querySelectorAll(".dce-mn-resolution-option"),r=this.resources.cameraEnhancer.getSelectedCamera(),a=this.resources.cameraEnhancer.getResolution();n.forEach(e=>{const t=e;t.getAttribute("data-davice-id")===(null==r?void 0:r.deviceId)?t.style.border="2px solid #fe814a":t.style.border="none"});const o={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},l=function(e){const t=e.width*e.height,i=e.width/e.height;let n="480p",s=Number.MAX_VALUE;for(const[e,r]of Object.entries(zs)){const a=r.width*r.height,o=r.width/r.height,l=.7*Math.abs(a-t)+Math.abs(o-i)*a*.3;l<s&&(s=l,n=e)}return n}(a);s.forEach(e=>{const t=e,i=t.getAttribute("data-height");t.style.border=i===o[l]?"2px solid #fe814a":"none"})}toggleSelectCameraBox(){const e=Gs(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),i.click()}async relaunch(){}async uploadFile(){var t,i,n,s,r,a;const{cvRouter:o}=this.resources,l=document.createElement("input");l.type="file",l.accept=null!==(t=this.config.uploadAcceptedTypes)&&void 0!==t?t:"image/*",l.style.display="none",document.body.appendChild(l);try{this.showScannerLoadingOverlay("Processing file..."),await this.closeCamera(!1);const t=await new Promise((e,t)=>{l.onchange=i=>{var n;const s=null===(n=i.target.files)||void 0===n?void 0:n[0];s?e(s):t(new Error("No file selected"))},l.addEventListener("cancel",async()=>{this.hideScannerLoadingOverlay(!1),this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay()}),l.click()});if(!t)return;let c;if(this.config.uploadFileConverter&&!t.type.startsWith("image/"))try{c=await this.config.uploadFileConverter(t)}catch(e){throw new Error(`Error converting file: ${e.message}`)}else{if(!t.type.startsWith("image/"))throw new Error("Unsupported file type. Please provide a converter function for this file type.");c=t}const d=this.config.utilizedTemplateNames[this.currentScanMode],u=await o.capture(c,d);this.capturedResultItems=u.items;const h=this.capturedResultItems.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(0===h.length)throw new Error("No image data found in the captured result");const g=h[0].imageData;g.toCanvas=()=>S(g),g.toBlob=async()=>await M("image/png",g),this.originalImageData=g;const m=null===(i=null==u?void 0:u.parsedResult)||void 0===i?void 0:i.parsedResultItems;let p={};if(null==m?void 0:m.length){const e=(null===(s=null===(n=m[0])||void 0===n?void 0:n.referenceItem)||void 0===s?void 0:s.text)||"";p=Js(e,m[0])}const f=new er({status:e.EnumResultStatus.RS_SUCCESS,data:p,primaryOriginalImage:this.originalImageData});null===(a=(r=this.resources).onResultUpdated)||void 0===a||a.call(r,f),this.currentScanResolver(f)}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}finally{this.hideScannerLoadingOverlay(!0),document.body.removeChild(l)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn;const t=Gs(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-sound-feedback"),s=n.querySelector(".dce-mn-sound-feedback-on");n.querySelector(".dce-mn-sound-feedback-off").style.display=this.isSoundFeedbackOn?"none":"block",s.style.display=this.isSoundFeedbackOn?"block":"none"}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:i}=this.resources;if(!t||!t.isOpen())return;const n=tr[e].width/tr[e].height;let s;const r=i.getVisibleRegionOfVideo({inPixels:!0}),{width:a,height:o}=r;if(r){if(r.width>r.height){const e=.5*o*n,t=Math.round(e/a*100),i=(100-t)/2;s={left:i,right:i+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*a/n,t=Math.round(e/o*100),i=(100-t)/2;s={left:5,right:95,top:i,bottom:i+t,isMeasuredInPercentage:!0}}null==i||i.setScanRegionMaskVisible(!0),t.setScanRegion(s)}}toggleScanGuide(t){const i=Gs(this.config.container),n=i.children[i.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const s=n.shadowRoot.querySelector(".dce-scanguide-passport"),r=n.shadowRoot.querySelector(".dce-scanguide-td1"),a=n.shadowRoot.querySelector(".dce-scanguide-td2");if(!1===t||!1===this.config.showScanGuide)return s.style.display="none",r.style.display="none",void(a.style.display="none");switch(this.currentScanMode){case e.EnumMRZScanMode.All:case e.EnumMRZScanMode.Passport:case e.EnumMRZScanMode.PassportAndTD1:case e.EnumMRZScanMode.PassportAndTD2:s.style.display="block",r.style.display="none",a.style.display="none",this.calculateScanRegion(e.EnumMRZDocumentType.Passport);break;case e.EnumMRZScanMode.TD1:case e.EnumMRZScanMode.TD1AndTD2:s.style.display="none",r.style.display="block",a.style.display="none",this.calculateScanRegion(e.EnumMRZDocumentType.TD1);break;case e.EnumMRZScanMode.TD2:s.style.display="none",r.style.display="none",a.style.display="block",this.calculateScanRegion(e.EnumMRZDocumentType.TD2)}}async openCamera(){try{const{cameraEnhancer:e,cameraView:t}=this.resources,i=Gs(this.config.container);if(i.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const n=t.getUIElement();n.parentElement||i.append(n),e.setPixelFormat(l.IPF_ABGR_8888),await e.open();const s=n.shadowRoot;if(s){const e=s.querySelector(".dce-macro-use-mobile-native-like-ui");e&&(e.style.display="block")}}await e.setResolution({width:2560,height:1440}),!this.initializedDCE&&e.isOpen()&&await this.initializeElements(),window.addEventListener("resize",this.handleResize);const n=i.children[i.children.length-1];if(!(null==n?void 0:n.shadowRoot))throw new Error("Shadow root not found");n.shadowRoot.querySelector(".dce-mn-torch-off").style.display="none",n.shadowRoot.querySelector(".dce-mn-torch-on").style.display="none"}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}}async closeCamera(e=!0){try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:t,cameraView:i}=this.resources,n=Gs(this.config.container);n.style.display=e?"none":"block",(null==i?void 0:i.getUIElement().parentElement)&&n.removeChild(i.getUIElement()),t.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}async handleMRZResult(t){var i,n,s,r,a,o,l,c;if(this.firstFrame)this.firstFrame=!1;else{if(console.log("[MRZ DEBUG] handleMRZResult — itemTypes:",t.items.map(e=>e.type),"| isMRZScanned:",this.isMRZScanned,"| areSidesDifferent:",this.areSidesDifferent,"| isPortraitScanned:",this.isPortraitScanned,"| isWaitingForFlip:",this.isWaitingForFlip),this.isMRZScanned&&!this.isPortraitScanned&&this.isWaitingForPortraitAfterMRZ){const{onResultUpdated:e}=this.resources;return void await this.tryPortraitOnSameSide(t,e)}if(this.isMRZScanned&&!this.isPortraitScanned&&this.areSidesDifferent&&!this.isWaitingForFlip){const e=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(e.length>0){const t=e[0].imageData;t.toCanvas=()=>S(t),t.toBlob=async()=>await M("image/png",t),this.originalImageData=t}const{onResultUpdated:i}=this.resources;return void await this.handlePortraitSideScan(t,i)}if(!(t.items.length<=1)){this.capturedResultItems=t.items;try{const{onResultUpdated:e}=this.resources,d=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(d.length>0){const e=d[0].imageData;e.toCanvas=()=>S(e),e.toBlob=async()=>await M("image/png",e),this.originalImageData=e}const u=null===(i=null==t?void 0:t.parsedResult)||void 0===i?void 0:i.parsedResultItems;if(null==u?void 0:u.length){this.isSoundFeedbackOn&&tt.beep();const i=(null===(s=null===(n=u[0])||void 0===n?void 0:n.referenceItem)||void 0===s?void 0:s.text)||"",d=Js(i,u[0]);let h=null;if(this.resources.returnDocumentImage||this.resources.returnPortraitImage){const e=t.processedDocumentResult;if((null===(r=null==e?void 0:e.detectedQuadResultItems)||void 0===r?void 0:r.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==re.CVS_FAILED&&(h=t.location)}const i=t.processedDocumentResult;if(console.log("[MRZ DEBUG] processedDocumentResult:",null==i?String(i):`detectedQuads=${null!==(o=null===(a=null==i?void 0:i.detectedQuadResultItems)||void 0===a?void 0:a.length)&&void 0!==o?o:0}, deskewedImages=${null!==(c=null===(l=null==i?void 0:i.deskewedImageResultItems)||void 0===l?void 0:l.length)&&void 0!==c?c:0}`),this.resources.returnDocumentImage&&!h)return void console.warn("[MRZ DEBUG] Skipping frame — returnDocumentImage=true but no valid documentQuad found")}let g=null;if(this.resources.returnDocumentImage&&h&&this.originalImageData)try{g=await Ls.cropAndDeskewImage(this.originalImageData,h),g.toCanvas=()=>S(g),g.toBlob=async()=>await M("image/png",g)}catch(e){console.warn("Error extracting document image:",e)}this.isMRZScanned||await this.handleMRZSideScan(d,g,h,e)}}catch(t){let i=(null==t?void 0:t.message)||t;console.error(i),alert(i),this.closeCamera(),this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}}}}initializeScanModeManager(){const{mrzFormatType:t}=this.config;if(this.scanModeManager={[e.EnumMRZDocumentType.Passport]:!0,[e.EnumMRZDocumentType.TD1]:!0,[e.EnumMRZDocumentType.TD2]:!0},!t||Array.isArray(t)&&0===t.length)return;Object.keys(this.scanModeManager).forEach(e=>{this.scanModeManager[e]=!1});(Array.isArray(t)?t:[t]).forEach(e=>{this.scanModeManager[e]=!0})}getScanMode(){const t=Object.entries(this.scanModeManager).filter(([e,t])=>t).map(([e])=>e).sort().join(",");return{[e.EnumMRZDocumentType.Passport]:e.EnumMRZScanMode.Passport,[e.EnumMRZDocumentType.TD1]:e.EnumMRZScanMode.TD1,[e.EnumMRZDocumentType.TD2]:e.EnumMRZScanMode.TD2,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD1}`]:e.EnumMRZScanMode.PassportAndTD1,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.PassportAndTD2,[`${e.EnumMRZDocumentType.TD1},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.TD1AndTD2,[`${e.EnumMRZDocumentType.Passport},${e.EnumMRZDocumentType.TD1},${e.EnumMRZDocumentType.TD2}`]:e.EnumMRZScanMode.All,"":e.EnumMRZScanMode.All}[t]}DCEShowToast(e,t=3e3){this.DCE_ELEMENTS.toast&&(this.DCE_ELEMENTS.toast.textContent=e,this.DCE_ELEMENTS.toast.style.display="",setTimeout(()=>{this.DCE_ELEMENTS.toast.style.display="none"},t))}async startCapturing(){const{cvRouter:t}=this.resources,i=this.config.utilizedTemplateNames[this.currentScanMode];try{this.firstFrame=!0,await t.startCapturing(i)}catch(t){let i=(null==t?void 0:t.message)||t;console.error("Failed to start capturing:",i),this.closeCamera(),this.currentScanResolver&&this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}}async toggleScanDocType(t){try{if(this.scanModeManager[t]&&0===Object.entries(this.scanModeManager).filter(([e,i])=>i&&e!==t).length)return console.warn("MRZ Scanner - At least one mode must be enabled"),void this.DCEShowToast("At least one mode must be enabled");this.scanModeManager[t]=!this.scanModeManager[t],this.currentScanMode=this.getScanMode(),this.stopCapturing(),this.toggleScanGuide(),await this.startCapturing(),this.DCE_ELEMENTS.td1ModeOption.classList.toggle("selected",this.scanModeManager[e.EnumMRZDocumentType.TD1]),this.DCE_ELEMENTS.td2ModeOption.classList.toggle("selected",this.scanModeManager[e.EnumMRZDocumentType.TD2]),this.DCE_ELEMENTS.passportModeOption.classList.toggle("selected",this.scanModeManager[e.EnumMRZDocumentType.Passport])}catch(t){let i=(null==t?void 0:t.message)||t;console.error("MRZ Scanner switch scan mode error: ",i),this.closeCamera(),this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}}async launch(){try{this.resetScanningState(),await this.initialize();const{cvRouter:e,cameraEnhancer:t}=this.resources;return new Promise(async e=>{this.currentScanResolver=e,this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),!this.initializedDCE&&t.isOpen()&&await this.initializeElements(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay(),this.resources.returnPortraitImage?this.showStatusMessage("Please scan the MRZ side first"):this.showStatusMessage("Please scan the MRZ side of the document")})}catch(t){let i=(null==t?void 0:t.message)||t;console.error("MRZ Scanner launch error: ",i),this.closeCamera(),this.currentScanResolver(new er({status:e.EnumResultStatus.RS_FAILED}))}}createStatusMessageElement(){const e=document.createElement("div");return e.className="dce-status-message",e.style.cssText="\n      position: absolute;\n      bottom: 25%;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 16px;\n      font-family: Verdana, sans-serif;\n      z-index: 999;\n      text-align: center;\n      max-width: 80%;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n    ",e}showStatusMessage(e,t){if(!this.statusMessageElement){const e=Gs(this.config.container),t=e.children[e.children.length-1];(null==t?void 0:t.shadowRoot)&&(this.statusMessageElement=this.createStatusMessageElement(),t.shadowRoot.appendChild(this.statusMessageElement))}this.statusMessageElement&&(this.statusMessageElement.textContent=e,this.statusMessageElement.style.display="block",t&&setTimeout(()=>{this.hideStatusMessage()},t))}hideStatusMessage(){this.statusMessageElement&&(this.statusMessageElement.style.display="none")}showSuccessBorder(e=1e3){const t=Gs(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;[i.shadowRoot.querySelector(".dce-mn-bg-mrz-passport"),i.shadowRoot.querySelector(".dce-mn-bg-mrz-td1"),i.shadowRoot.querySelector(".dce-mn-bg-mrz-td2")].forEach(t=>{if(t&&"none"!==t.style.display){const i=t.style.border;t.style.border="3px solid #4CAF50",setTimeout(()=>{t.style.border=i},e)}})}async handleMRZSideScan(t,i,n,s){let r=null,a=!1;if(this.resources.returnPortraitImage)try{const e=await Ns.findPortraitZone();if(console.log("[MRZ DEBUG] findPortraitZone result:",e,"| originalImageData:",!!this.originalImageData),e&&!e.errorCode){const t=!n||this.validatePortraitLocation(e,n);console.log("[MRZ DEBUG] portrait validation — isValid:",t,"| documentQuad:",n),t&&this.originalImageData&&(r=await Ls.cropAndDeskewImage(this.originalImageData,e),r.toCanvas=()=>S(r),r.toBlob=async()=>await M("image/png",r),a=!0)}}catch(e){console.warn("Error finding portrait zone:",e)}if(this.isMRZScanned=!0,this.mrzSideData={processedData:t,primaryOriginalImage:this.originalImageData,primaryDocumentImage:i,portraitImage:r},this.resources.returnPortraitImage&&!a)console.log("[MRZ DEBUG] handleMRZSideScan — MRZ scanned, waiting 1s for portrait on same side..."),this.isWaitingForPortraitAfterMRZ=!0,this.flipTimeoutHandle=window.setTimeout(()=>{var e;if(this.flipTimeoutHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isPortraitScanned)return;console.log("[MRZ DEBUG] Portrait not found within 1s. Starting flip prompt."),this.areSidesDifferent=!0,this.isWaitingForFlip=!0;const t=null!==(e=this.config.flipDocumentTimeout)&&void 0!==e?e:3e3;let i=Math.ceil(t/1e3);this.showSuccessBorder(1e3),this.showStatusMessage(`MRZ scanned! Please flip the document (${i}s)`),this.flipCountdownHandle=window.setInterval(()=>{i--,i>0&&this.showStatusMessage(`Please flip the document (${i}s)`)},1e3),this.flipTimeoutHandle=window.setTimeout(()=>{window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null,this.flipTimeoutHandle=null,this.isWaitingForFlip=!1,this.showStatusMessage("Now scan the portrait side")},t)},1e3);else{this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.showSuccessBorder(1e3);const n=r?"MRZ and portrait successfully scanned!":"MRZ successfully scanned!";this.showStatusMessage(n,1e3),setTimeout(()=>{this.closeCamera();const n=new er({status:e.EnumResultStatus.RS_SUCCESS,data:t,primaryOriginalImage:this.originalImageData,primaryDocumentImage:i,portraitImage:r});null==s||s(n),this.currentScanResolver(n),this.resetScanningState()},1e3)}}async tryPortraitOnSameSide(t,i){var n;if(!this.isWaitingForPortraitAfterMRZ)return;this.isWaitingForPortraitAfterMRZ=!1;let s=!1;try{const r=t.items.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE);if(r.length>0){const e=r[0].imageData;e.toCanvas=()=>S(e),e.toBlob=async()=>await M("image/png",e),this.originalImageData=e}const a=await Ns.findPortraitZone();if(this.isPortraitScanned)return;if(a&&!a.errorCode){let r=null;const o=t.processedDocumentResult;if((null===(n=null==o?void 0:o.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const e=o.detectedQuadResultItems[0];e.CrossVerificationStatus!==re.CVS_FAILED&&(r=e.location)}if((!r||this.validatePortraitLocation(a,r))&&this.originalImageData){s=!0;const t=await Ls.cropAndDeskewImage(this.originalImageData,a);t.toCanvas=()=>S(t),t.toBlob=async()=>await M("image/png",t),null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.mrzSideData.portraitImage=t,this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const n=new er({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:t});null==i||i(n),this.currentScanResolver(n),this.resetScanningState()},1e3)}}}catch(e){console.warn("[MRZ DEBUG] tryPortraitOnSameSide — error:",e)}finally{s||null===this.flipTimeoutHandle||(this.isWaitingForPortraitAfterMRZ=!0)}}async handlePortraitSideScan(t,i){var n;if(this.isProcessingPortraitFrame)return;this.isProcessingPortraitFrame=!0,console.log("[MRZ DEBUG] handlePortraitSideScan entered — originalImageData:",!!this.originalImageData);let s=!1;try{const r=await Ns.findPortraitZone();if(console.log("[MRZ DEBUG] handlePortraitSideScan — findPortraitZone result:",r),r&&!r.errorCode&&this.originalImageData){s=!0,this.isPortraitScanned=!0;let a=this.originalImageData,o=null;if(this.resources.returnDocumentImage)try{const e=t.processedDocumentResult;if((null===(n=null==e?void 0:e.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const t=e.detectedQuadResultItems[0];if(t.CrossVerificationStatus!==re.CVS_FAILED){const e=t.location;o=await Ls.cropAndDeskewImage(this.originalImageData,e),o.toCanvas=()=>S(o),o.toBlob=async()=>await M("image/png",o)}}}catch(e){console.warn("Error extracting secondary document image:",e)}let l=null;try{l=await Ls.cropAndDeskewImage(this.originalImageData,r),l.toCanvas=()=>S(l),l.toBlob=async()=>await M("image/png",l)}catch(e){console.warn("Error cropping portrait image:",e)}this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const t=new er({status:e.EnumResultStatus.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,secondaryOriginalImage:a,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,secondaryDocumentImage:o,portraitImage:l||this.mrzSideData.portraitImage});null==i||i(t),this.currentScanResolver(t),this.resetScanningState()},1e3)}}catch(e){console.warn("Error finding portrait on second side:",e)}finally{s||(this.isProcessingPortraitFrame=!1)}}resetScanningState(){this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),null!==this.flipCountdownHandle&&(window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null),this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null}}validatePortraitLocation(e,t){if(!e.points.every(e=>this.isPointInQuadrilateral(e,t)))return!1;return t.area/e.area>=3}isPointInQuadrilateral(e,t){const i=t.points;let n=!1;for(let t=0,s=i.length-1;t<i.length;s=t++){const r=i[t].x,a=i[t].y,o=i[s].x,l=i[s].y;a>e.y!=l>e.y&&e.x<(o-r)*(e.y-a)/(l-a)+r&&(n=!n)}return n}}const nr={cancel:'\n<svg id="cancel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cancelclip-path">\n      <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_582" data-name="Group 582" clip-path="url(#cancelclip-path)" transform="rotate(180 12 12)">\n    <path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n    <path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n  </g>\n</svg>  \n  ',rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class sr{constructor(e,t,i){this.resources=e,this.config=t,this.scannerView=i,this.editedFields={}}async launch(){try{return Gs(this.config.container).textContent="",await this.initialize(),Gs(this.config.container).style.display="flex",new Promise(e=>{this.currentScanResultViewResolver=e})}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const t=await this.scannerView.launch();if((null==t?void 0:t.status)===e.EnumResultStatus.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(t));this.resources.onResultUpdated&&((null==t?void 0:t.status)===e.EnumResultStatus.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==t?void 0:t.status)===e.EnumResultStatus.RS_SUCCESS&&this.resources.onResultUpdated(t)),this.dispose(!0),await this.initialize(),Gs(this.config.container).style.display="flex"}catch(t){throw console.error("Error in rescan handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new er({status:e.EnumResultStatus.RS_FAILED})),t}}async handleCancel(){var t;try{(null===(t=this.config)||void 0===t?void 0:t.onCancel)&&await this.config.onCancel(this.resources.result),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new er({status:e.EnumResultStatus.RS_CANCELLED})),this.hideView(),this.dispose()}catch(t){throw console.error("Error in cancel handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new er({status:e.EnumResultStatus.RS_FAILED})),t}}async handleDone(){var t,i;try{(null===(t=this.resources.result)||void 0===t?void 0:t.data)&&!Zs(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(i=this.config)||void 0===i?void 0:i.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(t){throw console.error("Error in done handler:",t),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new er({status:e.EnumResultStatus.RS_FAILED})),t}}createControls(){var e,t,i,n,s,r,a,o,l,c,d,u;const{toolbarButtonsConfig:h}=this.config;return function(e){Ws("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach(e=>{const i=document.createElement("div");i.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const n=document.createElement("div");if(n.className="dynamsoft-mrz-control-icon-wrapper",(s=e.icon).trim().startsWith("<svg")&&s.trim().endsWith("</svg>"))n.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,n.appendChild(t)}var s;const r=document.createElement("div");r.className="dynamsoft-mrz-control-text",r.textContent=e.label,e.isDisabled&&i.classList.add("disabled"),e.isHidden&&i.classList.add("hide"),i.appendChild(n),i.appendChild(r),e.onClick&&!e.isDisabled&&i.addEventListener("click",e.onClick),t.appendChild(i)}),t}([this.config._isFileMode?{id:"dynamsoft-mrz-scanResult-cancel",icon:(null===(e=null==h?void 0:h.cancel)||void 0===e?void 0:e.icon)||nr.cancel,label:(null===(t=null==h?void 0:h.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(i=null==h?void 0:h.cancel)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==h?void 0:h.cancel)||void 0===n?void 0:n.isHidden)||!1}:{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(s=null==h?void 0:h.rescan)||void 0===s?void 0:s.icon)||nr.rescan,label:(null===(r=null==h?void 0:h.rescan)||void 0===r?void 0:r.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(a=null==h?void 0:h.rescan)||void 0===a?void 0:a.className)||""}`,isHidden:(null===(o=null==h?void 0:h.rescan)||void 0===o?void 0:o.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(l=null==h?void 0:h.done)||void 0===l?void 0:l.icon)||nr.complete,label:(null===(c=null==h?void 0:h.done)||void 0===c?void 0:c.label)||"Done",className:`${(null===(d=null==h?void 0:h.done)||void 0===d?void 0:d.className)||""}`,isHidden:(null===(u=null==h?void 0:h.done)||void 0===u?void 0:u.isHidden)||!1,onClick:()=>this.handleDone()}])}getImagesToDisplay(){const t=[],i=this.resources.result;if(!i)return t;if(this.resources.returnOriginalImage){const n=i.getOriginalImage(e.EnumDocumentSide.MRZ);n&&t.push({imageData:n,label:"Original Image (MRZ Side)"});const s=i.getOriginalImage(e.EnumDocumentSide.Opposite);s&&t.push({imageData:s,label:"Original Image (Portrait Side)"})}if(this.resources.returnDocumentImage){const n=i.getDocumentImage(e.EnumDocumentSide.MRZ);n&&t.push({imageData:n,label:"Document Image (MRZ Side)"});const s=i.getDocumentImage(e.EnumDocumentSide.Opposite);s&&t.push({imageData:s,label:"Document Image (Portrait Side)"})}if(this.resources.returnPortraitImage){const e=i.getPortraitImage();e&&t.push({imageData:e,label:"Portrait Image"})}return t}createImagesDisplay(){const e=this.getImagesToDisplay();if(0===e.length)return null;const t=document.createElement("div");return t.className="dynamsoft-mrz-images-container",e.forEach(({imageData:e,label:i})=>{const n=document.createElement("div");n.className="dynamsoft-mrz-image-wrapper";const s=document.createElement("div");let r;s.className="dynamsoft-mrz-image-label",s.textContent=i,n.appendChild(s),(null==e?void 0:e.toCanvas)&&(r=e.toCanvas()),r&&(Object.assign(r.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),n.appendChild(r)),t.appendChild(n)}),t}handleFieldEdit(t,i){if(t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry)try{const[e,n,s]=i.split(/[\/\-\.]/);s&&n&&e&&(this.editedFields[t]={day:parseInt(s,10),month:parseInt(n,10),year:parseInt(e,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[t]=i}createMRZDataDisplay(){var t,i,n,s;const r=(null===(t=this.resources.result)||void 0===t?void 0:t.data)||{},a=!!this.config.allowResultEditing,o=r.invalidFields||[],l=[e.EnumMRZData.InvalidFields,e.EnumMRZData.IssuingStateRaw,e.EnumMRZData.NationalityRaw];!1===(null===(i=this.config)||void 0===i?void 0:i.showMRZText)&&l.push(e.EnumMRZData.MRZText);const c=document.createElement("div");if(c.className="dynamsoft-mrz-data-container",Zs(r)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText=null!==(s=null===(n=this.config)||void 0===n?void 0:n.emptyResultMessage)&&void 0!==s?s:"The necessary information could not be detected. Please try again.",c.appendChild(e),c}if(o.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${nr.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${a?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,c.appendChild(e)}else if(0===o.length&&a){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${nr.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,c.appendChild(e)}return Object.entries(r).forEach(([t,i])=>{if(l.includes(t)||!i)return;const n=document.createElement("div");n.className="dynamsoft-mrz-data-row";const s=o.includes(t);s&&n.classList.add("invalid-field");const r=[e.EnumMRZData.MRZText,e.EnumMRZData.DocumentType,e.EnumMRZData.IssuingStateRaw,e.EnumMRZData.NationalityRaw],d=document.createElement("span");if(d.className="dynamsoft-mrz-data-label",d.innerText=$s[t]||t,s){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=nr.failed,d.appendChild(e),a){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",d.appendChild(e)}}const u=document.createElement("div");if(u.className="dynamsoft-mrz-data-value",a&&!r.includes(t)){const r=document.createElement("input");r.className="dynamsoft-mrz-data-input",s&&r.classList.add("invalid"),t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry?(r.value=Qs(i),r.setAttribute("placeholder","YYYY-MM-DD")):r.value=i,r.addEventListener("input",e=>{if(this.handleFieldEdit(t,e.target.value),s){r.classList.remove("invalid"),n.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...o]);const e=this.editedFields.invalidFields.indexOf(t);e>-1&&this.editedFields.invalidFields.splice(e,1)}}),u.appendChild(r)}else t===e.EnumMRZData.MRZText?(u.classList.add("code"),u.innerText=i):t===e.EnumMRZData.DateOfBirth||t===e.EnumMRZData.DateOfExpiry?u.innerText=Qs(i):u.innerText=i,s&&u.classList.add("invalid-value");n.appendChild(d),n.appendChild(u),c.appendChild(n)}),c}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");Ws("dynamsoft-mrz-result-view-style",rr);const e=document.createElement("div");e.className="dynamsoft-mrz-result-view-container";const t=this.createImagesDisplay();t&&e.appendChild(t);const i=this.createMRZDataDisplay();e.appendChild(i);const n=this.createControls();e.appendChild(n),Gs(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){Gs(this.config.container).style.display="none"}dispose(e=!1){Gs(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const rr="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-images-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    width: 100%;\n    max-height: 300px;\n    overflow-y: auto;\n    padding: 1rem;\n    background-color: #323234;\n  }\n\n  .dynamsoft-mrz-image-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    background: #2a2a2c;\n    padding: 0.75rem;\n    border-radius: 6px;\n    border: 1px solid #404042;\n  }\n\n  .dynamsoft-mrz-image-label {\n    font-size: 0.85rem;\n    color: #aaa;\n    text-align: center;\n    font-weight: 500;\n    margin-bottom: 0.25rem;\n  }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: #fe8e14;\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-images-container{\n      flex: 1;\n      height: 100%;\n      max-height: none;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",ar={rootDirectory:"./resources/",dcvBundle:"./resources/dynamsoft-capture-vision-bundle@3.4.1000-dev-20260214095351/dist/",dcvData:"./resources/dynamsoft-capture-vision-data@1.2.0-dev-20260121170704/"};class or{showLoadingOverlay(e){var t,i;const n=Gs(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||Gs(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen=js(n,{message:e}),n.style.display="block",n.style.position="relative"}hideLoadingOverlay(e=!1){var t,i,n;const s=Gs(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||Gs(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,s.style.display="none",e&&(null===(n=this.config)||void 0===n?void 0:n.container)&&(Gs(this.config.container).style.display="none"))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources()}async initialize(){var e,t,i;if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};Ws("dynamsoft-mrz-loading-screen-style",Ys),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e},this.resources.returnOriginalImage=null!==(e=this.config.returnOriginalImage)&&void 0!==e&&e,this.resources.returnDocumentImage=null===(t=this.config.returnDocumentImage)||void 0===t||t,this.resources.returnPortraitImage=null===(i=this.config.returnPortraitImage)||void 0===i||i;const n={};return!this.isFileMode&&this.config.scannerViewConfig&&(this.scannerView=new ir(this.resources,this.config.scannerViewConfig),n.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new sr(this.resources,this.config.resultViewConfig,this.scannerView),n.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:n}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;throw console.error(t),new Error(t)}finally{this.hideLoadingOverlay(!0)}}initializeDynamsoftResources(){var e;Me.engineResourcePaths=Zs(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?ar:this.config.engineResourcePaths,Me.loadWasm(),bn.loadSpec("MRTD"),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t,i,n;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),zi._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=mrz&deploymenttype=web)"),await zi.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await Xe.createInstance((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath)||(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath)),this.resources.cameraEnhancer=await $e.createInstance(this.resources.cameraView)),this.resources.cvRouter=await wi.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath)}catch(e){let t="string"==typeof e?e:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"object"==typeof e?JSON.stringify(e):String(e);const i=(null==t?void 0:t.toLowerCase().includes("license"))?"The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(i),new Error(i)}}shouldCreateDefaultContainer(){var e,t;const i=!this.config.container,n=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return i&&n}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,i,n,s,r,a,o;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)&&(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!Gs(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)&&!Gs(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.resultViewConfig)||void 0===a?void 0:a.container)&&!Gs(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var t,i,n,s,r,a,o,l;this.config=null!==(t=this.config)&&void 0!==t?t:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=Gs(this.config.container));const c=this.config.container?this.createViewContainers(Gs(this.config.container)):{},d={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(e.EnumMRZScanMode).map(e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||Us[e]]})),templateFilePath:(null===(i=this.config)||void 0===i?void 0:i.templateFilePath)||"./dist/mrz-scanner.template.json"},u=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:c[e.EnumMRZScannerViews.Scanner]||Gs(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.uiPath)||(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.cameraEnhancerUIPath)||"./dist/mrz-scanner.ui.html",templateFilePath:d.templateFilePath,utilizedTemplateNames:d.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(o=null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.enableMultiFrameCrossFilter)||void 0===o||o,mrzFormatType:this.config.mrzFormatType}),h=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{_isFileMode:this.isFileMode,container:c[e.EnumMRZScannerViews.Result]||Gs(null===(l=this.config.resultViewConfig)||void 0===l?void 0:l.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},d),{scannerViewConfig:u,resultViewConfig:h})),!0}createViewContainers(t){t.textContent="";const i=[e.EnumMRZScannerViews.Scanner];return this.showResultView()&&i.push(e.EnumMRZScannerViews.Result),i.reduce((e,i)=>{const n=document.createElement("div");return n.className=`mrz-scanner-${i}-view-container`,Object.assign(n.style,{height:"100%",width:"100%",display:"none",position:"relative"}),t.append(n),e[i]=n,e},{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const i=e=>{const t=Gs(e);t&&(t.style.display="none",t.textContent="")};i(this.config.container),i(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),i(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async processUploadedFile(t){var i,n,s,r,a,o,l;try{this.showLoadingOverlay("Processing File...");const{cvRouter:c}=this.resources,d=null===(i=this.config.utilizedTemplateNames)||void 0===i?void 0:i.all,u=await c.getSimplifiedSettings(d);u.roiMeasuredInPercentage=!0,u.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await c.updateSettings(d,u);const h=await c.capture(t,d),g=h.items,m=g.filter(e=>e.type===Q.CRIT_ORIGINAL_IMAGE)[0].imageData;m.toCanvas=()=>S(m),m.toBlob=async()=>await M("image/png",m);const p=null===(n=null==h?void 0:h.parsedResult)||void 0===n?void 0:n.parsedResultItems;let f={};if(null==p?void 0:p.length){const e=(null===(r=null===(s=p[0])||void 0===s?void 0:s.referenceItem)||void 0===r?void 0:r.text)||"";f=Js(e,p[0])}let _=null;if(this.resources.returnDocumentImage)try{const e=h.processedDocumentResult;if((null===(a=null==e?void 0:e.detectedQuadResultItems)||void 0===a?void 0:a.length)>0){const t=e.detectedQuadResultItems[0];if(t.CrossVerificationStatus!==re.CVS_FAILED){const e=t.location;_=await Ls.cropAndDeskewImage(m,e),_.toCanvas=()=>S(_),_.toBlob=async()=>await M("image/png",_)}}}catch(e){console.warn("Error extracting document image from static file:",e)}const E=new er({status:e.EnumResultStatus.RS_SUCCESS,data:f,primaryOriginalImage:m,primaryDocumentImage:_});null===(l=(o=this.resources).onResultUpdated)||void 0===l||l.call(o,E)}catch(t){return console.error("Failed to process uploaded file:",t),new er({status:e.EnumResultStatus.RS_FAILED})}finally{this.hideLoadingOverlay(!1)}}async launch(t){var i;if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0,this.isFileMode=!!t;const{components:n}=await this.initialize();if(this.config.container&&(Gs(this.config.container).style.display="block"),this.isFileMode)return await this.processUploadedFile(t),n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView&&this.resources.result)return n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView)throw new Error("Scanner view is required when no previous result exists");const s=await n.scannerView.launch();return(null==s?void 0:s.status)!==e.EnumResultStatus.RS_SUCCESS?new er({status:null!==(i=null==s?void 0:s.status)&&void 0!==i?i:e.EnumResultStatus.RS_FAILED}):n.resultView?await n.resultView.launch():this.resources.result}catch(t){return alert((null==t?void 0:t.message)||t),console.error((null==t?void 0:t.message)||t),new er({status:e.EnumResultStatus.RS_FAILED})}finally{this.isCapturing=!1,this.dispose()}}}const lr={MRZScanner:or,MRZScannerView:ir,MRZResultView:sr};e.DEFAULT_TEMPLATE_NAMES=Us,e.Dynamsoft=Fs,e.DynamsoftMRZScanner=lr,e.MRZDataLabel=$s,e.MRZResultView=sr,e.MRZScanner=or,e.MRZScannerView=ir,e.displayMRZDate=Qs});
