const e=e=>e&&"object"==typeof e&&"function"==typeof e.then,t=(async()=>{})().constructor;let i=class extends t{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(i){let n;this._task=i,e(i)?n=i:"function"==typeof i&&(n=new t(i)),n&&(async()=>{try{const e=await n;i===this._task&&this.resolve(e)}catch(e){i===this._task&&this.reject(e)}})()}get isEmpty(){return null==this._task}constructor(t){let i,n;super((e,t)=>{i=e,n=t}),this._s="pending",this.resolve=t=>{this.isPending&&(e(t)?this.task=t:(this._s="fulfilled",i(t)))},this.reject=e=>{this.isPending&&(this._s="rejected",n(e))},this.task=t}};function n(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function s(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}var r,a,o;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(r||(r={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(a||(a={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(o||(o={}));const l="undefined"==typeof self,c="function"==typeof importScripts,d=(()=>{if(!c){if(!l&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),h=e=>{if(null==e&&(e="./"),l||c);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},u=e=>Object.prototype.toString.call(e),g=e=>Array.isArray?Array.isArray(e):"[object Array]"===u(e),p=e=>"number"==typeof e&&!Number.isNaN(e),f=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),m=e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.radius)||e.radius<0||!p(e.startAngle)||!p(e.endAngle)),_=e=>!!f(e)&&!!g(e.points)&&0!=e.points.length&&!e.points.some(e=>!T(e)),E=e=>!(!f(e)||!p(e.width)||e.width<=0||!p(e.height)||e.height<=0||!p(e.stride)||e.stride<=0||!("format"in e)||"tag"in e&&!v(e.tag)),y=(e,t)=>"bytes"===e&&"object"==typeof t&&"number"==typeof t.ptr&&"number"==typeof t.length,I=e=>!(!E(e)||!p(e.bytes.length)&&!p(e.bytes.ptr)),R=e=>!!E(e)&&e.bytes instanceof Uint8Array,w=e=>!(!f(e)||!p(e.left)||e.left<0||!p(e.top)||e.top<0||!p(e.right)||e.right<0||!p(e.bottom)||e.bottom<0||e.left>=e.right||e.top>=e.bottom),v=e=>null===e||!!f(e)&&!!p(e.imageId)&&"type"in e,C=e=>!(!f(e)||!T(e.startPoint)||!T(e.endPoint)||e.startPoint.x==e.endPoint.x&&e.startPoint.y==e.endPoint.y),T=e=>!!f(e)&&!!p(e.x)&&!!p(e.y),S=e=>!!f(e)&&!!g(e.points)&&0!=e.points.length&&!e.points.some(e=>!T(e)),D=e=>!!f(e)&&!!g(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some(e=>!T(e)),A=e=>!(!f(e)||!p(e.x)||!p(e.y)||!p(e.width)||e.width<0||!p(e.height)||e.height<0),b=async(e,t,i)=>await new Promise((n,s)=>{let r=new XMLHttpRequest;r.responseType=t,r.onloadstart=()=>{i&&i.loadstartCallback&&i.loadstartCallback()},r.onloadend=async e=>{i&&i.loadendCallback&&i.loadendCallback(),r.status<200||r.status>=300?s(r.status):n(r.response)},r.onprogress=e=>{i&&i.progressCallback&&i.progressCallback(e)},r.onerror=e=>{s(e)},r.open("GET",e,!0),r.send()}),M=e=>/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e),O=(e,t)=>{let i=e.split("."),n=t.split(".");for(let e=0;e<i.length&&e<n.length;++e){let t=i[e],s=n[e];if(t===s)continue;let r=parseInt(i[e]),a=parseInt(n[e]);return r===a||Number.isNaN(r)&&Number.isNaN(a)?t<s?-1:1:r<a||Number.isNaN(r)&&Number.isInteger(a)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},L=e=>{const t={};for(let i in e){if("rootDirectory"===i)continue;let n=i,s=e[n],r=s&&"object"==typeof s&&s.path?s.path:s,a=e.rootDirectory;if(a&&!a.endsWith("/")&&(a+="/"),"object"==typeof s&&s.isInternal)a&&(r=e[n].version?`${a}${H[n]}@${e[n].version}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`:`${a}${H[n]}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`);else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof r&&(r=r.replace(i,a||"")),"object"==typeof r&&"dwt"===n){const s=e[n].resourcesPath,r=e[n].serviceInstallerLocation;t[n]={resourcesPath:s.replace(i,a||""),serviceInstallerLocation:r.replace(i,a||"")};continue}}t[n]=h(r)}return t},N=async(e,t,i)=>await new Promise(async(n,s)=>{try{const s=t.split(".");let r=s[s.length-1];const a=await k(`image/${r}`,e);s.length<=1&&(r="png");const o=new File([a],t,{type:`image/${r}`});if(i){const e=URL.createObjectURL(o),i=document.createElement("a");i.href=e,i.download=t,i.click()}n(o)}catch(e){s()}}),P=e=>{R(e)&&(e=F(e));const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t},x=(e,t)=>{R(t)&&(t=F(t));const i=P(t);let n=new Image,s=i.toDataURL(e);return n.src=s,n},k=async(e,t)=>{R(t)&&(t=F(t));const i=P(t);if("image/bmp"===e){const e=i.getContext("2d"),t=B(e.getImageData(0,0,i.width,i.height));return new Blob([t],{type:"image/bmp"})}return new Promise((t,n)=>{i.toBlob(e=>t(e),e)})},B=e=>{const t=e.width,i=e.height,n=e.data,s=4*Math.floor((24*t+31)/32),r=s*i,a=54+r,o=new ArrayBuffer(a),l=new DataView(o);l.setUint16(0,19778,!0),l.setUint32(2,a,!0),l.setUint16(6,0,!0),l.setUint16(8,0,!0),l.setUint32(10,54,!0),l.setUint32(14,40,!0),l.setInt32(18,t,!0),l.setInt32(22,-i,!0),l.setUint16(26,1,!0),l.setUint16(28,24,!0),l.setUint32(30,0,!0),l.setUint32(34,r,!0),l.setInt32(38,2835,!0),l.setInt32(42,2835,!0),l.setUint32(46,0,!0),l.setUint32(50,0,!0);let c=54;const d=s-3*t;for(let e=0;e<i;e++){for(let i=0;i<t;i++){const s=4*(e*t+i),r=n[s],a=n[s+1],o=n[s+2];l.setUint8(c++,o),l.setUint8(c++,a),l.setUint8(c++,r)}for(let e=0;e<d;e++)l.setUint8(c++,0)}return o},F=e=>{let t,i=e.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===o.IPF_BGR_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n+2],t[4*n+3]=255}else if(Number(e.format)===o.IPF_RGB_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n+2],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n],t[4*n+3]=255}else if(Number(e.format)===o.IPF_GRAYSCALED){const e=i.length;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;n++)t[4*n]=t[4*n+1]=t[4*n+2]=i[n],t[4*n+3]=255}else if(Number(e.format)===o.IPF_BINARY_8||Number(e.format)===o.IPF_BINARY_8_INVERTED){const n=i.length,s=e.width,r=e.height,a=e.stride;t=new Uint8ClampedArray(s*r*4);for(let e=0;e<n;e++){let n=i[e],r=e%a,o=Math.floor(e/a);for(let e=0;e<8;e++){let i=r+e,a=4*(o*s+i);if(i>=s)break;t[a]=t[a+1]=t[a+2]=(128&n)/128*255,t[a+3]=255,n<<=1}}}else if(Number(e.format)===o.IPF_ABGR_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}else if(Number(e.format)===o.IPF_ARGB_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n+2],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n],t[4*n+3]=i[4*n+3]}else Number(e.format),o.IPF_BINARY_8_INVERTED;return new ImageData(t,e.width,e.height)},U=()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),V=async e=>{let t=URL.createObjectURL(e);try{const e=await new Promise((e,i)=>{const n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=t}),i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e.width,i.height=e.height,n.drawImage(e,0,0),{bytes:Uint8Array.from(n.getImageData(0,0,i.width,i.height).data),width:i.width,height:i.height,stride:4*i.width,format:o.IPF_ABGR_8888}}finally{URL.revokeObjectURL(t)}},G=async(e,t)=>{const i=new TextEncoder,n=await crypto.subtle.importKey("raw",i.encode(t),"PBKDF2",!1,["deriveKey"]),s=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},s,i.encode(e)),o=new Uint8Array(r.length+a.byteLength);return o.set(r),o.set(new Uint8Array(a),r.length),btoa(String.fromCharCode.apply(null,o))},W=async(e,t)=>{const i=atob(e),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const s=n.slice(0,12),r=n.slice(12),a=new TextEncoder,o=await crypto.subtle.importKey("raw",a.encode(t),"PBKDF2",!1,["deriveKey"]),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:128},l,r);return(new TextDecoder).decode(c)},H={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcvData:"dynamsoft-capture-vision-data",dce:"dynamsoft-camera-enhancer",identityutility:"dynamsoft-identity-utility",ddv:"dynamsoft-document-viewer",dwt:"dwt",dbrBundle:"dynamsoft-barcode-reader-bundle",dcvBundle:"dynamsoft-capture-vision-bundle"};var z,j,Z,Y,q,$,X,Q;let K,J,ee,te,ie,ne=class e{get _isFetchingStarted(){return n(this,q,"f")}constructor(){z.add(this),j.set(this,[]),Z.set(this,1),Y.set(this,r.BOPM_BLOCK),q.set(this,!1),$.set(this,void 0),X.set(this,a.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var t;if(!R(e))throw new TypeError("Invalid 'image'.");if((null===(t=e.imageTag)||void 0===t?void 0:t.hasOwnProperty("imageId"))&&"number"==typeof e.imageTag.imageId&&this.hasImage(e.imageTag.imageId))throw new Error("Existed imageId.");if(n(this,j,"f").length>=n(this,Z,"f"))switch(n(this,Y,"f")){case r.BOPM_BLOCK:break;case r.BOPM_UPDATE:if(n(this,j,"f").push(e),f(n(this,$,"f"))&&p(n(this,$,"f").imageId)&&1==n(this,$,"f").keepInBuffer)for(;n(this,j,"f").length>n(this,Z,"f");){const e=n(this,j,"f").findIndex(e=>{var t;return(null===(t=e.imageTag)||void 0===t?void 0:t.imageId)!==n(this,$,"f").imageId});n(this,j,"f").splice(e,1)}else n(this,j,"f").splice(0,n(this,j,"f").length-n(this,Z,"f"))}else n(this,j,"f").push(e)}getImage(){if(0===n(this,j,"f").length)return null;let t;if(n(this,$,"f")&&p(n(this,$,"f").imageId)){const e=n(this,z,"m",Q).call(this,n(this,$,"f").imageId);if(e<0)throw new Error(`Image with id ${n(this,$,"f").imageId} doesn't exist.`);t=n(this,j,"f").slice(e,e+1)[0]}else t=n(this,j,"f").pop();if([o.IPF_RGB_565,o.IPF_RGB_555,o.IPF_RGB_888,o.IPF_ARGB_8888,o.IPF_RGB_161616,o.IPF_ARGB_16161616,o.IPF_ABGR_8888,o.IPF_ABGR_16161616,o.IPF_BGR_888].includes(t.format)){if(n(this,X,"f")===a.CCUT_RGB_R_CHANNEL_ONLY){e._onLog&&e._onLog("only get R channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:i[e]=t.bytes[3*e+2];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:i[e]=t.bytes[4*e+2];break;case o.IPF_BGR_888:i[e]=t.bytes[3*e];break;case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}else if(n(this,X,"f")===a.CCUT_RGB_G_CHANNEL_ONLY){e._onLog&&e._onLog("only get G channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:case o.IPF_BGR_888:i[e]=t.bytes[3*e+1];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e+1]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}else if(n(this,X,"f")===a.CCUT_RGB_B_CHANNEL_ONLY){e._onLog&&e._onLog("only get B channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:i[e]=t.bytes[3*e];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:i[e]=t.bytes[4*e];break;case o.IPF_BGR_888:i[e]=t.bytes[3*e+2];break;case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e+2]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}}else[o.IPF_NV21,o.IPF_NV12].includes(t.format)&&e._onLog&&e._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(e,t){if(!((...e)=>0!==e.length&&e.every(e=>p(e)))(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&"[object Boolean]"!==u(t))throw new TypeError("Invalid 'keepInBuffer'.");s(this,$,{imageId:e,keepInBuffer:t})}_resetNextReturnedImage(){s(this,$,null)}hasImage(e){return n(this,z,"m",Q).call(this,e)>=0}startFetching(){s(this,q,!0)}stopFetching(){s(this,q,!1)}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(s(this,Z,e);n(this,j,"f")&&n(this,j,"f").length>e;)n(this,j,"f").shift()}getMaxImageCount(){return n(this,Z,"f")}getImageCount(){return n(this,j,"f").length}clearBuffer(){n(this,j,"f").length=0}isBufferEmpty(){return 0===n(this,j,"f").length}setBufferOverflowProtectionMode(e){s(this,Y,e)}getBufferOverflowProtectionMode(){return n(this,Y,"f")}setColourChannelUsageType(e){s(this,X,e)}getColourChannelUsageType(){return n(this,X,"f")}};j=new WeakMap,Z=new WeakMap,Y=new WeakMap,q=new WeakMap,$=new WeakMap,X=new WeakMap,z=new WeakSet,Q=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return n(this,j,"f").findIndex(t=>{var i;return(null===(i=t.imageTag)||void 0===i?void 0:i.imageId)===e})},"undefined"!=typeof navigator&&(K=navigator,J=K.userAgent,ee=K.platform,te=K.mediaDevices),function(){if(!l){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:K.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ee,search:"Win"},Mac:{str:ee},Linux:{str:ee}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||J,a=s.search||t,o=s.verStr||J,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||J,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=J.indexOf("Windows NT")&&(s="HarmonyOS"),ie={browser:i,version:n,OS:s}}l&&(ie={browser:"ssr",version:0,OS:"ssr"})}();const se="undefined"!=typeof WebAssembly&&J&&!(/Safari/.test(J)&&!/Chrome/.test(J)&&/\(.+\s11_2_([2-6]).*\)/.test(J)),re=!("undefined"==typeof Worker),ae=!(!te||!te.getUserMedia),oe=async()=>{let e=!1;if(ae)try{(await te.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),e=!0}catch(e){}return e};var le,ce,de,he,ue,ge,pe,fe,me;"Chrome"===ie.browser&&ie.version>66||"Safari"===ie.browser&&ie.version>13||"OPR"===ie.browser&&ie.version>43||"Edge"===ie.browser&&ie.version,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_DESKEWED_IMAGE=16]="CRIT_DESKEWED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT",e[e.CRIT_ENHANCED_IMAGE=64]="CRIT_ENHANCED_IMAGE"}(le||(le={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ce||(ce={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_UNSUPPORTED_JSON_KEY_WARNING=-10077]="EC_UNSUPPORTED_JSON_KEY_WARNING",e[e.EC_MODEL_FILE_NOT_FOUND=-10078]="EC_MODEL_FILE_NOT_FOUND",e[e.EC_PDF_LICENSE_NOT_FOUND=-10079]="EC_PDF_LICENSE_NOT_FOUND",e[e.EC_RECT_INVALID=-10080]="EC_RECT_INVALID",e[e.EC_TEMPLATE_VERSION_INCOMPATIBLE=-10081]="EC_TEMPLATE_VERSION_INCOMPATIBLE",e[e.EC_PORTRAIT_ZONE_NOT_FOUND=-10082]="EC_PORTRAIT_ZONE_NOT_FOUND",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_LICENSE_AUTH_QUOTA_EXCEEDED=-20013]="EC_LICENSE_AUTH_QUOTA_EXCEEDED",e[e.EC_LICENSE_RESULTS_LIMIT_EXCEEDED=-20014]="EC_LICENSE_RESULTS_LIMIT_EXCEEDED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(de||(de={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV",e[e.GEM_END=-1]="GEM_END"}(he||(he={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV",e[e.GTM_END=-1]="GTM_END"}(ue||(ue={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ge||(ge={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(pe||(pe={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(fe||(fe={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(me||(me={}));const _e={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_DESKEWED_IMAGE:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ENHANCED_IMAGE:BigInt(Math.pow(2,30)),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var Ee,ye,Ie,Re,we;!function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_DESKEWED_IMAGE=6]="ROET_DESKEWED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI",e[e.ROET_ENHANCED_IMAGE=9]="ROET_ENHANCED_IMAGE",e[e.ROET_AUXILIARY_REGION=10]="ROET_AUXILIARY_REGION"}(Ee||(Ee={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_DESKEWING=7]="ST_DOCUMENT_DESKEWING",e[e.ST_IMAGE_ENHANCEMENT=8]="ST_IMAGE_ENHANCEMENT"}(ye||(ye={})),function(e){e[e.IFF_JPEG=0]="IFF_JPEG",e[e.IFF_PNG=1]="IFF_PNG",e[e.IFF_BMP=2]="IFF_BMP",e[e.IFF_PDF=3]="IFF_PDF"}(Ie||(Ie={})),function(e){e[e.ICDM_NEAR=0]="ICDM_NEAR",e[e.ICDM_FAR=1]="ICDM_FAR"}(Re||(Re={})),function(e){e.MN_DYNAMSOFT_CAPTURE_VISION_ROUTER="cvr",e.MN_DYNAMSOFT_CORE="core",e.MN_DYNAMSOFT_LICENSE="license",e.MN_DYNAMSOFT_IMAGE_PROCESSING="dip",e.MN_DYNAMSOFT_UTILITY="utility",e.MN_DYNAMSOFT_BARCODE_READER="dbr",e.MN_DYNAMSOFT_DOCUMENT_NORMALIZER="ddn",e.MN_DYNAMSOFT_LABEL_RECOGNIZER="dlr",e.MN_DYNAMSOFT_CAPTURE_VISION_DATA="dcvData",e.MN_DYNAMSOFT_NEURAL_NETWORK="dnn",e.MN_DYNAMSOFT_CODE_PARSER="dcp",e.MN_DYNAMSOFT_CAMERA_ENHANCER="dce",e.MN_DYNAMSOFT_CAPTURE_VISION_STD="std"}(we||(we={}));const ve={},Ce=async e=>{let t="string"==typeof e?[e]:e,n=[];for(let e of t)n.push(ve[e]=ve[e]||new i);await Promise.all(n)},Te=async(e,t)=>{let n,s="string"==typeof e?[e]:e,r=[];for(let e of s){let s;r.push(s=ve[e]=ve[e]||new i(n=n||t())),s.isEmpty&&(s.task=n=n||t())}await Promise.all(r)},Se=async e=>await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(e.u8);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},Ae.postMessage({type:"imagePtrToUint8Array",id:n,body:{data:e}})}),De=async e=>await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(e.result);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},Ae.postMessage({type:"resolveDsImageData",id:n,body:{point:e}})});let Ae,be=0;const Me=()=>be++,Oe={};let Le;const Ne=e=>{Le=e,Ae&&Ae.postMessage({type:"setBLog",body:{value:!!e}})};let Pe=!1;const xe=e=>{Pe=e,Ae&&Ae.postMessage({type:"setBDebug",body:{value:!!e}})},ke={},Be={},Fe={dip:{wasm:!0}},Ue={std:{version:"2.0.0",path:h(d+"../../dynamsoft-capture-vision-std@2.0.0/dist/"),isInternal:!0},core:{version:"4.4.10-dev-20260129110706",path:d,isInternal:!0}};let Ve=5;"undefined"!=typeof navigator&&(Ve=navigator.hardwareConcurrency?navigator.hardwareConcurrency-1:5),Oe[-3]=async e=>{Ge.onWasmLoadProgressChanged&&Ge.onWasmLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Ge{static get engineResourcePaths(){return Ue}static set engineResourcePaths(e){Object.assign(Ue,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Le}static set _onLog(e){Ne(e)}static get _bDebug(){return Pe}static set _bDebug(e){xe(e)}static get _workerName(){return`${Ge._bundleEnv.toLowerCase()}.bundle.worker.js`}static get wasmLoadOptions(){return Ge._wasmLoadOptions}static set wasmLoadOptions(e){Object.assign(Ge._wasmLoadOptions,e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!ve[e]&&ve[e].isFulfilled}static async loadWasm(){return await(async()=>{let e,t;e instanceof Array||(e=e?[e]:[]);let n=ve.core;t=!n||n.isEmpty,t||await Ce("core");let s=new Map;const r=e=>{if(e=e.toLowerCase(),we.MN_DYNAMSOFT_CAPTURE_VISION_STD==e||we.MN_DYNAMSOFT_CORE==e)return;let t=Fe[e].deps;if(null==t?void 0:t.length)for(let e of t)r(e);let i=ve[e];s.has(e)||s.set(e,!i||i.isEmpty)};for(let t of e)r(t);let a=[];t&&a.push("core"),a.push(...s.keys());const o=[...s.entries()].filter(e=>!e[1]).map(e=>e[0]);await Te(a,async()=>{const e=[...s.entries()].filter(e=>e[1]).map(e=>e[0]);await Ce(o);const n=L(Ue),r={};for(let t of e)r[t]=Fe[t];const a={engineResourcePaths:n,autoResources:r,names:e,_bundleEnv:Ge._bundleEnv,wasmLoadOptions:Ge.wasmLoadOptions};let l=new i;if(t){a.needLoadCore=!0;let e=n[`${Ge._bundleEnv.toLowerCase()}Bundle`]+Ge._workerName;e.startsWith(location.origin)||(e=await fetch(e).then(e=>e.blob()).then(e=>URL.createObjectURL(e))),Ae=new Worker(e),Ae.onerror=e=>{let t=new Error(e.message);l.reject(t)},Ae.addEventListener("message",e=>{let t=e.data?e.data:e,i=t.type,n=t.id,s=t.body;switch(i){case"log":Le&&Le(t.message);break;case"warning":console.warn(t.message);break;case"task":try{Oe[n](s),delete Oe[n]}catch(e){throw delete Oe[n],e}break;case"event":try{Oe[n](s)}catch(e){throw e}break;default:console.log(e)}}),a.bLog=!!Le,a.bd=Pe,a.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await Ce("core");let c=be++;Oe[c]=e=>{if(e.success)Object.assign(ke,e.versions),"{}"!==JSON.stringify(e.versions)&&(Ge._versions=e.versions),Ge.loadedWasmType=e.loadedWasmType,l.resolve(void 0);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),l.reject(t)}},Ae.postMessage({type:"loadWasm",id:c,body:a}),await l})})()}static async detectEnvironment(){return await(async()=>({wasm:se,worker:re,getUserMedia:ae,camera:await oe(),browser:ie.browser,version:ie.version,OS:ie.OS}))()}static async getModuleVersion(){return await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"getModuleVersion",id:i})})}static getVersion(){return`4.4.10-dev-20260129110706(Worker: ${ke.core&&ke.core.worker||"Not Loaded"}, Wasm: ${ke.core&&ke.core.wasm||"Not Loaded"})`}static enableLogging(){ne._onLog=console.log,Ge._onLog=console.log}static disableLogging(){ne._onLog=null,Ge._onLog=null}static async cfd(e){return await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},Ae.postMessage({type:"cfd",id:n,body:{count:e}})})}}Ge._bSupportDce4Module=-1,Ge._bSupportIRTModule=-1,Ge._versions=null,Ge._bundleEnv="DCV",Ge._wasmLoadOptions={wasmType:"auto",pthreadPoolSize:Ve},Ge.loadedWasmType="ml-simd-pthread",Ge.browserInfo=ie;const We="undefined"==typeof self,He="function"==typeof importScripts,ze=(()=>{if(!He){if(!We&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),je=/<style>([\s\S]*?)<\/style>/g,Ze=/style="([\s\S]*?)"/g,Ye=(e,t)=>{const{inlineScript2Blob:i,internalCss2Blob:n,insertInternalCss2ExistedSheet:s}=t||{};if(s){let t,i;for(let n=0;n<document.styleSheets.length;++n){const s=document.styleSheets[n];try{i=s.cssRules,t=s;break}catch(e){}}t&&(e=e.replace(je,(e,n,s,r)=>{let a=n.split("}");const o=a.length-1;let l=[],c=null,d=0;for(let e=0;e<o;++e){let t=0;for(;-1!==(t=a[e].indexOf("{",t));)d+=1,t+=1;if(c)1===d?(l.push(c+a[e]+"}"),c=null,d=0):(c+=a[e]+"}",--d);else{if(d<1)throw new Error("invalid style");1===d?(l.push(a[e].trimStart()+"}"),d=0):(c=a[e].trimStart()+"}",--d)}}if(c||d)throw new Error("invalid style");for(let e of l)t.insertRule(e,i.length);return""}))}const r=[];n&&(e=e.replace(je,(e,t,i,n)=>(r.push(new Blob([t],{type:"text/css"})),"<HasStyle></HasStyle>")));const a=[];e=e.replace(Ze,(e,t,i,n)=>(a.push(t),"hasstyle"));const o=document.createElement("div");if(o.insertAdjacentHTML("beforeend",e),o.normalize(),n){const e=o.querySelectorAll("HasStyle");for(let t=0;t<r.length;t++){const i=r[t],n=e[t],s=document.createElement("link");s.rel="stylesheet",s.href=URL.createObjectURL(i),n.replaceWith(s)}}const l=o.querySelectorAll("[hasstyle]");for(let e=0;e<a.length;e++){const t=a[e],i=l[e];i.removeAttribute("hasstyle");const n=t.split(";").map(e=>e.trim()).filter(e=>e);if(i.style)for(let e of n){const t=e.split(":");i.style[t[0].trim()]=t[1].trim()}}for(let e of o.querySelectorAll("script")){const t=document.createElement("script");e.textContent&&(i&&!e.src?(t.src=URL.createObjectURL(new Blob([e.textContent],{type:"text/javascript"})),t.addEventListener("load",()=>URL.revokeObjectURL(t.src))):t.textContent=e.textContent);for(let i of e.attributes)t.setAttribute(i.name,i.value);e.replaceWith(t)}let c=new DocumentFragment;return c.append(...o.childNodes),1===c.childNodes.length?c.firstChild:c},qe=[["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],["camera2 0,"],["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"]],$e=e=>e&&"object"==typeof e&&"function"==typeof e.then,Xe=(async()=>{})().constructor;class Qe extends Xe{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,$e(e)?t=e:"function"==typeof e&&(t=new Xe(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&($e(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const Ke={width:1280,height:720},Je=function(){const e=this,t=MediaDeviceInfo.prototype.toJSON.apply(e);return t.trackLabel=e.trackLabel,t.capabilities=e.capabilities,t},et="The camera feature is available only in secure contexts (HTTPS)";let tt=class e{static _cameraNameMatcher=qe;static _mapDeviceInfo;_coreShell;_video;_coreInnerLayer;_coreOuterLayer;_regionBoxWrapper;_regionBoxMask;_regionBoxBorder;_objectFit="contain";_uiInlineScript2Blob=!0;_uiInternalCss2Blob=!0;_uiInternalCss2ExistedSheet=!1;_ui;_pOpen;_paused=!1;_shouldClose=!1;_cameraChangedWhenPaused=!1;_resolutionChangedWhenPaused=!1;_requestedCamera="back";_requestedResolution=Ke;_regionBox={unit:"view-size",center:{x:0,y:0},maskStyle:{background:"rgba(0, 0, 0, 0.5)"},borderStyle:{border:"1px solid #00ff7f"}};_eventListeners={};static _arrConstructors=[];static _arrOnOpen=[];static _arrBeforeClose=[];static _arrOnClose=[];constructor(){const t=this._coreShell=document.createElement("div");Object.assign(t.style,{width:"100%",height:"100%",minWidth:"100px",minHeight:"100px",backgroundColor:"black",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative"});const i=this._coreOuterLayer=document.createElement("div");Object.assign(i.style,{width:"auto",height:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"relative",overflow:"hidden"});const n=this._coreInnerLayer=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%",position:"relative",transformOrigin:"center"});const s=this._video=document.createElement("video");Object.assign(s.style,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",objectFit:"fill"}),s.muted=!0,s.playsInline=!0,n.append(s),i.append(n),t.append(i),new ResizeObserver(()=>{this._updateObjectFit()}).observe(t);for(let t of e._arrConstructors)t.call(this)}_updateObjectFit(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video,t=this._coreOuterLayer.style,i=this._regionBoxWrapper?.style;if("fill"===this._objectFit)return"100%"!==t.width&&(t.width="100%"),"100%"!==t.height&&(t.height="100%"),void(i&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%")));const{width:n,height:s}=this._coreShell.getBoundingClientRect(),r=`${e.videoWidth} / ${e.videoHeight}`;r!=t.aspectRatio&&(t.aspectRatio=r),i&&r!=i.aspectRatio&&(i.aspectRatio=r);let a=!1;n/s>e.videoWidth/e.videoHeight&&(a=!a),"cover"===this._objectFit&&(a=!a);const o=i&&"contain"===this._objectFit,l=i&&"cover"===this._objectFit;a?("auto"!=t.width&&(t.width="auto"),"100%"!=t.height&&(t.height="100%"),o&&("auto"!=i.width&&(i.width="auto"),"100%"!=i.height&&(i.height="100%"))):("100%"!=t.width&&(t.width="100%"),"auto"!=t.height&&(t.height="auto"),o&&("100%"!=i.width&&(i.width="100%"),"auto"!=i.height&&(i.height="auto"))),l&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%"))}get video(){return this._video}get track(){return this._video?.srcObject?.getTracks()[0]}get objectFit(){return this._objectFit}set objectFit(e){this._objectFit=e,this._updateObjectFit()}get ui(){return this._ui||this._coreShell}set ui(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if("string"==typeof e){if(!e.trim().startsWith("<"))throw Error("Invalid html string.");e=Ye(e,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet})}let t;if(e instanceof HTMLElement)t=e;else{if(!(e instanceof DocumentFragment))throw Error("Seems no HTMLElement.");t=document.createElement("div"),Object.assign(t.style,{width:"100%",height:"100%"}),t.append(e)}const i="dm-camera-core-container",n=t.classList.contains(i)?t:t.querySelector(`.${i}`);if(!n)throw Error(`Can't find element with class \`${i}\`.`);this._ui=t;for(let e of t.querySelectorAll("script"))e.currentDMCamera=this;n.append(this._coreShell)}get status(){return this._pOpen?this._pOpen.isPending?this._shouldClose?"closing":"opening":this._paused?"paused":"opened":"closed"}get requestedCamera(){return this._requestedCamera}get requestedResolution(){return this._requestedResolution}get currentCamera(){return"opened"!==this.status&&"paused"!==this.status?null:e._mapDeviceInfo?.[this.track?.getSettings()?.deviceId]}get currentResolution(){return{width:this.video?.videoWidth,height:this.video?.videoHeight}}get regionBox(){return this._regionBox}onOpened;static async hasCamera(){return!!navigator?.mediaDevices&&!!(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length}static async hasMacroCamera(){return!!navigator?.mediaDevices&&!!(await e.getDeviceInfos()).find(e=>e.capabilities?.facingMode?.includes("environment")&&e.capabilities?.focusDistance?.min<.061)}static async getDeviceInfos(){if(!navigator?.mediaDevices)throw Error(et);let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);if(!t.length)return[];if(t.some(e=>!e.deviceId)){let e;try{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind),t.some(e=>!e.deviceId)&&console.warn("Some camera does not have deviceId.")}catch(t){console.warn("Failed to get device ID by opening camera.",t)}if(e){const i=e.getTracks().filter(e=>"video"===e.kind)[0],n=i.getSettings().deviceId;let s=t.find(e=>e.deviceId===n);s?(s.trackLabel=i.label,s.capabilities=i.getCapabilities?.(),s.toJSON=Je):console.warn("Can't find current device by `track.getSettings().deviceId`."),e.getTracks().forEach(e=>e.stop())}}await e._setCapabilities(t);const i=t.reduce((e,t)=>(e[t.deviceId]=t,e),{});return e._mapDeviceInfo=i,[...t]}static async _setCapabilities(t){for(let i of t){if(!i.deviceId)continue;if(Je===i.toJSON)continue;let n=e._mapDeviceInfo?.[i.deviceId];if(n)i.trackLabel=n.trackLabel,i.capabilities=n.capabilities;else try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:i.deviceId},audio:!1}),t=e.getTracks().filter(e=>"video"===e.kind)[0];i.trackLabel=t.label,i.capabilities=t.getCapabilities?.(),e.getTracks().forEach(e=>e.stop())}catch(t){console.warn("Failed to get `trackLabel` and `capabilities`, by opening camera.",t)}i.toJSON=Je}}async open(){if("opened"!==this.status)if("closed"===this.status||"paused"===this.status)try{if("paused"===this.status&&this._cameraChangedWhenPaused&&(await this.close(),this._cameraChangedWhenPaused=!1),"closed"===this.status){if(this._pOpen=new Qe,"customized-video"!==this._requestedCamera){let t;if("string"==typeof this._requestedCamera){switch(this._requestedCamera){case"front":t={facingMode:"user"};break;case"quick-back":t={facingMode:"environment"};break;case"back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");for(let n of e._cameraNameMatcher){for(let e of i){const i=(e.trackLabel||e.label)?.toLowerCase();for(let s of n)if(i.includes(s)){t={deviceId:e.deviceId};break}if(t)break}if(t)break}if(t)break;i.reverse();for(let e of i)if(e.capabilities?.facingMode?.includes("environment")){t={deviceId:e.deviceId};break}if(t)break;t={deviceId:i[0].deviceId};break}case"macro-back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");const n=i.reduce((e,t)=>t?.capabilities?.facingMode?.includes("environment")?e&&e?.capabilities?.focusDistance?.min?t?.capabilities?.focusDistance?.min<e?.capabilities?.focusDistance?.min?t:e:t:e);t={deviceId:n?.deviceId||i[i.length-1].deviceId};break}default:throw Error(`Unknown camera preset: ${this._requestedCamera}`)}this._requestedCamera=t}else t=this._requestedCamera;const i={video:Object.assign({},t,this._requestedResolution),audio:!1};if(!navigator?.mediaDevices)throw Error(et);const n=await navigator.mediaDevices.getUserMedia(i);if("closing"===this.status)throw Error("Camera closed.");this._video.srcObject=n}if(await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this.track){const e=this.track.getSettings();let t=0;for(;++t<10&&(e.width!==this.video.videoWidth||e.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));if("closing"===this.status)throw Error("Camera closed.")}this._pOpen.resolve();try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}}else{if(this._pOpen=new Qe,await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this._paused=!1,this._pOpen.resolve(),this._resolutionChangedWhenPaused){try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._resolutionChangedWhenPaused=!1}}for(let t of e._arrOnOpen)t.call(this);this._callOpenedListeners()}catch(e){let t=this._video?.srcObject?.getTracks?.();if(t)for(let e of t)e?.stop();this._video.srcObject=null;const i=this._pOpen;throw this._pOpen=null,this._shouldClose=!1,i.reject(),Error(`Error opening camera: ${e?.message}`,{cause:e})}else{if("opening"!==this.status&&"closing"!==this.status)throw Error("Never");await this._pOpen}}async pause(){try{await this._pOpen}catch(e){}"opened"===this.status&&(this._video.pause(),this._paused=!0)}async close(){for(let t of e._arrBeforeClose)t.call(this);if("closed"===this.status)return;if("opening"===this.status&&(this._shouldClose=!0),"closing"===this.status){try{await this._pOpen}catch(t){}return}let t=this._video?.srcObject?.getTracks?.();if(t){for(let e of t)e?.stop();this._video.srcObject=null}this._pOpen=null,this._paused=!1;for(let t of e._arrOnClose)t.call(this);this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility="hidden"),this._eventListeners.closed?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}async requestCamera(e){if("string"==typeof e)it.includes(e)?this._requestedCamera=e:this._requestedCamera={deviceId:e};else if(e)if("videoinput"===e.kind)e.deviceId?this._requestedCamera={deviceId:e.deviceId}:this._requestedCamera="back";else{const t=this._requestedCamera=JSON.parse(JSON.stringify(e));if(t.width||t.height||t.aspectRatio){const e=this._requestedResolution={};t.width&&(e.width=t.width,delete t.width),t.height&&(e.height=t.height,delete t.height),t.aspectRatio&&(e.aspectRatio=t.aspectRatio,delete t.aspectRatio)}}else null===e?this._requestedCamera=null:void 0===e&&(this._requestedCamera="back");"opened"===this.status?(await this.close(),await this.open()):"paused"===this.status&&(this._cameraChangedWhenPaused=!0)}async requestResolution(e,t){let i={};if("number"==typeof e?(i.width=e,"number"==typeof t&&(i.height=t)):Array.isArray(e)?(e[0]&&(i.width=e[0]),e[1]&&(i.height=e[1])):e?((e=JSON.parse(JSON.stringify(e))).width&&(i.width=e.width),e.height&&(i.height=e.height),e.aspectRatio&&(i.aspectRatio=e.aspectRatio)):null===e?i=null:void 0===e&&(i=Ke),this._requestedResolution=i,"opened"===this.status){await this.track.applyConstraints({...i});const t=this.track.getSettings();let n=0;for(;++n<10&&(t.width!==this.video.videoWidth||t.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._callOpenedListeners()}else"paused"===this.status&&(this._resolutionChangedWhenPaused=!0,await this.track.applyConstraints({...i}))}getFrame(e){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");let{x:t=0,y:i=0,width:n=this._video.videoWidth,height:s=this._video.videoHeight,reusedContext:r}=e||{};n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const a=r?.canvas||document.createElement("canvas");return a.width!=n&&(a.width=n),a.height!=s&&(a.height=s),(r||a.getContext("2d")).drawImage(this._video,t,i,n,s,0,0,n,s),a}setRegionBox(e){if(!(e=Object.assign(this._regionBox,e)).width||!e.height){if(!e.innerUi)return this._regionBoxWrapper?.remove(),this._regionBoxWrapper=null,this._regionBoxMask=null,void(this._regionBoxBorder=null);Object.assign(e,{width:1,height:1,unit:"view-size",center:{x:0,y:0}})}this._regionBoxWrapper||(this._regionBoxWrapper=document.createElement("div"),Object.assign(this._regionBoxWrapper.style,{width:"auto",height:"100%",maxWidth:"100%",maxHeight:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",containerType:"size",visibility:"opened"===this.status?"":"hidden"}),this._regionBoxMask=document.createElement("div"),Object.assign(this._regionBoxMask.style,{width:"100%",height:"100%",flex:"none"}),this._regionBoxWrapper.append(this._regionBoxMask),this._regionBoxBorder=document.createElement("div"),Object.assign(this._regionBoxBorder.style,{flex:"none",boxSizing:"content-box",position:"absolute",transform:"translate(-50%,-50%)"}),this._regionBoxWrapper.append(this._regionBoxBorder),this._coreShell.append(this._regionBoxWrapper)),"string"==typeof e.innerUi&&(e.innerUi=Ye(e.innerUi)),e.innerUi instanceof DocumentFragment?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Node?1==this._regionBoxBorder.childNodes.length&&this._regionBoxBorder.firstChild==e.innerUi||(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi)):e.innerUi instanceof NodeList?this._regionBoxBorder.childNodes!==e.innerUi&&(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Array?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):this._regionBoxBorder.innerHTML="";let t=100*e.center.y-50*e.height+50+"%",i=100*e.center.x+50*e.width+50+"%",n=100*e.center.y+50*e.height+50+"%",s=100*e.center.x-50*e.width+50+"%";Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`}),"view-min"===e.unit&&(t=`calc(${100*e.center.y+50}% + max(-${50*e.height}cqmin, -${50*e.height}cqmax))`,i=`calc(${100*e.center.x+50}% + ${50*e.width}cqmin)`,n=`calc(${100*e.center.y+50}% + ${50*e.height}cqmin)`,s=`calc(${100*e.center.x+50}% + max(-${50*e.width}cqmin, -${50*e.width}cqmax))`,Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${s} ${t}, ${s} ${n}, ${i} ${n}, ${i} ${t}, ${s} ${t})`})),Object.assign(this._regionBoxMask.style,{...e.maskStyle}),Object.assign(this._regionBoxBorder.style,{width:100*e.width+"%",height:100*e.height+"%"}),"view-min"===e.unit&&Object.assign(this._regionBoxBorder.style,{width:100*e.width+"cqmin",height:100*e.height+"cqmin"}),Object.assign(this._regionBoxBorder.style,{top:100*e.center.y+50+"%",left:100*e.center.x+50+"%",...e.borderStyle}),"view-size"===e.unit&&1===e.width&&1===e.height&&(this._regionBoxBorder.style.borderWidth="0"),this._updateObjectFit()}addCanvas(){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),"opened"!==this.status&&"paused"!==this.status||(e.width=this._video.videoWidth,e.height=this._video.videoHeight),this._video.parentElement.append(e),e}_updateCanvasSize(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video;this._video.parentElement.querySelectorAll("canvas").forEach(t=>{t.width!==e.videoWidth&&(t.width=e.videoWidth),t.height!==e.videoHeight&&(t.height=e.videoHeight)})}addEventListener(e,t){(this._eventListeners[e]??=new Set).add(t)}removeEventListener(e,t){this._eventListeners[e]?.delete(t)}_callOpenedListeners(){try{this.onOpened?.(this)}catch(e){console.error(e)}this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility=""),this._eventListeners.opened?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}videoXY2AbsoluteLT(e){const t=this._video,i=t.getBoundingClientRect(),n=getComputedStyle(document.body);if("static"===n.position){const n=document.documentElement.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-n.x,top:e.y/t.videoHeight*i.height+i.y-n.y}))}{const s=document.body.getBoundingClientRect(),r=parseFloat(n.borderLeftWidth),a=parseFloat(n.borderTopWidth);return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-s.x-r,top:e.y/t.videoHeight*i.height+i.y-s.y-a}))}}videoXY2FixedLT(e){const t=this._video,i=t.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x,top:e.y/t.videoHeight*i.height+i.y}))}getVisibleAreaInVideoXY(e){const{isConsiderRegionBox:t=!1,rounded:i=!1}=e||{};let n;if(t&&this._regionBoxBorder){const e=this._regionBoxBorder.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height};const t=getComputedStyle(this._regionBoxBorder),i=parseFloat(t.borderLeftWidth),s=parseFloat(t.borderTopWidth),r=parseFloat(t.borderRightWidth),a=parseFloat(t.borderBottomWidth);n.x+=i,n.y+=s,n.width-=i+r,n.height-=s+a}else{const e=this._coreShell.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height}}const s=this._video.getBoundingClientRect(),r={x:(n.x-s.x)/s.width,y:(n.y-s.y)/s.height,width:n.width/s.width,height:n.height/s.height};r.x<0&&(r.width+=r.x,r.x=0),r.x>1&&(r.width-=r.x-1,r.x=1),r.y<0&&(r.height+=r.y,r.y=0),r.y>1&&(r.height-=r.y-1,r.y=1),r.x+r.width>1&&(r.width=1-r.x),r.x+r.width<0&&(r.width=-r.x),r.y+r.height>1&&(r.height=1-r.y),r.y+r.height<0&&(r.height=-r.y);const a=this._video.videoWidth,o=this._video.videoHeight;let l=(this.isMirrored?1-r.x-r.width:r.x)*a,c=r.y*o,d=r.width*a,h=r.height*o;return i&&(d=Math.round(d+l)-Math.round(l),h=Math.round(h+c)-Math.round(c),l=Math.round(l),c=Math.round(c)),{x:l,y:c,width:d,height:h}}};const it=["back","front","macro-back","quick-back","customized-video"];tt._arrConstructors.push(function(){const e=this;e._softZoom={zoom:1,center:{x:0,y:0}},e.maxZoom4GestureWheel=20,e._lastZoomTime=-1/0,e._mapZoomTouchs=new Map,e.enableGestureZoom=!0,e.enableWheelZoom=!1}),Object.defineProperty(tt.prototype,"softZoom",{get(){return this._softZoom}}),Object.defineProperty(tt.prototype,"isMirrored",{get(){return this._isMirrored},set(e){const t=this;t._isMirrored=e,t.setSoftZoom(t.softZoom.zoom,{center:t.softZoom.center})}}),Object.defineProperty(tt.prototype,"enableGestureZoom",{get(){return!!this._gestureZoomListener},set(e){const t=this;e?t._gestureZoomListener||(t._gestureZoomListener=e=>{t._changeZoomByTouch(e)},t._coreShell.addEventListener("touchstart",t._gestureZoomListener),t._coreShell.addEventListener("touchmove",t._gestureZoomListener),t._coreShell.addEventListener("touchend",t._gestureZoomListener),t._coreShell.addEventListener("touchcancel",t._gestureZoomListener)):t._gestureZoomListener&&(t._coreShell.removeEventListener("touchstart",t._gestureZoomListener),t._coreShell.removeEventListener("touchmove",t._gestureZoomListener),t._coreShell.removeEventListener("touchend",t._gestureZoomListener),t._coreShell.removeEventListener("touchcancel",t._gestureZoomListener),t._gestureZoomListener=null)}}),Object.defineProperty(tt.prototype,"enableWheelZoom",{get(){return!!this._wheelZoomListener},set(e){const t=this;e?t._wheelZoomListener||(t._wheelZoomListener=e=>{t._changeZoomByWheel(e)},t._coreShell.addEventListener("wheel",t._wheelZoomListener)):t._wheelZoomListener&&(t._coreShell.removeEventListener("wheel",t._wheelZoomListener),t._wheelZoomListener=null)}}),tt.prototype.getZoomRange=function(){if("opened"!==this.status)throw Error("Camera is not opened");return this.track.getCapabilities?.()?.zoom},tt.prototype.setZoom=async function(e){if("opened"!==this.status)throw Error("Camera is not opened");await this.track.applyConstraints({advanced:[{zoom:e}]})},tt.prototype.setSoftZoom=function(e,t){const i=this;let{center:n,limit:s}=t||{},{x:r=0,y:a=0}=n||{};s&&e<1&&(e=1);let o=i._isMirrored?`scale(${-e},${e})`:`scale(${e})`;if(n){if(s){const t=.5-.5/e;r<-t?r=-t:r>t&&(r=t),a<-t?a=-t:a>t&&(a=t)}o+=` translate(${r*=-100}%, ${a*=-100}%)`}i._softZoom={zoom:e,center:{x:r,y:a}},i._coreInnerLayer.style.transform=o},tt.prototype._changeZoomByWheel=function(e){const t=this,i=Date.now();let n=t._softZoom.zoom,s=n-e.deltaY/200;s>t.maxZoom4GestureWheel&&(s=t.maxZoom4GestureWheel),s<1&&(s=1),s!==n&&(t.setSoftZoom(s,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,e.preventDefault(),t._eventListeners.zoom?.forEach(e=>{try{e.call(t,JSON.parse(JSON.stringify(t._softZoom)))}catch(e){console.error(e)}}))},tt.prototype._changeZoomByTouch=function(e){const t=this;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=Date.now();if(i-t._lastZoomTime<100)return;let n=e.touches[0],s=e.touches[1],r=t._mapZoomTouchs.get(n.identifier),a=t._mapZoomTouchs.get(s.identifier);if(!r||!a)break;let o=Math.pow(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2),.5),l=Math.pow(Math.pow(n.clientX-s.clientX,2)+Math.pow(n.clientY-s.clientY,2),.5),c=t._softZoom.zoom;c*=l/o,c>t.maxZoom4GestureWheel&&(c=t.maxZoom4GestureWheel),c<1&&(c=1),t.setSoftZoom(c,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,t._eventListeners.zoom?.forEach(e=>{try{e(t)}catch(e){console.error(e)}});break}t._mapZoomTouchs.clear();for(let i of e.touches)t._mapZoomTouchs.set(i.identifier,{x:i.clientX,y:i.clientY})},tt._arrConstructors.push(function(){const e=this;e._isFocusing=!1,e._advancedFocusParameters={minFocusDistanceLimit:.01,maxFocusDistanceLimit:10,firstStepWaitDuration:500,coarseStepWaitDuration:350,switchStepWaitDuration:400,fineStepWaitDuration:350,maxStepCount:30,backToContinousDuration:5e3,focusWH:.2,coarseTuneRate:.5,coarseTuneTolerance:.5,fineTuneRate:1.1},e._advancedFocusTaskId=0,e.enableTapToFocus="simple"}),tt._getImageContrast=(e,t,i)=>{let n=0;for(let s=0;s<i-1;s++)for(let i=0;i<t-1;i++){const r=4*(s*t+i),a=r+4,o=r+4*t,l=e[r]-e[a],c=e[r+1]-e[a+1],d=e[r+2]-e[a+2],h=e[r]-e[o],u=e[r+1]-e[o+1],g=e[r+2]-e[o+2];n+=l*l+c*c+d*d+h*h+u*u+g*g}return n},tt.prototype._simpleFocus=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(e._isFocusing)return;const t=e.currentCamera?.capabilities;let i,n;if(t?.focusMode?.includes("manual"))if(t?.focusMode?.includes("continuous"))i="manual",n="continuous";else{if(!t?.focusMode?.includes("single-shot"))return void e._advancedFocus();i="manual",n="single-shot"}else if(t?.focusMode?.includes("single-shot"))t?.focusMode?.includes("continuous")?(i="continuous",n="single-shot"):(i=null,n="single-shot");else{if(!t?.focusMode?.includes("continuous"))return;i=null,n="continuous"}e._isFocusing=!0;try{i&&("manual"===i?await e.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t?.focusDistance?.max||10}]}):await e.track.applyConstraints({advanced:[{focusMode:i}]}),await new Promise(e=>setTimeout(e,500))),await e.track.applyConstraints({advanced:[{focusMode:n}]}),await new Promise(e=>setTimeout(e,500))}catch(t){"opened"===e.status&&console.warn("Error while do simple focus",t)}e._isFocusing=!1},tt.prototype._advancedFocus=async function(e,t,i){const n=this;if("opened"!==n.status)throw Error("Camera is not opened");if(n._isFocusing)return;const s=n.currentCamera?.capabilities;if(!s?.focusMode?.includes("manual"))return void n._simpleFocus();const r=n._advancedFocusParameters,a=n._video.videoWidth,o=n._video.videoHeight;if(a<2||o<2)return;let l,c=0;e?(e.x=Math.round(e.x),e.y=Math.round(e.y),t||(t=Math.min(a,o)*r.focusWH),t<2&&(t=2),t>a&&(t=a),t=2*Math.round(t/2),i||(i=t),i<2&&(i=2),i>o&&(i=o),i=2*Math.round(i/2),e.x<t/2&&(e.x=t/2),e.x>a-t/2&&(e.x=a-t/2),e.y<i/2&&(e.y=i/2),e.y>o-i/2&&(e.y=o-i/2),c=e.x-t/2,l=e.y-i/2):(t=a,i=o),n._isFocusing=!0;const d=++n._advancedFocusTaskId;let h=s?.focusDistance?.min;(!h||h<r.minFocusDistanceLimit)&&(h=r.minFocusDistanceLimit);let u=s?.focusDistance?.max;(!u||u>r.maxFocusDistanceLimit)&&(u=r.maxFocusDistanceLimit);let g=-1/0,p=-1/0,f=1/0,m=u,_=!1,E=!0;const y=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});let I=0;try{for(;++I<r.maxStepCount;){let e;await n.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:m}]}),_?E?(E=!1,e=r.switchStepWaitDuration):e=r.fineStepWaitDuration:E?(E=!1,e=r.firstStepWaitDuration):e=r.coarseStepWaitDuration,await new Promise(t=>setTimeout(t,e)),n.getFrame({x:c,y:l,width:t,height:i,reusedContext:y});const s=y.getImageData(0,0,t,i).data,a=tt._getImageContrast(s,t,i);if(_){if(a<=g){await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:f}]}),await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:f}]});break}if(u===m)break;g=a,a>p&&(p=a,f=m),m*=r.fineTuneRate,m>u&&(m=u)}else(a<=p*r.coarseTuneTolerance||h===m)&&(_=!0),g=a,a>p&&(p=a,f=m),_?(m=Math.sqrt(m*f),E=!0):(m*=r.coarseTuneRate,m<h&&(m=h))}}catch(e){"opened"===n.status&&console.warn("Error while do advanced focus",e)}n._isFocusing=!1,r.backToContinousDuration>0&&setTimeout(async()=>{if(n._advancedFocusTaskId===d)try{await n.track.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(e){}},r.backToContinousDuration)},Object.defineProperty(tt.prototype,"enableTapToFocus",{get(){return this._enableTapToFocus},set(e){const t=this;t._enableTapToFocus=e,e?t._tapToFocusListner||(t._tapToFocusListner=async e=>{if(!("opened"!==t.status||!t._enableTapToFocus||!e.isPrimary||e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||"touch"===e.pointerType&&t.enableGestureZoom&&(await new Promise(e=>setTimeout(e,300)),"opened"!==t.status||!t._enableTapToFocus||t._lastZoomTime>Date.now()-1e3||t._mapZoomTouchs.size>1)))if("experimental-advanced"===t._enableTapToFocus){const[{left:i,top:n},{left:s,top:r}]=t.videoXY2FixedLT([{x:0,y:0},{x:t._video.videoWidth,y:t._video.videoHeight}]);t._advancedFocus({x:(e.clientX-i)/(s-i)*t._video.videoWidth,y:(e.clientY-n)/(r-n)*t._video.videoHeight})}else t._simpleFocus()},t._coreShell.addEventListener("pointerdown",t._tapToFocusListner)):t._tapToFocusListner&&(t._coreShell.removeEventListener("pointerdown",t._tapToFocusListner),t._tapToFocusListner=null)}}),tt._arrConstructors.push(function(){this._isTorchOn=!1,this._autoTorchParameters={shortDelay:250,longDelay:1e3,shortLongDelaySwitchCount:10,maxErrorCount:10,grayThreshold:20,maxDarkCount:3}}),tt._arrOnClose.push(function(){this._isTorchOn=!1}),Object.defineProperty(tt.prototype,"isSupportTorch",{get(){return!!this.currentCamera?.capabilities?.torch}}),Object.defineProperty(tt.prototype,"isTorchOn",{get(){return this._isTorchOn}}),tt.prototype.turnOnTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");try{await e.track.applyConstraints({advanced:[{torch:!0}]})}catch(t){throw e._isTorchOn=!1,t}e._isTorchOn=!0},tt.prototype.turnOffTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");await e.track.applyConstraints({advanced:[{torch:!1}]}),e._isTorchOn=!1},tt.prototype.turnAutoTorch=function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(null==e._isTorchOn)return;e._isTorchOn=void 0;const t=e._autoTorchParameters,i=document.createElement("canvas"),n=i.getContext("2d",{willReadFrequently:!0});let s=0,r=0,a=0;(async()=>{for(;null==e._isTorchOn;){try{e.getFrame({reusedContext:n})}catch(i){if("opened"===e.status&&++s<t.maxErrorCount){await new Promise(e=>setTimeout(e,1e3));continue}e._isTorchOn=!1;break}const o=n.getImageData(0,0,i.width,i.height).data;let l=0;for(let e=0;e<o.length;e+=4)l+=o[e]+o[e+1]+o[e+2];if(l/=o.length/4*3,l<t.grayThreshold&&++r>=t.maxDarkCount){try{await e.turnOnTorch(),e._eventListeners.torchAutoOn?.forEach(t=>{try{t.call(e)}catch(e){console.error(e)}})}catch(e){}break}await new Promise(e=>setTimeout(e,a<t.shortLongDelaySwitchCount?t.shortDelay:t.longDelay)),++a}})()},tt._arrConstructors.push(function(){this._shouldCloseWhenHide=!0,this._maxReopenTry4CloseWhenHide=4}),tt._arrOnOpen.push(function(){const e=this;e._shouldCloseWhenHide&&(e._closeWhenHideListener||(e._closeWhenHideListener=()=>{e._closeWhenHide()},document.addEventListener("visibilitychange",e._closeWhenHideListener)))}),tt._arrBeforeClose.push(function(){const e=this;e._closeWhenHideListener&&!e._isDuringCloseWhenHide&&(document.removeEventListener("visibilitychange",e._closeWhenHideListener),e._closeWhenHideListener=null,e._isOpenBeforeHide=!1)}),Object.defineProperty(tt.prototype,"shouldCloseWhenHide",{get(){return this._shouldCloseWhenHide},set(e){const t=this;t._shouldCloseWhenHide=e,"opened"===t.status&&(e?t._closeWhenHideListener||(t._closeWhenHideListener=()=>{t._closeWhenHide()},document.addEventListener("visibilitychange",t._closeWhenHideListener)):t._closeWhenHideListener&&(document.removeEventListener("visibilitychange",t._closeWhenHideListener),t._closeWhenHideListener=null,t._isOpenBeforeHide=!1))}}),tt.prototype._closeWhenHide=async function(){const e=this;if("hidden"===document.visibilityState)"opened"===e.status&&(e._isDuringCloseWhenHide=!0,e._isOpenBeforeHide=!0,await e.close(),e._isDuringCloseWhenHide=!1);else if(e._isOpenBeforeHide){let t=0;for(;t++<e._maxReopenTry4CloseWhenHide&&"visible"===document.visibilityState;){try{await e.open()}catch(e){await new Promise(e=>setTimeout(e,300));continue}e._isOpenBeforeHide=!1;break}}},tt.showFilePicker=async function(e){let t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff",t.multiple=!0;let i=new Promise(function(e){t.addEventListener("change",function(){e(Array.from(t.files))})});Object.assign(t,e);let n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});return t.dispatchEvent(n),i};let nt,st=class{camera;_ctx;_data;_dataTime=-1/0;_x;_y;_w;_h;_type;maxTimeout=500;_pipeTaskId;isSaveOriginalRgba=!1;originalRgba;constructor(e){this.camera=e;const t=document.createElement("canvas");this._ctx=t.getContext("2d",{willReadFrequently:!0})}_getData(){if("opened"!==this.camera.status)return null;this.camera.getFrame({x:this._x,y:this._y,width:this._w,height:this._h,reusedContext:this._ctx});const e=this._ctx.getImageData(0,0,this._w,this._h).data;if(this.originalRgba=this.isSaveOriginalRgba?e:null,"rgba"===this._type)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const t=new Uint8Array(e.length/4);for(let i=0;i<e.length;i+=4)t[i/4]=.3*e[i]+.59*e[i+1]+.11*e[i+2];return t}getData(e){let{x:t=0,y:i=0,width:n=this.camera._video.videoWidth,height:s=this.camera._video.videoHeight,type:r="rgba"}=e||{};if(n=Math.round(n+t)-Math.round(t),s=Math.round(s+i)-Math.round(i),t=Math.round(t),i=Math.round(i),0===n||0===s||isNaN(n)||isNaN(s))return null;const a=t!==this._x||i!==this._y||n!==this._w||s!==this._h||r!==this._type;let o;return a&&(this._x=t,this._y=i,this._w=n,this._h=s,this._type=r),!a&&this._dataTime+this.maxTimeout>Date.now()&&this._data?(o=this._data,this._data=null):o=this._getData(),this._pipeTaskId||(this._pipeTaskId=setTimeout(()=>{this._pipeTaskId=null,this._data=this._getData(),this._dataTime=Date.now()},0)),o}},rt=class{_stAudioFree=new Set;_stAudioPlaying=new Set;_timeLastPlay=0;_bWarnedMaxTrack=!1;maxPlayingBeep=16;beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";beep(){if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-this._timeLastPlay<100)){if(this._timeLastPlay=t,this._stAudioFree.size&&(e=this._stAudioFree.values().next().value,this.beepSoundSource==e.src?(this._stAudioFree.delete(e),e.play()):e=null),!e)if(this._stAudioPlaying.size<this.maxPlayingBeep){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout(()=>{this._stAudioPlaying.delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,this._stAudioPlaying.delete(e),this._stAudioFree.add(e)})}else this._bWarnedMaxTrack||(this._bWarnedMaxTrack=!0,console.warn(`The requested audio tracks exceed ${this.maxPlayingBeep} and will not be played.`));e&&this._stAudioPlaying.add(e)}}};const at=()=>{(nt??=new rt).beep()},ot=(e=300)=>{if(!navigator?.vibrate)throw new Error("Not supported.");navigator.vibrate(e)},lt=tt,ct=tt;if(document?.head){const e=new Blob(["@keyframes dce-scanlight{from{top:0;}to{top:97%;}}"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}lt.createInstance=async function(e){let t;if(e instanceof tt?(t=e,e=void 0):t=new tt,void 0===t.disposed){if(t.disposed=!1,t._cameraEnhancer=t._cameraView=t,t._framePipeline=new st(t),t._dceScanRegion={x:0,y:0,width:100,height:100,isMeasuredInPercentage:!0},t._dceEventListeners={},t._oriOpen=t.open,t.open=dt,t._dceZoom=1,t._dceEnhancedFeatures=0,t._dceAutoZoomRange={min:1,max:10},t._oriSetZoom=t.setZoom,t.setZoom=ht,t.singleFrameMode="disabled",t.addImageToBuffer=t.clearBuffer=t.getBufferOverflowProtectionMode=t.getColourChannelUsageType=t.getImageCount=t.getImageFetchInterval=t.getMaxImageCount=t.hasImage=t.setBufferOverflowProtectionMode=t.setErrorListener=t.setImageFetchInterval=t.setMaxImageCount=t.setNextImageToReturn=()=>{},e??=ct.defaultUIElementURL,e&&await t.setUIElement(e),t._dceRegionMaskStyle={lineWidth:parseFloat(t.regionBox.borderStyle.border?.split(" ")[0]),strokeStyle:t.regionBox.borderStyle.border?.split(" ")[2],fillStyle:t.regionBox.maskStyle.background},t._dceRegionMaskVisible=!0,t._dceTipDuration=3e3,t._drawingLayers=[],t._drawingLayers.length=4,t._capturedResultReceiver={onCapturedResultReceived:bt.bind(t)},!t.regionBox.innerUi){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",width:"100%",height:"3%",borderRadius:"50%",boxShadow:"0px 0px 2vw 1px #00e5ff",background:"#fff",animation:"3s infinite dce-scanlight",pointerEvents:"none",userSelect:"none",display:"none"}),t.setRegionBox({innerUi:e})}t.addEventListener("opened",function(){this._dceEventListeners.cameraOpen?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}),this._dceEventListeners.played?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});const e=t.currentCamera?.deviceId;e!==t._dceLastDeviceId&&(t._dceLastDeviceId=e,this._dceEventListeners.cameraChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}));const i=t.currentResolution;i.width===t._dceLastResolution?.width&&i.height===t._dceLastResolution?.height||(t._dceLastResolution=i,this._dceEventListeners.resolutionChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}))}),t.addEventListener("closed",function(){this._dceEventListeners.cameraClose?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}),["mousedown","mouseup","dblclick"].forEach(e=>{t._coreShell.addEventListener(e,function(e){const i=[e.clientX,e.clientY],n=t._drawingLayers.filter(e=>e?._visible).map(e=>e._drawingItems).flat(),s=t.videoXY2AbsoluteLT(n.map(e=>{if(e instanceof Tt)return e.quad.points;if(e instanceof St||e instanceof Dt||e instanceof Dt){let{x:t,y:i,width:n,height:s}=e.rect,r=t+n,a=i+s;return[{x:t,y:i},{x:t,y:a},{x:r,y:a},{x:r,y:i}]}return e instanceof Ct?[e.line.startPoint,e.line.endPoint]:void 0}).flat()).map(e=>[e.left,e.top]);let r=0;n.forEach(t=>{let n=!1;t instanceof Tt||t instanceof St||t instanceof Dt||t instanceof Dt?(n=wt(i,[s[r],s[r+1],s[r+2],s[r+3]]),r+=4):t instanceof Ct&&(n=wt(i,[s[r],s[r+1]]),r+=2),n&&t._dceEventListeners[e.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})})})})}return t},lt.defaultUIElementURL="@engineResourcePath/ui/dce.ui.xml";const dt=async function(){const e=this;if("camera"===e.singleFrameMode||"image"===e.singleFrameMode){const t={multiple:!1};"camera"===e.singleFrameMode&&(t.capture="environment");const i=(await tt.showFilePicker(t))[0],n=document.createElement("canvas"),s=n.getContext("2d"),r=URL.createObjectURL(i),a=new Image;a.src=r,await a.decode(),n.width=a.width,n.height=a.height,s.drawImage(a,0,0),URL.revokeObjectURL(r);const o=s.getImageData(0,0,n.width,n.height).data,l={bytes:new Uint8Array(o.buffer,o.byteOffset,o.length),width:n.width,height:n.height,stride:4*n.width,format:10,toCanvas:()=>n,imageTag:{imageId:++gt,type:0}};return void e._dceEventListeners.singleFrameAcquired?.forEach(e=>{try{e.call(this,l)}catch(e){console.error(e)}})}const t=e.ui.querySelector(".dce-bg-loading");t&&(t.style.display="");try{await e._oriOpen()}catch(e){throw lt.onWarning&&lt.onWarning(e?.message),e}return t&&(t.style.display="none"),await new Promise(e=>setTimeout(e,0)),{deviceId:e.currentCamera?.deviceId,...e.currentResolution}};lt.prototype.dispose=function(){this.disposed=!0,this.close(),this.setScanLaserVisible(!1)},lt.prototype.getAllCameras=async function(){return(await tt.getDeviceInfos()).map(e=>({deviceId:e.deviceId,label:e.label}))},lt.prototype.getAvailableResolutions=async function(){const e=this,t=[];await e._oriOpen();for(let i of[[160,120],[320,240],[480,360],[640,480],[800,600],[960,720],[1280,720],[1920,1080],[2560,1440],[3840,2160]])await e.requestResolution(i),(e.currentResolution?.width===i[0]&&e.currentResolution?.height===i[1]||e.currentResolution?.width===i[1]&&e.currentResolution?.height===i[0])&&t.push({width:i[0],height:i[1]});return await e.close(),t},lt.prototype.getCameraStatus=function(){let e=this.status;return"closing"!==e&&"paused"!==e||(e="closed"),e},lt.prototype.getResolution=function(){return"opened"===this.status?this.currentResolution:this.requestedResolution},lt.prototype.getSelectedCamera=function(){return"opened"===this.status?{deviceId:this.currentCamera?.deviceId,label:this.currentCamera?.label}:null},lt.prototype.getVideoSettings=function(){let e="string"==typeof this.requestedCamera?{video:!0}:this.requestedCamera;return Object.assign(e,this.requestedResolution),e},Object.defineProperty(lt.prototype,"ifSkipCameraInspection",{get(){return"quick-back"===this.requestedCamera},set(e){e?this.requestCamera("quick-back"):this.requestCamera("back")}}),lt.prototype.isOpen=function(){return"opened"===this.status},lt.prototype.isPaused=function(){return"paused"===this.status},lt.prototype.resume=async function(){await this._oriOpen()},lt.prototype.selectCamera=async function(e){return await this.requestCamera("string"==typeof e?e:e.deviceId),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},lt.prototype.setResolution=async function(e){return await this.requestResolution(e),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},lt.testCameraAccess=async function(){let e,t=!0;try{await tt.getDeviceInfos()}catch(i){t=!1,e=i.message||i}return{ok:t,message:e}},lt.prototype.updateVideoSettings=async function(e){await this.requestCamera(e)},Object.defineProperty(lt.prototype,"videoSrc",{get(){return this._dceVideoSrc},set(e){const t=this;t._dceVideoSrc=e,e?(t.video.src=e,t.requestCamera("customized-video")):(t.video.src="",t.requestCamera(void 0))}}),lt.prototype.disableEnhancedFeatures=function(e){this._dceEnhancedFeatures=this._dceEnhancedFeatures-(this._dceEnhancedFeatures&e)},lt.prototype.enableEnhancedFeatures=function(e){this._dceEnhancedFeatures|=e},lt.prototype.getCameraSettings=function(){return this.track.getSettings()},lt.prototype.getCapabilities=function(){return this.track.getCapabilities()},lt.prototype.getColorTemperature=function(){return this.track?.getSettings()?.colorTemperature},lt.prototype.getExposureCompensation=function(){return this.track?.getSettings()?.exposureCompensation},lt.prototype.getFrameRate=function(){return this.track?.getSettings()?.frameRate},lt.prototype.setColorTemperature=function(e){this.track?.applyConstraints?.({advanced:[{colorTemperature:{ideal:e}}]})},lt.prototype.setExposureCompensation=function(e){this.track?.applyConstraints?.({advanced:[{exposureCompensation:{ideal:e}}]})},lt.prototype.setFrameRate=function(e){this.track?.applyConstraints?.({advanced:[{frameRate:{ideal:e}}]})},lt.prototype.getZoomSettings=function(){return{factor:this._dceZoom}};const ht=async function(e){const t=this;if("number"==typeof e)return void await t._oriSetZoom(e);let i,n=e.factor;try{i=t.getZoomRange().max}catch(e){i=null}i?n<i?(await t._oriSetZoom(n),t.setSoftZoom(1)):(await t._oriSetZoom(i),t.setSoftZoom(n/i)):t.setSoftZoom(n),t._dceZoom=n};function ut(e,t,i,n){const s=document.createElement("canvas");s.width=t,s.height=i;const r=s.getContext("2d");if(10!==n){let n=new Uint8Array(t*i*4);for(let t=0;t<e.length;++t){let i=4*t;n[i+2]=n[i+1]=n[i]=e[t],n[i+3]=255}e=n}const a=new Uint8ClampedArray(e),o=new ImageData(a,t,i);return r.putImageData(o,0,0),s}lt.prototype.resetZoom=function(){this.setZoom(1),this.setSoftZoom(1,{center:{x:0,y:0}})},lt.prototype.getFocusSettings=function(){return this._dceFocusSettings},lt.prototype.setFocus=async function(e){const t=this;if(t._dceFocusSettings=e,"manual"!==e.mode)await t.track.applyConstraints({advanced:[{focusMode:e.mode}]});else if(e.distance)await t.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:e.distance}]});else{let{x:i,y:n}=e.area.centerPoint,s=e.area.width,r=e.area.height,a=t.currentResolution.width,o=t.currentResolution.height;"string"==typeof i&&(i=i.endsWith("%")?parseFloat(i)*a:parseFloat(i)),"string"==typeof n&&(n=n.endsWith("%")?parseFloat(n)*o:parseFloat(n)),"string"==typeof s&&(s=s.endsWith("%")?parseFloat(s)*a:parseFloat(s)),"string"==typeof r&&(r=r.endsWith("%")?parseFloat(r)*o:parseFloat(r)),await t._advancedFocus({x:i,y:n},s,r)}},lt.prototype.setAutoZoomRange=function(e){this._dceAutoZoomRange=e},lt.prototype.getAutoZoomRange=function(){return this._dceAutoZoomRange};let gt=0;lt.prototype.fetchImage=lt.prototype.getImage=lt.prototype.takePhoto=function(){const e=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),t=2!=this._pixelFormat,i=this._framePipeline.getData({...e,type:t?"rgba":"gray"});if(!i)return null;this._dceEventListeners.frameAddedToBuffer?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});let{width:n,height:s}=e,r=t?10:2;return{bytes:i,width:n,height:s,stride:e.width*(t?4:1),format:r,toCanvas:()=>ut(i,n,s,r),imageTag:{imageId:++gt,type:1}}},Object.defineProperty(lt.prototype,"singleFrameMode",{get(){return this._singleFrameMode},set(e){const t=this;t._singleFrameMode=e;const i=t.ui.querySelector(".dce-bg-camera");i&&("disabled"!==e?(t._singleFrameModeClickCallback||(t._singleFrameModeClickCallback=()=>{t.open()},i.addEventListener("click",t._singleFrameModeClickCallback)),i.style.display=""):(t._singleFrameModeClickCallback&&(i.removeEventListener("click",t._singleFrameModeClickCallback),t._singleFrameModeClickCallback=null),i.style.display="none"))}}),lt.prototype.getScanRegion=function(){return this._dceScanRegion},lt.prototype.hasNextImageToFetch=function(){return"opened"===this.status},lt.prototype.isBufferEmpty=function(){return"opened"!==this.status},lt.prototype.setColourChannelUsageType=function(e){},lt.prototype.startFetching=function(){},lt.prototype.setPixelFormat=function(){return this._pixelFormat},lt.prototype.setPixelFormat=function(e){this._pixelFormat=e},lt.prototype.setScanRegion=function(e){this._dceScanRegion=e;const t=this._dceRegionMaskVisible,i=this._dceRegionMaskStyle;if(e.isMeasuredInPercentage)if(void 0!==e.x){let n=e;this.setRegionBox({width:n.width/100,height:n.height/100,center:{x:(n.x+n.width/2-50)/100,y:(n.y+n.height/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=e;this.setRegionBox({width:(n.right-n.left)/100,height:(n.bottom-n.top)/100,center:{x:((n.left+n.right)/2-50)/100,y:((n.top+n.bottom)/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=this.video.videoWidth||720,s=this.video.videoHeight||1280;if(void 0!==e.x){let r=e;this.setRegionBox({width:Math.min(r.width/n,1),height:Math.min(r.height/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let r=e;this.setRegionBox({width:Math.min((r.right-r.left)/n,1),height:Math.min((r.bottom-r.top)/s,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}}},lt.prototype.stopFetching=function(){},lt.prototype.setCameraView=function(e){if(e===this)return;const t=e.ui.parentElement;e.ui.parentElement&&(e.ui.remove(),t.append(this.ui));let i=[];for(let t in e)"function"==typeof e[t]&&i.push(t);for(let t of i)e[t]=this[t].bind(this)},lt.prototype.getCameraView=function(){return this},lt.prototype.getVideoEl=function(){return this.video},lt.prototype.convertToPageCoordinates=function(e){return this.videoXY2AbsoluteLT([e]).map(e=>({x:e.left,y:e.top}))[0]},lt.prototype.convertToClientCoordinates=function(e){return this.videoXY2FixedLT([e]).map(e=>({x:e.left,y:e.top}))[0]},lt.prototype.convertToScanRegionCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY({isConsiderRegionBox:!0});if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},lt.prototype.convertToContainCoordinates=function(e){const t=this,{x:i,y:n,width:s,height:r}=t.getVisibleAreaInVideoXY();if(isNaN(i)||isNaN(n)||isNaN(s)||isNaN(r))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},lt.prototype.on=function(e,t){(this._dceEventListeners[e]??=new Set).add(t)},lt.prototype.off=function(e,t){this._dceEventListeners[e]?.delete(t)},ct.prototype.getUIElement=function(){return this.ui},ct.prototype.setUIElement=async function(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if(e instanceof HTMLElement&&!e.childElementCount)return await this.setUIElement(ct.defaultUIElementURL),e.append(this.getUIElement()),void(this.ui=e);if("string"==typeof e){let t=e.trim();if(!t.trimStart().startsWith("<")){if(t.includes("@engineResourcePath/")){const e=lt.handleEngineResourcePaths(lt.CoreModule.engineResourcePaths);t=t.replace("@engineResourcePath/","DBR"===lt.CoreModule._bundleEnv?e.dbrBundle:e.dcvData)}t=await fetch(t).then(e=>e.text()),t=t.trim()}if(!t.startsWith("<"))throw Error("Invalid html string.");if(t.startsWith("<template>")&&(t=t.substring(10,t.length-11).trim()),!t.startsWith("<"))throw Error("Invalid html string.");let i,n=Ye(t,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet});if(n instanceof HTMLElement)i=n;else{if(!(n instanceof DocumentFragment))throw Error("Seems no HTMLElement.");i=document.createElement("div"),Object.assign(i.style,{width:"100%",height:"100%"}),i.append(n)}e=i,Object.defineProperty(e,"shadowRoot",{value:e,writable:!0})}if(!(e instanceof HTMLElement))throw Error("Invalid html string.");const t="dm-camera-core-container";let i=e.classList.contains(t)?e:e.querySelector(`.${t}`);if(!i){const n="dce-video-container";i=e.classList.contains(n)?e:e.querySelector(`.${n}`),i&&(e.style.overflow="hidden",e.querySelector("select.dce-sel-camera")?.remove(),e.querySelector("select.dce-sel-resolution")?.remove(),i.classList.add(t))}i||e.classList.add(t),this.ui=e},ct.prototype.getVideoElement=function(){return this.video},ct.prototype.setVideoFit=function(e){this.objectFit=e},ct.prototype.getVideoFit=function(){return this.objectFit},ct.prototype.getVisibleRegionOfVideo=function(e){let{inPixels:t}=e||{inPixels:!1};const i=this.getVisibleAreaInVideoXY();if(t)return{...i,isMeasuredInPercentage:!1};{let{width:e,height:t}=this.currentResolution;return{x:i.x/e*100,y:i.y/t*100,width:i.width/e*100,height:i.height/t*100,isMeasuredInPercentage:!0}}},ct.prototype.setScanRegionMaskStyle=function(e){const t=this._dceRegionMaskVisible;this._dceRegionMaskStyle={...e},this.setRegionBox({maskStyle:{background:t?e.fillStyle:""},borderStyle:{border:t?`${e.lineWidth}px solid ${e.strokeStyle}`:""}})},ct.prototype.getScanRegionMaskStyle=function(){return this._dceRegionMaskStyle},ct.prototype.setScanRegionMaskVisible=function(e){this._dceRegionMaskVisible=e;const t=this._dceRegionMaskStyle;this.setRegionBox({maskStyle:{background:e?t.fillStyle:""},borderStyle:{border:e?`${t.lineWidth}px solid ${t.strokeStyle}`:""}})},ct.prototype.isScanRegionMaskVisible=function(){return this._dceRegionMaskVisible},ct.prototype.setScanLaserVisible=function(e){const t=this.regionBox.innerUi.style;t.display=e?"":"none",setTimeout(()=>{t.display="none",e&&(t.display="")},0)},ct.prototype.isScanLaserVisible=function(){return"none"!==this.regionBox.innerUi.style.display},ct.prototype.setPowerByMessageVisible=function(e){let t=this.ui.querySelector("dce-msg-poweredby,dm-camera-mn-msg-poweredby");t&&(e?"none"!==t.style.display&&(t.style.display=""):t.style.display="none")},ct.prototype.isPowerByMessageVisible=function(){let e=this.ui.querySelector("dce-msg-poweredby");return e&&"none"!==e.style.display},ct.prototype.getTipConfig=function(){return{duration:this._dceTipDuration}},ct.prototype.setTipConfig=function(e){this._dceTipDuration=e.duration},ct.prototype.setTipVisible=function(e){if(e)this.funcShowToast?.(this._dceTipMessage,this._dceTipDuration);else{const e=this.ui.querySelector(".dm-camera-mn-toast");e&&(e.style.display="none")}},ct.prototype.isTipVisible=function(){const e=this.ui.querySelector(".dm-camera-mn-toast");return!!e&&"none"!=e.style.display},ct.prototype.updateTipMessage=function(e){this._dceTipMessage=e},ct.prototype.createDrawingLayer=function(){const e=new Rt;return e._ctx=this.addCanvas().getContext("2d"),this._drawingLayers.push(e),e},ct.prototype.getDrawingLayer=function(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=new Rt,t._ctx=this.addCanvas().getContext("2d"),this._drawingLayers[e]=t,1===e?t._defaultStyle=It.STYLE_BLUE_STROKE:2===e?t._defaultStyle=It.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=It.STYLE_GREEN_STROKE_FILL)),t},ct.prototype.getAllDrawingLayers=function(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)},ct.prototype.clearUserDefinedDrawingLayers=function(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4},ct.prototype.deleteUserDefinedDrawingLayer=function(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])},ct.prototype.clearAllInnerDrawingItems=function(){for(let e of this._drawingLayers.slice(1,4))e?.clearDrawingItems()};let pt=class{static _beepInstance;static beep(){null!=this._beepInstance?this._beepInstance.beep():at()}static get beepSoundSource(){return this._beepInstance?.beepSoundSource}static set beepSoundSource(e){this._beepInstance??=new rt,this._beepInstance.beepSoundSource=e}static vibrate(){null!=this.vibrateDuration?ot(this.vibrateDuration):ot()}static vibrateDuration};const ft="73,245,73",mt="73,173,245",_t="254,180,32",Et="245,236,73",yt=(e,t)=>{let i,n;return"f"===t?(i="strokeAndFill",n="0.3"):"t"===t?(i="fill",n="0.2"):(i="stroke",n="0.3"),{lineWidth:2,fillStyle:`rgba(${e},${n})`,strokeStyle:`rgba(${e},0.9)`,fontFamily:"consolas",fontSize:40,paintMode:i}},It={STYLE_GREEN_STROKE:yt(ft),STYLE_GREEN_STROKE_FILL:yt(ft,"f"),STYLE_GREEN_STROKE_TRANSPARENT:yt(ft,"t"),STYLE_BLUE_STROKE:yt(mt),STYLE_BLUE_STROKE_FILL:yt(mt,"f"),STYLE_BLUE_STROKE_TRANSPARENT:yt(mt,"t"),STYLE_ORANGE_STROKE:yt(_t),STYLE_ORANGE_STROKE_FILL:yt(_t,"f"),STYLE_ORANGE_STROKE_TRANSPARENT:yt(_t,"t"),STYLE_YELLOW_STROKE:yt(Et),STYLE_YELLOW_STROKE_FILL:yt(Et,"f"),STYLE_YELLOW_STROKE_TRANSPARENT:yt(Et,"t"),createDrawingStyle(e){let t=Object.assign({},this.STYLE_YELLOW_STROKE_FILL,e);return Object.assign(e,t),e},getDrawingStyle(e){return"number"==typeof e?this.STYLE_GREEN_STROKE:e},getAllDrawingStyles:()=>[],updateDrawingStyle(e,t){Object.keys(e).forEach(t=>{delete e[t]}),Object.assign(e,t)}};let Rt=class{_visible=!0;_ctx;_defaultStyle=It.STYLE_YELLOW_STROKE_FILL;_drawingItems=[];_mode="viewer";_renderTask;getId(){return this}isVisible(){return this._visible}setVisible(e){this._visible=e;const t=this._ctx;if(!t)return;const i=t.canvas;t.clearRect(0,0,i.width,i.height)}setDefaultStyle(e,t,i){this._defaultStyle=It.getDrawingStyle(e),this._delayRenderAll()}addDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=this._drawingItems.concat(e),this._delayRenderAll()}removeDrawingItems(e){this._drawingItems=this._drawingItems.filter(t=>!e.includes(t))}setDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=[...e],this._delayRenderAll()}getDrawingItems(e){return this._drawingItems.filter(t=>!e||e(t))}hasDrawingItem(e){return this._drawingItems.includes(e)}clearDrawingItems(){this._drawingItems=[],this._delayRenderAll()}_delayRenderAll(){this._renderTask||(this._renderTask=setTimeout(()=>{this.renderAll(),this._renderTask=null},0))}renderAll(){if(!this._visible||!this._ctx)return;const e=this._ctx,t=e.canvas;e.clearRect(0,0,t.width,t.height);for(let t of this._drawingItems){const i=It.getDrawingStyle(t.drawingStyleId||this._defaultStyle);if(t instanceof Dt){e.font=`${i.fontSize}px ${i.fontFamily}`;const{x:n,y:s,width:r,height:a}=t.rect;e.fillText(t.text,n,s,r)}else if(t instanceof At){const i=t.image,n=i.naturalWidth||i.videoWidth||i.width||0,s=i.naturalHeight||i.videoHeight||i.height||0;if(!n||!s)continue;let{x:r,y:a,width:o,height:l}=t.rect;t.maintainAspectRatio&&(l=o/n*s),e.drawImage(i,r,a,o,l)}else{if(e.fillStyle=i.fillStyle,e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,e.setLineDash([]),t._bSelected&&(e.strokeStyle="#0f0",e.lineWidth=4,e.setLineDash([4,4])),e.beginPath(),t instanceof Tt){const i=t.quad.points;e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.lineTo(i[3].x,i[3].y)}else if(t instanceof Ct){const i=t.line.startPoint,n=t.line.endPoint;e.moveTo(i.x,i.y),e.lineTo(n.x,n.y)}else if(t instanceof St){const{x:i,y:n,width:s,height:r}=t.rect;e.moveTo(i,n),e.lineTo(i+s,n),e.lineTo(i+s,n+r),e.lineTo(i,n+r)}i.paintMode.toLowerCase().includes("fill")&&e.fill(),e.closePath(),i.paintMode.toLowerCase().includes("stroke")&&e.stroke()}}}getMode(){return this._mode}setMode(e){}};function wt(e,t){const[i,n]=e;let s=!1;for(let e=0,r=t.length-1;e<t.length;r=e++){const[a,o]=t[e],[l,c]=t[r];if((i-a)*(n-o)==(i-l)*(n-c))return!0;o>n!=c>n&&i<(l-a)*(n-o)/(c-o)+a&&(s=!s)}return s}let vt=class{coordinateBase="image";drawingLayerId;drawingStyleId;mediaType;_state=Ot.DIS_DEFAULT;_notes=[];_bSelected=!1;_dceEventListeners={};getState(){return this._state}addNote(e,t){if(t){let t=!1;for(let i=0;i<this._notes.length;++i)this._notes[i].name===e.name&&(this._notes.splice(i,1,e),t=!0);t||this._notes.push(e)}else this._notes.push(e)}getNote(e){for(let t of this._notes)if(e===t.name)return t;return null}getNotes(){return[...this._notes]}hasNote(e){for(let t of this._notes)if(e===t.name)return!0;return!1}updateNote(e,t,i){for(let n of this._notes)e===n.name&&(i&&"object"==typeof n.content&&"object"==typeof t?n.content={...n.content,content:t}:n.content=t)}deleteNote(e){this._notes=this._notes.filter(t=>t.name!==e)}clearNotes(){this._notes=[]}_delayRenderAll(){this.drawingLayerId?._delayRenderAll()}_setSelected(e){this._bSelected=e,this._delayRenderAll()}on(e,t){(this._dceEventListeners[e]??=new Set).add(t)}off(e,t){this._dceEventListeners[e]?.delete(t)}},Ct=class extends vt{line;constructor(e,t){super(),this.mediaType=Mt.DIMT_LINE,this.line=e,this.drawingStyleId=t}getLine(){return this.line}setLine(e){this.line=e,this._delayRenderAll()}},Tt=class extends vt{quad;constructor(e,t){super(),this.mediaType=Mt.DIMT_QUADRILATERAL,this.quad=e,this.drawingStyleId=t}getQuad(){return this.quad}setQuad(e){this.quad=e,this._delayRenderAll()}},St=class extends vt{rect;constructor(e,t){super(),this.mediaType=Mt.DIMT_RECTANGLE,this.rect=e,this.drawingStyleId=t}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},Dt=class extends vt{text;rect;constructor(e,t,i){super(),this.mediaType=Mt.DIMT_TEXT,this.text=e,this.rect=t,this.drawingStyleId=i}getText(){return this.text}setText(e){this.text=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},At=class extends vt{image;rect;maintainAspectRatio;constructor(e,t,i,n){super(),this.mediaType=Mt.DIMT_IMAGE,e.bytes&&e.format&&(e=ut(e.bytes,e.width,e.height,e.format)),this.image=e,this.rect=t,this.maintainAspectRatio=i,this.drawingStyleId=n}getImage(){return this.image}setImage(e){this.image=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}};const bt=function(e,t){if(this.disposed)return;this.clearAllInnerDrawingItems();const i=e?.items;if(!i?.length)return;const n=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),s=n.x,r=n.y;for(let e of i){let i,n,a;switch(e.type){case 2:i=this.getDrawingLayer(2),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isBarcodeVerifyOpen&&!e.verified&&(a=It.STYLE_ORANGE_STROKE_TRANSPARENT);break;case 4:i=this.getDrawingLayer(3),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isLabelVerifyOpen&&!e.verified&&(a=It.STYLE_GREEN_STROKE_TRANSPARENT);break;case 8:i=this.getDrawingLayer(1),n=e.location.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isDetectVerifyOpen&&1!==e.crossVerificationStatus&&(a=It.STYLE_BLUE_STROKE_TRANSPARENT);break;case 16:i=this.getDrawingLayer(1),n=e.sourceLocation.points.map(e=>({x:s+e.x,y:r+e.y})),t?.isNormalizeVerifyOpen&&1!==e.crossVerificationStatus&&(a=It.STYLE_BLUE_STROKE_TRANSPARENT);break;default:continue}i.addDrawingItems([new Tt({points:n})],a)}};var Mt,Ot,Lt,Nt;!function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(Mt||(Mt={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(Ot||(Ot={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Lt||(Lt={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(Nt||(Nt={}));let Pt=function(){let e=this,t=1e5,i=function(e,t,i){return new Promise(function(n){if(e.toBlob)e.toBlob(function(e){n(e)},t,i);else{let s=e.toDataURL(t,i),r=xt.convertBase64ToBlob(s.substring(s.indexOf(",")+1),t);n(r)}})},n=Pt._doCallbackNoBreak,s=Ye(['<div style="width:100%;height:100%;border:1px solid #ccc;">','<div class="kPainterBox">','<div class="kPainterImgsDiv">','<canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas>',"</div",'><div class="kPainterCroper" style="width:50px;height:50px;display:none;">','<div class="kPainterCells">',"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","</div",'><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div','><div class="kPainterEdges">','<div data-orient="-1,0"></div','><div data-orient="0,-1"></div','><div data-orient="1,0"></div','><div data-orient="0,1"></div>',"</div",'><div class="kPainterCorners">','<div data-orient="-1,-1"><i></i></div','><div data-orient="1,-1"><i></i></div','><div data-orient="1,1"><i></i></div','><div data-orient="-1,1"><i></i></div>',"</div",'><div class="kPainterMover" data-orient="0,0">',"<div></div>",'<svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg>',"</div>","</div",'><div class="kPainterPerspect" style="display:none;">','<canvas class="kPainterPerspectCvs"></canvas','><div class="kPainterPerspectCorner" data-index="0"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="1"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="2"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="3"><canvas style="display:none"></div>',"</div",'><div class="kPainterGesturePanel"></div>',"</div>","</div>"].join("")),r=s.firstChild,a=r.querySelector(".kPainterImgsDiv > .kPainterCanvas");e.getHtmlElement=function(){return s};let o=-1,l=[],c=null,d=null,h=!1,u="view";e.getCurIndex=function(){return o},e.getCount=function(){return l.length},e.isEditing=function(){return h},e.getMode=function(){return u},e.getImage=function(e,t){if(null==t&&(t=o),isNaN(t))return;if((t=Math.round(t))<0||t>=l.length)return;let i;return e?i=l[t]:(i=document.createElement("img"),i.src=l[t].src,i.setAttribute("style","")),i},e.onStartLoading=null,e.onFinishLoading=null;let g=function(){n(e.onStartLoading)},p=function(){n(e.onFinishLoading)},f=new function(){let s=this,a=new Gt,c=e.addImage=function(e){return new Promise(function(t,i){if(h)return i(Error("`addImage(imgData)`: The function is only valid in `view` mode."));if(e instanceof Blob);else if(e instanceof HTMLCanvasElement);else if("string"==typeof e||e instanceof String);else if(!(e instanceof HTMLImageElement)){if(e instanceof Array||e instanceof FileList){let n=[],s=!1;for(let r=0;r<e.length;++r)c(e[r]).then(function(i){n.push(i),s=!0,n.length==e.length&&t(n)},function(r){n.push(r),n.length==e.length&&(s?t(n):(Error("`addImage(imgData)`: No img added in this array. Get more info in `<this error object>.addImgErrArr`.").addImgErrArr=n,i(Error("`addImage(imgData)`: No img added in this array."))))});return}return i(Error("`addImage(imgData)`: Type of `imgData` should be `Blob`, `HTMLCanvasElement`, `HTMLImageElement`, `String(url)`, `Array(a array of source)`, `FileList`."))}g(),a.push(d,null,[e,function(e){"string"!=typeof e?t(e):i(Error("`addImage(imgData)`: "+e)),a.next(),a.isWorking||p()}])})},d=function(e,t){u(e,function(e,i){e instanceof Blob?n(function(){_(e,i,t)}):t(e)})},u=s.getBlobAndFormatFromAnyImgData=function(e,t){let n=function(e){t(e,"image/png")};if(e instanceof Blob)n(e);else if(e instanceof HTMLCanvasElement)i(e).then(n);else if("string"==typeof e||e instanceof String){let i=e;if("data:"==i.substring(0,5)){let e="";"image/"==i.substring(5,11)&&(e=i.substring(5,i.indexOf(";",11)));let t=xt.convertBase64ToBlob(i.substring(i.indexOf("base64,")+7),e);n(t)}else xt.convertURLToBlob(i,function(e){e?n(e):t("Network error.")})}else if(e instanceof HTMLImageElement){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)return void t("Cors error.");let s=e.src;u(s,function(r,a){if(r instanceof Blob)t(r,a);else{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0);let r,a="",o=s.lastIndexOf("?"),l=-1;-1!=o?(l=s.lastIndexOf(".",o),-1!=l&&o-l<=5&&(a=s.substring(l+1,o))):(l=s.lastIndexOf("."),-1!=l&&(a=s.length-l<=5?s.substring(l+1):s.substring(l+1,l+5))),r=-1!=a.indexOf("webp")?"image/webp":-1!=a.indexOf("png")||-1!=a.indexOf("gif")||-1!=a.indexOf("svg")?"image/png":"image/jpeg",i(t,r).then(n)}})}else t("Type of `imgData` not support.")};e.addedImageMaxWH=4096,e.isShowNewImgWhenAdd=!0;let f,_=function(t,n,s){let a=new Image;a.kPainterOriBlob=a.kPainterBlob=t,a.kPainterSaveFormat=n;let c=URL.createObjectURL(a.kPainterBlob);a.onload=a.onerror=function(){if(e._noAnyUseButForIosSafariBug0=a.naturalWidth,e._noAnyUseButForIosSafariBug1=a.naturalHeight,a.kPainterWidth=a.naturalWidth,a.kPainterHeight=a.naturalHeight,a.kPainterOriWidth=a.kPainterWidth,a.kPainterOriHeight=a.kPainterHeight,a.kPainterWidth>e.addedImageMaxWH||a.kPainterHeight>e.addedImageMaxWH)i(function(e,t,i){t=t||new xt.Matrix(1,0,0,1,0,0);let n=document.createElement("canvas"),s=!1;0!=t.a*t.d&&0==t.b*t.c?(n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height):(s=!0,n.width=e.naturalHeight||e.height,n.height=e.naturalWidth||e.width);let r=1;(n.width>i||n.height>i)&&(r=i/Math.max(n.width,n.height),n.width=Math.min(n.width*r),n.height=Math.min(n.height*r));let a=n.getContext("2d");return a.setTransform(t.a,t.b,t.c,t.d,t.e*n.width,t.f*n.height),s?a.drawImage(e,0,0,n.height,n.width):a.drawImage(e,0,0,n.width,n.height),n}(a,null,e.addedImageMaxWH),n).then(function(e){URL.revokeObjectURL(c),a.kPainterOriBlob=a.kPainterBlob=e,c=URL.createObjectURL(a.kPainterBlob),a.src=c});else{a.onload=a.onerror=null,r.querySelector(".kPainterImgsDiv").append(a),(e.isShowNewImgWhenAdd||-1==o)&&R(l.length-1);try{!function(){for(let e=0;e<d.length;++e){let t=d[e].cvs,i=d[e].mwh,n=Math.min(i/a.naturalWidth,i/a.naturalHeight,1);t.width=Math.round(a.naturalWidth*n),t.height=Math.round(a.naturalHeight*n),t.getContext("2d").drawImage(a,0,0,t.width,t.height)}}()}catch(e){setTimeout(function(){throw e},0)}s&&s(l.length-1)}};let d=[];try{!function(){for(let e=0;e<v.length;++e){let t=v[e],i=t.kPainterFunWrap,n=document.createElement("canvas");n.className="kPainterThumbnailCanvas",d.push({cvs:n,mwh:t.kPainterMaxWH});let s=null;try{s=i?i(n):n}catch(e){setTimeout(function(){throw e},0);break}s&&(s.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(s),t.appendChild(s))}}()}catch(e){setTimeout(function(){throw e},0)}a.style.display="none",l.push(a),a.src=c},E=function(){let i=l[o],s=r;Bt(s);let a=Ft(s),c=i.kPainterZoom=Math.min(a.width/i.kPainterWidth,a.height/i.kPainterHeight);if(i.style.width=(Math.round(i.kPainterWidth*c)||1)+"px",i.style.height=(Math.round(i.kPainterHeight*c)||1)+"px",i.style.left=i.style.right=i.style.top=i.style.bottom="-100000px",l.length>=2){let e=l[(l.length+o-1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.right=t+"px",e.style.left=e.style.top=e.style.bottom="-100000px"}if(l.length>=3){let e=l[(l.length+o+1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.left=t+"px",e.style.right=e.style.top=e.style.bottom="-100000px"}n(e.onUpdateImgPosZoom)},y=null,I=null;e.updateUIOnResize=function(t){if(null!=y&&(clearTimeout(y),y=null,I()),t)return new Promise(function(t,i){f=h,y=setTimeout(function(){if(-1==o)y=null,t();else if(f!=h)y=null,t();else{if(h){let t=e.getFreeTransformCornerPos();m.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();y=null,t()}},500),I=i});if(-1!=o){if(h){let t=e.getFreeTransformCornerPos();m.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();return!0}return!1};let R=s.showImg=function(t){let i=l[t];i.parentElement.childNodes.forEach(function(e){e.style.display="none"}),o=t,i.style.display="",l.length>=2&&(t>0||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t-1)%l.length].style.display=""),l.length>=3&&(t<l.length-1||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t+1)%l.length].style.display=""),E(),w()};e.onNumChange=null;let w=function(){let t,i;return function(){t==o&&i==l.length||(t=o,i=l.length,n(e.onNumChange,[o,l.length]))}}();e.changePage=function(e){if(h)return!1;let t;switch(e){case"f":t=0;break;case"p":t=o-1;break;case"n":t=o+1;break;case"l":t=l.length-1;break;default:if(arguments.length<1||isNaN(e))return!1;t=Math.round(e)}return!(t<0||t>=l.length||t==o||(R(t),0))},e.movePage=function(){if(h)return!1;let e,t;if(1==arguments.length?t=arguments[0]:arguments.length>=2&&(e=arguments[0],t=arguments[1]),null==e&&(e=o),isNaN(t))return!1;if(t=Math.round(t),t<0||t>l.length)return!1;if(isNaN(e))return!1;if(e=Math.round(e),e<0||e>=l.length)return!1;if(e==t)return!0;let i=l.splice(e,1)[0];t>e?l.splice(t-1,0,i):l.splice(t,0,i),e==o?o=t>e?t-1:t:e<o&&t>o?--o:e>o&&t<o&&++o,w();try{for(let i=0;i<v.length;++i){let n=v[i],s=n.kPainterThumbBoxArr[e];n.kPainterThumbBoxArr.length==t?n.append(s):n.kPainterThumbBoxArr[t].before(s),n.kPainterThumbBoxArr.splice(e,1),t>e?n.kPainterThumbBoxArr.splice(t-1,0,s):n.kPainterThumbBoxArr.splice(t,0,s)}}catch(e){setTimeout(function(){throw e},0)}return!0},e.del=function(e){if(h)return!1;if(arguments.length<1&&(e=o),isNaN(e))return!1;if((e=Math.round(e))<0||e>=l.length)return!1;URL.revokeObjectURL(l[e].src),l[e].remove(),l.splice(e,1);try{for(let t=0;t<v.length;++t){let i=v[t];i.kPainterThumbBoxArr[e].remove(),i.kPainterThumbBoxArr.splice(e,1)}}catch(e){setTimeout(function(){throw e},0)}return e<o?(--o,w()):e==o?(o==l.length&&--o,o>=0?R(o):w()):w(),!0},e.getWidth=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterWidth},e.getHeight=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterHeight},e.getBlob=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?null:l[e].kPainterBlob};let v=s.thumbnailBoxArr=[];e.bindThumbnailBox=function(t,i,n){if(h)return!1;if(!(t instanceof HTMLElement))return!1;e.unbindThumbnailBox(t),t.innerHTML="",t.kPainterFunWrap=i,t.kPainterMaxWH=n||256,t.kPainterThumbBoxArr=[];for(let n=0;n<l.length;++n){let s=l[n];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r=Math.min(t.kPainterMaxWH/s.naturalWidth,t.kPainterMaxWH/s.naturalHeight,1),a=document.createElement("canvas");a.width=Math.round(s.naturalWidth*r),a.height=Math.round(s.naturalHeight*r),a.getContext("2d").drawImage(s,0,0,a.width,a.height),a.className="kPainterThumbnailCanvas";let o=null;try{o=i?i(a):a}catch(e){return setTimeout(function(){throw e},0),!1}o&&(o.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(o),t.appendChild(o))}return v.push(t),!0},e.unbindThumbnailBox=function(e){if(h)return!1;if(e){for(let t=0;t<v.length;++t)if(v[t]==e)return e.innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0,v.splice(t,1),!0;return!1}for(let t=0;t<v.length;++t)(e=v[t]).innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0;return v.length=0,!0}},m=new function(){let i,s,u,g,p,m=Number.NEGATIVE_INFINITY;e.leftDoubleClickZoomRate=2,e.rightDoubleClickZoomRate=.5;let _,y,I,R,w,v,C,T,S,D,A,b,M,O,L,N,P,x,k=function(t){if(-1==o)return;let n,a=t.targetTouches;if(a){if(a.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";a=[{pageX:t.clientX,pageY:t.clientY}],n=t.buttons}if(1==a.length){_=s=a[0].pageX,y=u=a[0].pageY,F();let t=m;m=(new Date).getTime();let o=i;if(i=n||(Math.abs(N-P)/P<.01?1:2),m-t<1e3&&i==o&&(1==i||2==i)&&Math.abs(a[0].pageX-g)<8&&Math.abs(a[0].pageY-p)<8){m=Number.NEGATIVE_INFINITY;let t=_,n=y,s=N,r=1==i?e.leftDoubleClickZoomRate:e.rightDoubleClickZoomRate;N*=r,N>4&&(N=4,r=4/s),N<P&&(N=P,r=P/s);let a=O+T.pageX0+T.width/2,o=L+T.pageY0+T.height/2;O-=(r-1)*(t-a),L-=(r-1)*(n-o),V()}if(null!=c)return;c="posZoom",r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),x=a[0].identifier}else if(2==a.length){if(_=s=a[0].pageX,y=u=a[0].pageY,null==c&&(c="posZoom"),"posZoom"!=c)return;F(),r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),w=a[1].pageX,v=a[1].pageY,I=(_+w)/2,R=(y+v)/2,C=Math.sqrt(Math.pow(_-w,2)+Math.pow(y-v,2))}else 0==a.length&&(g=_,p=y,B())};e.allowedTouchMoveSwitchImgOverBoundary=!0;let B=function(){if(-1!=o&&"posZoom"==c){if(d=null,c=null,r.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),r.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="1"),r.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="1"),!h&&1!=l.length){let t,i,n=!1;if(N/P<1.2&&(n=!0,t=Math.sqrt(Math.pow(_-s,2)+Math.pow(y-u,2)),i=t/(((new Date).getTime()-m)/1e3)),O<-(Math.round(b*N)||1)/2||n&&t<-50&&i<-200){if(o+1<l.length||e.allowedTouchMoveSwitchImgOverBoundary)return void f.showImg((l.length+o+1)%l.length)}else if((O>(Math.round(b*N)||1)/2||n&&t>50&&i>200)&&(o-1>=0||e.allowedTouchMoveSwitchImgOverBoundary))return void f.showImg((l.length+o-1)%l.length)}V(),U()}},F=function(e){let i=r;if(h?(D=a,b=D.width,M=D.height):(D=l[o],b=D.kPainterWidth,M=D.kPainterHeight),O=parseFloat(D.style.left)+t,L=parseFloat(D.style.top)+t,A=Ut(D),0!=A.a*A.d&&0==A.b*A.c);else{let e=b;b=M,M=e}if(N=D.kPainterZoom||1,T=Bt(i),S=Ft(i),P=Math.min(S.width/b,S.height/M),h&&E.isCropRectShowing&&!e){let e=E.getNeededRect();P=Math.max(Math.max(e.width,b*P)/b,Math.max(e.height,M*P)/M)}};e.onUpdateImgPosZoom=null;let U=function(){if(D.style.left=O-t+"px",D.style.right=-O-t+"px",D.style.top=L-t+"px",D.style.bottom=-L-t+"px",D.kPainterZoom=N,0!=A.a*A.d&&0==A.b*A.c?(D.style.width=(Math.round(b*N)||1)+"px",D.style.height=(Math.round(M*N)||1)+"px"):(D.style.height=(Math.round(b*N)||1)+"px",D.style.width=(Math.round(M*N)||1)+"px"),!h&&1!=l.length){let e=Math.max(0,((Math.round(b*N)||1)-T.width)/2);if(l.length>2||O>e){let t=l[(l.length+o-1)%l.length];t.style.left=O-e-T.width+"px",t.style.right=-O+e+T.width+"px"}if(l.length>2||O<=-e){let t=l[(l.length+o+1)%l.length];t.style.left=O+e+T.width+"px",t.style.right=-O-e-T.width+"px"}}n(e.onUpdateImgPosZoom)},V=function(e,t){if(N>4&&(N=4),N<P&&(N=P),!e){let e=Math.round(b*N)||1;if(S.width>e)O=0;else{let t=(e-S.width)/2;O<-t?O=-t:O>t&&(O=t)}}{let e=Math.round(M*N)||1;if(S.height>e)L=0;else{let t=(e-S.height)/2;L<-t?L=-t:L>t&&(L=t)}}};e.getZoom=function(){if(0!=l.length)return F(),N},e.setZoom=function(e,t){return 0==l.length||(e=parseFloat(e))!=e?null:(F(),t?N*=e:N=e,V(),U(),N)},this.setImgStyleFit=function(){F(!0),N=P,V(),U(),e.setCropRectArea()},["touchstart","touchcancel","touchend","mousedown"].forEach(e=>r.addEventListener(e,k)),r.addEventListener("mouseup",function(e){"mouse"==d&&(g=e.clientX,p=e.clientY,B())}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&(g=_,p=y,B())}),r.addEventListener("contextmenu",function(e){e.preventDefault()}),["touchmove","mousemove"].forEach(e=>r.addEventListener(e,function(e){let t=e.targetTouches;if(t){if("touch"!=d)return}else{if("mouse"!=d)return;t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("posZoom"!=c||x!=t[0].identifier)return;let i=_,n=y;_=t[0].pageX,y=t[0].pageY,O+=_-i,L+=y-n,V(!h),U(),e.preventDefault()}else if(2==t.length){if("posZoom"!=c)return;let i=I,n=R,s=C,r=N;_=t[0].pageX,y=t[0].pageY,w=t[1].pageX,v=t[1].pageY,I=(_+w)/2,R=(y+v)/2,C=Math.sqrt(Math.pow(_-w,2)+Math.pow(y-v,2));let a=C/s;N*=a,N>4&&(N=4,a=4/r),N<P&&(N=P,a=P/r);let o=O+T.pageX0+T.width/2,l=L+T.pageY0+T.height/2;O-=(a-1)*(i-o),L-=(a-1)*(n-l),V(),U(),e.preventDefault()}}))},_=new function(){let t,n=this,s=[];e.stepImgsGCThreshold=10;let _=[],I=[];e.addProtectedStep=function(e){return!!h&&(e=parseInt(e))==e&&(-1!=I.indexOf(e)||(I.push(e),I.sort(function(e,t){return e-t})),!0)},e.removeProtectedStep=function(e){if(!h)return!1;if((e=parseInt(e))!=e)return!1;let t=I.indexOf(e);return-1!=t&&(I.splice(t,1),!0)},e.getProtectedSteps=function(){return h?I.concat():null};let R=n.pushStack=function(i){s.length=t+1;for(let e=_.length-1;e>0&&_[e].beginStep>t;--e)--_.length;let n;if(i.srcBlob){n={crop:{left:0,top:0,width:1,height:1},transform:new xt.Matrix(1,0,0,1,0,0),srcBlob:i.srcBlob,saveFormat:i.saveFormat};for(let t=0;_.length>=e.stepImgsGCThreshold;){if(I.filter(function(e){return _[t].beginStep<=e&&e<_[t].endStep}).length){if(++t<_.length)continue;break}{let e=_[t].beginStep,i=_[t].endStep;for(let t=e;t<i;++t)s[t]=null;_.splice(t,1)}}s.push(n),++t;let r={blob:n.srcBlob,beginStep:t,endStep:t+1};_.push(r)}else{let e,r=s[t],a=r.crop,c=i.transform,d=i.crop,h={};e=c||r.transform,h.left=a.left,h.top=a.top,h.width=a.width,h.height=a.height,0!=e.a*e.d&&0==e.b*e.c?(c&&(e=new xt.Matrix(Math.sign(c.a),0,0,Math.sign(c.d),0,0)),d&&(1==e.a?h.left+=d.left*a.width:h.left+=(1-d.left-d.width)*a.width,1==e.d?h.top+=d.top*a.height:h.top+=(1-d.top-d.height)*a.height,h.width*=d.width,h.height*=d.height)):(c&&(e=new xt.Matrix(0,Math.sign(c.b),Math.sign(c.c),0,0,0)),d&&(1==e.b?h.left+=d.top*a.width:h.left+=(1-d.top-d.height)*a.width,1==e.c?h.top+=d.left*a.height:h.top+=(1-d.left-d.width)*a.height,h.width*=d.height,h.height*=d.width));let u=l[o],g=Math.pow(10,Math.ceil(Math.max(u.kPainterWidth,u.kPainterHeight)).toString().length+2);h.left=Math.round(h.left*g)/g,h.top=Math.round(h.top*g)/g,h.width=Math.round(h.width*g)/g,h.height=Math.round(h.height*g)/g,n={crop:h,transform:e,srcBlob:r.srcBlob,saveFormat:r.saveFormat},s.push(n),++t,n.srcBlob&&(_[_.length-1].endStep=t+1)}};e.undo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t>0){let i=t-1;for(;null==s[i];)--i;v(t,i,function(){return e()})}})},e.redo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t<s.length-1){let i=t+1;for(;null==s[i];)++i;v(t,i,function(){return e()})}})},e.getStepCount=function(){return h?s.length:NaN},e.getCurStep=function(){return h?t:NaN},e.setCurStep=function(e){return new Promise(function(i,n){return arguments.length<1||isNaN(e)||(e=Math.round(e))<0||e>=s.length||null==s[e]?n(Error("`setCurStep(index)`: The parameter `index` is invalid.")):void v(t,e,function(){return i()})})},n.needAlwaysTrueTransform=!1;let w,v=function(e,i,r){t=i;let o=s[e].crop,l=s[t].crop;o.left==l.left&&o.top==l.top&&o.width==l.width&&o.bottom==l.bottom&&s[e].srcBlob==s[t].srcBlob?(Vt(a,s[t].transform.dot(s[e].transform.inversion()).dot(Ut(a))),m.setImgStyleFit(),r&&r()):C(n.needAlwaysTrueTransform,!1,r)};!function(){let e=window.devicePixelRatio||1,t=screen.width,i=screen.height;w=Math.min(t,i)*e}();let C=n.updateCvsAsync=function(e,i,n){a.style.display="none";let r=s[t],c=r.srcBlob||l[o].kPainterOriBlob,d=function(){let t=URL.createObjectURL(c),s=new Image;s.onload=s.onerror=function(){s.onload=s.onerror=null,T(s,r,e,i),URL.revokeObjectURL(t),n&&n()},s.src=t};window.createImageBitmap?createImageBitmap(c).then(function(t){T(t,r,e,i),n&&n()}).catch(function(){d()}):d()},T=function(t,i,n,s){e._noAnyUseButForIosSafariBug0=t.naturalWidth,e._noAnyUseButForIosSafariBug1=t.naturalHeight;let r=t.naturalWidth||t.width,o=t.naturalHeight||t.height,l=i.crop,c=i.transform,d=a.getContext("2d"),h=a.fullQualityWidth=Math.round(r*l.width)||1,u=a.fullQualityHeight=Math.round(o*l.height)||1,g=!1;if(0!=c.a*c.d&&0==c.b*c.c?(a.fullQualityWidth=h,a.fullQualityHeight=u):(a.fullQualityWidth=u,a.fullQualityHeight=h,n&&(g=!0)),a.hasCompressed=!1,n){let e,t;g?(e=u,t=h):(e=h,t=u),a.width=e,a.height=t;let i=e/2*(1-c.a-c.c),n=t/2*(1-c.b-c.d);d.setTransform(c.a,c.b,c.c,c.d,i,n)}else if(h>w||u>w){let e=w/Math.max(h,u);a.width=Math.round(h*e)||1,a.height=Math.round(u*e)||1,a.hasCompressed=!0}else a.width=h,a.height=u;let p,f,_=Math.round(r*l.left),E=Math.round(o*l.top);if(_==r&&--_,E==o&&--E,g?(p=a.height,f=a.width):(p=a.width,f=a.height),h/p<=2)d.drawImage(t,_,E,h,u,0,0,p,f);else{let e=document.createElement("canvas");e.width=Math.round(h/2),e.height=Math.round(u/2);let i,n,s=e.getContext("2d"),r=Math.round(h/2),a=Math.round(u/2);for(s.drawImage(t,_,E,h,u,0,0,r,a);i=r,n=a,r=Math.round(i/2),a=Math.round(n/2),!(r<=p||a<=f);)s.drawImage(e,0,0,i,n,0,0,r,a);d.drawImage(e,0,0,i,n,0,0,p,f)}Vt(a,n?new xt.Matrix(1,0,0,1,0,0):c),s||(m.setImgStyleFit(),a.style.display="")};e.enterEdit=function(){return new Promise(function(i,n){if(h)return n(Error("`enterEdit()`: The function is invalid in current mode."));if(-1==o)return n(Error("`enterEdit()`: There is no image in the instance."));u="",g(),h=!0;let r=l[o].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new xt.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};var f;s.push(r),t=0,f=function(){return p(),d=null,c=null,u="basicEdit",i()},a.parentElement.childNodes.forEach(function(e){e!==a&&(e.style.display="none")}),C(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),f()})})};let S=e.cancelEdit=function(){return!!h&&(h=!1,s.length=0,_.length=0,f.showImg(o),a.style.display="none",E.hideCropRect(),y.hideFreeTransformBorderDirectly(),d=null,c=null,u="view",!0)},D=!1;e.saveEdit=function(n){return new Promise(function(m,_){if(!h||D)return _(Error("`saveEdit(isCover)`: The function is invalid in current mode."));u="",D=!0,g(),setTimeout(function(){!function(e,n){let c=s[t].crop,d=s[t].transform,h=s[0].crop,u=s[0].transform,g=l[o];if(s[t].srcBlob||u.a!=d.a||u.b!=d.b||u.c!=d.c||u.d!=d.d||Math.round(g.kPainterOriWidth*c.left)!=Math.round(g.kPainterOriWidth*h.left)||Math.round(g.kPainterOriHeight*c.top)!=Math.round(g.kPainterOriHeight*h.top)||Math.round(g.kPainterOriWidth*(c.left+c.width))!=Math.round(g.kPainterOriWidth*(h.left+h.width))||Math.round(g.kPainterOriHeight*(c.top+c.height))!=Math.round(g.kPainterOriHeight*(h.top+h.height))){URL.revokeObjectURL(g.src);let c=new Image,h=function(){c.onload=c.onerror=function(){c.onload=c.onerror=null,n?(l[o].remove(),l.splice(o,1,c)):l.splice(++o,0,c),r.querySelector(".kPainterImgsDiv").append(c),e()},i(a,s[t].saveFormat||g.kPainterSaveFormat).then(function(e){c.kPainterBlob=e,c.kPainterWidth=a.width,c.kPainterHeight=a.height,s[t].srcBlob?(c.kPainterOriBlob=e,c.kPainterOriWidth=a.width,c.kPainterOriHeight=a.height,c.kPainterSaveFormat=s[t].saveFormat):(c.kPainterOriBlob=g.kPainterOriBlob,c.kPainterOriWidth=g.kPainterOriWidth,c.kPainterOriHeight=g.kPainterOriHeight,c.kPainterProcess=s[t],c.kPainterSaveFormat=g.kPainterSaveFormat);let i=URL.createObjectURL(e);c.src=i})};a.hasCompressed||1!=d.a||0!=d.b||0!=d.c||1!=d.d||0!=d.e||0!=d.f?(a.style.display="none",C(!0,!0,h)):h()}else e()}(function(){S(),p(),D=!1,d=null,c=null;try{!function(){for(let t=0;t<f.thumbnailBoxArr.length;++t){let i=f.thumbnailBoxArr[t],s=l[o];e._noAnyUseButForIosSafariBug0=s.naturalWidth,e._noAnyUseButForIosSafariBug1=s.naturalHeight;let r,a=Math.min(i.kPainterMaxWH/s.naturalWidth,i.kPainterMaxWH/s.naturalHeight,1);if(n){let e=i.kPainterThumbBoxArr[o];r=e.classList.contains("kPainterThumbnailCanvas")?e:e.querySelector(".kPainterThumbnailCanvas")}else r=document.createElement("canvas"),r.className="kPainterThumbnailCanvas";if(r.width=Math.round(s.naturalWidth*a),r.height=Math.round(s.naturalHeight*a),r.getContext("2d").drawImage(s,0,0,r.width,r.height),!n){let e=i.kPainterFunWrap,t=null;try{t=e?e(r):r}catch(e){return setTimeout(function(){throw e},0),!1}t&&(t.getKPainterIndex=function(){return i.kPainterThumbBoxArr.indexOf(this)},i.kPainterThumbBoxArr.splice(o,0,t),i.kPainterThumbBoxArr[o-1].after(t))}}}()}catch(e){setTimeout(function(){throw e},0)}return u="view",m()},n)},100)})},e.rotateRight=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(0,1,-1,0,0,0),e);Vt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,m.setImgStyleFit(),!0},e.rotateLeft=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(0,-1,1,0,0,0),e);Vt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,m.setImgStyleFit(),!0},e.mirror=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(-1,0,0,1,0,0),e);return Vt(a,t),R({transform:t}),m.setImgStyleFit(),!0},e.flip=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(1,0,0,-1,0,0),e);return Vt(a,t),R({transform:t}),m.setImgStyleFit(),!0},e.resize=function(e,t){return new Promise(function(s,r){return h?(e=parseInt(e),t=parseInt(t),e!=e||e<1?r(Error("`resize`: The parameter `newWidth` is invaild.")):t!=t||t<1?r(Error("`resize`: The parameter `newHeight` is invaild.")):(g(),void n.updateCvsAsync(!0,!0,function(){n.needAlwaysTrueTransform=!0;let r=e,o=t;for(;2*r<a.width;)r*=2;for(;2*o<a.height;)o*=2;let l,c=a;for(;;){l=document.createElement("canvas"),l.width=r,l.height=o,l.getContext("2d").drawImage(c,0,0,r,o);let i=!1;if(e!=r&&(r/=2,i=!0),t!=o&&(o/=2,i=!0),!i)break}i(l).then(function(e){n.pushStack({srcBlob:e,saveFormat:"image/jpeg"}),n.updateCvs(!1,!1,function(){return n.needAlwaysTrueTransform=!1,p(),s()})})}))):r(Error("`resize`: The function is invaild in this mode."))})},e.getEditWidth=function(){return h?a.fullQualityWidth:NaN},e.getEditHeight=function(){return h?a.fullQualityHeight:NaN}},E=new function(){let i=this;e.isAutoShowCropUI=!0;let s,o,l,u,g,p,f,m,E,y,I,R,w,v,C,T,S,D,A,b,M=r.querySelector(".kPainterCroper");i.isCropRectShowing=!1,e.showCropRect=i.showCropRect=function(){h&&(i.isCropRectShowing=!0,k(),M.style.display="")},e.hideCropRect=i.hideCropRect=function(){i.isCropRectShowing=!1,M.style.display="none"},Object.assign(M.style,{"border-left-width":t+"px","border-top-width":t+"px","border-right-width":t+"px","border-bottom-width":t+"px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"}),e.setCropRectStyle=function(e){switch(parseInt(e)){case 0:return M.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display="none"),M.querySelectorAll(".kPainterMover").forEach(e=>e.style.display=""),!0;case 1:return M.querySelectorAll(".kPainterMover").forEach(e=>e.style.display="none"),M.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display=""),!0;default:return!1}},e.cropRectMinW=50,e.cropRectMinH=50;let O=function(e){e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if(null!=c)return;c="crop",l=t[0].identifier,s=t[0].pageX,o=t[0].pageY;let e=this.getAttribute("data-orient").split(",");u=e[0],g=e[1],N()}else 0==t.length&&L()},L=function(){"crop"==c&&(d=null,c=null)},N=function(){p=Ft(r),P(),C=parseFloat(M.style.width),T=parseFloat(M.style.height),w=parseFloat(M.style.left)-C/2+t,v=parseFloat(M.style.top)-T/2+t,S=Math.max(-p.width/2,f),D=Math.max(-p.height/2,m),A=Math.min(p.width/2,E),b=Math.min(p.height/2,y)},P=function(){let e=Ut(a),i=parseFloat(a.style.left)+t,n=parseFloat(a.style.top)+t;0!=e.a*e.d&&0==e.b*e.c?(I=parseFloat(a.style.width),R=parseFloat(a.style.height)):(I=parseFloat(a.style.height),R=parseFloat(a.style.width));let s=I/2,r=R/2;f=i-s,m=n-r,E=i+s,y=n+r};r.querySelectorAll(".kPainterCroper > .kPainterEdges > div, .kPainterCroper > .kPainterCorners > div, .kPainterCroper > .kPainterMover, .kPainterCroper > .kPainterBigMover").forEach(e=>{["touchstart","touchcancel","touchend","mousedown"].forEach(t=>e.addEventListener(t,O))}),r.addEventListener("mouseup",function(){"mouse"==d&&L()}),r.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&L()}),e.onCropRectChange=null;let x=function(){M.style.left=w+C/2-t+"px",M.style.right=-w-C/2-t+"px",M.style.top=v+T/2-t+"px",M.style.bottom=-v-T/2-t+"px",M.style.width=C+"px",M.style.height=T+"px",n(e.onCropRectChange)};["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if("crop"!=c||l!=i[0].identifier)return;let n=s,r=o;s=i[0].pageX,o=i[0].pageY;let a=s-n,d=o-r;-1==u?(C-a<e.cropRectMinW&&(a=C-e.cropRectMinW),w+a<S&&(a=S-w),C-=a,w+=a):1==u&&(C+a<e.cropRectMinW&&(a=-C+e.cropRectMinW),w+C+a>A&&(a=A-C-w),C+=a),-1==g?(T-d<e.cropRectMinH&&(d=T-e.cropRectMinH),v+d<D&&(d=D-v),T-=d,v+=d):1==g&&(T+d<e.cropRectMinH&&(d=-T+e.cropRectMinH),v+T+d>b&&(d=b-T-v),T+=d),0==u&&0==g&&(w+a<S?a=S-w:w+C+a>A&&(a=A-C-w),v+d<D?d=D-v:v+T+d>b&&(d=b-T-v),w+=a,v+=d),x(),t.preventDefault()}}));let k=e.setCropRectArea=function(e,t,n,s){if(!i.isCropRectShowing)return!1;e>=-.5||(e=-.5),t>=-.5||(t=-.5),n<=.5||(n=.5),s<=.5||(s=.5),e>n&&(e=n=(e+n)/2),t>s&&(t=s=(t+s)/2),N(),w=f+(e+.5)*I,w<S&&(w=S),v=m+(t+.5)*R,v<D&&(v=D);let r=f+(n+.5)*I;r>A&&(r=A),C=r-w;let a=m+(s+.5)*R;return a>b&&(a=b),T=a-v,x(),!0},B=e.getCropRectArea=function(e){if(!i.isCropRectShowing)return null;!function(){let e,t=Ut(a);e=0!=t.a*t.d&&0==t.b*t.c?parseFloat(a.style.width):parseFloat(a.style.height),e!=I&&N()}();let t=(w-f)/I-.5,n=(v-m)/R-.5,s=t+C/I,r=n+T/R;return e&&(t=Math.round(t*a.fullQualityWidth*2)/2,n=Math.round(n*a.fullQualityHeight*2)/2,s=Math.round(s*a.fullQualityWidth*2)/2,r=Math.round(r*a.fullQualityHeight*2)/2),[t,n,s,r]};i.getNeededRect=function(){N();let e={};return e.width=2*Math.max(-w,w+C),e.height=2*Math.max(-v,v+T),e},e.crop=function(e){return new Promise(function(t,i){if(!h)return i(Error("crop([ltrb])`: The function is invalid in this mode."));if(N(),!(e=e||B()))return i(Error("crop([ltrb])`: No thing can be cropped."));let n=e[0],s=e[1],r=e[2],o=e[3];if((n+.5)*a.fullQualityWidth<.5&&(.5-r)*a.fullQualityWidth<=.5&&(s+.5)*a.fullQualityHeight<.5&&(.5-o)*a.fullQualityHeight<=.5)return t([n,s,r,o]);_.pushStack({crop:{left:n+.5,top:s+.5,width:r-n,height:o-s}}),_.updateCvsAsync(_.needAlwaysTrueTransform,!1,function(){return t([n,s,r,o])})})}},y=new function(){let t=this;!function(){let i=r.querySelector(".kPainterPerspect");t.hideFreeTransformBorderDirectly=function(){i.style.display="none"};let s=r.querySelector(".kPainterPerspect > .kPainterPerspectCvs");e.onFreeTransformCornerPosChange=null;let o=e.setFreeTransformCornerPos=function(e){if("freeTransform"!=u)return;let t=a.kPainterZoom,n=Ut(a),s=a.width*t,r=a.height*t;if(0==n.a*n.d||0!=n.b*n.c){let e=s;s=r,r=e}let o=a.width*t/2,l=a.height*t/2;for(let t=0;t<I.length;++t){let i=I[t],n=e[i.getAttribute("data-index")],a=s*n[0],c=r*n[1];a<-o?a=-o:a>o&&(a=o),c<-l?c=-l:c>l&&(c=l),i.style.left=a+"px",i.style.right=-a+"px",i.style.top=c+"px",i.style.bottom=-c+"px"}f(),i.style.display=""},l=e.getFreeTransformCornerPos=function(){let e=a.kPainterZoom,t=Ut(a),i=a.width*e,n=a.height*e;if(0==t.a*t.d||0!=t.b*t.c){let e=i;i=n,n=e}let s=[];for(let e=0;e<I.length;++e){let t=I[e];s.push([parseFloat(t.style.left)/i,parseFloat(t.style.top)/n])}return s},f=function(){let t=kt(r);s.width=Math.round(t.width),s.height=Math.round(t.height);let i=[];for(let e=0;e<I.length;++e)i.push([Math.round(parseFloat(I[e].style.left)+t.width/2),Math.round(parseFloat(I[e].style.top)+t.height/2)]);let a,o=s.getContext("2d"),l=Number.POSITIVE_INFINITY;for(let e=0;e<4;++e){let t=i[e][0]*i[e][0]+i[e][1]*i[e][1];t<l&&(l=t,a=e)}let c=[];for(let e=0;e<4;++e)c.push([i[(a+e)%4][0],i[(a+e)%4][1]]);o.fillStyle="rgba(0,0,0,0.3)",o.beginPath(),o.moveTo(0,0),o.lineTo(c[0][0],c[0][1]);let d=[];for(let e=0;e<4;++e)d.push((h=c[e][0],u=c[e][1],g=c[(e+1)%4][0],p=c[(e+1)%4][1],f=c[(e+2)%4][0],m=c[(e+2)%4][1],_=c[(e+3)%4][0],E=c[(e+3)%4][1],[Math.sign((p-u)*f+(h-g)*m+g*u-h*p),Math.sign((p-u)*_+(h-g)*E+g*u-h*p)]));var h,u,g,p,f,m,_,E;let y,R=function(e,t,i,n,s,r,a,o){let l=n-t,c=e-i,d=i*t-e*n,h=o-r,u=s-a,g=a*r-s*o,p=c*h-u*l;return[(d*u-g*c)/p,(g*l-d*h)/p]},w=function(){let e,t,i=c[1][0]-c[0][0];i&&(e=(c[1][1]-c[0][1])/i);let n=c[3][0]-c[0][0];return n&&(t=(c[3][1]-c[0][1])/n),i>0?!(n>0)||e<=t:0==i?!(n>0):!(n>=0)&&e<=t}();d[0][0]*d[0][1]<0?d[2][0]*d[2][1]<0&&(y=R(c[0][0],c[0][1],c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]),w?(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1]))):d[1][0]*d[1][1]<0&&d[3][0]*d[3][1]<0&&(y=R(c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1],c[0][0],c[0][1]),w?(o.lineTo(c[1][0],c[1][1]),o.lineTo(y[0],y[1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(y[0],y[1])):(o.lineTo(y[0],y[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(y[0],y[1]),o.lineTo(c[1][0],c[1][1]))),y||(w?(o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]))),o.lineTo(c[0][0],c[0][1]),o.lineTo(0,0),o.lineTo(0,s.height),o.lineTo(s.width,s.height),o.lineTo(s.width,0),o.lineTo(0,0),o.fill(),n(e.onFreeTransformCornerPosChange)};e.isShowMagnifier=!0,e.magnifierZoom=2;let m=function(){if(!e.isShowMagnifier)return;const t=v.querySelector("canvas");100!=t.width&&(t.width=100),100!=t.height&&(t.height=100);const i=t.getContext("2d"),n=parseInt(v.getAttribute("data-index")),[s,r]=l()[n],o=e.magnifierZoom;i.fillStyle="#aaa",i.strokeStyle="#0f0",i.lineWidth=1;let c=a.width*(.5+s)-50/o,d=a.height*(.5+r)-50/o,h=100/o,u=100/o,g=0,p=0,f=100,m=100;{const e=f/h,t=m/u;if(c<0){const t=-c*e;g+=t,f-=t,h+=c,c=0}if(d<0){const e=-d*t;p+=e,m-=e,u+=d,d=0}if(c+h>a.width){const t=c+h-a.width;f-=t*e,h-=t}if(d+u>a.height){const e=d+u-a.height;m-=e*t,u-=e}}i.fillRect(0,0,t.width,t.height),i.drawImage(a,c,d,h,u,g,p,f,m),i.beginPath(),i.moveTo(40,50),i.lineTo(60,50),i.moveTo(50,40),i.lineTo(50,60),i.closePath(),i.stroke();for(let e of C)e!==t&&"none"!==e.style.display&&(e.style.display="none");"none"===t.style.display&&(t.style.display="")},y=function(){e.isShowMagnifier&&C.forEach(e=>{"none"!==e.style.display&&(e.style.display="none")})},I=[...r.querySelectorAll(".kPainterPerspect > .kPainterPerspectCorner")];I.forEach(e=>{e.style.left="0"}),I.forEach(e=>{e.style.top="0"}),I.forEach(e=>{e.style.right="0"}),I.forEach(e=>{e.style.bottom="0"});let R,w,v,C=I.map(e=>e.querySelector("canvas")),T=null,S=function(t){let i,n=a.kPainterZoom,s=a.width*n/2,r=a.height*n/2,o=!1;i=t?I:[v];for(let e=0;e<i.length;++e){let t=i[e],n=parseFloat(t.style.left),a=parseFloat(t.style.top),l=!0,c=!0;n<-s?n=-s:n>s?n=s:l=!1,a<-r?a=-r:a>r?a=r:c=!1,l&&(t.style.left=n+"px",t.style.right=-n+"px"),c&&(t.style.top=a+"px",t.style.bottom=-a+"px"),(l||c)&&(o=!0)}if(o&&f(),e._dceGetQuads){let t,i=e._dceSelectedItemIdxs,n=a.width,s=a.height;t=i.size?[...i.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x<0?t.x=0:t.x>n&&(t.x=n),t.y<0?t.y=0:t.y>s&&(t.y=s);e.setQuad(e.quad)}}};["touchstart","touchcancel","touchend","mousedown"].forEach(e=>I.forEach(t=>t.addEventListener(e,function(e){v=this,e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("perspect"!=c)return;c="perspectCornerMoving",S(),m(),T=t[0].identifier,R=t[0].pageX,w=t[0].pageY}else 0==t.length&&"perspectCornerMoving"==c&&(S(),y(),d=null,c="perspect")}))),["touchmove","mousemove"].forEach(t=>r.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if(T!=i[0].identifier)return;if("perspectCornerMoving"!=c&&"perspectQuadMoving"!=c)return;let n=R,s=w;R=i[0].pageX,w=i[0].pageY;let r=R-n,o=w-s;if("perspectCornerMoving"===c){let t=parseFloat(v.style.left)+r,i=parseFloat(v.style.top)+o;if(v.style.left=t+"px",v.style.right=-t+"px",v.style.top=i+"px",v.style.bottom=-i+"px",e._dceGetQuads){let t=a.kPainterZoom,i=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(i){let e=parseInt(v.getAttribute("data-index")),n=i.quad.points[e];n.x+=r/t,n.y+=o/t,i.setQuad(i.quad)}}f(),m()}else if("perspectQuadMoving"===c){for(let e=0;e<I.length;++e){let t=I[e],i=parseFloat(t.style.left)+r,n=parseFloat(t.style.top)+o;t.style.left=i+"px",t.style.right=-i+"px",t.style.top=n+"px",t.style.bottom=-n+"px"}if(e._dceGetQuads){let t,i=a.kPainterZoom,n=e._dceSelectedItemIdxs;t=n.size?[...n.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x+=r/i,t.y+=o/i;e.setQuad(e.quad)}}f()}t.preventDefault()}})),["touchstart","touchcancel","touchend","mousedown"].forEach(t=>r.addEventListener(t,function(t){let n=t.targetTouches;if(n){if(n.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";n=[{pageX:t.clientX,pageY:t.clientY}]}if(1==n.length){if("perspect"!=c)return;let s=Ft(i),r=(s.pageX0+s.pageX1)/2,o=(s.pageY0+s.pageY1)/2,d=a.kPainterZoom,h=a.width*d,u=a.height*d,g=(n[0].pageX-r)/h,p=(n[0].pageY-o)/u;if(e._dceGetQuads){(t.shiftKey||t.ctrlKey)&&(e._dceThisClickShouldKeepMultiSelect=!0);const i=e._dceGetQuads(),n=e._dceSelectedItemIdxs;let s=!1;for(let r=i.length-1;r>=0;--r){let a=i[r].quad.points,o=e.getWidth(),l=e.getHeight(),c=a.map(({x:e,y:t})=>[e/o-.5,t/l-.5]);if(wt([g,p],c)){t.shiftKey||t.ctrlKey?(n.add(e._dceSelectedItemIdx),i[e._dceSelectedItemIdx]?._setSelected(!0),n.add(r),i[r]?._setSelected(!0)):n.has(r)&&(e._dceThisClickShouldKeepMultiSelect=!0),e._dceSelectedItemIdx=r,e.setFreeTransformCornerPos(c),s=!0,i[r]._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});break}}if(!s)return}else if(!wt([g,p],l()))return;c="perspectQuadMoving",T=n[0].identifier,R=n[0].pageX,w=n[0].pageY,t.preventDefault()}else 0==n.length&&"perspectQuadMoving"==c&&(S(!0),d=null,c="perspect")})),["mouseup","mouseleave"].forEach(t=>r.addEventListener(t,function(t){if("mouse"==d){if(e._dceGetQuads){if("perspectQuadMoving"==c&&!e._dceThisClickShouldKeepMultiSelect||"perspect"==c){const t=e._dceGetQuads();for(let i of e._dceSelectedItemIdxs)t[i]?._setSelected(!1);e._dceSelectedItemIdxs.clear()}e._dceThisClickShouldKeepMultiSelect=!1}if("perspectCornerMoving"==c)S(),y(),d=null,c="perspect";else if("perspectQuadMoving"==c){if(e._dceGetQuads){const i=e._dceGetQuads();i[e._dceSelectedItemIdx]?._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}S(!0),d=null,c="perspect"}}})),e.enterFreeTransformMode=function(){return new Promise(function(e,t){if(!h)return t(Error("`enterFreeTransformMode`: The function is only valid in edit mode."));u="",d=null,c="perspect",g(),setTimeout(function(){E.hideCropRect(),_.updateCvsAsync(!0,!1,async()=>{_.needAlwaysTrueTransform=!0,u="freeTransform",o([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]),i.style.display="",p(),e()})},0)})},e.exitFreeTransformMode=function(){return new Promise(function(t,n){if("freeTransform"!=u)return n(Error("`exitFreeTransformMode`: It is not in `freeTransform` mode."));u="",i.style.display="none",_.updateCvsAsync(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),d=null,c=null,_.needAlwaysTrueTransform=!1,u="basicEdit",t()})})}}()}};Pt._doCallbackNoBreak=function(e,t){if(e)try{e.apply(window,t||[])}catch(e){setTimeout(function(){throw e},0)}};let xt={};Math.sign||(Math.sign=function(e){return e>0?1:0==e?1/e<0?-0:0:e<0?-1:NaN}),xt.Matrix=function(e,t,i,n,s,r){this.a=e,this.b=t,this.c=i,this.d=n,this.e=s,this.f=r},xt.Matrix.dot=function(e,t){let i=e,n=t;return new xt.Matrix(i.a*n.a+i.c*n.b,i.b*n.a+i.d*n.b,i.a*n.c+i.c*n.d,i.b*n.c+i.d*n.d,i.a*n.e+i.c*n.f+i.e,i.b*n.e+i.d*n.f+i.f)},xt.Matrix.prototype.dot=function(e){return xt.Matrix.dot(this,e)},xt.Matrix.equals=function(e,t){let i=e,n=t;return i.a==n.a&&i.b==n.b&&i.c==n.c&&i.d==n.d&&i.e==n.e&&i.f==n.f},xt.Matrix.prototype.equals=function(e){return xt.Matrix.equals(this,e)},xt.Matrix.prototype.inversion=function(){let e=this.a,t=this.b,i=this.c,n=this.d,s=this.e,r=this.f,a=e*n-t*i;return new xt.Matrix(n/a,-t/a,-i/a,e/a,(i*r-n*s)/a,(t*s-e*r)/a)},xt.convertURLToBlob=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onloadend=function(){t(this.response)},i.send()},xt.convertBase64ToBlob=function(e,t){let i=atob(e),n=new Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);let s=new Uint8Array(n);return new Blob([s],{type:t})};let kt=function(e){let t=getComputedStyle(e);const i=e.getBoundingClientRect();let n={};return n.pageX0=i.left+window.scrollX,n.pageY0=i.top+window.scrollY,n.width=t?parseFloat(t.width):i.width,n.height=t?parseFloat(t.height):i.height,n.pageX1=n.pageX0+n.width,n.pageY1=n.pageY0+n.height,n},Bt=function(e){let t=kt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("border-left-width"))||0,i.top=parseFloat(t.getPropertyValue("border-top-width"))||0,i.right=parseFloat(t.getPropertyValue("border-right-width"))||0,i.bottom=parseFloat(t.getPropertyValue("border-bottom-width"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Ft=function(e){let t=Bt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("padding-left"))||0,i.top=parseFloat(t.getPropertyValue("padding-top"))||0,i.right=parseFloat(t.getPropertyValue("padding-right"))||0,i.bottom=parseFloat(t.getPropertyValue("padding-bottom"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Ut=function(e){let t=e.style.transform,i="matrix(",n=t.indexOf(i);if(-1!=n){n+=i.length;let e=t.substring(n,t.indexOf(")",n)).split(",");for(let t=0;t<e.length;++t)e[t]=parseFloat(e[t]);return new xt.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])}i="scale(";let s=t.indexOf(i);if(-1!=s){s+=i.length;let e=parseFloat(t.substring(s));return new xt.Matrix(e,0,0,e,0,0)}return new xt.Matrix(1,0,0,1,0,0)},Vt=function(e,t){let i=t,n="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";e.style.transform=n},Gt=function(){this._queue=[],this.isWorking=!1,this.timeout=100};if(Gt.prototype.push=function(e,t,i,n){this._queue.push({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Gt.prototype.unshift=function(e,t,i,n){this._queue.unshift({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Gt.prototype.next=function(){if(0==this._queue.length)return void(this.isWorking=!1);this.isWorking=!0;let e=this._queue.shift(),t=e.task,i=e.context?e.context:self,n=e.args?e.args:[],s=e.handleReturn;setTimeout(function(){let e=t.apply(i,n);"function"==typeof s&&s(e)},this.timeout)},document?.head){const e=new Blob(["\n.kPainterBox, .kPainterBox *{box-sizing: border-box;}\n.kPainterBox{width:100%;height:100%;border-bottom:none;position:relative;padding:15px;}\n.kPainterBox > .kPainterImgsDiv{width:100%;height:100%;}\n.kPainterBox > .kPainterImgsDiv > canvas, .kPainterBox > .kPainterImgsDiv > img{position:absolute;margin:auto;/*left:0;top:0;right:0;bottom:0;transform-origin:left top;*/pointer-events:none;}\n/*.kPainterBox > .center{margin:auto;left:0;right:0;top:0;bottom:0;}*/\n.kPainterBox > .kPainterCroper{position:absolute;margin:auto;border-style:solid;border-color:rgba(0,0,0,0.3);/*border-right-width:100vw;border-bottom-width:100vh;*/box-sizing:content-box;}\n.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;line-height:0;position:relative;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div{display:inline-block;width:33.33%;height:33.33%;border-style:solid;border-color:rgba(255,255,255,0.5);position:absolute;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(1){border-width:1px 0 0 1px;left:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(2){border-width:1px 1px 0 1px;left:0;top:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(3){border-width:1px 1px 0 0;right:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(4){border-width:1px 0 1px 1px;left:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(5){border-width:1px 1px 1px 1px;left:0;top:0;right:0;bottom:0;margin:auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(6){border-width:1px 1px 1px 0;right:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(7){border-width:0 0 1px 1px;left:0;bottom:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(8){border-width:0 1px 1px 1px;left:0;bottom:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(9){border-width:0 1px 1px 0;right:0;bottom:0;}\n/*.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;overflow:hidden;}\n.kPainterBox > .kPainterCroper > .kPainterCells > table{width:100%;height:100%;}\n.kPainterBox > .kPainterCroper > .kPainterCells td{border:1px solid white;}*/\n.kPainterBox > .kPainterCroper > .kPainterBigMover{position:absolute;width:100%;height:100%;left:0;top:0;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div{position:absolute;border-color:white;border-style:solid;border:0;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(1){width:30px;height:100%;left:-15px;top:0;z-index:1;cursor:w-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(2){width:100%;height:30px;left:0;top:-15px;z-index:1;cursor:n-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(3){width:30px;height:100%;right:-15px;top:0;z-index:1;cursor:e-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(4){width:100%;height:30px;left:0;bottom:-15px;z-index:1;cursor:s-resize;}\n/*.kPainterBox > .kPainterCroper > .kPainterEdges > div > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterCroper > .kPainterCorners > div{position:absolute;width:16px;height:16px;border-color:white;border-style:solid;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1){left:0;top:0;border-width:2px 0 0 2px;z-index:1;cursor:nw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2){right:0;top:0;border-width:2px 2px 0 0;z-index:1;cursor:ne-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3){right:0;bottom:0;border-width:0 2px 2px 0;z-index:1;cursor:se-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4){left:0;bottom:0;border-width:0 0 2px 2px;z-index:1;cursor:sw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div > i{width:32px;height:32px;position:absolute;display:inline-block;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1) > i{left:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2) > i{right:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3) > i{right:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4) > i{left:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterMover{display:inline-block;position:absolute;border:solid 12px rgba(0,0,0,0.15);border-radius:12px;left: 13px;top:13px;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterMover > div{display:inline-block;position:absolute;border:solid 15px transparent;border-radius:15px;left:-15px;top:-15px;}\n.kPainterBox > .kPainterCroper > .kPainterMover > svg{display:inline-block;position:absolute;left:-10px;top:-10px;}\n/*.kPainterBox > .kPainterCroper > .kPainterCorners > div > i > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterPerspect{position:absolute;width:100%;height:100%;left:0;top:0;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCvs{position:absolute;margin:auto;left:-100000px;top:-100000px;right:-100000px;bottom:-100000px;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner{position:absolute;margin:auto;width:20px;height:20px;border-radius:10px;border:2px solid #0f0;color:#fff;background:rgba(0,0,0,0.3);text-align:center;line-height:16px;font-size:12px;font-family:Arial,sans-serif;z-index:1;cursor:move;}\n.kPainterBox > .kPainterGesturePanel{position:absolute;left:0;top:0;width:100%;height:100%;}\n\n.kPainterVideoMdl, .kPainterVideoMdl *{box-sizing: border-box;}\n.kPainterVideoMdl{position:fixed;left:0px;top:0px;width:100%;height:100%;display:none;background:black;}\n.kPainterVideoMdl > .kPainterVideo{width:100%;height:100%;}\n.kPainterVideoMdl > .kPainterCameraSelect{height:20px;position:absolute;left:4px;top:4px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterResolutionSelect{height:20px;position:absolute;left:4px;top:28px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo{position:absolute;margin:0 auto;left:0;right:0;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo > svg{vertical-align:middle;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo{position:absolute;right:20px;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo > svg{vertical-align:middle;}\n\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner > canvas{position:absolute;left:-43px;top:-113px;border-radius:50px;border:1px solid #0f0;pointer-events:none;user-select:none;z-index:2}\n"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}let Wt=class e{_painter;_oriImage;_drawingLayers=[];static async createInstance(t){const i=new e,n=i._painter=new Pt;return n._dceGetQuads=()=>i._drawingLayers.filter(e=>e).map(e=>e._drawingItems.filter(e=>e instanceof Tt)).flat(),n._dceSelectedItemIdx=0,n._dceSelectedItemIdxs=new Set,t&&await i.setUIElement(t),i}disposed;dispose(){this.disposed=!0}getUIElement(){const e=this._painter.getHtmlElement();return e.parentElement||e}setUIElement(e){const t=this._painter.getHtmlElement();if(e!==t)return e.append(t),Promise.resolve()}async setOriginalImage(e){this._oriImage=e,e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||(e=ut(e.bytes,e.width,e.height,e.format));const t=this._painter;t.cancelEdit(),t.del(),await t.addImage(e),await t.enterEdit(),await t.enterFreeTransformMode(),this._updateCvsToPainter(),this._updateFreeTransformWhenInitImgOrItem()}_updateCvsToPainter(){const e=this._painter;if("freeTransform"!==e.getMode())return;const t=e.getHtmlElement(),i=t.querySelector(".kPainterCanvas").style,n=e.getWidth(),s=e.getHeight();for(let e of this._drawingLayers){if(!e)continue;const r=e._ctx.canvas;r.width!==n&&(r.width=n),r.height!==s&&(r.height=s);for(let e of["left","top","right","bottom","width","height","transform"])r.style[e]=i[e];r.style.display="",t.querySelector(".kPainterImgsDiv").append(r)}}_updateFreeTransformWhenInitImgOrItem(){const e=this._painter;if("freeTransform"!==e.getMode())return;e._dceSelectedItemIdx=0,e._dceSelectedItemIdxs.clear();let t=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(t){let i=t.quad.points,n=e.getWidth(),s=e.getHeight();e.setFreeTransformCornerPos(i.map(({x:e,y:t})=>[e/n-.5,t/s-.5]))}else e.setFreeTransformCornerPos([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]])}getOriginalImage(){return this._oriImage}_createDrawingLayer(){const e=new Rt;return e._ctx=document.createElement("canvas").getContext("2d"),e._mode="editor",e._oriAddDrawingItems=e.addDrawingItems,e.addDrawingItems=t=>{e._oriAddDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e._oriSetDrawingItems=e.setDrawingItems,e.setDrawingItems=t=>{e._oriSetDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e}createDrawingLayer(){const e=this._createDrawingLayer();return this._drawingLayers.push(e),this._updateCvsToPainter(),e}getDrawingLayer(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=this._createDrawingLayer(),1===e?t._defaultStyle=It.STYLE_BLUE_STROKE:2===e?t._defaultStyle=It.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=It.STYLE_GREEN_STROKE_FILL),this._drawingLayers[e]=t,this._updateCvsToPainter()),t}getAllDrawingLayers(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)}clearUserDefinedDrawingLayers(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4}deleteUserDefinedDrawingLayer(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])}getSelectedDrawingItems(){const e=this._painter,t=e._dceGetQuads();let i=e._dceSelectedItemIdxs;if(t.length&&i.size)return t.filter((e,t)=>i.has(t));let n=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(!n){const e=this._painter;if("freeTransform"!==e.getMode())return null;n=new Tt({points:null});let t=e.getWidth(),i=e.getHeight();n.quad.points=e.getFreeTransformCornerPos().map(e=>({x:(e[0]+.5)*t,y:(e[1]+.5)*i}))}return[n]}};function Ht(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function zt(e,t,i,n,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;const jt=e=>e&&"object"==typeof e&&"function"==typeof e.then,Zt=(async()=>{})().constructor;let Yt=class extends Zt{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,jt(e)?t=e:"function"==typeof e&&(t=new Zt(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(jt(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}},qt=class{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e(i.count);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(e){return await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},Ae.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:e}})})}async getBufferedCharacterItemSet(){return await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e(i.itemSet);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})}};var $t={onTaskResultsReceived:!1,onTargetROIResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onDeskewedImageReceived:!1,onEnhancedImageReceived:!1,onColourImageUnitReceived:!1,onScaledColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesUnitReceived:!1};const Xt=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet)if(t.isDce||t.isFilter)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])};let Qt=class{constructor(e){this._irrRegistryState=$t,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),Xt(this);let t=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");t=e._observedResultUnitTypes,e._observedTaskMap.forEach((e,t)=>{i[t]=e}),e._observedTaskMap.clear()}return await new Promise((e,n)=>{let s=Me();Oe[s]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},Ae.postMessage({type:"cvr_setIrrRegistry",id:s,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:t.toString(),observedTaskMap:i}})})}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),Xt(this),await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr.privideDsImage}};const Kt="undefined"==typeof self,Jt="function"==typeof importScripts,ei=(()=>{if(!Jt){if(!Kt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ti=e=>{if(null==e&&(e="./"),Kt||Jt);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var ii;Ge.engineResourcePaths.cvr={version:"3.4.10-dev-20260129110712",path:ei,isInternal:!0},Fe.cvr={js:!0,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE,we.MN_DYNAMSOFT_IMAGE_PROCESSING,we.MN_DYNAMSOFT_NEURAL_NETWORK]},Fe.dnn={wasm:!0,deps:[we.MN_DYNAMSOFT_IMAGE_PROCESSING]},Be.cvr={};const ni="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,ni)<0&&(Ge.engineResourcePaths.std={version:ni,path:ti(ei+`../../dynamsoft-capture-vision-std@${ni}/dist/`),isInternal:!0});const si="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,si)<0)&&(Ge.engineResourcePaths.dip={version:si,path:ti(ei+`../../dynamsoft-image-processing@${si}/dist/`),isInternal:!0});const ri="2.0.10";(!Ge.engineResourcePaths.dnn||"string"!=typeof Ge.engineResourcePaths.dnn&&O(Ge.engineResourcePaths.dnn.version,ri)<0)&&(Ge.engineResourcePaths.dnn={version:ri,path:ti(ei+`../../dynamsoft-capture-vision-dnn@${ri}/dist/`),isInternal:!0});let ai=class{static getVersion(){return this._version}};var oi,li,ci,di,hi,ui,gi,pi,fi,mi,_i,Ei,yi,Ii,Ri,wi,vi,Ci,Ti,Si,Di,Ai,bi,Mi;function Oi(e,t){if(e){if(e.sourceLocation){const i=e.sourceLocation.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}if(e.location){const i=e.location.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}Oi(e.referencedItem,t)}}function Li(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}function Ni(e){return{type:le.CRIT_ORIGINAL_IMAGE,referenceItem:null,targetROIDefName:"",taskName:"",imageData:e,toCanvas:()=>P(e),toImage:t=>x(t,e),toBlob:t=>k(t,e)}}function Pi(e){const t=[de.EC_UNSUPPORTED_JSON_KEY_WARNING,de.EC_LICENSE_AUTH_QUOTA_EXCEEDED,de.EC_LICENSE_RESULTS_LIMIT_EXCEEDED];if(e.errorCode&&t.includes(e.errorCode))return void console.warn(e.message);let i=new Error(e.errorCode?`[${e.functionName}] [${e.errorCode}] ${e.message}`:`[${e.functionName}] ${e.message}`);if(i.stack&&(i.stack=e.stack),e.isShouldThrow)throw i;return e.rj&&e.rj(i),!0}ai._version=`3.4.10-dev-20260129110712(Worker: ${null===(ii=ke.cvr)||void 0===ii?void 0:ii.worker}, Wasm: loading...`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(oi||(oi={}));const xi={onTaskResultsReceived:()=>{},isFilter:!0};Oe[-2]=async e=>{ki.onDataLoadProgressChanged&&ki.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class ki{constructor(){li.add(this),this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(Ge.browserInfo.OS)?2048:4096,this.onCaptureError=null,this._instanceID=void 0,this.privideDsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._dynamsoft=!0,ci.set(this,null),di.set(this,null),hi.set(this,null),ui.set(this,null),gi.set(this,null),pi.set(this,new Set),fi.set(this,new Set),mi.set(this,new Set),_i.set(this,500),Ei.set(this,0),yi.set(this,0),Ii.set(this,!1),Ri.set(this,!1),wi.set(this,!1),vi.set(this,null),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return Ht(this,wi,"f")}static async createInstance(e=!0){if(!Be.license)throw Error("The `license` module cannot be found.");return await Be.license.dynamsoft(),await Ge.loadWasm(),await new Promise((t,i)=>{const n=new ki;let s=Me();Oe[s]=async e=>{e.success?(n._instanceID=e.instanceID,n._currentSettings=JSON.parse(JSON.parse(e.outputSettings).data),ki._isNoOnnx=e.isNoOnnx,ai._version=`3.4.10-dev-20260129110712(Worker: ${ke.cvr.worker}, Wasm: ${e.version})`,zt(n,Ri,!0),zt(n,ui,n.getIntermediateResultManager()),zt(n,Ri,!1),t(n)):Pi({message:e.message,rj:i,stack:e.stack,functionName:"createInstance"})},Ae.postMessage({type:"cvr_createInstance",id:s,body:{loadPresetTemplates:e}})})}static async appendDLModelBuffer(e,t){return await Ge.loadWasm(),ki._isNoOnnx?Promise.reject("Model not supported in the current environment."):await new Promise((i,n)=>{let s=Me();const r=L(Ge.engineResourcePaths);let a;Oe[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Pi({message:t.errorString?t.errorString:"Append Model Buffer Failed.",rj:n,errorCode:t.errorCode,functionName:"appendDLModelBuffer"}),i(t)}Pi({message:e.message,rj:n,stack:e.stack,functionName:"appendDLModelBuffer"})},t?a=t.endsWith("/")?t:t+"/":"DCV"===Ge._bundleEnv?a=r.dcvData+"models/":"DBR"===Ge._bundleEnv&&(a=r.dbrBundle+"models/");let o=Array.isArray(e)?e:[e];o=o.map(e=>e.replace(/\.data$/i,"")),Ae.postMessage({type:"cvr_appendDLModelBuffer",id:s,body:{modelNames:o,path:a}})})}static async clearDLModelBuffers(){return await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e();Pi({message:i.message,rj:t,stack:i.stack,functionName:"clearDLModelBuffers"})},Ae.postMessage({type:"cvr_clearDLModelBuffers",id:i})})}async _singleFrameModeCallback(e){const t={bytes:e.bytes,width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.imageTag};for(let e of Ht(this,pi,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(Ni(t));this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(t,this._templateName);i.originalImageTag=e.imageTag,Ht(this,ci,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1}),Ht(this,li,"m",Si).call(this,i)}setInput(e){Li(this),zt(this,ci,e),e||Ht(this,vi,"f")&&(Ht(this,ui,"f").removeResultReceiver(Ht(this,vi,"f")),zt(this,vi,null))}getInput(){return Ht(this,ci,"f")}addImageSourceStateListener(e){if(Li(this),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&Ht(this,fi,"f").add(e)}removeImageSourceStateListener(e){return Li(this),Ht(this,fi,"f").delete(e)}addResultReceiver(e){if(Li(this),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(Ht(this,pi,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){Li(this),Ht(this,pi,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onProcessedDocumentResultReceived:!1,onParsedResultsReceived:!1};for(let t of Ht(this,pi,"f"))t.isDce||(e.onCapturedResultReceived=!!t.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!t.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!t.onRecognizedTextLinesReceived,e.onProcessedDocumentResultReceived=!!t.onProcessedDocumentResultReceived,e.onParsedResultsReceived=!!t.onParsedResultsReceived);let t=Me();return await new Promise((i,n)=>{Oe[t]=async e=>{e.success?i():Pi({message:e.message,rj:n,stack:e.stack,functionName:"addResultReceiver"})},Ae.postMessage({type:"cvr_setCrrRegistry",id:t,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}})})}async addResultFilter(e){if(Li(this),!e._dynamsoft)throw new Error("User defined CapturedResultFilter is not supported.");if(!e||"object"!=typeof e||!Object.keys(e).length)return console.warn("Invalid filter.");Ht(this,mi,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){Li(this),Ht(this,mi,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(Ht(this,ui,"f").removeResultReceiver(xi),0===Ht(this,mi,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1,[le.CRIT_ENHANCED_IMAGE]:!1},t={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1,[le.CRIT_ENHANCED_IMAGE]:!1};return await Ht(this,li,"m",Di).call(this,e),void await Ht(this,li,"m",Ai).call(this,t)}for(let e of Ht(this,mi,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(le.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(le.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(le.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(le.CRIT_DESKEWED_IMAGE),e.isLatestOverlappingEnabled(le.CRIT_BARCODE)&&([...Ht(this,ui,"f")._intermediateResultReceiverSet.values()].find(e=>e.isFilter)||Ht(this,ui,"f").addResultReceiver(xi)),await Ht(this,li,"m",Di).call(this,e.verificationEnabled),await Ht(this,li,"m",Ai).call(this,e.duplicateFilterEnabled),await Ht(this,li,"m",bi).call(this,e.duplicateForgetTime),await Ht(this,li,"m",Mi).call(this,e.crossVerificationCriteria)}async startCapturing(e){if(Li(this),!this._isPauseScan)return;if(!Ht(this,ci,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=ki._defaultTemplate);for(let e of Ht(this,mi,"f"))await this.addResultFilter(e);const t=L(Ge.engineResourcePaths);return void 0!==Ht(this,ci,"f").singleFrameMode&&"disabled"!==Ht(this,ci,"f").singleFrameMode?(this._templateName=e,void Ht(this,ci,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind)):Ht(this,hi,"f")&&Ht(this,hi,"f").isPending?Ht(this,hi,"f"):(zt(this,hi,new Yt((i,n)=>{if(this.disposed)return;let s=Me();Oe[s]=async t=>{Ht(this,hi,"f")&&!Ht(this,hi,"f").isFulfilled&&(t.success?(this._isPauseScan=!1,this._isOutputOriginalImage=t.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{-1!==this._minImageCaptureInterval&&Ht(this,ci,"f").startFetching(),this._loopReadVideo(e),i()},0)):Pi({message:t.message,rj:n,stack:t.stack,functionName:"startCapturing"}))},Ae.postMessage({type:"cvr_startCapturing",id:s,instanceID:this._instanceID,body:{templateName:e,engineResourcePaths:t}})})),await Ht(this,hi,"f"))}stopCapturing(){if(Li(this),!Ht(this,ci,"f"))return;Ht(this,ci,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,zt(this,hi,null),Ht(this,ci,"f").setColourChannelUsageType(a.CCUT_AUTO);const e=Me();Oe[e]=()=>{},Ae.postMessage({type:"cvr_stopCapturing",id:e,instanceID:this._instanceID})}async containsTask(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));Pi({message:e.message,rj:i,stack:e.stack,functionName:"containsTask"})},Ae.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async switchCapturingTemplate(e){this.stopCapturing(),await this.startCapturing(e)}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(zt(this,Ii,!0),Ht(this,ci,"f").isBufferEmpty())if(Ht(this,ci,"f").hasNextImageToFetch())for(let e of Ht(this,fi,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(oi.ISS_BUFFER_EMPTY);else if(!Ht(this,ci,"f").hasNextImageToFetch())for(let e of Ht(this,fi,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(oi.ISS_EXHAUSTED);const t=Ht(this,ci,"f").getImage();if(t&&t.imageTag&&Date.now()-t.imageTag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!t)return void this._reRunCurrnetFunc(e);for(let e of Ht(this,pi,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(Ni(t));const i=Date.now();this._captureDsimage(t,e).then(async n=>{if(ki._onLog&&ki._onLog("no js handle time: "+(Date.now()-i)),this._isPauseScan)return void this._reRunCurrnetFunc(e);n.originalImageTag=t.imageTag?t.imageTag:null,Ht(this,ci,"f")._capturedResultReceiver&&Ht(this,ci,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(n,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify});for(let e of Ht(this,mi,"f")){const t=e;t.onOriginalImageResultReceived(n),t.onDecodedBarcodesReceived(n),t.onRecognizedTextLinesReceived(n),t.onProcessedDocumentResultReceived(n),t.onParsedResultsReceived(n)}Ht(this,li,"m",Si).call(this,n);const s=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-i),this._averageFetchImageTimeArray.push(t&&t.imageTag?t.imageTag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,ki._onLog&&(ki._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),ki._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),ki._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),ki._onLog(`averageTime: ${this._averageTime}`))),ki._onLog){const e=Date.now()-s;e>10&&ki._onLog(`fetch image calculate time: ${e}`)}ki._onLog&&ki._onLog(`time finish decode: ${Date.now()}`),ki._onLog&&ki._onLog("main time: "+(Date.now()-i)),ki._onLog&&ki._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(t=>{Ht(this,ci,"f").stopFetching(),"platform error"!==t.message&&(t.errorCode&&0===t.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{Ht(this,ci,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),setTimeout(()=>{if(!this.onCaptureError)throw t;this.onCaptureError(t)},0))})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async getClarity(e,t,i,n,s){const{bytes:r,width:a,height:o,stride:l,format:c}=e;let d=Me();return new Promise((e,h)=>{Oe[d]=async t=>{t.success?e(t.clarity):Pi({message:t.message,rj:h,stack:t.stack,functionName:"getClarity"})},Ae.postMessage({type:"cvr_getClarity",id:d,instanceID:this._instanceID,body:{bytes:r,width:a,height:o,stride:l,format:c,bitcount:t,wr:i,hr:n,grayThreshold:s}},[r.buffer])})}async capture(e,t){let i;if(Li(this),t||(t=ki._defaultTemplate),zt(this,Ii,!1),R(e))i=await this._captureDsimage(e,t);else if("string"==typeof e)i="data:image/"==e.substring(0,11)?await this._captureBase64(e,t):await this._captureUrl(e,t);else if(e instanceof Blob)i=await this._captureBlob(e,t);else if(e instanceof HTMLImageElement)i=await this._captureImage(e,t);else if(e instanceof HTMLCanvasElement)i=await this._captureCanvas(e,t);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");i=await this._captureVideo(e,t)}return i}async _captureDsimage(e,t){return await this._captureInWorker(e,t)}async _captureUrl(e,t){let i=await b(e,"blob");return await this._captureBlob(i,t)}async _captureBase64(e,t){e=e.substring(e.indexOf(",")+1);let i=atob(e),n=i.length,s=new Uint8Array(n);for(;n--;)s[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([s]),t)}async _captureBlob(e,t){let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await async function(t){return await new Promise((i,n)=>{let s=URL.createObjectURL(t),r=new Image;r.src=s,r.onload=()=>{URL.revokeObjectURL(r.dbrObjUrl),i(r)},r.onerror=()=>{let t="Unsupported image format. Please upload files in one of the following formats: .jpg,.jpeg,.ico,.gif,.svg,.webp,.png,.bmp";"image/svg+xml"===e.type&&(t="Invalid SVG file. The file appears to be malformed or contains invalid XML."),n(new Error(t))}})}(e));let s=await this._captureImage(i||n,t);return i&&i.close(),s}async _captureImage(e,t){let i,n,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(s,r);a>this.maxImageSideLength?(zt(this,yi,this.maxImageSideLength/a),i=Math.round(s*Ht(this,yi,"f")),n=Math.round(r*Ht(this,yi,"f"))):(i=s,n=r),Ht(this,di,"f")||zt(this,di,document.createElement("canvas"));const o=Ht(this,di,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(o,t)}async _captureCanvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:o.IPF_ABGR_8888};return await this._captureInWorker(n,t)}async _captureVideo(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,n,s=e.videoWidth,r=e.videoHeight,a=Math.max(s,r);a>this.maxImageSideLength?(zt(this,yi,this.maxImageSideLength/a),i=Math.round(s*Ht(this,yi,"f")),n=Math.round(r*Ht(this,yi,"f"))):(i=s,n=r),Ht(this,di,"f")||zt(this,di,document.createElement("canvas"));const o=Ht(this,di,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,s,r,0,0,i,n),await this._captureCanvas(o,t)}async _captureInWorker(e,t){let{bytes:i,width:n,height:s,stride:r,format:a,imageTag:o}=e,l=Me();return await new Promise((c,d)=>{this.privideDsImage=e,Oe[l]=t=>{if(t.success){const i=Date.now();ki._onLog&&(ki._onLog(`get result time from worker: ${i}`),ki._onLog("worker to main time consume: "+(i-t.workerReturnMsgTime)));try{Ht(this,li,"m",Ci).call(this,t.captureResult,e),e.bytes=t.bytes,t.isScanner||zt(this,yi,0),Ht(this,li,"m",Ti).call(this,t.intermediateResult,o);const i=Date.now();return i-Ht(this,Ei,"f")>Ht(this,_i,"f")&&null!==t.mliRecord&&(null===localStorage||void 0===localStorage||localStorage.setItem("dynamsoft",t.mliRecord),zt(this,Ei,i)),c(t.captureResult)}catch(e){Pi({message:e.message,rj:d,stack:e.stack,functionName:"capture"})}}else Pi({message:t.message,rj:d,stack:t.stack,functionName:"capture"})},ki._onLog&&ki._onLog(`send buffer to worker: ${Date.now()}`),Ae.postMessage({type:"cvr_capture",id:l,instanceID:this._instanceID,body:{bytes:i,width:n,height:s,stride:r,format:a,templateName:t||"",isScanner:Ht(this,Ii,"f"),dynamsoft:this._dynamsoft}},[i.buffer])})}async initSettings(e){if(Li(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await b(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=Me();Oe[n]=async n=>{if(n.success){const s=JSON.parse(n.response);if(0!==s.errorCode&&Pi({message:s.errorString?s.errorString:"Init Settings Failed.",rj:i,errorCode:s.errorCode,functionName:"initSettings"}))return;const r=JSON.parse(e);return this._currentSettings=r,this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,ki._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,t(s)}Pi({message:n.message,rj:i,stack:n.stack,functionName:"initSettings"})},Ae.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid template.")}async outputSettings(e,t){return Li(this),await new Promise((i,n)=>{let s=Me();Oe[s]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Pi({message:t.errorString,rj:n,errorCode:t.errorCode,functionName:"outputSettings"}),i(JSON.parse(t.data))}Pi({message:e.message,rj:n,stack:e.stack,functionName:"outputSettings"})},Ae.postMessage({type:"cvr_outputSettings",id:s,instanceID:this._instanceID,body:{templateName:e,includeDefaultValues:!!t}})})}async outputSettingsToFile(e,t,i,n){const s=await this.outputSettings(e,n),r=new Blob([JSON.stringify(s,null,2,function(e,t){return t instanceof Array?JSON.stringify(t):t},2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(r),t.endsWith(".json")&&(t=t.replace(".json","")),e.download=`${t}.json`,e.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(e.href)},500)},e.click()}return r}async getTemplateNames(){return Li(this),await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Pi({message:n.errorString,rj:t,errorCode:n.errorCode,functionName:"getTemplateNames"}),e(JSON.parse(n.data))}Pi({message:i.message,rj:t,stack:i.stack,functionName:"getTemplateNames"})},Ae.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})}async getSimplifiedSettings(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success){const n=JSON.parse(e.response);0!==n.errorCode&&Pi({message:n.errorString,rj:i,errorCode:n.errorCode,functionName:"getSimplifiedSettings"});const s=JSON.parse(n.data,(e,t)=>"barcodeFormatIds"===e?BigInt(t):t);return s.minImageCaptureInterval=this._minImageCaptureInterval,t(s)}Pi({message:e.message,rj:i,stack:e.stack,functionName:"getSimplifiedSettings"})},Ae.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,t){return Li(this),await new Promise((i,n)=>{let s=Me();Oe[s]=async e=>{if(e.success){const s=JSON.parse(e.response);return t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._isOutputOriginalImage=e.isOutputOriginalImage,0!==s.errorCode&&Pi({message:s.errorString?s.errorString:"Update Settings Failed.",rj:n,errorCode:s.errorCode,functionName:"updateSettings"}),this._currentSettings=await this.outputSettings("*"),i(s)}Pi({message:e.message,rj:n,stack:e.stack,functionName:"updateSettings"})},Ae.postMessage({type:"cvr_updateSettings",id:s,instanceID:this._instanceID,body:{settings:t,templateName:e}})})}async resetSettings(){return Li(this),await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Pi({message:n.errorString?n.errorString:"Reset Settings Failed.",rj:t,errorCode:n.errorCode,functionName:"resetSettings"}),this._currentSettings=await this.outputSettings("*"),e(n)}Pi({message:i.message,rj:t,stack:i.stack,functionName:"resetSettings"})},Ae.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})}getBufferedItemsManager(){return Ht(this,gi,"f")||zt(this,gi,new qt(this)),Ht(this,gi,"f")}getIntermediateResultManager(){if(Li(this),!Ht(this,Ri,"f")&&0!==Ge.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return Ht(this,ui,"f")||zt(this,ui,new Qt(this)),Ht(this,ui,"f")}static async setGlobalIntraOpNumThreads(e=0){return e>4||e<0?Promise.reject(new RangeError("'intraOpNumThreads' should be between 0 and 4.")):(await Ge.loadWasm(),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t();Pi({message:e.message,rj:i,stack:e.stack,functionName:"setGlobalIntraOpNumThreads"})},Ae.postMessage({type:"cvr_setGlobalIntraOpNumThreads",id:n,body:{intraOpNumThreads:e}})}))}async parseRequiredResources(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));Pi({message:e.message,rj:i,stack:e.stack,functionName:"parseRequiredResources"})},Ae.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){Li(this),Ht(this,hi,"f")&&this.stopCapturing(),zt(this,ci,null),Ht(this,pi,"f").clear(),Ht(this,fi,"f").clear(),Ht(this,mi,"f").clear(),Ht(this,ui,"f")._intermediateResultReceiverSet.clear(),zt(this,wi,!0);let e=Me();Oe[e]=e=>{e.success||Pi({message:e.message,stack:e.stack,isShouldThrow:!0,functionName:"dispose"})},Ae.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:Ht(this,ci,"f"),promiseStartScan:Ht(this,hi,"f"),intermediateResultManager:Ht(this,ui,"f"),bufferdItemsManager:Ht(this,gi,"f"),resultReceiverSet:Ht(this,pi,"f"),isaStateListenerSet:Ht(this,fi,"f"),resultFilterSet:Ht(this,mi,"f"),compressRate:Ht(this,yi,"f"),canvas:Ht(this,di,"f"),isScanner:Ht(this,Ii,"f"),innerUseTag:Ht(this,Ri,"f"),isDestroyed:Ht(this,wi,"f")}}async _getWasmFilterState(){return await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success){const t=JSON.parse(i.response);return e(t)}Pi({message:i.message,rj:t,stack:i.stack,functionName:""})},Ae.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})}}ci=new WeakMap,di=new WeakMap,hi=new WeakMap,ui=new WeakMap,gi=new WeakMap,pi=new WeakMap,fi=new WeakMap,mi=new WeakMap,_i=new WeakMap,Ei=new WeakMap,yi=new WeakMap,Ii=new WeakMap,Ri=new WeakMap,wi=new WeakMap,vi=new WeakMap,li=new WeakSet,Ci=function(e,t){var i,n,s,r,a,o,l,c,d,h,u,g;for(let p=0;p<e.items.length;p++){const f=e.items[p];switch(0!==Ht(this,yi,"f")&&Oi(f,Ht(this,yi,"f")),f.type){case le.CRIT_ORIGINAL_IMAGE:e.items[p]=Ni(t);break;case le.CRIT_BARCODE:null!==(i=(l=e.decodedBarcodesResult).barcodeResultItems)&&void 0!==i||(l.barcodeResultItems=[]),e.decodedBarcodesResult.barcodeResultItems.push(f);break;case le.CRIT_TEXT_LINE:null!==(n=(c=e.recognizedTextLinesResult).textLineResultItems)&&void 0!==n||(c.textLineResultItems=[]),e.recognizedTextLinesResult.textLineResultItems.push(f);break;case le.CRIT_DETECTED_QUAD:null!==(s=(d=e.processedDocumentResult).detectedQuadResultItems)&&void 0!==s||(d.detectedQuadResultItems=[]),e.processedDocumentResult.detectedQuadResultItems.push(f);break;case le.CRIT_DESKEWED_IMAGE:Be.ddn&&Be.ddn.handleDeskewedAndEnhancedImageResultItem(f),null!==(r=(h=e.processedDocumentResult).deskewedImageResultItems)&&void 0!==r||(h.deskewedImageResultItems=[]),e.processedDocumentResult.deskewedImageResultItems.push(f);break;case le.CRIT_ENHANCED_IMAGE:Be.ddn&&Be.ddn.handleDeskewedAndEnhancedImageResultItem(f),null!==(a=(u=e.processedDocumentResult).enhancedImageResultItems)&&void 0!==a||(u.enhancedImageResultItems=[]),e.processedDocumentResult.enhancedImageResultItems.push(f);break;case le.CRIT_PARSED_RESULT:Be.dcp&&Be.dcp.handleParsedResultItem(f),null!==(o=(g=e.parsedResult).parsedResultItems)&&void 0!==o||(g.parsedResultItems=[]),e.parsedResult.parsedResultItems.push(f)}}},Ti=function(e,t){const i=e;if(i){let e=0;for(let n of Ht(this,ui,"f")._intermediateResultReceiverSet){e++;for(let s of i){if(["onTaskResultsReceived","onTargetROIResultsReceived"].includes(s.info.callbackName)){for(let e of s.intermediateResultUnits)e.originalImageTag=t||null;n[s.info.callbackName]&&n[s.info.callbackName]({intermediateResultUnits:s.intermediateResultUnits},s.info)}else n[s.info.callbackName]&&n[s.info.callbackName](s.result,s.info);e===Ht(this,ui,"f")._intermediateResultReceiverSet.size&&delete s.info.callbackName}}}},Si=function(e){for(let t of Ht(this,pi,"f"))e.decodedBarcodesResult&&t.onDecodedBarcodesReceived&&t.onDecodedBarcodesReceived(e.decodedBarcodesResult),e.recognizedTextLinesResult&&t.onRecognizedTextLinesReceived&&t.onRecognizedTextLinesReceived(e.recognizedTextLinesResult),e.processedDocumentResult&&t.onProcessedDocumentResultReceived&&t.onProcessedDocumentResultReceived(e.processedDocumentResult),e.parsedResult&&t.onParsedResultsReceived&&t.onParsedResultsReceived(e.parsedResult),t.onCapturedResultReceived&&t.onCapturedResultReceived(e)},Di=async function(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},Ae.postMessage({type:"cvr_enableResultCrossVerification",id:n,instanceID:this._instanceID,body:{verificationEnabled:e}})})},Ai=async function(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},Ae.postMessage({type:"cvr_enableResultDeduplication",id:n,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})},bi=async function(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},Ae.postMessage({type:"cvr_setDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})},Mi=async function(e){return Li(this),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success)return t();Pi({message:e.message,rj:i,stack:e.stack,functionName:"setResultCrossVerificationCriteria"})},Ae.postMessage({type:"cvr_setResultCrossVerificationCriteria",id:n,instanceID:this._instanceID,body:{criteria:e}})})},ki._defaultTemplate="Default",ki._isNoOnnx=!1;class Bi{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}class Fi{constructor(){this._observedResultUnitTypes=_e.IRUT_ALL,this._observedTaskMap=new Map,this._parameters={setObservedResultUnitTypes:e=>{this._observedResultUnitTypes=e},getObservedResultUnitTypes:()=>this._observedResultUnitTypes,isResultUnitTypeObserved:e=>!!(e&this._observedResultUnitTypes),addObservedTask:e=>{this._observedTaskMap.set(e,!0)},removeObservedTask:e=>{this._observedTaskMap.set(e,!1)},isTaskObserved:e=>0===this._observedTaskMap.size||!!this._observedTaskMap.get(e)},this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null,this.onShortLinesUnitReceived=null}getObservationParameters(){return this._parameters}}var Ui;!function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadSingleBarcode",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(Ui||(Ui={}));const Vi="undefined"==typeof self,Gi=Vi?{}:self,Wi="function"==typeof importScripts,Hi=(()=>{if(!Wi){if(!Vi&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),zi=e=>e&&"object"==typeof e&&"function"==typeof e.then,ji=(async()=>{})().constructor;let Zi=class extends ji{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,zi(e)?t=e:"function"==typeof e&&(t=new ji(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(zi(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}};const Yi=" is not allowed to change after `createInstance` or `loadWasm` is called.",qi=!Vi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",$i=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+Yi);i._license=t}};!Vi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Xi=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!Vi){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},Qi=(e,t)=>{t=Xi(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+Yi);i._licenseServer=t}},Ki=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Yi);i._deviceFriendlyName=t}};let Ji,en,tn,nn,sn;"undefined"!=typeof navigator&&(Ji=navigator,en=Ji.userAgent,tn=Ji.platform,nn=Ji.mediaDevices),function(){if(!Vi){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ji.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:tn,search:"Win"},Mac:{str:tn},Linux:{str:tn}};let i="unknownBrowser",n=0,s="unknownOS";for(let t in e){const s=e[t]||{};let r=s.str||en,a=s.search||t,o=s.verStr||en,l=s.verSearch||t;if(l instanceof Array||(l=[l]),-1!=r.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||en,r=i.search||e;if(-1!=n.indexOf(r)){s=e;break}}"Linux"==s&&-1!=en.indexOf("Windows NT")&&(s="HarmonyOS"),sn={browser:i,version:n,OS:s}}Vi&&(sn={browser:"ssr",version:0,OS:"ssr"})}(),nn&&nn.getUserMedia,"Chrome"===sn.browser&&sn.version>66||"Safari"===sn.browser&&sn.version>13||"OPR"===sn.browser&&sn.version>43||"Edge"===sn.browser&&sn.version;const rn=()=>(Ge.loadWasm(),Te("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:i,sp:n,rmk:s,cv:r}=((e,t=!1)=>{const i=on;if(i._pLoad.isEmpty){let n,s,r,a=i._license||"",o=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(s=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),o=Xi(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(Gi.crypto||(r="Please upgrade your browser to support online key."),Gi.crypto.subtle||(r="Require https to use online key in this browser."))),r)throw new Error(r);return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:o,sp:l,rmk:n,cv:s}}throw new Error("Can't preprocess license again"+Yi)})(),a=new Zi;on._pLoad.task=a,(async()=>{try{await on._pLoad}catch(e){}})();let o=Me();Oe[o]=t=>{if(t.message&&on._onAuthMessage){let e=on._onAuthMessage(t.message);null!=e&&(t.message=e)}let i,n=!1;if(1===e&&(n=!0),t.success?(Le&&Le("init license success"),t.message&&console.warn(t.message),Ge._bSupportIRTModule=t.bSupportIRTModule,Ge._bSupportDce4Module=t.bSupportDce4Module,on.bPassValidation=!0,[0,-10076].includes(t.initLicenseInfo.errorCode)?[-10076].includes(t.initLicenseInfo.errorCode)&&console.warn(t.initLicenseInfo.errorString):a.reject(new Error(t.initLicenseInfo.errorString))):(i=Error(t.message),t.stack&&(i.stack=t.stack),t.ltsErrorCode&&(i.ltsErrorCode=t.ltsErrorCode),n||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const e=L(Ge.engineResourcePaths),i=("DCV"===Ge._bundleEnv?e.dcvData:e.dbrBundle)+"ui/";(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let s=await n.text();if(!s.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.insertAdjacentHTML("beforeend",s);let a=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==r.childElementCount?r.children[0]:r;o.remove();let l,c,d,h,u,g=[o],p=o.children;for(let e of p)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}});else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",()=>{o.remove();for(let e of a)e.remove()});else if(!d&&e.classList.contains("dls-license-icon-error"))d=e,"error"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-icon-warn"))h=e,"warn"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-msg-content")){u=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),s=t.indexOf("(",n),r=t.indexOf(")",s);if(-1==i||-1==n||-1==s||-1==r){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),o=t.substring(i+1,n);a.innerText=o;let l=t.substring(s+1,r);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(r+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:on._bNeverShowDialog,engineResourcePath:i,_onLog:Le},t.success?"warn":"error",t.message)}t.success?a.resolve(void 0):a.reject(i)},await Ce("core");const l=await Ge.getModuleVersion();Ae.postMessage({type:"license_dynamsoft",body:{v:"DCV"===Ge._bundleEnv?l.CVR.replace(/\.\d+$/,""):l.DBR.replace(/\.\d+$/,""),brtk:!!e,bptk:1===e,l:t,os:sn,fn:on.deviceFriendlyName,ls:i,sp:n,rmk:s,cv:r,_e:on._e,mliRecord:null===localStorage||void 0===localStorage?void 0:localStorage.getItem("dynamsoft")},id:o}),on.bCallInitLicense=!0,await a}));let an;Be.license={},Be.license.dynamsoft=rn,Be.license.getAR=async()=>{{let e=ve.dynamsoft_inited;e&&e.isRejected&&await e}return Ae?new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success){delete i.success;{let e=on.license;e&&(e.startsWith("t")||e.startsWith("f"))&&(i.pk=e)}if(Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null)}else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},Ae.postMessage({type:"license_getAR",id:i})}):null};let on=class e{static setLicenseServer(t){Qi(e,t)}static get license(){return this._license}static set license(t){$i(e,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){Qi(e,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){Ki(e,t)}static initLicense(t,i){if($i(e,t),e.bCallInitLicense=!0,"boolean"==typeof i&&i||"object"==typeof i&&i.executeNow)return rn()}static setDeviceFriendlyName(t){Ki(e,t)}static getDeviceFriendlyName(){return e._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await Te("dynamsoft_uuid",async()=>{await Ge.loadWasm();let e=new Zi,t=Me();Oe[t]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},Ae.postMessage({type:"license_getDeviceUUID",id:t}),an=await e}),an))()}};on._pLoad=new Zi,on.bPassValidation=!1,on.bCallInitLicense=!1,on._license=qi,on._licenseServer=[],on._deviceFriendlyName="",on._e=!0,Ge.engineResourcePaths.license={version:"4.4.10-dev-20260129110719",path:Hi,isInternal:!0},Fe.license={wasm:!0,js:!0},Be.license.LicenseManager=on;const ln="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,ln)<0&&(Ge.engineResourcePaths.std={version:ln,path:(e=>{if(null==e&&(e="./"),Vi||Wi);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Hi+`../../dynamsoft-capture-vision-std@${ln}/dist/`),isInternal:!0});let cn=class{static getVersion(){return`4.4.10-dev-20260129110719(Worker: ${ke.license&&ke.license.worker||"Not Loaded"}, Wasm: ${ke.license&&ke.license.wasm||"Not Loaded"})`}};const dn="undefined"==typeof self,hn="function"==typeof importScripts,un=(()=>{if(!hn){if(!dn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),gn=e=>{if(null==e&&(e="./"),dn||hn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ge.engineResourcePaths.dbr={version:"11.4.10-dev-20260129110729",path:un,isInternal:!0},Fe.dbr={js:!1,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE,we.MN_DYNAMSOFT_IMAGE_PROCESSING]},Be.dbr={};const pn="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,pn)<0&&(Ge.engineResourcePaths.std={version:pn,path:gn(un+`../../dynamsoft-capture-vision-std@${pn}/dist/`),isInternal:!0});const fn="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,fn)<0)&&(Ge.engineResourcePaths.dip={version:fn,path:gn(un+`../../dynamsoft-image-processing@${fn}/dist/`),isInternal:!0});let mn=class{static getVersion(){const e=ke.dbr&&ke.dbr.wasm;return`11.4.10-dev-20260129110729(Worker: ${ke.dbr&&ke.dbr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}};const _n={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var En,yn,In,Rn;function wn(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(En||(En={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(yn||(yn={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_NEURAL_NETWORK=512]="LM_NEURAL_NETWORK",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=-1]="LM_END"}(In||(In={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=-1]="DM_END"}(Rn||(Rn={})),"function"==typeof SuppressedError&&SuppressedError;const vn="undefined"==typeof self,Cn=(()=>{if(!vn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),Tn=e=>{if(null==e&&(e="./"),vn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Sn,Dn;Ge.engineResourcePaths.dlr={version:"4.4.10-dev-20260129110735",path:Cn,isInternal:!0},Fe.dlr={js:!0,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE,we.MN_DYNAMSOFT_IMAGE_PROCESSING]};const An="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,An)<0&&(Ge.engineResourcePaths.std={version:An,path:Tn(Cn+`../../dynamsoft-capture-vision-std@${An}/dist/`),isInternal:!0});const bn="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,bn)<0)&&(Ge.engineResourcePaths.dip={version:bn,path:Tn(Cn+`../../dynamsoft-image-processing@${bn}/dist/`),isInternal:!0});let Mn=class e{static getVersion(){const e=ke.dlr&&ke.dlr.wasm;return`4.4.10-dev-20260129110735(Worker: ${ke.dlr&&ke.dlr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadConfusableCharsData(t,i){return wn(e,Sn,"m",Dn).call(e,"confusable",t,i)}static async loadOverlappingCharsData(t,i){return wn(e,Sn,"m",Dn).call(e,"overlapping",t,i)}};Sn=Mn,Dn=async function(e,t,i){return await Ge.loadWasm(),await new Promise((n,s)=>{let r=Me();Oe[r]=async e=>{if(e.success){const t=JSON.parse(e.result);if(0!==t.errorCode){let e=new Error(t.errorString);return e.errorCode=t.errorCode,s(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,s(t)}},i&&!i.endsWith("/")&&(i+="/");const a=L(Ge.engineResourcePaths);Ae.postMessage({type:"dlr_loadData",id:r,body:{type:e,dataName:t,dataPath:i||a.dcvData+"char-resources/"}})})},Be.dlr={loadConfusableCharsData:Mn.loadConfusableCharsData,loadOverlappingCharsData:Mn.loadOverlappingCharsData};const On={filterVINResult:function(e){let t="";if(18===e.characterResults.length){let t=e.characterResults[9].location.points[0].x-e.characterResults[8].location.points[1].x;t<2&&(t=2);let i=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,n=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,s=2===t?3:t;i-t>=s&&n-t<s?e.characterResults.shift():n-t>=s&&i-t<s||e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[10].location.points[0].x-e.characterResults[9].location.points[1].x;t<2&&(t=2);let i,n,s,r=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,a=e.characterResults[18].location.points[0].x-e.characterResults[17].location.points[1].x,o=e.characterResults[2].location.points[0].x-e.characterResults[1].location.points[1].x,l=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,c=2===t?3:t;if("1"===e.characterResults[1].characterH||"1"===e.characterResults[2].characterH||"1"===e.characterResults[16].characterH||"1"===e.characterResults[17].characterH){for(let t=9;t<e.characterResults.length;t++)if("1"!==e.characterResults[t].characterH){s=e.characterResults[t].location.points[1].x-e.characterResults[t].location.points[0].x;break}"1"===e.characterResults[1].characterH&&(i=s-(e.characterResults[1].location.points[1].x-e.characterResults[1].location.points[0].x)+3),"1"===e.characterResults[2].characterH&&(i=s-(e.characterResults[2].location.points[1].x-e.characterResults[2].location.points[0].x)+3),"1"===e.characterResults[16].characterH&&(n=s-(e.characterResults[16].location.points[1].x-e.characterResults[16].location.points[0].x)+3),"1"===e.characterResults[17].characterH&&(n=s-(e.characterResults[17].location.points[1].x-e.characterResults[17].location.points[0].x)+3)}if(o-t>=(i||c)&&l-t<(n||c))e.characterResults.splice(0,2);else if(l-t>=(n||c)&&o-t<(i||c))e.characterResults.splice(17,2);else if(r>t&&a>t)e.characterResults.pop(),e.characterResults.shift();else{let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,i=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,n=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,s=Math.min(t,i,n);s===t?e.characterResults.splice(0,2):s===i?e.characterResults.splice(17,2):s===n&&(e.characterResults.pop(),e.characterResults.shift())}}for(let i of e.characterResults)t+=i.characterH;return t},checkValidVIN:function(e){return!(!e||17!=e.length)&&(e=>{const t=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let n=0;for(let s=0;s<e.length;s++){let r=t.get(e[s]);r&&(n+=r*i[s])}return n%11})(e).toString()===e[8]},checkValidMRP:function(e){if(!e||44!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),n=t(e,0,8).toString(),s=t(e,13,18).toString(),r=t(e,21,26).toString(),a=t(e,28,41).toString(),o=t(i,0,i.length).toString();return n===e[9]&&s===e[19]&&r===e[27]&&a===e[42]&&o===e[43]},checkValidMRV:function(e){if(!e||44!=e.length&&36!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10},i=t(e,0,8).toString(),n=t(e,13,18).toString(),s=t(e,21,26).toString();return i===e[9]&&n===e[19]&&s===e[27]},checkValidIDCard:function(e,t){if(!e||30!=e.length&&36!=e.length)return!1;const i=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),s=[7,3,1];let r=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(r+=t*s[o%3]),o++}return r%10};if(30===e.length){if(t&&e===t)return i(e,5,13).toString()===e[14];if(t&&e!==t){const n=`${t.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return i(n,0,n.length-1).toString()===e[29]}}else if(36===e.length){const t=i(e,0,8).toString(),n=i(e,13,18).toString(),s=i(e,21,26).toString(),r=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,a=i(r,0,r.length-1).toString();return t===e[9]&&n===e[19]&&s===e[27]&&a===e[35]}}};var Ln,Nn,Pn;function xn(e){delete e.moduleId;const t=JSON.parse(e.jsonString).ResultInfo,i=e.fullCodeString;e.getFieldValue=e=>"fullcodestring"===e.toLowerCase()?i:kn(t,e,"map"),e.getFieldRawValue=e=>"fullcodestring"===e.toLowerCase()?i:kn(t,e,"raw"),e.getFieldMappingStatus=e=>Bn(t,e),e.getFieldValidationStatus=e=>Fn(t,e),e.getAllFieldNames=()=>function(e){const t=[],i=e=>{const t=[];for(let n of e)for(let e of n)e.FieldName&&t.push(e.FieldName),e.ChildFields&&e.ChildFields.length>0&&t.push(...i(e.ChildFields));return t};for(let n of e)n.FieldName&&t.push(n.FieldName),n.ChildFields&&n.ChildFields.length>0&&t.push(...i(n.ChildFields));return t}(t),delete e.fullCodeString}function kn(e,t,i){for(let n of e){if(n.FieldName===t)return"raw"===i&&n.RawValue?n.RawValue:n.Value;if(n.ChildFields&&n.ChildFields.length>0){let e;for(let s of n.ChildFields)e=kn(s,t,i);if(void 0!==e)return e}}}function Bn(e,t){for(let i of e){if(i.FieldName===t)return i.MappingStatus?Number(Nn[i.MappingStatus]):Nn.MS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=Bn(n,t);if(void 0!==e)return e}}return Nn.MS_NONE}function Fn(e,t){for(let i of e){if(i.FieldName===t&&i.ValidationStatus)return i.ValidationStatus?Number(Pn[i.ValidationStatus]):Pn.VS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=Fn(n,t);if(void 0!==e)return e}}return Pn.VS_NONE}function Un(e){if(e.disposed)throw new Error('"CodeParser" instance has been disposed')}!function(e){e[e.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",e[e.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",e[e.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED"}(Ln||(Ln={})),Oe[-1]=async e=>{Mn.onDataLoadProgressChanged&&Mn.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})},function(e){e[e.MS_NONE=0]="MS_NONE",e[e.MS_SUCCEEDED=1]="MS_SUCCEEDED",e[e.MS_FAILED=2]="MS_FAILED"}(Nn||(Nn={})),function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_SUCCEEDED=1]="VS_SUCCEEDED",e[e.VS_FAILED=2]="VS_FAILED"}(Pn||(Pn={}));const Vn=e=>e&&"object"==typeof e&&"function"==typeof e.then,Gn=(async()=>{})().constructor;class Wn extends Gn{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Vn(e)?t=e:"function"==typeof e&&(t=new Gn(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Vn(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}let Hn=class e{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static async createInstance(){await Be.license.dynamsoft(),await Ge.loadWasm();const t=new e,i=new Wn;let n=Me();return Oe[n]=async e=>{if(e.success)t._instanceID=e.instanceID,i.resolve(t);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),i.reject(t)}},Ae.postMessage({type:"dcp_createInstance",id:n}),i}async dispose(){Un(this);let e=Me();this.bDestroyed=!0,Oe[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},Ae.postMessage({type:"dcp_dispose",id:e,instanceID:this._instanceID})}get disposed(){return this.bDestroyed}async initSettings(e){if(Un(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await b(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=Me();Oe[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString?n.errorString:"Init Settings Failed.");return e.errorCode=n.errorCode,i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},Ae.postMessage({type:"dcp_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid settings.")}async resetSettings(){return Un(this),await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"dcp_resetSettings",id:i,instanceID:this._instanceID})})}async parse(e,t=""){if(Un(this),!e||!(e instanceof Array||e instanceof Uint8Array||"string"==typeof e))throw new Error("`parse` must pass in an Array or Uint8Array or string");return await new Promise((i,n)=>{let s=Me();e instanceof Array&&(e=Uint8Array.from(e)),"string"==typeof e&&(e=Uint8Array.from(function(e){let t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e))),Oe[s]=async e=>{if(e.success){let t=JSON.parse(e.parseResponse);return t.errorCode?n(new Error(t.errorString)):(xn(t),i(t))}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},Ae.postMessage({type:"dcp_parse",id:s,instanceID:this._instanceID,body:{source:e,taskSettingName:t}})})}};const zn="undefined"==typeof self,jn="function"==typeof importScripts,Zn=(()=>{if(!jn){if(!zn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();Ge.engineResourcePaths.dcp={version:"3.4.10-dev-20260129110745",path:Zn,isInternal:!0},Fe.dcp={js:!0,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE]},Be.dcp={handleParsedResultItem:xn};const Yn="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,Yn)<0&&(Ge.engineResourcePaths.std={version:Yn,path:(e=>{if(null==e&&(e="./"),zn||jn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Zn+`../../dynamsoft-capture-vision-std@${Yn}/dist/`),isInternal:!0}),Oe[-4]=async e=>{qn.onSpecLoadProgressChanged&&qn.onSpecLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};let qn=class{static getVersion(){const e=ke.dcp&&ke.dcp.wasm;return`3.4.10-dev-20260129110745(Worker: ${ke.dcp&&ke.dcp.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadSpec(e,t){return await Ge.loadWasm(),await new Promise((i,n)=>{let s=Me();Oe[s]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},t&&!t.endsWith("/")&&(t+="/");let r=(e instanceof Array?e:[e]).map(e=>e.replace(/^MRTD.*$/,"MRTD"));r=r.map(e=>e.replace(/\.data$/i,""));let a=L(Ge.engineResourcePaths);Ae.postMessage({type:"dcp_appendResourceBuffer",id:s,body:{specificationPath:t||`${"DBR"===Ge._bundleEnv?a.dbrBundle:a.dcvData}parser-resources/`,specificationNames:r}})})}};const $n="undefined"==typeof self,Xn="function"==typeof importScripts,Qn=(()=>{if(!Xn){if(!$n&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Kn=e=>{if(null==e&&(e="./"),$n||Xn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ge.engineResourcePaths.ddn={version:"3.4.10-dev-20260129110740",path:Qn,isInternal:!0},Fe.ddn={js:!0,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE,we.MN_DYNAMSOFT_IMAGE_PROCESSING]},Be.ddn={handleDeskewedAndEnhancedImageResultItem:function(e){let t=e,i=F(t.imageData);t.toCanvas=()=>P(i),t.toImage=e=>x(e,i),t.toBlob=e=>k(e,i)}};const Jn="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,Jn)<0&&(Ge.engineResourcePaths.std={version:Jn,path:Kn(Qn+`../../dynamsoft-capture-vision-std@${Jn}/dist/`),isInternal:!0});const es="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,es)<0)&&(Ge.engineResourcePaths.dip={version:es,path:Kn(Qn+`../../dynamsoft-image-processing@${es}/dist/`),isInternal:!0});let ts=class{static getVersion(){const e=ke.ddn&&ke.ddn.wasm;return`3.4.10-dev-20260129110740(Worker: ${ke.ddn&&ke.ddn.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}};var is;!function(e){e[e.ICM_COLOUR=0]="ICM_COLOUR",e[e.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",e[e.ICM_BINARY=2]="ICM_BINARY"}(is||(is={}));const ns="undefined"==typeof self,ss="function"==typeof importScripts,rs=(()=>{if(!ss){if(!ns&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),as=e=>{if(null==e&&(e="./"),ns||ss);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ge.engineResourcePaths.utility={version:"2.4.10-dev-20260129110724",path:rs,isInternal:!0},Fe.utility={js:!0,wasm:!0};const os="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,os)<0&&(Ge.engineResourcePaths.std={version:os,path:as(rs+`../../dynamsoft-capture-vision-std@${os}/dist/`),isInternal:!0});const ls="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,ls)<0)&&(Ge.engineResourcePaths.dip={version:ls,path:as(rs+`../../dynamsoft-image-processing@${ls}/dist/`),isInternal:!0});class cs{static getVersion(){return`2.4.10-dev-20260129110724(Worker: ${ke.utility&&ke.utility.worker||"Not Loaded"}, Wasm: ${ke.utility&&ke.utility.wasm||"Not Loaded"})`}}function ds(e,t,i,n){if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}"function"==typeof SuppressedError&&SuppressedError;const hs="undefined"==typeof self,us="function"==typeof importScripts,gs=(()=>{if(!us){if(!hs&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ps=e=>{if(null==e&&(e="./"),hs||us);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ge.engineResourcePaths.dbr={version:"11.0.30-dev-20250522174049",path:gs,isInternal:!0},Fe.dbr={js:!1,wasm:!0,deps:[we.MN_DYNAMSOFT_LICENSE,we.MN_DYNAMSOFT_IMAGE_PROCESSING]},Be.dbr={};const fs="2.0.0";"string"!=typeof Ge.engineResourcePaths.std&&O(Ge.engineResourcePaths.std.version,fs)<0&&(Ge.engineResourcePaths.std={version:fs,path:ps(gs+`../../dynamsoft-capture-vision-std@${fs}/dist/`),isInternal:!0});const ms="3.0.10";(!Ge.engineResourcePaths.dip||"string"!=typeof Ge.engineResourcePaths.dip&&O(Ge.engineResourcePaths.dip.version,ms)<0)&&(Ge.engineResourcePaths.dip={version:ms,path:ps(gs+`../../dynamsoft-image-processing@${ms}/dist/`),isInternal:!0});const _s={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var Es,ys,Is,Rs,ws;(ws=Es||(Es={}))[ws.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",ws[ws.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",ws[ws.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT",function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(ys||(ys={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=4294967295]="LM_END"}(Is||(Is={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=4294967295]="DM_END"}(Rs||(Rs={}));const vs=async(e,t)=>{let i,n=document.createElement("canvas"),s=n.getContext("2d"),r=e;try{if(r instanceof Blob){i=URL.createObjectURL(r);const e=await new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.src=i});n.width=e.width,n.height=e.height,s.drawImage(e,0,0),r=s.getImageData(0,0,n.width,n.height)}else n.width=r.width,n.height=r.height,s.putImageData(r,0,0);if("image/bmp"===t){const e=B(r);return new Blob([e],{type:"image/bmp"})}return await new Promise(e=>{n.toBlob(t=>{e(t)},t)})}finally{URL.revokeObjectURL(i)}};function Cs(e,t){let i=!0;for(let a=0;a<e.length;a++){const o=(a+1)%e.length;if(n=e[a],r=t,((s=e[o]).x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x)<0){i=!1;break}}var n,s,r;return i}function Ts(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function Ss(e,t){const[i,n]=e,s=i.x,r=i.y,a=n.x,o=n.y,l=t.x,c=t.y,d=(a-s)**2+(o-r)**2;if(0===d)return Math.sqrt((l-s)**2+(c-r)**2);const h=((l-s)*(a-s)+(c-r)*(o-r))/d;if(h<0)return Math.sqrt((l-s)**2+(c-r)**2);if(h>1)return Math.sqrt((l-a)**2+(c-o)**2);{const e=s+h*(a-s),t=r+h*(o-r);return Math.sqrt((l-e)**2+(c-t)**2)}}function Ds(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],s=e[(i+1)%e.length];t.push([n,s])}return t}function As(e){const[t,i]=e;return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function bs(e,t,i,n){const s=t.x-e.x,r=t.y-e.y,a=n.x-i.x,o=n.y-i.y,l=(-r*(e.x-i.x)+s*(e.y-i.y))/(-a*r+s*o),c=(a*(e.y-i.y)-o*(e.x-i.x))/(-a*r+s*o);return l>=0&&l<=1&&c>=0&&c<=1?{x:e.x+c*s,y:e.y+c*r}:null}function Ms(e){let t=0;for(let i=0;i<e.length;i++){const n=(i+1)%e.length;t+=e[i].x*e[n].y,t-=e[n].x*e[i].y}return Math.abs(t/2)}function Os(e,t,i){let n=t.x-e.x,s=t.y-e.y,r=i.x-e.x;return n*(i.y-e.y)-s*r>0}function Ls(e,t){for(let i=0;i<4;i++)if(!Os(e.points[i],e.points[(i+1)%4],t))return!1;return!0}function Ns(e,t,i,n){const s=e.points,r=t.points;let a=8*i;a=Math.max(a,5);const o=Ds(s)[3],l=Ds(s)[1],c=Ds(r)[3],d=Ds(r)[1];let h,u=0;if(h=Math.max(Math.abs(Ss(o,t.points[0])),Math.abs(Ss(o,t.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(Ss(l,t.points[1])),Math.abs(Ss(l,t.points[2]))),h>u&&(u=h),h=Math.max(Math.abs(Ss(c,e.points[0])),Math.abs(Ss(c,e.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(Ss(d,e.points[1])),Math.abs(Ss(d,e.points[2]))),h>u&&(u=h),u>a)return!1;const g=As(Ds(s)[0]),p=As(Ds(s)[2]),f=As(Ds(r)[0]),m=As(Ds(r)[2]),_=Ts(g,m),E=Ts(f,p),y=_>E,I=Math.min(_,E),R=Ts(g,p),w=Ts(f,m);let v=12*i;return v=Math.max(v,5),v=Math.min(v,R),v=Math.min(v,w),!!(I<v||Cs(s,y?f:m)||Cs(r,y?p:g))&&(y?(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]):(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]),n.area=Ms(n.points),!0)}class Ps{constructor(e,t,i,n){this.overlapCount=e,this.verificationCount=t,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const t={x:0,y:0};return e.forEach(({x:e,y:i})=>{t.x+=e,t.y+=i}),t.x/=e.length,t.y/=e.length,t}isProbablySameLocationWithOffset(e,t){const i=this.item.location,n=e.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let s=new Array(4).fill(0),r=new Array(4).fill(0),a=0,o=0;for(let e=0;e<4;++e)s[e]=Math.round(100*(n.points[e].x-i.points[e].x))/100,a+=s[e],r[e]=Math.round(100*(n.points[e].y-i.points[e].y))/100,o+=r[e];a/=4,o/=4;for(let e=0;e<4;++e){if(Math.abs(s[e]-a)>this.strictLimit||Math.abs(a)>.8)return!1;if(Math.abs(r[e]-o)>this.strictLimit||Math.abs(o)>.8)return!1}return t.x=a,t.y=o,!0}isLocationOverlap(e,t){if(this.locationArea>t){for(let t=0;t<4;t++)if(Ls(this.location,e.points[t]))return!0;const t=this.getCenterPoint(e.points);if(Ls(this.location,t))return!0}else{for(let t=0;t<4;t++)if(Ls(e,this.location.points[t]))return!0;if(Ls(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,t={x:0,y:0}){if(this.isOneD){const i=Object.assign({},e.location);for(let e=0;e<4;e++)i.points[e].x-=t.x,i.points[e].y-=t.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],s=[this.location.points[1],this.location.points[2]];for(let e=0;e<4;e++){const t=i.points[e],r=0===e||3===e?n:s;if(Math.abs(Ss(r,t))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=e.location.points[i],s=this.location.points[i];if(!(Math.abs(s.x+t.x-n.x)<this.locationThreshold))return!1;if(Math.abs(s.y+t.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,t,i=!0){const n=Object.assign({},e.location);for(let e=0;e<4;e++)n.points[e].x-=t.x,n.points[e].y-=t.y;if(!this.isLocationOverlap(n,e.location.area))return!1;if(i){const e=.75;return function(e,t){const i=[];for(let n=0;n<4;n++)for(let s=0;s<4;s++){const r=bs(e[n],e[(n+1)%4],t[s],t[(s+1)%4]);r&&i.push(r)}return e.forEach(e=>{Cs(t,e)&&i.push(e)}),t.forEach(t=>{Cs(e,t)&&i.push(t)}),Ms(function(e){if(e.length<=1)return e;e.sort((e,t)=>e.x-t.x||e.y-t.y);const t=e.shift();return e.sort((e,i)=>Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(i.y-t.y,i.x-t.x)),[t,...e]}(i))}([...this.location.points],n.points)>this.locationArea*e}return!0}}var xs,ks,Bs,Fs,Us,Vs;const Gs={barcode:2,text_line:4,detected_quad:8,deskewed_image:16,enhanced_image:64},Ws=e=>Object.values(Gs).includes(e)||Gs.hasOwnProperty(e),Hs=(e,t)=>"string"==typeof e?t[Gs[e]]:t[e],zs=(e,t,i)=>{"string"==typeof e?t[Gs[e]]=i:t[e]=i},js=(e,t,i)=>{const n=[{type:le.CRIT_BARCODE,resultName:"decodedBarcodesResult",itemNames:["barcodeResultItems"]},{type:le.CRIT_TEXT_LINE,resultName:"recognizedTextLinesResult",itemNames:["textLineResultItems"]}],s=t.items;if(e.isResultCrossVerificationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type!==i||s[e].verified||s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&e.verified)})}if(e.isResultDeduplicationEnabled(i)){for(let e=s.length-1;e>=0;e--)s[e].type===i&&s[e].duplicate&&s.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const s=t[e.resultName][n];t[e.resultName][n]=s.filter(e=>e.type===i&&!e.duplicate)})}};class Zs{constructor(){this.verificationEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!0,[le.CRIT_DETECTED_QUAD]:!0,[le.CRIT_DESKEWED_IMAGE]:!1},this.duplicateFilterEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1},this.duplicateForgetTime={[le.CRIT_BARCODE]:3e3,[le.CRIT_TEXT_LINE]:3e3,[le.CRIT_DETECTED_QUAD]:3e3,[le.CRIT_DESKEWED_IMAGE]:3e3},this.crossVerificationCriteria={[le.CRIT_BARCODE]:{frameWindow:5,minConsistentFrames:2},[le.CRIT_TEXT_LINE]:{frameWindow:5,minConsistentFrames:2},[le.CRIT_DETECTED_QUAD]:{frameWindow:6,minConsistentFrames:4},[le.CRIT_DESKEWED_IMAGE]:{frameWindow:6,minConsistentFrames:4}},xs.set(this,new Map),ks.set(this,new Map),Bs.set(this,new Map),Fs.set(this,new Map),Us.set(this,new Map),Vs.set(this,new Map),this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,this.latestOverlappingEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1},this.maxOverlappingFrames={[le.CRIT_BARCODE]:this.crossVerificationFrames,[le.CRIT_TEXT_LINE]:this.crossVerificationFrames,[le.CRIT_DETECTED_QUAD]:this.crossVerificationFrames,[le.CRIT_DESKEWED_IMAGE]:this.crossVerificationFrames},Object.defineProperties(this,{onOriginalImageResultReceived:{value:e=>{},writable:!1},onDecodedBarcodesReceived:{value:e=>{this.latestOverlappingFilter(e),js(this,e,le.CRIT_BARCODE)},writable:!1},onRecognizedTextLinesReceived:{value:e=>{js(this,e,le.CRIT_TEXT_LINE)},writable:!1},onProcessedDocumentResultReceived:{value:e=>{},writable:!1},onParsedResultsReceived:{value:e=>{},writable:!1}})}_dynamsoft(){ds(this,xs,"f").forEach((e,t)=>{zs(t,this.verificationEnabled,e)}),ds(this,ks,"f").forEach((e,t)=>{zs(t,this.duplicateFilterEnabled,e)}),ds(this,Bs,"f").forEach((e,t)=>{zs(t,this.duplicateForgetTime,e)}),ds(this,Fs,"f").forEach((e,t)=>{zs(t,this.latestOverlappingEnabled,e)}),ds(this,Us,"f").forEach((e,t)=>{zs(t,this.maxOverlappingFrames,e)}),ds(this,Vs,"f").forEach((e,t)=>{zs(t,this.crossVerificationCriteria,e)})}enableResultCrossVerification(e,t){Ws(e)&&ds(this,xs,"f").set(e,t)}isResultCrossVerificationEnabled(e){return!!Ws(e)&&Hs(e,this.verificationEnabled)}enableResultDeduplication(e,t){Ws(e)&&(t&&this.enableLatestOverlapping(e,!1),ds(this,ks,"f").set(e,t))}isResultDeduplicationEnabled(e){return!!Ws(e)&&Hs(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,t){Ws(e)&&(t>18e4&&(t=18e4),t<0&&(t=0),ds(this,Bs,"f").set(e,t))}getDuplicateForgetTime(e){return Ws(e)?Hs(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0;const t=[le.CRIT_BARCODE,le.CRIT_TEXT_LINE,le.CRIT_DETECTED_QUAD,le.CRIT_DESKEWED_IMAGE,le.CRIT_ENHANCED_IMAGE];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}setResultCrossVerificationCriteria(e,t,i){t<i&&(t=i),ds(this,Vs,"f").set(e,{frameWindow:t,minConsistentFrames:i})}getResultCrossVerificationCriteria(e){return Hs(e,this.crossVerificationCriteria)}enableLatestOverlapping(e,t){Ws(e)&&(t&&this.enableResultDeduplication(e,!1),ds(this,Fs,"f").set(e,t))}isLatestOverlappingEnabled(e){return!!Ws(e)&&Hs(e,this.latestOverlappingEnabled)}setMaxOverlappingFrames(e,t){Ws(e)&&ds(this,Us,"f").set(e,t)}getMaxOverlappingFrames(e){return Ws(e)?Hs(e,this.maxOverlappingFrames):-1}latestOverlappingFilter(e){var t,i,n;const s=this.isResultCrossVerificationEnabled(le.CRIT_BARCODE),r=this.isLatestOverlappingEnabled(le.CRIT_BARCODE);if(r){const a=this.crossVerificationFrames,o=60,l=r?this.getMaxOverlappingFrames(le.CRIT_BARCODE):this.crossVerificationFrames,c=e.items.length,d=null===(n=null===(i=null===(t=null==e?void 0:e.intermediateResult)||void 0===t?void 0:t[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,h=d?d.length:0;let u=[];const g=[],p={x:0,y:0};let f=new Array(c).fill(-1),m=0;const _=e.items.map(e=>{if(1!==e.type){const t=(BigInt(e.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0);return new Ps(l,t?1:2,t,e)}}).filter(Boolean);if(this.overlapSet.length>0){const e=new Array(c).fill(new Array(this.overlapSet.length).fill(1));let t=0;for(;t<c;){const i={x:0,y:0},n=new Array(c).fill(-1);let s=!1;for(;t<c;t++){if(!_[t])continue;const r=_[t].item;for(let a=0;a<this.overlapSet.length;a++){if(e[t][a]<1)continue;const o=this.overlapSet[a],l=o.item;if(r.format===l.format&&r.text===l.text){if(s=o.isProbablySameLocationWithOffset(_[t],i),s){n[t]=a,e[t][a]=0;break}}else e[t][a]=0}if(s)break}if(s){for(let s=0;s<c;s++){if(s===t||!_[s])continue;const r=_[s].item;for(let t=0;t<this.overlapSet.length;t++){if(e[s][t]<1)continue;if(n.includes(t))continue;const a=this.overlapSet[t],o=a.item;if(r.format===o.format&&r.text===o.text){if(a.isMatchedLocationWithOffset(_[s],i)){n[s]=t,e[s][t]=0;break}}else e[s][t]=0}}const s=n.filter(e=>-1!==e).length;s>m&&(m=s,f=n,p.x=i.x,p.y=i.y)}}if(0===m){for(let t=0;t<c;t++){const i=_[t].item;for(let n=0;n<this.overlapSet.length;n++){if(e[t][n]<1)continue;if(f.includes(n))continue;const s=this.overlapSet[n],r=s.item;if(i.format===r.format&&i.text===r.text){if(s.isMatchedLocationWithOffset(_[t])){f[t]=n,e[t][n]=0;break}}else e[t][n]=0}}m+=f.filter(e=>-1!=e).length}let i=this.overlapSet.length<=3?m>=1:m>=2;if(!i&&r&&h>0){let e=0;for(let t=0;t<this.overlapSet.length;t++){const i=this.overlapSet[t];for(let t=0;t<h;t++)if(i.isOverlappedLocationWithOffset(d[t],p)){e++;break}}i=this.overlapSet.length<=3?e>=1:e>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,e.items.forEach((e,t)=>{if(1!==e.type){const i=Object.assign({},e),n=(BigInt(e.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0),r=e.confidence<o,a=new Ps(l,n?1:2,n,i);s&&n&&r&&g.push(t),this.overlapSet.push(a)}});else{let t=!0;r?(Math.abs(p.x)>5||Math.abs(p.y)>5)&&(t=!1):t=!1;for(let i=0;i<e.items.length;i++){const e=f[i];if(e<0&&_[i]){const e=_[i].item;let n={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let i=0;i<4;i++)n.points[i].x=t?e.location.points[i].x-p.x:e.location.points[i].x,n.points[i].y=t?e.location.points[i].y-p.y:e.location.points[i].y;for(let s=0;s<this.overlapSet.length;s++){if(f.includes(s))continue;const r=this.overlapSet[s].item.text,a=this.overlapSet[s].item.format;if(e.format===a&&e.text===r){if(this.overlapSet[s].isOverlappedLocationWithOffset(e,p,!1)){const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new Ps(l,r,n,t),f[i]=s;break}if(_[i].isOneD){let r={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]};for(let e=0;e<4;e++)r.points[e].x=t?this.overlapSet[s].location.points[e].x:this.overlapSet[s].location.points[e].x+p.x,r.points[e].y=t?this.overlapSet[s].location.points[e].y:this.overlapSet[s].location.points[e].y+p.y;let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(Ns(n,r,e.moduleSize,a)){e.location=a;const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[s]=new Ps(l,r,n,t),f[i]=s;break}}}}}else{if(t)_[i]&&(_[i].item.location=this.overlapSet[e].location);else{const t=Object.assign({},_[i].item),n=(BigInt(t.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[e]=new Ps(l,s,n,t)}this.overlapSet[e]&&(this.overlapSet[e].overlapCount=l,this.overlapSet[e].verificationCount=2,this.overlapSet[e].crossVerificationFrame=a)}}t?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let e=0;e<this.overlapSet.length;e++){if(f.includes(e))continue;const n=this.overlapSet[e];n.overlapCount--,n.crossVerificationFrame--;const s=n.overlapCount+this.stabilityCount;if(r&&s>0){for(let e=0;e<c;e++)if(n.isOverlappedLocationWithOffset(_[e],p,!1)){i=!1;break}if(!i)break;const e=n.item;if(!t){for(let e=0;e<4;e++)n.location.points[e].x+=p.x,n.location.points[e].y+=p.y;e.location=n.location}2===n.verificationCount&&u.push(e)}}if(r&&!i){u=[];for(let e=0;e<this.overlapSet.length;e++){if(f.includes(e))continue;const t=this.overlapSet[e];t.overlapCount=0-this.stabilityCount,t.crossVerificationFrame=0,t.verificationCount=0}}for(let e=0;e<c;e++){if(-1!==f[e]||!_[e])continue;const i=_[e].item;if(t){for(let t=0;t<4;t++)_[e].location.points[t].x-=p.x,_[e].location.points[t].y-=p.y;i.location=_[e].location}let n=!1;for(let t of this.overlapSet)if(!(t.crossVerificationFrame<=0&&t.verificationCount<=0)&&(n=t.isLocationOverlap(_[e].location,_[e].locationArea),n))break;if(n){g.push(e);continue}const r=Object.assign({},i),a=(BigInt(i.format)&BigInt(_s.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(_s.BF_GS1_DATABAR))!=BigInt(0),c=i.confidence<o,d=new Ps(l,a?1:2,a,r);s&&a&&c?g.push(e):d.verificationCount=2,this.overlapSet.push(d)}this.overlapSet=this.overlapSet.filter(e=>!(e.overlapCount+this.stabilityCount<=0&&e.crossVerificationFrame<=0))}g.sort((e,t)=>t-e).forEach((t,i)=>{e.items.splice(t,1)}),u.forEach(t=>{e.items.push(Object.assign(Object.assign({},t),{overlapped:!0}))})}}}var Ys,qs,$s,Xs,Qs,Ks,Js,er;xs=new WeakMap,ks=new WeakMap,Bs=new WeakMap,Fs=new WeakMap,Us=new WeakMap,Vs=new WeakMap;class tr{static async readFromFile(e){if("string"==typeof e){if(!M(e))return Promise.reject(new TypeError("The input string is not a valid URL."));{const t=await fetch(e);e=await t.blob()}}return await V(e)}static async saveToFile(e,t,i){if(!e||!t)return null;if("string"!=typeof t)throw new TypeError("FileName must be of type string.");const n=F(e);return N(n,t,i)}static async readFromMemory(e){if(!ds(tr,Ys,"f",qs).has(e))throw new Error("Image data ID does not exist.");return ds(tr,Ys,"f",qs).get(e)}static async saveToMemory(e,t){var i,n,s;const r=await vs(e,t),a=await V(r),o=(function(e,t,i,n,s){if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");s?s.value=i:t.set(e,i)}(i=tr,Ys,(s=ds(i,Ys,"f",$s),n=s++,s),0,$s),n);return ds(tr,Ys,"f",qs).set(o,a),o}static async readFromBase64String(e){const t=await(async e=>{let t,i="image/png";if(e.includes("base64,")){const n=e.split(","),s=n[0].match(/:(.*?);/);s&&(i=s[1]),t=atob(n[1])}else t=atob(e);const n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new Blob([s],{type:i})})(e);return await V(t)}static async saveToBase64String(e,t){e instanceof Blob&&(e=await V(e));let i=F(e);const n=await vs(i,t);return await(async e=>await new Promise((t,i)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=e=>{i(e)},n.readAsDataURL(e)}))(n)}}Ys=tr,qs={value:new Map},$s={value:0};class ir{static async drawOnImage(e,t,i,n=4294901760,s=1,r="test.png",a){if(!e)throw new Error("Invalid image.");if(!t)throw new Error("Invalid drawingItem.");if(!i)throw new Error("Invalid type.");let o;if(e instanceof Blob)o=await V(e);else if("string"==typeof e){let t=await b(e,"blob");o=await V(t)}else R(e)&&(o=e,"bigint"==typeof o.format&&(o.format=Number(o.format)));return await new Promise((e,l)=>{let c=Me();Oe[c]=async t=>{if(t.success)return a&&tr.saveToFile(t.image,r,a),e(t.image);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},Ae.postMessage({type:"utility_drawOnImage",id:c,body:{dsImage:o,drawingItem:Array.isArray(t)?t:[t],color:n,thickness:s,type:i}})})}}class nr{static async cropImage(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=R(e)?e:await V(e);return await new Promise((e,o)=>{let l=Me();Oe[l]=async t=>{if(t.success)return e(t.cropImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},Ae.postMessage({type:"utility_cropImage",id:l,body:{type:"Rect",bytes:i,width:n,height:s,stride:r,format:a,roi:t}})})}static async adjustBrightness(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=R(e)?e:await V(e);return await new Promise((e,o)=>{let l=Me();Oe[l]=async t=>{if(t.success)return e(t.adjustBrightness);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},Ae.postMessage({type:"utility_adjustBrightness",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,brightness:t}})})}static async adjustContrast(e,t){const{bytes:i,width:n,height:s,stride:r,format:a}=R(e)?e:await V(e);return await new Promise((e,o)=>{let l=Me();Oe[l]=async t=>{if(t.success)return e(t.adjustContrast);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},Ae.postMessage({type:"utility_adjustContrast",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,contrast:t}})})}static async filterImage(e,t){if(![0,1,2].includes(t))throw new Error("Invalid filterType.");const{bytes:i,width:n,height:s,stride:r,format:a}=R(e)?e:await V(e);return await new Promise((e,o)=>{let l=Me();Oe[l]=async t=>{if(t.success)return e(t.filterImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},Ae.postMessage({type:"utility_filterImage",id:l,body:{bytes:i,width:n,height:s,stride:r,format:a,filterType:t}})})}static async convertToGray(e,t,i,n){const{bytes:s,width:r,height:a,stride:o,format:l}=R(e)?e:await V(e);return await new Promise((e,c)=>{let d=Me();Oe[d]=async t=>{if(t.success)return e(t.convertToGray);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},Ae.postMessage({type:"utility_convertToGray",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,R:t,G:i,B:n}})})}static async convertToBinaryGlobal(e,t=-1,i=!1){const{bytes:n,width:s,height:r,stride:a,format:o}=R(e)?e:await V(e);return await new Promise((e,l)=>{let c=Me();Oe[c]=async t=>{if(t.success)return e(t.convertToBinaryGlobal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},Ae.postMessage({type:"utility_convertToBinaryGlobal",id:c,body:{bytes:n,width:s,height:r,stride:a,format:o,threshold:t,invert:i}})})}static async convertToBinaryLocal(e,t=0,i=10,n=!1){const{bytes:s,width:r,height:a,stride:o,format:l}=R(e)?e:await V(e);return await new Promise((e,c)=>{let d=Me();Oe[d]=async t=>{if(t.success)return e(t.convertToBinaryLocal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},Ae.postMessage({type:"utility_convertToBinaryLocal",id:d,body:{bytes:s,width:r,height:a,stride:o,format:l,blockSize:t,compensation:i,invert:n}})})}static async cropAndDeskewImage(e,t,i=0,n=0,s=0){const{bytes:r,width:a,height:o,stride:l,format:c}=R(e)?e:await V(e);return await new Promise((e,d)=>{let h=Me();Oe[h]=async t=>{if(t.success)return e(t.cropAndDeskewImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,d(e)}},Ae.postMessage({type:"utility_cropAndDeskewImage",id:h,body:{bytes:r,width:a,height:o,stride:l,format:c,roi:t,dstWidth:i,dstHeight:n,padding:s}})})}}!function(e){e[e.FT_HIGH_PASS=0]="FT_HIGH_PASS",e[e.FT_SHARPEN=1]="FT_SHARPEN",e[e.FT_SMOOTH=2]="FT_SMOOTH"}(Xs||(Xs={}));class sr{static async findPortraitZone(){return await Ge.loadWasm(),await Be.license.dynamsoft(),await new Promise((e,t)=>{let i=Me();Oe[i]=async i=>{if(i.success){const n=JSON.parse(i.quad);n.errorCode&&0!==n.errorCode&&t(new Error(n.errorString)),e(n)}else{let e=new Error(i.message);e.stack=i.stack+"\n"+e.stack,t(e)}},Ae.postMessage({type:"identityUtility_findPortraitZone",id:i})})}}class rr{static getVersion(){return`1.0.10-dev-20260129110800(Worker: ${ke.identityutility&&ke.identityutility.worker||"Not Loaded"}, Wasm: ${ke.identityutility&&ke.identityutility.wasm||"Not Loaded"})`}}Ge.engineResourcePaths.rootDirectory=(e=>{if(null==e&&(e="./"),We||He);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(ze+"../../"),Ge.engineResourcePaths.dcvBundle={version:"3.4.1000-dev-20260214095351",path:ze,isInternal:!0},Ge.engineResourcePaths.dcvData={version:"1.2.0",path:ze,isInternal:!0},lt.CoreModule=Ge,lt.handleEngineResourcePaths=L,function(e){e.MRZ="mrz",e.Opposite="opposite"}(Qs||(Qs={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2",e.PassportAndTD1="passportAndTd1",e.PassportAndTD2="passportAndTd2",e.TD1AndTD2="td1AndTd2",e.All="all"}(Ks||(Ks={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2"}(Js||(Js={})),function(e){e.Scanner="scanner",e.Result="scan-result"}(er||(er={}));const ar={[Ks.Passport]:"ReadPassport",[Ks.TD1]:"ReadId-TD1",[Ks.TD2]:"ReadId-TD2",[Ks.PassportAndTD1]:"ReadPassportAndId-TD1",[Ks.PassportAndTD2]:"ReadPassportAndId-TD2",[Ks.TD1AndTD2]:"ReadId",[Ks.All]:"ReadPassportAndId"};var or;function lr(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}!function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(or||(or={}));function cr(e,t){if(!document.getElementById(e)){const i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}}const dr=e=>!e||0===Object.keys(e).length;function hr(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}const ur={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};function gr(e,t={}){const{message:i,spinnerSize:n=32}=t,s=document.createElement("div");s.className="dynamsoft-mrz-loading-screen";const r=document.createElement("div");r.className="dynamsoft-mrz-loading";const a=document.createElement("div");a.className="dynamsoft-mrz-loading-content";const o=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${n}" \n      height="${n}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(a.innerHTML=o,i){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=i,a.appendChild(e)}return r.appendChild(a),s.appendChild(r),e.appendChild(s),{element:s,updateMessage:e=>{let t=r.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,a.appendChild(t)):null==t||t.remove()},hide:()=>{s&&s.parentNode&&(s.classList.add("fade-out"),setTimeout(()=>{var e;null===(e=s.parentNode)||void 0===e||e.removeChild(s)},200))}}}const pr='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var fr;!function(e){e.InvalidFields="invalidFields",e.DocumentType="documentType",e.DocumentNumber="documentNumber",e.MRZText="mrzText",e.FirstName="firstName",e.LastName="lastName",e.Age="age",e.Sex="sex",e.IssuingState="issuingState",e.IssuingStateRaw="issuingStateRaw",e.Nationality="nationality",e.NationalityRaw="nationalityRaw",e.DateOfBirth="dateOfBirth",e.DateOfExpiry="dateOfExpiry",e.OptionalData1="optionalData1",e.OptionalData2="optionalData2"}(fr||(fr={}));const mr={[fr.InvalidFields]:"Invalid Fields",[fr.DocumentType]:"Document Type",[fr.DocumentNumber]:"Document Number",[fr.MRZText]:"MRZ Text",[fr.FirstName]:"Given Name(s)",[fr.LastName]:"Surname",[fr.Age]:"Age",[fr.Sex]:"Sex",[fr.IssuingState]:"Issuing State",[fr.IssuingStateRaw]:"Issuing State (Raw Value)",[fr.Nationality]:"Nationality",[fr.NationalityRaw]:"Nationality State (Raw Value)",[fr.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[fr.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)",[fr.OptionalData1]:"Optional Data 1",[fr.OptionalData2]:"Optional Data 2"};function _r(e,t,i,n=!1){const s=parseInt(e,10);let r;if(n)r=s>=60?1900+s:2e3+s;else{r=s>(new Date).getFullYear()%100?1900+s:2e3+s}return{year:r,month:parseInt(t,10),day:parseInt(i,10)}}function Er(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function yr(e){return"D<<"===e?"D":e}function Ir(e,t){const i=[],n=e=>t.getFieldValidationStatus(e)===Pn.VS_FAILED,s=t.codeType,r=function(e){switch(e){case"MRTD_TD1_ID":return Js.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return Js.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return Js.Passport;default:throw new Error(`Unknown document type: ${e}`)}}(s),a=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(s),o=r===Js.Passport&&"MRTD_TD3_PASSPORT"===s?"passportNumber":"documentNumber",l=_r(t.getFieldValue("birthYear"),t.getFieldValue("birthMonth"),t.getFieldValue("birthDay")),c=_r(t.getFieldValue("expiryYear"),t.getFieldValue("expiryMonth"),t.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach(e=>{n(e)&&i.push(fr.DateOfBirth)}),["expiryYear","expiryMonth","expiryDay"].forEach(e=>{n(e)&&i.push(fr.DateOfExpiry)});const d={[fr.LastName]:t.getFieldValue("primaryIdentifier"),[fr.FirstName]:t.getFieldValue("secondaryIdentifier"),[fr.Nationality]:t.getFieldValue("nationality"),[fr.NationalityRaw]:yr(t.getFieldRawValue("nationality")),[fr.DocumentNumber]:t.getFieldValue(o)||t.getFieldValue("longDocumentNumber"),[fr.IssuingState]:t.getFieldValue("issuingState"),[fr.IssuingStateRaw]:yr(t.getFieldRawValue("issuingState")),[fr.Sex]:hr(t.getFieldValue("sex"))};Object.keys(d).forEach(e=>{let t=!1;switch(e){case fr.FirstName:t=n("secondaryIdentifier");break;case fr.LastName:t=n("primaryIdentifier");break;case fr.DocumentNumber:t=n(o)||n("longDocumentNumber");break;default:t=n(e)}t&&i.push(e)});const h=function(e){const t=new Date,i=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(i?0:1)}(l);h<1&&i.push(fr.Age);return{[fr.InvalidFields]:i,[fr.FirstName]:d[fr.FirstName],[fr.LastName]:d[fr.LastName],[fr.Age]:h,[fr.DateOfBirth]:l,[fr.Sex]:d[fr.Sex],[fr.Nationality]:d[fr.Nationality],[fr.NationalityRaw]:d[fr.NationalityRaw],[fr.DocumentNumber]:d[fr.DocumentNumber],[fr.DateOfExpiry]:c,[fr.IssuingState]:d[fr.IssuingState],[fr.IssuingStateRaw]:d[fr.IssuingStateRaw],[fr.DocumentType]:hr(a),[fr.MRZText]:e}}class Rr{constructor(e){var t,i,n,s,r;this._primaryOriginalImage=null,this._secondaryOriginalImage=null,this._primaryDocumentImage=null,this._secondaryDocumentImage=null,this._portraitImage=null,this.status=e.status,this.data=e.data,this._primaryOriginalImage=null!==(t=e.primaryOriginalImage)&&void 0!==t?t:null,this._secondaryOriginalImage=null!==(i=e.secondaryOriginalImage)&&void 0!==i?i:null,this._primaryDocumentImage=null!==(n=e.primaryDocumentImage)&&void 0!==n?n:null,this._secondaryDocumentImage=null!==(s=e.secondaryDocumentImage)&&void 0!==s?s:null,this._portraitImage=null!==(r=e.portraitImage)&&void 0!==r?r:null}getDocumentImage(e){return e===Qs.MRZ?this._primaryDocumentImage:this._secondaryDocumentImage}getOriginalImage(e){return e===Qs.MRZ?this._primaryOriginalImage:this._secondaryOriginalImage}getPortraitImage(){return this._portraitImage}}const wr={[Js.TD1]:{width:85.6,height:53.98},[Js.TD2]:{width:105,height:74},[Js.Passport]:{width:125,height:88}};class vr{showScannerLoadingOverlay(e){const t=lr(this.config.container);this.loadingScreen=gr(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(lr(this.config.container).style.display="none"))}constructor(e,t){this.resources=e,this.config=t,this.isSoundFeedbackOn=!1,this.scanModeManager={[Js.Passport]:!0,[Js.TD1]:!0,[Js.TD2]:!0},this.currentScanMode=Ks.All,this.resizeTimer=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.flipTimeoutHandle=null,this.flipCountdownHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null},this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,soundFeedbackBtn:null,closeScannerBtn:null,scanModeSelectContainer:null,passportModeOption:null,td1ModeOption:null,td2ModeOption:null,toast:null},this.statusMessageElement=null,this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.toggleScanGuide(!0)},500)},this.firstFrame=!0}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),cr("dynamsoft-mrz-loading-screen-style",pr);try{const{cameraView:e,cameraEnhancer:t,cvRouter:i}=this.resources;if(e.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),e.setVideoFit("cover"),i.setInput(t),!0===this.config.enableMultiFrameCrossFilter){const e=new Zs;e.enableResultCrossVerification(le.CRIT_TEXT_LINE,!0),await i.addResultFilter(e)}const n=new Bi;n.onCapturedResultReceived=e=>this.handleMRZResult(e),await i.addResultReceiver(n),this.toggleSoundFeedback(!1),!1===this.config.showScanGuide&&this.toggleScanGuide(!1),this.initialized=!0}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const i=new Rr({status:or.RS_FAILED});this.currentScanResolver(i)}}}initializeElements(){var e;const t=lr(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))throw new Error("Shadow root not found");if(this.DCE_ELEMENTS={selectCameraBtn:i.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:i.shadowRoot.querySelector(".dce-mn-upload-image-icon"),soundFeedbackBtn:i.shadowRoot.querySelector(".dce-mn-sound-feedback"),closeScannerBtn:i.shadowRoot.querySelector(".dce-mn-close"),scanModeSelectContainer:i.shadowRoot.querySelector(".dce-mn-scan-mode-select"),passportModeOption:i.shadowRoot.querySelector(".scan-mode-option-passport"),td1ModeOption:i.shadowRoot.querySelector(".scan-mode-option-td1"),td2ModeOption:i.shadowRoot.querySelector(".scan-mode-option-td2"),toast:i.shadowRoot.querySelector(".dce-mn-toast")},this.setupScanModeSelector(),this.assignDCEClickEvents(),this.DCE_ELEMENTS.toast.style.display="none",!1===this.config.showUploadImage&&(this.DCE_ELEMENTS.uploadImageBtn.style.visibility="hidden"),!1===this.config.showSoundToggle&&(this.DCE_ELEMENTS.soundFeedbackBtn.style.visibility="hidden"),!1===(null===(e=this.config)||void 0===e?void 0:e.showPoweredByDynamsoft)){i.shadowRoot.querySelector(".dce-mn-msg-poweredby").style.display="none"}this.initializedDCE=!0}setupScanModeSelector(){if(!1!==this.config.showFormatSelector)switch(this.currentScanMode){case Ks.PassportAndTD1:this.DCE_ELEMENTS.td2ModeOption.style.display="none";break;case Ks.PassportAndTD2:this.DCE_ELEMENTS.td1ModeOption.style.display="none";break;case Ks.TD1AndTD2:this.DCE_ELEMENTS.passportModeOption.style.display="none";break;case Ks.All:break;default:this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}else this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.uploadImageBtn.onclick=()=>this.uploadFile(),this.DCE_ELEMENTS.soundFeedbackBtn.onclick=()=>this.toggleSoundFeedback(),this.DCE_ELEMENTS.closeScannerBtn.onclick=()=>this.handleCloseBtn(),this.DCE_ELEMENTS.selectCameraBtn.onclick=e=>{e.stopPropagation(),this.toggleSelectCameraBox()},this.DCE_ELEMENTS.passportModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.passportModeOption.style.display&&await this.toggleScanDocType(Js.Passport)},this.DCE_ELEMENTS.td1ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td1ModeOption.style.display&&await this.toggleScanDocType(Js.TD1)},this.DCE_ELEMENTS.td2ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td2ModeOption.style.display&&await this.toggleScanDocType(Js.TD2)}}handleCloseBtn(){if(this.closeCamera(),this.currentScanResolver)if(this.isMRZScanned&&!this.isPortraitScanned&&(this.areSidesDifferent||this.isWaitingForPortraitAfterMRZ)){const e=new Rr({status:or.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:this.mrzSideData.portraitImage});this.currentScanResolver(e),this.resetScanningState()}else this.currentScanResolver(new Rr({status:or.RS_CANCELLED})),this.resetScanningState()}attachOptionClickListeners(){const e=lr(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...t.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...t.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach(e=>{e.addEventListener("click",async t=>{const n=e.getAttribute("data-davice-id"),s=e.getAttribute("data-height"),r=e.getAttribute("data-width");n?this.resources.cameraEnhancer.selectCamera(n).then(()=>{this.toggleScanGuide()}):s&&r&&this.resources.cameraEnhancer.setResolution({width:parseInt(r),height:parseInt(s)}).then(()=>{this.toggleScanGuide()}),"none"!==i.style.display&&this.toggleSelectCameraBox()})})}highlightCameraAndResolutionOption(){const e=lr(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),n=i.querySelectorAll(".dce-mn-camera-option"),s=i.querySelectorAll(".dce-mn-resolution-option"),r=this.resources.cameraEnhancer.getSelectedCamera(),a=this.resources.cameraEnhancer.getResolution();n.forEach(e=>{const t=e;t.getAttribute("data-davice-id")===(null==r?void 0:r.deviceId)?t.style.border="2px solid #fe814a":t.style.border="none"});const o={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},l=function(e){const t=e.width*e.height,i=e.width/e.height;let n="480p",s=Number.MAX_VALUE;for(const[e,r]of Object.entries(ur)){const a=r.width*r.height,o=r.width/r.height,l=.7*Math.abs(a-t)+Math.abs(o-i)*a*.3;l<s&&(s=l,n=e)}return n}(a);s.forEach(e=>{const t=e,i=t.getAttribute("data-height");t.style.border=i===o[l]?"2px solid #fe814a":"none"})}toggleSelectCameraBox(){const e=lr(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const i=t.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),i.click()}async relaunch(){}async uploadFile(){var e,t,i,n,s,r,a;const{cvRouter:o}=this.resources,l=document.createElement("input");l.type="file",l.accept=null!==(e=this.config.uploadAcceptedTypes)&&void 0!==e?e:"image/*",l.style.display="none",document.body.appendChild(l);try{this.showScannerLoadingOverlay("Processing file..."),await this.closeCamera(!1);const e=await new Promise((e,t)=>{l.onchange=i=>{var n;const s=null===(n=i.target.files)||void 0===n?void 0:n[0];s?e(s):t(new Error("No file selected"))},l.addEventListener("cancel",async()=>{this.hideScannerLoadingOverlay(!1),this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay()}),l.click()});if(!e)return;let c;if(this.config.uploadFileConverter&&!e.type.startsWith("image/"))try{c=await this.config.uploadFileConverter(e)}catch(e){throw new Error(`Error converting file: ${e.message}`)}else{if(!e.type.startsWith("image/"))throw new Error("Unsupported file type. Please provide a converter function for this file type.");c=e}const d=this.config.utilizedTemplateNames[this.currentScanMode],h=await o.capture(c,d);this.capturedResultItems=h.items;const u=this.capturedResultItems.filter(e=>e.type===le.CRIT_ORIGINAL_IMAGE);if(0===u.length)throw new Error("No image data found in the captured result");const g=u[0].imageData;g.toCanvas=()=>P(g),g.toBlob=async()=>await k("image/png",g),this.originalImageData=g;const p=null===(t=null==h?void 0:h.parsedResult)||void 0===t?void 0:t.parsedResultItems;let f={};if(null==p?void 0:p.length){const e=(null===(n=null===(i=p[0])||void 0===i?void 0:i.referenceItem)||void 0===n?void 0:n.text)||"";f=Ir(e,p[0])}let m=null,_=null;if(this.resources.returnDocumentImage)try{const e=h.processedDocumentResult;if((null===(s=null==e?void 0:e.detectedQuadResultItems)||void 0===s?void 0:s.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==me.CVS_FAILED&&(_=t.location,m=await nr.cropAndDeskewImage(this.originalImageData,_),m.toCanvas=()=>P(m),m.toBlob=async()=>await k("image/png",m))}}catch(e){console.warn("Error extracting document image from file upload:",e)}let E=null;if(this.resources.returnPortraitImage)try{const e=await sr.findPortraitZone();if(e&&!e.errorCode){(!_||this.validatePortraitLocation(e,_))&&(E=await nr.cropAndDeskewImage(this.originalImageData,e),E.toCanvas=()=>P(E),E.toBlob=async()=>await k("image/png",E))}}catch(e){console.warn("Error finding portrait zone in file upload:",e)}const y=new Rr({status:or.RS_SUCCESS,data:f,primaryOriginalImage:this.originalImageData,primaryDocumentImage:m,portraitImage:E});null===(a=(r=this.resources).onResultUpdated)||void 0===a||a.call(r,y),this.currentScanResolver(y)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new Rr({status:or.RS_FAILED}))}finally{this.hideScannerLoadingOverlay(!0),document.body.removeChild(l)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn;const t=lr(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-mn-sound-feedback"),s=n.querySelector(".dce-mn-sound-feedback-on");n.querySelector(".dce-mn-sound-feedback-off").style.display=this.isSoundFeedbackOn?"none":"block",s.style.display=this.isSoundFeedbackOn?"block":"none"}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:i}=this.resources;if(!t||!t.isOpen())return;const n=wr[e].width/wr[e].height;let s;const r=i.getVisibleRegionOfVideo({inPixels:!0}),{width:a,height:o}=r;if(r){if(r.width>r.height){const e=.5*o*n,t=Math.round(e/a*100),i=(100-t)/2;s={left:i,right:i+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*a/n,t=Math.round(e/o*100),i=(100-t)/2;s={left:5,right:95,top:i,bottom:i+t,isMeasuredInPercentage:!0}}null==i||i.setScanRegionMaskVisible(!0),t.setScanRegion(s)}}toggleScanGuide(e){const t=lr(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;const n=i.shadowRoot.querySelector(".dce-scanguide-passport"),s=i.shadowRoot.querySelector(".dce-scanguide-td1"),r=i.shadowRoot.querySelector(".dce-scanguide-td2");if(!1===e||!1===this.config.showScanGuide)return n.style.display="none",s.style.display="none",void(r.style.display="none");switch(this.currentScanMode){case Ks.All:case Ks.Passport:case Ks.PassportAndTD1:case Ks.PassportAndTD2:n.style.display="block",s.style.display="none",r.style.display="none",this.calculateScanRegion(Js.Passport);break;case Ks.TD1:case Ks.TD1AndTD2:n.style.display="none",s.style.display="block",r.style.display="none",this.calculateScanRegion(Js.TD1);break;case Ks.TD2:n.style.display="none",s.style.display="none",r.style.display="block",this.calculateScanRegion(Js.TD2)}}async openCamera(){try{const{cameraEnhancer:e,cameraView:t}=this.resources,i=lr(this.config.container);if(i.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const n=t.getUIElement();n.parentElement||i.append(n),e.setPixelFormat(o.IPF_ABGR_8888),await e.open();const s=n.shadowRoot;if(s){const e=s.querySelector(".dce-macro-use-mobile-native-like-ui");e&&(e.style.display="block")}}await e.setResolution({width:2560,height:1440}),!this.initializedDCE&&e.isOpen()&&await this.initializeElements(),window.addEventListener("resize",this.handleResize);const n=i.children[i.children.length-1];if(!(null==n?void 0:n.shadowRoot))throw new Error("Shadow root not found");n.shadowRoot.querySelector(".dce-mn-torch-off").style.display="none",n.shadowRoot.querySelector(".dce-mn-torch-on").style.display="none"}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new Rr({status:or.RS_FAILED}))}}async closeCamera(e=!0){try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:t,cameraView:i}=this.resources,n=lr(this.config.container);n.style.display=e?"none":"block",(null==i?void 0:i.getUIElement().parentElement)&&n.removeChild(i.getUIElement()),t.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}async handleMRZResult(e){var t,i,n,s,r,a,o,l;if(this.firstFrame)this.firstFrame=!1;else{if(console.log("[MRZ DEBUG] handleMRZResult — itemTypes:",e.items.map(e=>e.type),"| isMRZScanned:",this.isMRZScanned,"| areSidesDifferent:",this.areSidesDifferent,"| isPortraitScanned:",this.isPortraitScanned,"| isWaitingForFlip:",this.isWaitingForFlip),this.isMRZScanned&&!this.isPortraitScanned&&this.isWaitingForPortraitAfterMRZ){const{onResultUpdated:t}=this.resources;return void await this.tryPortraitOnSameSide(e,t)}if(this.isMRZScanned&&!this.isPortraitScanned&&this.areSidesDifferent&&!this.isWaitingForFlip){const t=e.items.filter(e=>e.type===le.CRIT_ORIGINAL_IMAGE);if(t.length>0){const e=t[0].imageData;e.toCanvas=()=>P(e),e.toBlob=async()=>await k("image/png",e),this.originalImageData=e}const{onResultUpdated:i}=this.resources;return void await this.handlePortraitSideScan(e,i)}if(!(e.items.length<=1)){this.capturedResultItems=e.items;try{const{onResultUpdated:c}=this.resources,d=e.items.filter(e=>e.type===le.CRIT_ORIGINAL_IMAGE);if(d.length>0){const e=d[0].imageData;e.toCanvas=()=>P(e),e.toBlob=async()=>await k("image/png",e),this.originalImageData=e}const h=null===(t=null==e?void 0:e.parsedResult)||void 0===t?void 0:t.parsedResultItems;if(null==h?void 0:h.length){this.isSoundFeedbackOn&&pt.beep();const t=(null===(n=null===(i=h[0])||void 0===i?void 0:i.referenceItem)||void 0===n?void 0:n.text)||"",d=Ir(t,h[0]);let u=null;if(this.resources.returnDocumentImage||this.resources.returnPortraitImage){const t=e.processedDocumentResult;if((null===(s=null==t?void 0:t.detectedQuadResultItems)||void 0===s?void 0:s.length)>0){const e=t.detectedQuadResultItems[0];e.CrossVerificationStatus!==me.CVS_FAILED&&(u=e.location)}const i=e.processedDocumentResult;if(console.log("[MRZ DEBUG] processedDocumentResult:",null==i?String(i):`detectedQuads=${null!==(a=null===(r=null==i?void 0:i.detectedQuadResultItems)||void 0===r?void 0:r.length)&&void 0!==a?a:0}, deskewedImages=${null!==(l=null===(o=null==i?void 0:i.deskewedImageResultItems)||void 0===o?void 0:o.length)&&void 0!==l?l:0}`),this.resources.returnDocumentImage&&!u)return void console.warn("[MRZ DEBUG] Skipping frame — returnDocumentImage=true but no valid documentQuad found")}let g=null;if(this.resources.returnDocumentImage&&u&&this.originalImageData)try{g=await nr.cropAndDeskewImage(this.originalImageData,u),g.toCanvas=()=>P(g),g.toBlob=async()=>await k("image/png",g)}catch(e){console.warn("Error extracting document image:",e)}this.isMRZScanned||await this.handleMRZSideScan(d,g,u,c)}}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new Rr({status:or.RS_FAILED}))}}}}initializeScanModeManager(){const{mrzFormatType:e}=this.config;if(this.scanModeManager={[Js.Passport]:!0,[Js.TD1]:!0,[Js.TD2]:!0},!e||Array.isArray(e)&&0===e.length)return;Object.keys(this.scanModeManager).forEach(e=>{this.scanModeManager[e]=!1});(Array.isArray(e)?e:[e]).forEach(e=>{this.scanModeManager[e]=!0})}getScanMode(){const e=Object.entries(this.scanModeManager).filter(([e,t])=>t).map(([e])=>e).sort().join(",");return{[Js.Passport]:Ks.Passport,[Js.TD1]:Ks.TD1,[Js.TD2]:Ks.TD2,[`${Js.Passport},${Js.TD1}`]:Ks.PassportAndTD1,[`${Js.Passport},${Js.TD2}`]:Ks.PassportAndTD2,[`${Js.TD1},${Js.TD2}`]:Ks.TD1AndTD2,[`${Js.Passport},${Js.TD1},${Js.TD2}`]:Ks.All,"":Ks.All}[e]}DCEShowToast(e,t=3e3){this.DCE_ELEMENTS.toast&&(this.DCE_ELEMENTS.toast.textContent=e,this.DCE_ELEMENTS.toast.style.display="",setTimeout(()=>{this.DCE_ELEMENTS.toast.style.display="none"},t))}async startCapturing(){const{cvRouter:e}=this.resources,t=this.config.utilizedTemplateNames[this.currentScanMode];try{this.firstFrame=!0,await e.startCapturing(t)}catch(e){let t=(null==e?void 0:e.message)||e;console.error("Failed to start capturing:",t),this.closeCamera(),this.currentScanResolver&&this.currentScanResolver(new Rr({status:or.RS_FAILED}))}}async toggleScanDocType(e){try{if(this.scanModeManager[e]&&0===Object.entries(this.scanModeManager).filter(([t,i])=>i&&t!==e).length)return console.warn("MRZ Scanner - At least one mode must be enabled"),void this.DCEShowToast("At least one mode must be enabled");this.scanModeManager[e]=!this.scanModeManager[e],this.currentScanMode=this.getScanMode(),this.stopCapturing(),this.toggleScanGuide(),await this.startCapturing(),this.DCE_ELEMENTS.td1ModeOption.classList.toggle("selected",this.scanModeManager[Js.TD1]),this.DCE_ELEMENTS.td2ModeOption.classList.toggle("selected",this.scanModeManager[Js.TD2]),this.DCE_ELEMENTS.passportModeOption.classList.toggle("selected",this.scanModeManager[Js.Passport])}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner switch scan mode error: ",t),this.closeCamera(),this.currentScanResolver(new Rr({status:or.RS_FAILED}))}}async launch(){try{this.resetScanningState(),await this.initialize();const{cvRouter:e,cameraEnhancer:t}=this.resources;return new Promise(async e=>{this.currentScanResolver=e,this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),!this.initializedDCE&&t.isOpen()&&await this.initializeElements(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay(),this.resources.returnPortraitImage?this.showStatusMessage("Please scan the MRZ side first"):this.showStatusMessage("Please scan the MRZ side of the document")})}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner launch error: ",t),this.closeCamera(),this.currentScanResolver(new Rr({status:or.RS_FAILED}))}}createStatusMessageElement(){const e=document.createElement("div");return e.className="dce-status-message",e.style.cssText="\n      position: absolute;\n      bottom: 25%;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 16px;\n      font-family: Verdana, sans-serif;\n      z-index: 999;\n      text-align: center;\n      max-width: 80%;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n    ",e}showStatusMessage(e,t){if(!this.statusMessageElement){const e=lr(this.config.container),t=e.children[e.children.length-1];(null==t?void 0:t.shadowRoot)&&(this.statusMessageElement=this.createStatusMessageElement(),t.shadowRoot.appendChild(this.statusMessageElement))}this.statusMessageElement&&(this.statusMessageElement.textContent=e,this.statusMessageElement.style.display="block",t&&setTimeout(()=>{this.hideStatusMessage()},t))}hideStatusMessage(){this.statusMessageElement&&(this.statusMessageElement.style.display="none")}showSuccessBorder(e=1e3){const t=lr(this.config.container),i=t.children[t.children.length-1];if(!(null==i?void 0:i.shadowRoot))return;[i.shadowRoot.querySelector(".dce-mn-bg-mrz-passport"),i.shadowRoot.querySelector(".dce-mn-bg-mrz-td1"),i.shadowRoot.querySelector(".dce-mn-bg-mrz-td2")].forEach(t=>{if(t&&"none"!==t.style.display){const i=t.style.border;t.style.border="3px solid #4CAF50",setTimeout(()=>{t.style.border=i},e)}})}async handleMRZSideScan(e,t,i,n){let s=null,r=!1;if(this.resources.returnPortraitImage)try{const e=await sr.findPortraitZone();if(console.log("[MRZ DEBUG] findPortraitZone result:",e,"| originalImageData:",!!this.originalImageData),e&&!e.errorCode){const t=!i||this.validatePortraitLocation(e,i);console.log("[MRZ DEBUG] portrait validation — isValid:",t,"| documentQuad:",i),t&&this.originalImageData&&(s=await nr.cropAndDeskewImage(this.originalImageData,e),s.toCanvas=()=>P(s),s.toBlob=async()=>await k("image/png",s),r=!0)}}catch(e){console.warn("Error finding portrait zone:",e)}if(this.isMRZScanned=!0,this.mrzSideData={processedData:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:s},this.resources.returnPortraitImage&&!r)console.log("[MRZ DEBUG] handleMRZSideScan — MRZ scanned, waiting 1s for portrait on same side..."),this.isWaitingForPortraitAfterMRZ=!0,this.flipTimeoutHandle=window.setTimeout(()=>{var e;if(this.flipTimeoutHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isPortraitScanned)return;console.log("[MRZ DEBUG] Portrait not found within 1s. Starting flip prompt."),this.areSidesDifferent=!0,this.isWaitingForFlip=!0;const t=null!==(e=this.config.flipDocumentTimeout)&&void 0!==e?e:3e3;let i=Math.ceil(t/1e3);this.showSuccessBorder(1e3),this.showStatusMessage(`MRZ scanned! Please flip the document (${i}s)`),this.flipCountdownHandle=window.setInterval(()=>{i--,i>0&&this.showStatusMessage(`Please flip the document (${i}s)`)},1e3),this.flipTimeoutHandle=window.setTimeout(()=>{window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null,this.flipTimeoutHandle=null,this.isWaitingForFlip=!1,this.showStatusMessage("Now scan the portrait side")},t)},1e3);else{this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.showSuccessBorder(1e3);const i=s?"MRZ and portrait successfully scanned!":"MRZ successfully scanned!";this.showStatusMessage(i,1e3),setTimeout(()=>{this.closeCamera();const i=new Rr({status:or.RS_SUCCESS,data:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:s});null==n||n(i),this.currentScanResolver(i),this.resetScanningState()},1e3)}}async tryPortraitOnSameSide(e,t){var i;if(!this.isWaitingForPortraitAfterMRZ)return;this.isWaitingForPortraitAfterMRZ=!1;let n=!1;try{const s=e.items.filter(e=>e.type===le.CRIT_ORIGINAL_IMAGE);if(s.length>0){const e=s[0].imageData;e.toCanvas=()=>P(e),e.toBlob=async()=>await k("image/png",e),this.originalImageData=e}const r=await sr.findPortraitZone();if(this.isPortraitScanned)return;if(r&&!r.errorCode){let s=null;const a=e.processedDocumentResult;if((null===(i=null==a?void 0:a.detectedQuadResultItems)||void 0===i?void 0:i.length)>0){const e=a.detectedQuadResultItems[0];e.CrossVerificationStatus!==me.CVS_FAILED&&(s=e.location)}if((!s||this.validatePortraitLocation(r,s))&&this.originalImageData){n=!0;const e=await nr.cropAndDeskewImage(this.originalImageData,r);e.toCanvas=()=>P(e),e.toBlob=async()=>await k("image/png",e),null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.mrzSideData.portraitImage=e,this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const i=new Rr({status:or.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:e});null==t||t(i),this.currentScanResolver(i),this.resetScanningState()},1e3)}}}catch(e){console.warn("[MRZ DEBUG] tryPortraitOnSameSide — error:",e)}finally{n||null===this.flipTimeoutHandle||(this.isWaitingForPortraitAfterMRZ=!0)}}async handlePortraitSideScan(e,t){var i;if(this.isProcessingPortraitFrame)return;this.isProcessingPortraitFrame=!0,console.log("[MRZ DEBUG] handlePortraitSideScan entered — originalImageData:",!!this.originalImageData);let n=!1;try{const s=await sr.findPortraitZone();if(console.log("[MRZ DEBUG] handlePortraitSideScan — findPortraitZone result:",s),s&&!s.errorCode&&this.originalImageData){n=!0,this.isPortraitScanned=!0;let r=this.originalImageData,a=null;if(this.resources.returnDocumentImage)try{const t=e.processedDocumentResult;if((null===(i=null==t?void 0:t.detectedQuadResultItems)||void 0===i?void 0:i.length)>0){const e=t.detectedQuadResultItems[0];if(e.CrossVerificationStatus!==me.CVS_FAILED){const t=e.location;a=await nr.cropAndDeskewImage(this.originalImageData,t),a.toCanvas=()=>P(a),a.toBlob=async()=>await k("image/png",a)}}}catch(e){console.warn("Error extracting secondary document image:",e)}let o=null;try{o=await nr.cropAndDeskewImage(this.originalImageData,s),o.toCanvas=()=>P(o),o.toBlob=async()=>await k("image/png",o)}catch(e){console.warn("Error cropping portrait image:",e)}this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const e=new Rr({status:or.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,secondaryOriginalImage:r,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,secondaryDocumentImage:a,portraitImage:o||this.mrzSideData.portraitImage});null==t||t(e),this.currentScanResolver(e),this.resetScanningState()},1e3)}}catch(e){console.warn("Error finding portrait on second side:",e)}finally{n||(this.isProcessingPortraitFrame=!1)}}resetScanningState(){this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),null!==this.flipCountdownHandle&&(window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null),this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null}}validatePortraitLocation(e,t){if(!e.points.every(e=>this.isPointInQuadrilateral(e,t)))return!1;return t.area/e.area>=3}isPointInQuadrilateral(e,t){const i=t.points;let n=!1;for(let t=0,s=i.length-1;t<i.length;s=t++){const r=i[t].x,a=i[t].y,o=i[s].x,l=i[s].y;a>e.y!=l>e.y&&e.x<(o-r)*(e.y-a)/(l-a)+r&&(n=!n)}return n}}const Cr={cancel:'\n<svg id="cancel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cancelclip-path">\n      <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_582" data-name="Group 582" clip-path="url(#cancelclip-path)" transform="rotate(180 12 12)">\n    <path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n    <path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n  </g>\n</svg>  \n  ',rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class Tr{constructor(e,t,i){this.resources=e,this.config=t,this.scannerView=i,this.editedFields={}}async launch(){try{return lr(this.config.container).textContent="",await this.initialize(),lr(this.config.container).style.display="flex",new Promise(e=>{this.currentScanResultViewResolver=e})}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const e=await this.scannerView.launch();if((null==e?void 0:e.status)===or.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(e));this.resources.onResultUpdated&&((null==e?void 0:e.status)===or.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==e?void 0:e.status)===or.RS_SUCCESS&&this.resources.onResultUpdated(e)),this.dispose(!0),await this.initialize(),lr(this.config.container).style.display="flex"}catch(e){throw console.error("Error in rescan handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Rr({status:or.RS_FAILED})),e}}async handleCancel(){var e;try{(null===(e=this.config)||void 0===e?void 0:e.onCancel)&&await this.config.onCancel(this.resources.result),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Rr({status:or.RS_CANCELLED})),this.hideView(),this.dispose()}catch(e){throw console.error("Error in cancel handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Rr({status:or.RS_FAILED})),e}}async handleDone(){var e,t;try{(null===(e=this.resources.result)||void 0===e?void 0:e.data)&&!dr(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(e){throw console.error("Error in done handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Rr({status:or.RS_FAILED})),e}}createControls(){var e,t,i,n,s,r,a,o,l,c,d,h;const{toolbarButtonsConfig:u}=this.config;return function(e){cr("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach(e=>{const i=document.createElement("div");i.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const n=document.createElement("div");if(n.className="dynamsoft-mrz-control-icon-wrapper",(s=e.icon).trim().startsWith("<svg")&&s.trim().endsWith("</svg>"))n.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,n.appendChild(t)}var s;const r=document.createElement("div");r.className="dynamsoft-mrz-control-text",r.textContent=e.label,e.isDisabled&&i.classList.add("disabled"),e.isHidden&&i.classList.add("hide"),i.appendChild(n),i.appendChild(r),e.onClick&&!e.isDisabled&&i.addEventListener("click",e.onClick),t.appendChild(i)}),t}([this.config._isFileMode?{id:"dynamsoft-mrz-scanResult-cancel",icon:(null===(e=null==u?void 0:u.cancel)||void 0===e?void 0:e.icon)||Cr.cancel,label:(null===(t=null==u?void 0:u.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(i=null==u?void 0:u.cancel)||void 0===i?void 0:i.className)||""}`,isHidden:(null===(n=null==u?void 0:u.cancel)||void 0===n?void 0:n.isHidden)||!1}:{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(s=null==u?void 0:u.rescan)||void 0===s?void 0:s.icon)||Cr.rescan,label:(null===(r=null==u?void 0:u.rescan)||void 0===r?void 0:r.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(a=null==u?void 0:u.rescan)||void 0===a?void 0:a.className)||""}`,isHidden:(null===(o=null==u?void 0:u.rescan)||void 0===o?void 0:o.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(l=null==u?void 0:u.done)||void 0===l?void 0:l.icon)||Cr.complete,label:(null===(c=null==u?void 0:u.done)||void 0===c?void 0:c.label)||"Done",className:`${(null===(d=null==u?void 0:u.done)||void 0===d?void 0:d.className)||""}`,isHidden:(null===(h=null==u?void 0:u.done)||void 0===h?void 0:h.isHidden)||!1,onClick:()=>this.handleDone()}])}getImagesToDisplay(){const e=[],t=this.resources.result;if(!t)return e;if(this.resources.returnOriginalImage){const i=t.getOriginalImage(Qs.MRZ);i&&e.push({imageData:i,label:"Original Image (MRZ Side)"});const n=t.getOriginalImage(Qs.Opposite);n&&e.push({imageData:n,label:"Original Image (Portrait Side)"})}if(this.resources.returnDocumentImage){const i=t.getDocumentImage(Qs.MRZ);i&&e.push({imageData:i,label:"Document Image (MRZ Side)"});const n=t.getDocumentImage(Qs.Opposite);n&&e.push({imageData:n,label:"Document Image (Portrait Side)"})}if(this.resources.returnPortraitImage){const i=t.getPortraitImage();i&&e.push({imageData:i,label:"Portrait Image"})}return e}createImagesDisplay(){const e=this.getImagesToDisplay();if(0===e.length)return null;const t=document.createElement("div");return t.className="dynamsoft-mrz-images-container",e.forEach(({imageData:e,label:i})=>{const n=document.createElement("div");n.className="dynamsoft-mrz-image-wrapper";const s=document.createElement("div");let r;s.className="dynamsoft-mrz-image-label",s.textContent=i,n.appendChild(s),(null==e?void 0:e.toCanvas)&&(r=e.toCanvas()),r&&(Object.assign(r.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),n.appendChild(r)),t.appendChild(n)}),t}handleFieldEdit(e,t){if(e===fr.DateOfBirth||e===fr.DateOfExpiry)try{const[i,n,s]=t.split(/[\/\-\.]/);s&&n&&i&&(this.editedFields[e]={day:parseInt(s,10),month:parseInt(n,10),year:parseInt(i,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[e]=t}createMRZDataDisplay(){var e,t,i,n;const s=(null===(e=this.resources.result)||void 0===e?void 0:e.data)||{},r=!!this.config.allowResultEditing,a=s.invalidFields||[],o=[fr.InvalidFields,fr.IssuingStateRaw,fr.NationalityRaw];!1===(null===(t=this.config)||void 0===t?void 0:t.showMRZText)&&o.push(fr.MRZText);const l=document.createElement("div");if(l.className="dynamsoft-mrz-data-container",dr(s)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText=null!==(n=null===(i=this.config)||void 0===i?void 0:i.emptyResultMessage)&&void 0!==n?n:"The necessary information could not be detected. Please try again.",l.appendChild(e),l}if(a.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${Cr.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${r?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,l.appendChild(e)}else if(0===a.length&&r){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${Cr.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,l.appendChild(e)}return Object.entries(s).forEach(([e,t])=>{if(o.includes(e)||!t)return;const i=document.createElement("div");i.className="dynamsoft-mrz-data-row";const n=a.includes(e);n&&i.classList.add("invalid-field");const s=[fr.MRZText,fr.DocumentType,fr.IssuingStateRaw,fr.NationalityRaw],c=document.createElement("span");if(c.className="dynamsoft-mrz-data-label",c.innerText=mr[e]||e,n){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=Cr.failed,c.appendChild(e),r){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",c.appendChild(e)}}const d=document.createElement("div");if(d.className="dynamsoft-mrz-data-value",r&&!s.includes(e)){const s=document.createElement("input");s.className="dynamsoft-mrz-data-input",n&&s.classList.add("invalid"),e===fr.DateOfBirth||e===fr.DateOfExpiry?(s.value=Er(t),s.setAttribute("placeholder","YYYY-MM-DD")):s.value=t,s.addEventListener("input",t=>{if(this.handleFieldEdit(e,t.target.value),n){s.classList.remove("invalid"),i.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...a]);const t=this.editedFields.invalidFields.indexOf(e);t>-1&&this.editedFields.invalidFields.splice(t,1)}}),d.appendChild(s)}else e===fr.MRZText?(d.classList.add("code"),d.innerText=t):e===fr.DateOfBirth||e===fr.DateOfExpiry?d.innerText=Er(t):d.innerText=t,n&&d.classList.add("invalid-value");i.appendChild(c),i.appendChild(d),l.appendChild(i)}),l}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");cr("dynamsoft-mrz-result-view-style",Sr);const e=document.createElement("div");e.className="dynamsoft-mrz-result-view-container";const t=this.createImagesDisplay();t&&e.appendChild(t);const i=this.createMRZDataDisplay();e.appendChild(i);const n=this.createControls();e.appendChild(n),lr(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){lr(this.config.container).style.display="none"}dispose(e=!1){lr(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const Sr="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-images-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    width: 100%;\n    max-height: 300px;\n    overflow-y: auto;\n    padding: 1rem;\n    background-color: #323234;\n  }\n\n  .dynamsoft-mrz-image-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    background: #2a2a2c;\n    padding: 0.75rem;\n    border-radius: 6px;\n    border: 1px solid #404042;\n  }\n\n  .dynamsoft-mrz-image-label {\n    font-size: 0.85rem;\n    color: #aaa;\n    text-align: center;\n    font-weight: 500;\n    margin-bottom: 0.25rem;\n  }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: #fe8e14;\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-images-container{\n      flex: 1;\n      height: 100%;\n      max-height: none;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",Dr={rootDirectory:"./resources/",dcvBundle:"./resources/dynamsoft-capture-vision-bundle@3.4.1000-dev-20260214095351/dist/",dcvData:"./resources/dynamsoft-capture-vision-data@1.2.0-dev-20260121170704/"};class Ar{showLoadingOverlay(e){var t,i;const n=lr(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||lr(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen=gr(n,{message:e}),n.style.display="block",n.style.position="relative"}hideLoadingOverlay(e=!1){var t,i,n;const s=lr(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||lr(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,s.style.display="none",e&&(null===(n=this.config)||void 0===n?void 0:n.container)&&(lr(this.config.container).style.display="none"))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources()}async initialize(){var e,t,i;if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};cr("dynamsoft-mrz-loading-screen-style",pr),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e},this.resources.returnOriginalImage=null!==(e=this.config.returnOriginalImage)&&void 0!==e&&e,this.resources.returnDocumentImage=null===(t=this.config.returnDocumentImage)||void 0===t||t,this.resources.returnPortraitImage=null===(i=this.config.returnPortraitImage)||void 0===i||i;const n={};return!this.isFileMode&&this.config.scannerViewConfig&&(this.scannerView=new vr(this.resources,this.config.scannerViewConfig),n.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new Tr(this.resources,this.config.resultViewConfig,this.scannerView),n.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:n}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;throw console.error(t),new Error(t)}finally{this.hideLoadingOverlay(!0)}}initializeDynamsoftResources(){var e;Ge.engineResourcePaths=dr(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?Dr:this.config.engineResourcePaths,Ge.loadWasm(),qn.loadSpec("MRTD"),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t,i,n;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),on._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=mrz&deploymenttype=web)"),await on.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await ct.createInstance((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath)||(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.cameraEnhancerUIPath)),this.resources.cameraEnhancer=await lt.createInstance(this.resources.cameraView)),this.resources.cvRouter=await ki.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath)}catch(e){let t="string"==typeof e?e:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:"object"==typeof e?JSON.stringify(e):String(e);const i=(null==t?void 0:t.toLowerCase().includes("license"))?"The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(i),new Error(i)}}shouldCreateDefaultContainer(){var e,t;const i=!this.config.container,n=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return i&&n}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,i,n,s,r,a,o;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)&&(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!lr(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)&&!lr(null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.resultViewConfig)||void 0===a?void 0:a.container)&&!lr(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var e,t,i,n,s,r,a,o;this.config=null!==(e=this.config)&&void 0!==e?e:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=lr(this.config.container));const l=this.config.container?this.createViewContainers(lr(this.config.container)):{},c={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(Ks).map(e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||ar[e]]})),templateFilePath:(null===(t=this.config)||void 0===t?void 0:t.templateFilePath)||"./dist/mrz-scanner.template.json"},d=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:l[er.Scanner]||lr(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.container)||null,cameraEnhancerUIPath:(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.uiPath)||(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.cameraEnhancerUIPath)||"./dist/mrz-scanner.ui.html",templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(a=null===(r=this.config.scannerViewConfig)||void 0===r?void 0:r.enableMultiFrameCrossFilter)||void 0===a||a,mrzFormatType:this.config.mrzFormatType}),h=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{_isFileMode:this.isFileMode,container:l[er.Result]||lr(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},c),{scannerViewConfig:d,resultViewConfig:h})),!0}createViewContainers(e){e.textContent="";const t=[er.Scanner];return this.showResultView()&&t.push(er.Result),t.reduce((t,i)=>{const n=document.createElement("div");return n.className=`mrz-scanner-${i}-view-container`,Object.assign(n.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(n),t[i]=n,t},{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const i=e=>{const t=lr(e);t&&(t.style.display="none",t.textContent="")};i(this.config.container),i(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),i(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async processUploadedFile(e){var t,i,n,s,r,a,o;try{this.showLoadingOverlay("Processing File...");const{cvRouter:l}=this.resources,c=null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t.all,d=await l.getSimplifiedSettings(c);d.roiMeasuredInPercentage=!0,d.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await l.updateSettings(c,d);const h=await l.capture(e,c),u=h.items,g=u.filter(e=>e.type===le.CRIT_ORIGINAL_IMAGE)[0].imageData;g.toCanvas=()=>P(g),g.toBlob=async()=>await k("image/png",g);const p=null===(i=null==h?void 0:h.parsedResult)||void 0===i?void 0:i.parsedResultItems;let f={};if(null==p?void 0:p.length){const e=(null===(s=null===(n=p[0])||void 0===n?void 0:n.referenceItem)||void 0===s?void 0:s.text)||"";f=Ir(e,p[0])}let m=null,_=null;if(this.resources.returnDocumentImage)try{const e=h.processedDocumentResult;if((null===(r=null==e?void 0:e.detectedQuadResultItems)||void 0===r?void 0:r.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==me.CVS_FAILED&&(_=t.location,m=await nr.cropAndDeskewImage(g,_),m.toCanvas=()=>P(m),m.toBlob=async()=>await k("image/png",m))}}catch(e){console.warn("Error extracting document image from static file:",e)}let E=null;if(this.resources.returnPortraitImage)try{const e=await sr.findPortraitZone();if(e&&!e.errorCode){let t=!0;if(_){const i=_.points,n=e.points.every(e=>{let t=!1;for(let n=0,s=i.length-1;n<i.length;s=n++){const r=i[n].x,a=i[n].y,o=i[s].x,l=i[s].y;a>e.y!=l>e.y&&e.x<(o-r)*(e.y-a)/(l-a)+r&&(t=!t)}return t});t=n&&_.area/e.area>=3}t&&(E=await nr.cropAndDeskewImage(g,e),E.toCanvas=()=>P(E),E.toBlob=async()=>await k("image/png",E))}}catch(e){console.warn("Error finding portrait zone in static file:",e)}const y=new Rr({status:or.RS_SUCCESS,data:f,primaryOriginalImage:g,primaryDocumentImage:m,portraitImage:E});null===(o=(a=this.resources).onResultUpdated)||void 0===o||o.call(a,y)}catch(e){return console.error("Failed to process uploaded file:",e),new Rr({status:or.RS_FAILED})}finally{this.hideLoadingOverlay(!1)}}async launch(e){var t;if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0,this.isFileMode=!!e;const{components:i}=await this.initialize();if(this.config.container&&(lr(this.config.container).style.display="block"),this.isFileMode)return await this.processUploadedFile(e),i.resultView?await i.resultView.launch():this.resources.result;if(!i.scannerView&&this.resources.result)return i.resultView?await i.resultView.launch():this.resources.result;if(!i.scannerView)throw new Error("Scanner view is required when no previous result exists");const n=await i.scannerView.launch();return(null==n?void 0:n.status)!==or.RS_SUCCESS?new Rr({status:null!==(t=null==n?void 0:n.status)&&void 0!==t?t:or.RS_FAILED}):i.resultView?await i.resultView.launch():this.resources.result}catch(e){return alert((null==e?void 0:e.message)||e),console.error((null==e?void 0:e.message)||e),new Rr({status:or.RS_FAILED})}finally{this.isCapturing=!1,this.dispose()}}}const br={MRZScanner:Ar,MRZScannerView:vr,MRZResultView:Tr};export{mn as BarcodeReaderModule,rt as Beep,tt as Camera,lt as CameraEnhancer,ct as CameraView,ki as CaptureVisionRouter,ai as CaptureVisionRouterModule,Bi as CapturedResultReceiver,Hn as CodeParser,qn as CodeParserModule,Ge as CoreModule,ar as DEFAULT_TEMPLATE_NAMES,ts as DocumentNormalizerModule,vt as DrawingItem,Rt as DrawingLayer,It as DrawingStyleManager,br as DynamsoftMRZScanner,_n as EnumBarcodeFormat,r as EnumBufferOverflowProtectionMode,le as EnumCapturedResultItemType,a as EnumColourChannelUsageType,ce as EnumCornerType,me as EnumCrossVerificationStatus,Rn as EnumDeblurMode,Qs as EnumDocumentSide,Mt as EnumDrawingItemMediaType,Ot as EnumDrawingItemState,Lt as EnumEnhancedFeatures,de as EnumErrorCode,En as EnumExtendedBarcodeResultType,Xs as EnumFilterType,he as EnumGrayscaleEnhancementMode,ue as EnumGrayscaleTransformationMode,Re as EnumImageCaptureDistanceMode,is as EnumImageColourMode,Ie as EnumImageFileFormat,o as EnumImagePixelFormat,oi as EnumImageSourceState,ge as EnumImageTagType,_e as EnumIntermediateResultUnitType,In as EnumLocalizationMode,fr as EnumMRZData,Js as EnumMRZDocumentType,Ks as EnumMRZScanMode,er as EnumMRZScannerViews,Nn as EnumMappingStatus,we as EnumModuleName,pe as EnumPDFReadingMode,Nt as EnumPixelFormat,Ui as EnumPresetTemplate,yn as EnumQRCodeErrorCorrectionLevel,fe as EnumRasterDataSource,Ln as EnumRawTextLineStatus,Ee as EnumRegionObjectElementType,or as EnumResultStatus,ye as EnumSectionType,Pn as EnumValidationStatus,pt as Feedback,st as FramePipeline,sr as IdentityProcessor,rr as IdentityUtilityModule,ir as ImageDrawer,Wt as ImageEditorView,tr as ImageIO,nr as ImageProcessor,ne as ImageSourceAdapter,Fi as IntermediateResultReceiver,Pt as KPainter,Mn as LabelRecognizerModule,on as LicenseManager,cn as LicenseModule,mr as MRZDataLabel,Tr as MRZResultView,Ar as MRZScanner,vr as MRZScannerView,Zs as MultiFrameResultCrossFilter,Tt as QuadDrawingItem,cs as UtilityModule,ut as _bufferToCanvas,wt as _isPointInPolygon,N as _saveToFile,k as _toBlob,P as _toCanvas,x as _toImage,Pe as bDebug,at as beep,V as blobToDsImage,M as checkIsLink,O as compareVersion,F as createImageData,W as d,Er as displayMRZDate,Te as doOrWaitAsyncDependency,G as e,B as encodeBMP,Me as getNextTaskID,L as handleEngineResourcePaths,Se as imagePtrToUint8Array,ke as innerVersions,m as isArc,_ as isContour,R as isDSImageData,w as isDSRect,y as isDsImageKeyValue,v as isImageTag,C as isLineSegment,f as isObject,I as isOriginalDsImageData,T as isPoint,S as isPolygon,D as isQuad,A as isRect,U as isSimdSupported,ve as mapAsyncDependency,Be as mapPackageRegister,Oe as mapTaskCallBack,Le as onLog,H as productNameMap,b as requestResource,De as resolveDsImageData,xe as setBDebug,Ne as setOnLog,Ye as stringToHtml,On as utilsFuncs,ot as vibrate,Ce as waitAsyncDependency,Ae as worker,Fe as workerAutoResources};
