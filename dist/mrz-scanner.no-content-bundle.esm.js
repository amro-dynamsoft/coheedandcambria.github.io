import{EnumValidationStatus as e,MultiFrameResultCrossFilter as t,EnumCapturedResultItemType as n,CapturedResultReceiver as i,_toCanvas as a,_toBlob as s,EnumCrossVerificationStatus as o,ImageProcessor as r,IdentityProcessor as l,EnumImagePixelFormat as c,Feedback as d,CoreModule as u,CodeParserModule as h,LicenseManager as m,CameraView as g,CameraEnhancer as p,CaptureVisionRouter as f}from"@dynamsoft/dynamsoft-capture-vision-bundle";export*from"@dynamsoft/dynamsoft-capture-vision-bundle";var y,w,v,S;!function(e){e.MRZ="mrz",e.Opposite="opposite"}(y||(y={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2",e.PassportAndTD1="passportAndTd1",e.PassportAndTD2="passportAndTd2",e.TD1AndTD2="td1AndTd2",e.All="all"}(w||(w={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2"}(v||(v={})),function(e){e.Scanner="scanner",e.Result="scan-result"}(S||(S={}));const D={[w.Passport]:"ReadPassport",[w.TD1]:"ReadId-TD1",[w.TD2]:"ReadId-TD2",[w.PassportAndTD1]:"ReadPassportAndId-TD1",[w.PassportAndTD2]:"ReadPassportAndId-TD2",[w.TD1AndTD2]:"ReadId",[w.All]:"ReadPassportAndId"};var R;function E(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}!function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(R||(R={}));function C(e,t){if(!document.getElementById(e)){const n=document.createElement("style");n.id=e,n.textContent=t,document.head.appendChild(n)}}const I=e=>!e||0===Object.keys(e).length;function M(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}const T={"4k":{width:3840,height:2160},"2k":{width:2560,height:1440},"1080p":{width:1920,height:1080},"720p":{width:1280,height:720},"480p":{width:640,height:480}};function b(e,t={}){const{message:n,spinnerSize:i=32}=t,a=document.createElement("div");a.className="dynamsoft-mrz-loading-screen";const s=document.createElement("div");s.className="dynamsoft-mrz-loading";const o=document.createElement("div");o.className="dynamsoft-mrz-loading-content";const r=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${i}" \n      height="${i}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(o.innerHTML=r,n){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=n,o.appendChild(e)}return s.appendChild(o),a.appendChild(s),e.appendChild(a),{element:a,updateMessage:e=>{let t=s.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,o.appendChild(t)):null==t||t.remove()},hide:()=>{a&&a.parentNode&&(a.classList.add("fade-out"),setTimeout(()=>{var e;null===(e=a.parentNode)||void 0===e||e.removeChild(a)},200))}}}const x='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var z;!function(e){e.InvalidFields="invalidFields",e.DocumentType="documentType",e.DocumentNumber="documentNumber",e.MRZText="mrzText",e.FirstName="firstName",e.LastName="lastName",e.Age="age",e.Sex="sex",e.IssuingState="issuingState",e.IssuingStateRaw="issuingStateRaw",e.Nationality="nationality",e.NationalityRaw="nationalityRaw",e.DateOfBirth="dateOfBirth",e.DateOfExpiry="dateOfExpiry",e.OptionalData1="optionalData1",e.OptionalData2="optionalData2"}(z||(z={}));const P={[z.InvalidFields]:"Invalid Fields",[z.DocumentType]:"Document Type",[z.DocumentNumber]:"Document Number",[z.MRZText]:"MRZ Text",[z.FirstName]:"Given Name(s)",[z.LastName]:"Surname",[z.Age]:"Age",[z.Sex]:"Sex",[z.IssuingState]:"Issuing State",[z.IssuingStateRaw]:"Issuing State (Raw Value)",[z.Nationality]:"Nationality",[z.NationalityRaw]:"Nationality State (Raw Value)",[z.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[z.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)",[z.OptionalData1]:"Optional Data 1",[z.OptionalData2]:"Optional Data 2"};function F(e,t,n,i=!1){const a=parseInt(e,10);let s;if(i)s=a>=60?1900+a:2e3+a;else{s=a>(new Date).getFullYear()%100?1900+a:2e3+a}return{year:s,month:parseInt(t,10),day:parseInt(n,10)}}function V(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function O(e){return"D<<"===e?"D":e}function _(t,n){const i=[],a=t=>n.getFieldValidationStatus(t)===e.VS_FAILED,s=n.codeType,o=function(e){switch(e){case"MRTD_TD1_ID":return v.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return v.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return v.Passport;default:throw new Error(`Unknown document type: ${e}`)}}(s),r=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(s),l=o===v.Passport&&"MRTD_TD3_PASSPORT"===s?"passportNumber":"documentNumber",c=F(n.getFieldValue("birthYear"),n.getFieldValue("birthMonth"),n.getFieldValue("birthDay")),d=F(n.getFieldValue("expiryYear"),n.getFieldValue("expiryMonth"),n.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach(e=>{a(e)&&i.push(z.DateOfBirth)}),["expiryYear","expiryMonth","expiryDay"].forEach(e=>{a(e)&&i.push(z.DateOfExpiry)});const u={[z.LastName]:n.getFieldValue("primaryIdentifier"),[z.FirstName]:n.getFieldValue("secondaryIdentifier"),[z.Nationality]:n.getFieldValue("nationality"),[z.NationalityRaw]:O(n.getFieldRawValue("nationality")),[z.DocumentNumber]:n.getFieldValue(l)||n.getFieldValue("longDocumentNumber"),[z.IssuingState]:n.getFieldValue("issuingState"),[z.IssuingStateRaw]:O(n.getFieldRawValue("issuingState")),[z.Sex]:M(n.getFieldValue("sex"))};Object.keys(u).forEach(e=>{let t=!1;switch(e){case z.FirstName:t=a("secondaryIdentifier");break;case z.LastName:t=a("primaryIdentifier");break;case z.DocumentNumber:t=a(l)||a("longDocumentNumber");break;default:t=a(e)}t&&i.push(e)});const h=function(e){const t=new Date,n=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(n?0:1)}(c);h<1&&i.push(z.Age);return{[z.InvalidFields]:i,[z.FirstName]:u[z.FirstName],[z.LastName]:u[z.LastName],[z.Age]:h,[z.DateOfBirth]:c,[z.Sex]:u[z.Sex],[z.Nationality]:u[z.Nationality],[z.NationalityRaw]:u[z.NationalityRaw],[z.DocumentNumber]:u[z.DocumentNumber],[z.DateOfExpiry]:d,[z.IssuingState]:u[z.IssuingState],[z.IssuingStateRaw]:u[z.IssuingStateRaw],[z.DocumentType]:M(r),[z.MRZText]:t}}class L{constructor(e){var t,n,i,a,s;this._primaryOriginalImage=null,this._secondaryOriginalImage=null,this._primaryDocumentImage=null,this._secondaryDocumentImage=null,this._portraitImage=null,this.status=e.status,this.data=e.data,this._primaryOriginalImage=null!==(t=e.primaryOriginalImage)&&void 0!==t?t:null,this._secondaryOriginalImage=null!==(n=e.secondaryOriginalImage)&&void 0!==n?n:null,this._primaryDocumentImage=null!==(i=e.primaryDocumentImage)&&void 0!==i?i:null,this._secondaryDocumentImage=null!==(a=e.secondaryDocumentImage)&&void 0!==a?a:null,this._portraitImage=null!==(s=e.portraitImage)&&void 0!==s?s:null}getDocumentImage(e){return e===y.MRZ?this._primaryDocumentImage:this._secondaryDocumentImage}getOriginalImage(e){return e===y.MRZ?this._primaryOriginalImage:this._secondaryOriginalImage}getPortraitImage(){return this._portraitImage}}const A={[v.TD1]:{width:85.6,height:53.98},[v.TD2]:{width:105,height:74},[v.Passport]:{width:125,height:88}};class N{showScannerLoadingOverlay(e){const t=E(this.config.container);this.loadingScreen=b(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(E(this.config.container).style.display="none"))}constructor(e,t){this.resources=e,this.config=t,this.isSoundFeedbackOn=!1,this.scanModeManager={[v.Passport]:!0,[v.TD1]:!0,[v.TD2]:!0},this.currentScanMode=w.All,this.resizeTimer=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedDCE=!1,this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.flipTimeoutHandle=null,this.flipCountdownHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null},this.DCE_ELEMENTS={selectCameraBtn:null,uploadImageBtn:null,soundFeedbackBtn:null,closeScannerBtn:null,scanModeSelectContainer:null,passportModeOption:null,td1ModeOption:null,td2ModeOption:null,toast:null},this.statusMessageElement=null,this.loadingScreen=null,this.handleResize=()=>{this.toggleScanGuide(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.toggleScanGuide(!0)},500)},this.firstFrame=!0}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),C("dynamsoft-mrz-loading-screen-style",x);try{const{cameraView:e,cameraEnhancer:a,cvRouter:s}=this.resources;if(e.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),e.setVideoFit("cover"),s.setInput(a),!0===this.config.enableMultiFrameCrossFilter){const e=new t;e.enableResultCrossVerification(n.CRIT_TEXT_LINE,!0),await s.addResultFilter(e)}const o=new i;o.onCapturedResultReceived=e=>this.handleMRZResult(e),await s.addResultReceiver(o),this.toggleSoundFeedback(!1),!1===this.config.showScanGuide&&this.toggleScanGuide(!1),this.initialized=!0}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n=new L({status:R.RS_FAILED});this.currentScanResolver(n)}}}initializeElements(){var e;const t=E(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))throw new Error("Shadow root not found");if(this.DCE_ELEMENTS={selectCameraBtn:n.shadowRoot.querySelector(".dce-mn-select-camera-icon"),uploadImageBtn:n.shadowRoot.querySelector(".dce-mn-upload-image-icon"),soundFeedbackBtn:n.shadowRoot.querySelector(".dce-mn-sound-feedback"),closeScannerBtn:n.shadowRoot.querySelector(".dce-mn-close"),scanModeSelectContainer:n.shadowRoot.querySelector(".dce-mn-scan-mode-select"),passportModeOption:n.shadowRoot.querySelector(".scan-mode-option-passport"),td1ModeOption:n.shadowRoot.querySelector(".scan-mode-option-td1"),td2ModeOption:n.shadowRoot.querySelector(".scan-mode-option-td2"),toast:n.shadowRoot.querySelector(".dce-mn-toast")},this.setupScanModeSelector(),this.assignDCEClickEvents(),this.DCE_ELEMENTS.toast.style.display="none",!1===this.config.showUploadImage&&(this.DCE_ELEMENTS.uploadImageBtn.style.visibility="hidden"),!1===this.config.showSoundToggle&&(this.DCE_ELEMENTS.soundFeedbackBtn.style.visibility="hidden"),!1===(null===(e=this.config)||void 0===e?void 0:e.showPoweredByDynamsoft)){n.shadowRoot.querySelector(".dce-mn-msg-poweredby").style.display="none"}this.initializedDCE=!0}setupScanModeSelector(){if(!1!==this.config.showFormatSelector)switch(this.currentScanMode){case w.PassportAndTD1:this.DCE_ELEMENTS.td2ModeOption.style.display="none";break;case w.PassportAndTD2:this.DCE_ELEMENTS.td1ModeOption.style.display="none";break;case w.TD1AndTD2:this.DCE_ELEMENTS.passportModeOption.style.display="none";break;case w.All:break;default:this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}else this.DCE_ELEMENTS.scanModeSelectContainer.style.display="none"}assignDCEClickEvents(){if(!Object.values(this.DCE_ELEMENTS).every(Boolean))throw new Error("Camera control elements not found");this.closeCamera=this.closeCamera.bind(this),this.DCE_ELEMENTS.uploadImageBtn.onclick=()=>this.uploadFile(),this.DCE_ELEMENTS.soundFeedbackBtn.onclick=()=>this.toggleSoundFeedback(),this.DCE_ELEMENTS.closeScannerBtn.onclick=()=>this.handleCloseBtn(),this.DCE_ELEMENTS.selectCameraBtn.onclick=e=>{e.stopPropagation(),this.toggleSelectCameraBox()},this.DCE_ELEMENTS.passportModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.passportModeOption.style.display&&await this.toggleScanDocType(v.Passport)},this.DCE_ELEMENTS.td1ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td1ModeOption.style.display&&await this.toggleScanDocType(v.TD1)},this.DCE_ELEMENTS.td2ModeOption.onclick=async()=>{"none"!==this.DCE_ELEMENTS.td2ModeOption.style.display&&await this.toggleScanDocType(v.TD2)}}handleCloseBtn(){if(this.closeCamera(),this.currentScanResolver)if(this.isMRZScanned&&!this.isPortraitScanned&&(this.areSidesDifferent||this.isWaitingForPortraitAfterMRZ)){const e=new L({status:R.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:this.mrzSideData.portraitImage});this.currentScanResolver(e),this.resetScanningState()}else this.currentScanResolver(new L({status:R.RS_CANCELLED})),this.resetScanningState()}attachOptionClickListeners(){const e=E(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings");[...t.shadowRoot.querySelectorAll(".dce-mn-camera-option"),...t.shadowRoot.querySelectorAll(".dce-mn-resolution-option")].forEach(e=>{e.addEventListener("click",async t=>{const i=e.getAttribute("data-davice-id"),a=e.getAttribute("data-height"),s=e.getAttribute("data-width");i?this.resources.cameraEnhancer.selectCamera(i).then(()=>{this.toggleScanGuide()}):a&&s&&this.resources.cameraEnhancer.setResolution({width:parseInt(s),height:parseInt(a)}).then(()=>{this.toggleScanGuide()}),"none"!==n.style.display&&this.toggleSelectCameraBox()})})}highlightCameraAndResolutionOption(){const e=E(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-camera-and-resolution-settings"),i=n.querySelectorAll(".dce-mn-camera-option"),a=n.querySelectorAll(".dce-mn-resolution-option"),s=this.resources.cameraEnhancer.getSelectedCamera(),o=this.resources.cameraEnhancer.getResolution();i.forEach(e=>{const t=e;t.getAttribute("data-davice-id")===(null==s?void 0:s.deviceId)?t.style.border="2px solid #fe814a":t.style.border="none"});const r={"480p":"480","720p":"720","1080p":"1080","2k":"1440","4k":"2160"},l=function(e){const t=e.width*e.height,n=e.width/e.height;let i="480p",a=Number.MAX_VALUE;for(const[e,s]of Object.entries(T)){const o=s.width*s.height,r=s.width/s.height,l=.7*Math.abs(o-t)+Math.abs(r-n)*o*.3;l<a&&(a=l,i=e)}return i}(o);a.forEach(e=>{const t=e,n=t.getAttribute("data-height");t.style.border=n===r[l]?"2px solid #fe814a":"none"})}toggleSelectCameraBox(){const e=E(this.config.container),t=e.children[e.children.length-1];if(!(null==t?void 0:t.shadowRoot))return;const n=t.shadowRoot.querySelector(".dce-mn-resolution-box");this.highlightCameraAndResolutionOption(),this.attachOptionClickListeners(),n.click()}async relaunch(){}async uploadFile(){var e,t,i,c,d,u,h;const{cvRouter:m}=this.resources,g=document.createElement("input");g.type="file",g.accept=null!==(e=this.config.uploadAcceptedTypes)&&void 0!==e?e:"image/*",g.style.display="none",document.body.appendChild(g);try{this.showScannerLoadingOverlay("Processing file..."),await this.closeCamera(!1);const e=await new Promise((e,t)=>{g.onchange=n=>{var i;const a=null===(i=n.target.files)||void 0===i?void 0:i[0];a?e(a):t(new Error("No file selected"))},g.addEventListener("cancel",async()=>{this.hideScannerLoadingOverlay(!1),this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay()}),g.click()});if(!e)return;let p;if(this.config.uploadFileConverter&&!e.type.startsWith("image/"))try{p=await this.config.uploadFileConverter(e)}catch(e){throw new Error(`Error converting file: ${e.message}`)}else{if(!e.type.startsWith("image/"))throw new Error("Unsupported file type. Please provide a converter function for this file type.");p=e}const f=this.config.utilizedTemplateNames[this.currentScanMode],y=await m.capture(p,f);this.capturedResultItems=y.items;const w=this.capturedResultItems.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(0===w.length)throw new Error("No image data found in the captured result");const v=w[0].imageData;v.toCanvas=()=>a(v),v.toBlob=async()=>await s("image/png",v),this.originalImageData=v;const S=null===(t=null==y?void 0:y.parsedResult)||void 0===t?void 0:t.parsedResultItems;let D={};if(null==S?void 0:S.length){const e=(null===(c=null===(i=S[0])||void 0===i?void 0:i.referenceItem)||void 0===c?void 0:c.text)||"";D=_(e,S[0])}let E=null,C=null;if(this.resources.returnDocumentImage)try{const e=y.processedDocumentResult;if((null===(d=null==e?void 0:e.detectedQuadResultItems)||void 0===d?void 0:d.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==o.CVS_FAILED&&(C=t.location,E=await r.cropAndDeskewImage(this.originalImageData,C),E.toCanvas=()=>a(E),E.toBlob=async()=>await s("image/png",E))}}catch(e){console.warn("Error extracting document image from file upload:",e)}let I=null;if(this.resources.returnPortraitImage)try{const e=await l.findPortraitZone();if(e&&!e.errorCode){(!C||this.validatePortraitLocation(e,C))&&(I=await r.cropAndDeskewImage(this.originalImageData,e),I.toCanvas=()=>a(I),I.toBlob=async()=>await s("image/png",I))}}catch(e){console.warn("Error finding portrait zone in file upload:",e)}const M=new L({status:R.RS_SUCCESS,data:D,primaryOriginalImage:this.originalImageData,primaryDocumentImage:E,portraitImage:I});null===(h=(u=this.resources).onResultUpdated)||void 0===h||h.call(u,M),this.currentScanResolver(M)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new L({status:R.RS_FAILED}))}finally{this.hideScannerLoadingOverlay(!0),document.body.removeChild(g)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn;const t=E(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-mn-sound-feedback"),a=i.querySelector(".dce-mn-sound-feedback-on");i.querySelector(".dce-mn-sound-feedback-off").style.display=this.isSoundFeedbackOn?"none":"block",a.style.display=this.isSoundFeedbackOn?"block":"none"}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:n}=this.resources;if(!t||!t.isOpen())return;const i=A[e].width/A[e].height;let a;const s=n.getVisibleRegionOfVideo({inPixels:!0}),{width:o,height:r}=s;if(s){if(s.width>s.height){const e=.5*r*i,t=Math.round(e/o*100),n=(100-t)/2;a={left:n,right:n+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*o/i,t=Math.round(e/r*100),n=(100-t)/2;a={left:5,right:95,top:n,bottom:n+t,isMeasuredInPercentage:!0}}null==n||n.setScanRegionMaskVisible(!0),t.setScanRegion(a)}}toggleScanGuide(e){const t=E(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;const i=n.shadowRoot.querySelector(".dce-scanguide-passport"),a=n.shadowRoot.querySelector(".dce-scanguide-td1"),s=n.shadowRoot.querySelector(".dce-scanguide-td2");if(!1===e||!1===this.config.showScanGuide)return i.style.display="none",a.style.display="none",void(s.style.display="none");switch(this.currentScanMode){case w.All:case w.Passport:case w.PassportAndTD1:case w.PassportAndTD2:i.style.display="block",a.style.display="none",s.style.display="none",this.calculateScanRegion(v.Passport);break;case w.TD1:case w.TD1AndTD2:i.style.display="none",a.style.display="block",s.style.display="none",this.calculateScanRegion(v.TD1);break;case w.TD2:i.style.display="none",a.style.display="none",s.style.display="block",this.calculateScanRegion(v.TD2)}}async openCamera(){try{const{cameraEnhancer:e,cameraView:t}=this.resources,n=E(this.config.container);if(n.style.display="block",e.isOpen())e.isPaused()&&await e.resume();else{const i=t.getUIElement();i.parentElement||n.append(i),e.setPixelFormat(c.IPF_ABGR_8888),await e.open();const a=i.shadowRoot;if(a){const e=a.querySelector(".dce-macro-use-mobile-native-like-ui");e&&(e.style.display="block")}}await e.setResolution({width:2560,height:1440}),!this.initializedDCE&&e.isOpen()&&await this.initializeElements(),window.addEventListener("resize",this.handleResize);const i=n.children[n.children.length-1];if(!(null==i?void 0:i.shadowRoot))throw new Error("Shadow root not found");i.shadowRoot.querySelector(".dce-mn-torch-off").style.display="none",i.shadowRoot.querySelector(".dce-mn-torch-on").style.display="none"}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new L({status:R.RS_FAILED}))}}async closeCamera(e=!0){try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null);const{cameraEnhancer:t,cameraView:n}=this.resources,i=E(this.config.container);i.style.display=e?"none":"block",(null==n?void 0:n.getUIElement().parentElement)&&i.removeChild(n.getUIElement()),t.close(),this.stopCapturing()}catch(e){let t=(null==e?void 0:e.message)||e;console.error(`Close Camera error: ${t}`)}}pauseCamera(){const{cameraEnhancer:e}=this.resources;e.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}async handleMRZResult(e){var t,i,l,c,u,h,m,g;if(this.firstFrame)this.firstFrame=!1;else{if(console.log("[MRZ DEBUG] handleMRZResult — itemTypes:",e.items.map(e=>e.type),"| isMRZScanned:",this.isMRZScanned,"| areSidesDifferent:",this.areSidesDifferent,"| isPortraitScanned:",this.isPortraitScanned,"| isWaitingForFlip:",this.isWaitingForFlip),this.isMRZScanned&&!this.isPortraitScanned&&this.isWaitingForPortraitAfterMRZ){const{onResultUpdated:t}=this.resources;return void await this.tryPortraitOnSameSide(e,t)}if(this.isMRZScanned&&!this.isPortraitScanned&&this.areSidesDifferent&&!this.isWaitingForFlip){const t=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(t.length>0){const e=t[0].imageData;e.toCanvas=()=>a(e),e.toBlob=async()=>await s("image/png",e),this.originalImageData=e}const{onResultUpdated:i}=this.resources;return void await this.handlePortraitSideScan(e,i)}if(!(e.items.length<=1)){this.capturedResultItems=e.items;try{const{onResultUpdated:p}=this.resources,f=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(f.length>0){const e=f[0].imageData;e.toCanvas=()=>a(e),e.toBlob=async()=>await s("image/png",e),this.originalImageData=e}const y=null===(t=null==e?void 0:e.parsedResult)||void 0===t?void 0:t.parsedResultItems;if(null==y?void 0:y.length){this.isSoundFeedbackOn&&d.beep();const t=(null===(l=null===(i=y[0])||void 0===i?void 0:i.referenceItem)||void 0===l?void 0:l.text)||"",n=_(t,y[0]);let f=null;if(this.resources.returnDocumentImage||this.resources.returnPortraitImage){const t=e.processedDocumentResult;if((null===(c=null==t?void 0:t.detectedQuadResultItems)||void 0===c?void 0:c.length)>0){const e=t.detectedQuadResultItems[0];e.CrossVerificationStatus!==o.CVS_FAILED&&(f=e.location)}const n=e.processedDocumentResult;if(console.log("[MRZ DEBUG] processedDocumentResult:",null==n?String(n):`detectedQuads=${null!==(h=null===(u=null==n?void 0:n.detectedQuadResultItems)||void 0===u?void 0:u.length)&&void 0!==h?h:0}, deskewedImages=${null!==(g=null===(m=null==n?void 0:n.deskewedImageResultItems)||void 0===m?void 0:m.length)&&void 0!==g?g:0}`),this.resources.returnDocumentImage&&!f)return void console.warn("[MRZ DEBUG] Skipping frame — returnDocumentImage=true but no valid documentQuad found")}let w=null;if(this.resources.returnDocumentImage&&f&&this.originalImageData)try{w=await r.cropAndDeskewImage(this.originalImageData,f),w.toCanvas=()=>a(w),w.toBlob=async()=>await s("image/png",w)}catch(e){console.warn("Error extracting document image:",e)}this.isMRZScanned||await this.handleMRZSideScan(n,w,f,p)}}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),this.currentScanResolver(new L({status:R.RS_FAILED}))}}}}initializeScanModeManager(){const{mrzFormatType:e}=this.config;if(this.scanModeManager={[v.Passport]:!0,[v.TD1]:!0,[v.TD2]:!0},!e||Array.isArray(e)&&0===e.length)return;Object.keys(this.scanModeManager).forEach(e=>{this.scanModeManager[e]=!1});(Array.isArray(e)?e:[e]).forEach(e=>{this.scanModeManager[e]=!0})}getScanMode(){const e=Object.entries(this.scanModeManager).filter(([e,t])=>t).map(([e])=>e).sort().join(",");return{[v.Passport]:w.Passport,[v.TD1]:w.TD1,[v.TD2]:w.TD2,[`${v.Passport},${v.TD1}`]:w.PassportAndTD1,[`${v.Passport},${v.TD2}`]:w.PassportAndTD2,[`${v.TD1},${v.TD2}`]:w.TD1AndTD2,[`${v.Passport},${v.TD1},${v.TD2}`]:w.All,"":w.All}[e]}DCEShowToast(e,t=3e3){this.DCE_ELEMENTS.toast&&(this.DCE_ELEMENTS.toast.textContent=e,this.DCE_ELEMENTS.toast.style.display="",setTimeout(()=>{this.DCE_ELEMENTS.toast.style.display="none"},t))}async startCapturing(){const{cvRouter:e}=this.resources,t=this.config.utilizedTemplateNames[this.currentScanMode];try{this.firstFrame=!0,await e.startCapturing(t)}catch(e){let t=(null==e?void 0:e.message)||e;console.error("Failed to start capturing:",t),this.closeCamera(),this.currentScanResolver&&this.currentScanResolver(new L({status:R.RS_FAILED}))}}async toggleScanDocType(e){try{if(this.scanModeManager[e]&&0===Object.entries(this.scanModeManager).filter(([t,n])=>n&&t!==e).length)return console.warn("MRZ Scanner - At least one mode must be enabled"),void this.DCEShowToast("At least one mode must be enabled");this.scanModeManager[e]=!this.scanModeManager[e],this.currentScanMode=this.getScanMode(),this.stopCapturing(),this.toggleScanGuide(),await this.startCapturing(),this.DCE_ELEMENTS.td1ModeOption.classList.toggle("selected",this.scanModeManager[v.TD1]),this.DCE_ELEMENTS.td2ModeOption.classList.toggle("selected",this.scanModeManager[v.TD2]),this.DCE_ELEMENTS.passportModeOption.classList.toggle("selected",this.scanModeManager[v.Passport])}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner switch scan mode error: ",t),this.closeCamera(),this.currentScanResolver(new L({status:R.RS_FAILED}))}}async launch(){try{this.resetScanningState(),await this.initialize();const{cvRouter:e,cameraEnhancer:t}=this.resources;return new Promise(async e=>{this.currentScanResolver=e,this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),!this.initializedDCE&&t.isOpen()&&await this.initializeElements(),this.toggleScanGuide(),await this.startCapturing(),this.hideScannerLoadingOverlay(),this.resources.returnPortraitImage?this.showStatusMessage("Please scan the MRZ side first"):this.showStatusMessage("Please scan the MRZ side of the document")})}catch(e){let t=(null==e?void 0:e.message)||e;console.error("MRZ Scanner launch error: ",t),this.closeCamera(),this.currentScanResolver(new L({status:R.RS_FAILED}))}}createStatusMessageElement(){const e=document.createElement("div");return e.className="dce-status-message",e.style.cssText="\n      position: absolute;\n      bottom: 25%;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 16px;\n      font-family: Verdana, sans-serif;\n      z-index: 999;\n      text-align: center;\n      max-width: 80%;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n    ",e}showStatusMessage(e,t){if(!this.statusMessageElement){const e=E(this.config.container),t=e.children[e.children.length-1];(null==t?void 0:t.shadowRoot)&&(this.statusMessageElement=this.createStatusMessageElement(),t.shadowRoot.appendChild(this.statusMessageElement))}this.statusMessageElement&&(this.statusMessageElement.textContent=e,this.statusMessageElement.style.display="block",t&&setTimeout(()=>{this.hideStatusMessage()},t))}hideStatusMessage(){this.statusMessageElement&&(this.statusMessageElement.style.display="none")}showSuccessBorder(e=1e3){const t=E(this.config.container),n=t.children[t.children.length-1];if(!(null==n?void 0:n.shadowRoot))return;[n.shadowRoot.querySelector(".dce-mn-bg-mrz-passport"),n.shadowRoot.querySelector(".dce-mn-bg-mrz-td1"),n.shadowRoot.querySelector(".dce-mn-bg-mrz-td2")].forEach(t=>{if(t&&"none"!==t.style.display){const n=t.style.border;t.style.border="3px solid #4CAF50",setTimeout(()=>{t.style.border=n},e)}})}async handleMRZSideScan(e,t,n,i){let o=null,c=!1;if(this.resources.returnPortraitImage)try{const e=await l.findPortraitZone();if(console.log("[MRZ DEBUG] findPortraitZone result:",e,"| originalImageData:",!!this.originalImageData),e&&!e.errorCode){const t=!n||this.validatePortraitLocation(e,n);console.log("[MRZ DEBUG] portrait validation — isValid:",t,"| documentQuad:",n),t&&this.originalImageData&&(o=await r.cropAndDeskewImage(this.originalImageData,e),o.toCanvas=()=>a(o),o.toBlob=async()=>await s("image/png",o),c=!0)}}catch(e){console.warn("Error finding portrait zone:",e)}if(this.isMRZScanned=!0,this.mrzSideData={processedData:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:o},this.resources.returnPortraitImage&&!c)console.log("[MRZ DEBUG] handleMRZSideScan — MRZ scanned, waiting 1s for portrait on same side..."),this.isWaitingForPortraitAfterMRZ=!0,this.flipTimeoutHandle=window.setTimeout(()=>{var e;if(this.flipTimeoutHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isPortraitScanned)return;console.log("[MRZ DEBUG] Portrait not found within 1s. Starting flip prompt."),this.areSidesDifferent=!0,this.isWaitingForFlip=!0;const t=null!==(e=this.config.flipDocumentTimeout)&&void 0!==e?e:3e3;let n=Math.ceil(t/1e3);this.showSuccessBorder(1e3),this.showStatusMessage(`MRZ scanned! Please flip the document (${n}s)`),this.flipCountdownHandle=window.setInterval(()=>{n--,n>0&&this.showStatusMessage(`Please flip the document (${n}s)`)},1e3),this.flipTimeoutHandle=window.setTimeout(()=>{window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null,this.flipTimeoutHandle=null,this.isWaitingForFlip=!1,this.showStatusMessage("Now scan the portrait side")},t)},1e3);else{this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.showSuccessBorder(1e3);const n=o?"MRZ and portrait successfully scanned!":"MRZ successfully scanned!";this.showStatusMessage(n,1e3),setTimeout(()=>{this.closeCamera();const n=new L({status:R.RS_SUCCESS,data:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:o});null==i||i(n),this.currentScanResolver(n),this.resetScanningState()},1e3)}}async tryPortraitOnSameSide(e,t){var i;if(!this.isWaitingForPortraitAfterMRZ)return;this.isWaitingForPortraitAfterMRZ=!1;let c=!1;try{const d=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(d.length>0){const e=d[0].imageData;e.toCanvas=()=>a(e),e.toBlob=async()=>await s("image/png",e),this.originalImageData=e}const u=await l.findPortraitZone();if(this.isPortraitScanned)return;if(u&&!u.errorCode){let n=null;const l=e.processedDocumentResult;if((null===(i=null==l?void 0:l.detectedQuadResultItems)||void 0===i?void 0:i.length)>0){const e=l.detectedQuadResultItems[0];e.CrossVerificationStatus!==o.CVS_FAILED&&(n=e.location)}if((!n||this.validatePortraitLocation(u,n))&&this.originalImageData){c=!0;const e=await r.cropAndDeskewImage(this.originalImageData,u);e.toCanvas=()=>a(e),e.toBlob=async()=>await s("image/png",e),null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.mrzSideData.portraitImage=e,this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const n=new L({status:R.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:e});null==t||t(n),this.currentScanResolver(n),this.resetScanningState()},1e3)}}}catch(e){console.warn("[MRZ DEBUG] tryPortraitOnSameSide — error:",e)}finally{c||null===this.flipTimeoutHandle||(this.isWaitingForPortraitAfterMRZ=!0)}}async handlePortraitSideScan(e,t){var n;if(this.isProcessingPortraitFrame)return;this.isProcessingPortraitFrame=!0,console.log("[MRZ DEBUG] handlePortraitSideScan entered — originalImageData:",!!this.originalImageData);let i=!1;try{const c=await l.findPortraitZone();if(console.log("[MRZ DEBUG] handlePortraitSideScan — findPortraitZone result:",c),c&&!c.errorCode&&this.originalImageData){i=!0,this.isPortraitScanned=!0;let l=this.originalImageData,d=null;if(this.resources.returnDocumentImage)try{const t=e.processedDocumentResult;if((null===(n=null==t?void 0:t.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const e=t.detectedQuadResultItems[0];if(e.CrossVerificationStatus!==o.CVS_FAILED){const t=e.location;d=await r.cropAndDeskewImage(this.originalImageData,t),d.toCanvas=()=>a(d),d.toBlob=async()=>await s("image/png",d)}}}catch(e){console.warn("Error extracting secondary document image:",e)}let u=null;try{u=await r.cropAndDeskewImage(this.originalImageData,c),u.toCanvas=()=>a(u),u.toBlob=async()=>await s("image/png",u)}catch(e){console.warn("Error cropping portrait image:",e)}this.showSuccessBorder(1e3),this.showStatusMessage("MRZ and portrait successfully scanned!",1e3),setTimeout(()=>{this.closeCamera();const e=new L({status:R.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,secondaryOriginalImage:l,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,secondaryDocumentImage:d,portraitImage:u||this.mrzSideData.portraitImage});null==t||t(e),this.currentScanResolver(e),this.resetScanningState()},1e3)}}catch(e){console.warn("Error finding portrait on second side:",e)}finally{i||(this.isProcessingPortraitFrame=!1)}}resetScanningState(){this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),null!==this.flipCountdownHandle&&(window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null),this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null}}validatePortraitLocation(e,t){if(!e.points.every(e=>this.isPointInQuadrilateral(e,t)))return!1;return t.area/e.area>=3}isPointInQuadrilateral(e,t){const n=t.points;let i=!1;for(let t=0,a=n.length-1;t<n.length;a=t++){const s=n[t].x,o=n[t].y,r=n[a].x,l=n[a].y;o>e.y!=l>e.y&&e.x<(r-s)*(e.y-o)/(l-o)+s&&(i=!i)}return i}}const k={cancel:'\n<svg id="cancel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cancelclip-path">\n      <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_582" data-name="Group 582" clip-path="url(#cancelclip-path)" transform="rotate(180 12 12)">\n    <path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n    <path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n  </g>\n</svg>  \n  ',rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class Z{constructor(e,t,n){this.resources=e,this.config=t,this.scannerView=n,this.editedFields={}}async launch(){try{return E(this.config.container).textContent="",await this.initialize(),E(this.config.container).style.display="flex",new Promise(e=>{this.currentScanResultViewResolver=e})}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const e=await this.scannerView.launch();if((null==e?void 0:e.status)===R.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(e));this.resources.onResultUpdated&&((null==e?void 0:e.status)===R.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==e?void 0:e.status)===R.RS_SUCCESS&&this.resources.onResultUpdated(e)),this.dispose(!0),await this.initialize(),E(this.config.container).style.display="flex"}catch(e){throw console.error("Error in rescan handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new L({status:R.RS_FAILED})),e}}async handleCancel(){var e;try{(null===(e=this.config)||void 0===e?void 0:e.onCancel)&&await this.config.onCancel(this.resources.result),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new L({status:R.RS_CANCELLED})),this.hideView(),this.dispose()}catch(e){throw console.error("Error in cancel handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new L({status:R.RS_FAILED})),e}}async handleDone(){var e,t;try{(null===(e=this.resources.result)||void 0===e?void 0:e.data)&&!I(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(e){throw console.error("Error in done handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new L({status:R.RS_FAILED})),e}}createControls(){var e,t,n,i,a,s,o,r,l,c,d,u;const{toolbarButtonsConfig:h}=this.config;return function(e){C("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach(e=>{const n=document.createElement("div");n.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const i=document.createElement("div");if(i.className="dynamsoft-mrz-control-icon-wrapper",(a=e.icon).trim().startsWith("<svg")&&a.trim().endsWith("</svg>"))i.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,i.appendChild(t)}var a;const s=document.createElement("div");s.className="dynamsoft-mrz-control-text",s.textContent=e.label,e.isDisabled&&n.classList.add("disabled"),e.isHidden&&n.classList.add("hide"),n.appendChild(i),n.appendChild(s),e.onClick&&!e.isDisabled&&n.addEventListener("click",e.onClick),t.appendChild(n)}),t}([this.config._isFileMode?{id:"dynamsoft-mrz-scanResult-cancel",icon:(null===(e=null==h?void 0:h.cancel)||void 0===e?void 0:e.icon)||k.cancel,label:(null===(t=null==h?void 0:h.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(n=null==h?void 0:h.cancel)||void 0===n?void 0:n.className)||""}`,isHidden:(null===(i=null==h?void 0:h.cancel)||void 0===i?void 0:i.isHidden)||!1}:{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(a=null==h?void 0:h.rescan)||void 0===a?void 0:a.icon)||k.rescan,label:(null===(s=null==h?void 0:h.rescan)||void 0===s?void 0:s.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(o=null==h?void 0:h.rescan)||void 0===o?void 0:o.className)||""}`,isHidden:(null===(r=null==h?void 0:h.rescan)||void 0===r?void 0:r.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(l=null==h?void 0:h.done)||void 0===l?void 0:l.icon)||k.complete,label:(null===(c=null==h?void 0:h.done)||void 0===c?void 0:c.label)||"Done",className:`${(null===(d=null==h?void 0:h.done)||void 0===d?void 0:d.className)||""}`,isHidden:(null===(u=null==h?void 0:h.done)||void 0===u?void 0:u.isHidden)||!1,onClick:()=>this.handleDone()}])}getImagesToDisplay(){const e=[],t=this.resources.result;if(!t)return e;if(this.resources.returnOriginalImage){const n=t.getOriginalImage(y.MRZ);n&&e.push({imageData:n,label:"Original Image (MRZ Side)"});const i=t.getOriginalImage(y.Opposite);i&&e.push({imageData:i,label:"Original Image (Portrait Side)"})}if(this.resources.returnDocumentImage){const n=t.getDocumentImage(y.MRZ);n&&e.push({imageData:n,label:"Document Image (MRZ Side)"});const i=t.getDocumentImage(y.Opposite);i&&e.push({imageData:i,label:"Document Image (Portrait Side)"})}if(this.resources.returnPortraitImage){const n=t.getPortraitImage();n&&e.push({imageData:n,label:"Portrait Image"})}return e}createImagesDisplay(){const e=this.getImagesToDisplay();if(0===e.length)return null;const t=document.createElement("div");return t.className="dynamsoft-mrz-images-container",e.forEach(({imageData:e,label:n})=>{const i=document.createElement("div");i.className="dynamsoft-mrz-image-wrapper";const a=document.createElement("div");let s;a.className="dynamsoft-mrz-image-label",a.textContent=n,i.appendChild(a),(null==e?void 0:e.toCanvas)&&(s=e.toCanvas()),s&&(Object.assign(s.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),i.appendChild(s)),t.appendChild(i)}),t}handleFieldEdit(e,t){if(e===z.DateOfBirth||e===z.DateOfExpiry)try{const[n,i,a]=t.split(/[\/\-\.]/);a&&i&&n&&(this.editedFields[e]={day:parseInt(a,10),month:parseInt(i,10),year:parseInt(n,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[e]=t}createMRZDataDisplay(){var e,t,n,i;const a=(null===(e=this.resources.result)||void 0===e?void 0:e.data)||{},s=!!this.config.allowResultEditing,o=a.invalidFields||[],r=[z.InvalidFields,z.IssuingStateRaw,z.NationalityRaw];!1===(null===(t=this.config)||void 0===t?void 0:t.showMRZText)&&r.push(z.MRZText);const l=document.createElement("div");if(l.className="dynamsoft-mrz-data-container",I(a)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText=null!==(i=null===(n=this.config)||void 0===n?void 0:n.emptyResultMessage)&&void 0!==i?i:"The necessary information could not be detected. Please try again.",l.appendChild(e),l}if(o.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${k.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${s?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,l.appendChild(e)}else if(0===o.length&&s){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${k.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,l.appendChild(e)}return Object.entries(a).forEach(([e,t])=>{if(r.includes(e)||!t)return;const n=document.createElement("div");n.className="dynamsoft-mrz-data-row";const i=o.includes(e);i&&n.classList.add("invalid-field");const a=[z.MRZText,z.DocumentType,z.IssuingStateRaw,z.NationalityRaw],c=document.createElement("span");if(c.className="dynamsoft-mrz-data-label",c.innerText=P[e]||e,i){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=k.failed,c.appendChild(e),s){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",c.appendChild(e)}}const d=document.createElement("div");if(d.className="dynamsoft-mrz-data-value",s&&!a.includes(e)){const a=document.createElement("input");a.className="dynamsoft-mrz-data-input",i&&a.classList.add("invalid"),e===z.DateOfBirth||e===z.DateOfExpiry?(a.value=V(t),a.setAttribute("placeholder","YYYY-MM-DD")):a.value=t,a.addEventListener("input",t=>{if(this.handleFieldEdit(e,t.target.value),i){a.classList.remove("invalid"),n.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...o]);const t=this.editedFields.invalidFields.indexOf(e);t>-1&&this.editedFields.invalidFields.splice(t,1)}}),d.appendChild(a)}else e===z.MRZText?(d.classList.add("code"),d.innerText=t):e===z.DateOfBirth||e===z.DateOfExpiry?d.innerText=V(t):d.innerText=t,i&&d.classList.add("invalid-value");n.appendChild(c),n.appendChild(d),l.appendChild(n)}),l}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");C("dynamsoft-mrz-result-view-style",B);const e=document.createElement("div");e.className="dynamsoft-mrz-result-view-container";const t=this.createImagesDisplay();t&&e.appendChild(t);const n=this.createMRZDataDisplay();e.appendChild(n);const i=this.createControls();e.appendChild(i),E(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){E(this.config.container).style.display="none"}dispose(e=!1){E(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const B="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-images-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    width: 100%;\n    max-height: 300px;\n    overflow-y: auto;\n    padding: 1rem;\n    background-color: #323234;\n  }\n\n  .dynamsoft-mrz-image-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    background: #2a2a2c;\n    padding: 0.75rem;\n    border-radius: 6px;\n    border: 1px solid #404042;\n  }\n\n  .dynamsoft-mrz-image-label {\n    font-size: 0.85rem;\n    color: #aaa;\n    text-align: center;\n    font-weight: 500;\n    margin-bottom: 0.25rem;\n  }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: #fe8e14;\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-images-container{\n      flex: 1;\n      height: 100%;\n      max-height: none;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",H={rootDirectory:"./resources/",dcvBundle:"./resources/dynamsoft-capture-vision-bundle@3.4.1000-dev-20260214095351/dist/",dcvData:"./resources/dynamsoft-capture-vision-data@1.2.0-dev-20260121170704/"};class U{showLoadingOverlay(e){var t,n;const i=E(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||E(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen=b(i,{message:e}),i.style.display="block",i.style.position="relative"}hideLoadingOverlay(e=!1){var t,n,i;const a=E(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||E(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,a.style.display="none",e&&(null===(i=this.config)||void 0===i?void 0:i.container)&&(E(this.config.container).style.display="none"))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources()}async initialize(){var e,t,n;if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};C("dynamsoft-mrz-loading-screen-style",x),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e},this.resources.returnOriginalImage=null!==(e=this.config.returnOriginalImage)&&void 0!==e&&e,this.resources.returnDocumentImage=null===(t=this.config.returnDocumentImage)||void 0===t||t,this.resources.returnPortraitImage=null===(n=this.config.returnPortraitImage)||void 0===n||n;const i={};return!this.isFileMode&&this.config.scannerViewConfig&&(this.scannerView=new N(this.resources,this.config.scannerViewConfig),i.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new Z(this.resources,this.config.resultViewConfig,this.scannerView),i.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:i}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;throw console.error(t),new Error(t)}finally{this.hideLoadingOverlay(!0)}}initializeDynamsoftResources(){var e;u.engineResourcePaths=I(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?H:this.config.engineResourcePaths,u.loadWasm(),h.loadSpec("MRTD"),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t,n,i;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),m._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=mrz&deploymenttype=web)"),await m.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await g.createInstance((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath)||(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.cameraEnhancerUIPath)),this.resources.cameraEnhancer=await p.createInstance(this.resources.cameraView)),this.resources.cvRouter=await f.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath)}catch(e){let t="string"==typeof e?e:null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"object"==typeof e?JSON.stringify(e):String(e);const n=(null==t?void 0:t.toLowerCase().includes("license"))?"The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(n),new Error(n)}}shouldCreateDefaultContainer(){var e,t;const n=!this.config.container,i=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return n&&i}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,n,i,a,s,o,r;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)&&(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!E(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.container)&&!E(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)&&!E(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var e,t,n,i,a,s,o,r;this.config=null!==(e=this.config)&&void 0!==e?e:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=E(this.config.container));const l=this.config.container?this.createViewContainers(E(this.config.container)):{},c={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(w).map(e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||D[e]]})),templateFilePath:(null===(t=this.config)||void 0===t?void 0:t.templateFilePath)||"./dist/mrz-scanner.template.json"},d=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:l[S.Scanner]||E(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.uiPath)||(null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.cameraEnhancerUIPath)||"./dist/mrz-scanner.ui.html",templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(o=null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.enableMultiFrameCrossFilter)||void 0===o||o,mrzFormatType:this.config.mrzFormatType}),u=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{_isFileMode:this.isFileMode,container:l[S.Result]||E(null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},c),{scannerViewConfig:d,resultViewConfig:u})),!0}createViewContainers(e){e.textContent="";const t=[S.Scanner];return this.showResultView()&&t.push(S.Result),t.reduce((t,n)=>{const i=document.createElement("div");return i.className=`mrz-scanner-${n}-view-container`,Object.assign(i.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(i),t[n]=i,t},{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const n=e=>{const t=E(e);t&&(t.style.display="none",t.textContent="")};n(this.config.container),n(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),n(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async processUploadedFile(e){var t,i,c,d,u,h,m;try{this.showLoadingOverlay("Processing File...");const{cvRouter:g}=this.resources,p=null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t.all,f=await g.getSimplifiedSettings(p);f.roiMeasuredInPercentage=!0,f.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await g.updateSettings(p,f);const y=await g.capture(e,p),w=y.items,v=w.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE)[0].imageData;v.toCanvas=()=>a(v),v.toBlob=async()=>await s("image/png",v);const S=null===(i=null==y?void 0:y.parsedResult)||void 0===i?void 0:i.parsedResultItems;let D={};if(null==S?void 0:S.length){const e=(null===(d=null===(c=S[0])||void 0===c?void 0:c.referenceItem)||void 0===d?void 0:d.text)||"";D=_(e,S[0])}let E=null,C=null;if(this.resources.returnDocumentImage)try{const e=y.processedDocumentResult;if((null===(u=null==e?void 0:e.detectedQuadResultItems)||void 0===u?void 0:u.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==o.CVS_FAILED&&(C=t.location,E=await r.cropAndDeskewImage(v,C),E.toCanvas=()=>a(E),E.toBlob=async()=>await s("image/png",E))}}catch(e){console.warn("Error extracting document image from static file:",e)}let I=null;if(this.resources.returnPortraitImage)try{const e=await l.findPortraitZone();if(e&&!e.errorCode){let t=!0;if(C){const n=C.points;t=e.points.every(e=>{let t=!1;for(let i=0,a=n.length-1;i<n.length;a=i++){const s=n[i].x,o=n[i].y,r=n[a].x,l=n[a].y;o>e.y!=l>e.y&&e.x<(r-s)*(e.y-o)/(l-o)+s&&(t=!t)}return t})&&C.area/e.area>=3}t&&(I=await r.cropAndDeskewImage(v,e),I.toCanvas=()=>a(I),I.toBlob=async()=>await s("image/png",I))}}catch(e){console.warn("Error finding portrait zone in static file:",e)}const M=new L({status:R.RS_SUCCESS,data:D,primaryOriginalImage:v,primaryDocumentImage:E,portraitImage:I});null===(m=(h=this.resources).onResultUpdated)||void 0===m||m.call(h,M)}catch(e){return console.error("Failed to process uploaded file:",e),new L({status:R.RS_FAILED})}finally{this.hideLoadingOverlay(!1)}}async launch(e){var t;if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0,this.isFileMode=!!e;const{components:n}=await this.initialize();if(this.config.container&&(E(this.config.container).style.display="block"),this.isFileMode)return await this.processUploadedFile(e),n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView&&this.resources.result)return n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView)throw new Error("Scanner view is required when no previous result exists");const i=await n.scannerView.launch();return(null==i?void 0:i.status)!==R.RS_SUCCESS?new L({status:null!==(t=null==i?void 0:i.status)&&void 0!==t?t:R.RS_FAILED}):n.resultView?await n.resultView.launch():this.resources.result}catch(e){return alert((null==e?void 0:e.message)||e),console.error((null==e?void 0:e.message)||e),new L({status:R.RS_FAILED})}finally{this.isCapturing=!1,this.dispose()}}}const G={MRZScanner:U,MRZScannerView:N,MRZResultView:Z};export{D as DEFAULT_TEMPLATE_NAMES,G as DynamsoftMRZScanner,y as EnumDocumentSide,z as EnumMRZData,v as EnumMRZDocumentType,w as EnumMRZScanMode,S as EnumMRZScannerViews,R as EnumResultStatus,P as MRZDataLabel,Z as MRZResultView,U as MRZScanner,N as MRZScannerView,V as displayMRZDate};
