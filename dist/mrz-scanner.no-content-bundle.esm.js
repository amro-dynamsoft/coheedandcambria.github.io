import{EnumValidationStatus as e,MultiFrameResultCrossFilter as t,EnumCapturedResultItemType as n,CapturedResultReceiver as i,EnumImagePixelFormat as a,_toCanvas as s,_toBlob as r,EnumCrossVerificationStatus as o,ImageProcessor as l,IdentityProcessor as c,Feedback as d,CoreModule as h,CodeParserModule as u,LicenseManager as m,CameraView as g,CameraEnhancer as p,CaptureVisionRouter as f}from"@dynamsoft/dynamsoft-capture-vision-bundle";export*from"@dynamsoft/dynamsoft-capture-vision-bundle";var w,v,C,y;!function(e){e.MRZ="mrz",e.Opposite="opposite"}(w||(w={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2",e.PassportAndTD1="passportAndTd1",e.PassportAndTD2="passportAndTd2",e.TD1AndTD2="td1AndTd2",e.All="all"}(v||(v={})),function(e){e.Passport="passport",e.TD1="td1",e.TD2="td2"}(C||(C={})),function(e){e.Scanner="scanner",e.Result="scan-result"}(y||(y={}));const V={[v.Passport]:"ReadPassport",[v.TD1]:"ReadId-TD1",[v.TD2]:"ReadId-TD2",[v.PassportAndTD1]:"ReadPassportAndId-TD1",[v.PassportAndTD2]:"ReadPassportAndId-TD2",[v.TD1AndTD2]:"ReadId",[v.All]:"ReadPassportAndId"};var L;function S(e){if("string"==typeof e){const t=document.querySelector(e);if(!t)throw new Error("Element not found");return t}return e instanceof HTMLElement?e:null}!function(e){e[e.RS_SUCCESS=0]="RS_SUCCESS",e[e.RS_CANCELLED=1]="RS_CANCELLED",e[e.RS_FAILED=2]="RS_FAILED"}(L||(L={}));function D(e,t){const n=document.getElementById(e);if(n)return void(n.textContent=t);const i=document.createElement("style");i.id=e,i.textContent=t,document.head.appendChild(i)}const I=e=>!e||0===Object.keys(e).length;function R(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function b(e,t={}){const{message:n,spinnerSize:i=32}=t,a=document.createElement("div");a.className="dynamsoft-mrz-loading-screen";const s=document.createElement("div");s.className="dynamsoft-mrz-loading";const r=document.createElement("div");r.className="dynamsoft-mrz-loading-content";const o=`\n    <svg \n      xmlns="http://www.w3.org/2000/svg" \n      viewBox="0 0 24 24" \n      fill="none" \n      stroke="white" \n      stroke-linecap="round" \n      stroke-linejoin="round" \n      width="${i}" \n      height="${i}" \n      stroke-width="0.75"\n    > \n      <path d="M12 3a9 9 0 1 0 9 9"></path> \n    </svg>\n  `;if(r.innerHTML=o,n){const e=document.createElement("div");e.className="dynamsoft-mrz-loading-message",e.textContent=n,r.appendChild(e)}return s.appendChild(r),a.appendChild(s),e.appendChild(a),{element:a,updateMessage:e=>{let t=s.querySelector(".dynamsoft-mrz-loading-message");null!==e?t?t.textContent=e:(t=document.createElement("div"),t.className="dynamsoft-mrz-loading-message",t.textContent=e,r.appendChild(t)):null==t||t.remove()},hide:()=>{a&&a.parentNode&&(a.classList.add("fade-out"),setTimeout(()=>{var e;null===(e=a.parentNode)||void 0===e||e.removeChild(a)},200))}}}const x='\n  .dynamsoft-mrz-loading-screen {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #323234;\n    z-index: 998;\n    opacity: 1;\n    transition: opacity 0.2s ease-out;\n  }\n\n  .dynamsoft-mrz-loading-screen.fade-out {\n    opacity: 0;\n  }\n\n  .dynamsoft-mrz-loading {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n    z-index: 999;\n    transform: translate(-50%, -50%);\n  }\n\n  .dynamsoft-mrz-loading-content {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 16px;\n  }\n\n  .dynamsoft-mrz-loading svg {\n    animation: spin 1s linear infinite;\n  }\n\n  .dynamsoft-mrz-loading-message {\n    color: white;\n    font-family: "Verdana";\n    font-size: 14px;\n    text-align: center;\n    max-width: 200px;\n    line-height: 1.4;\n    opacity: 0.9;\n  }\n\n  @keyframes spin {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n';var z;!function(e){e.InvalidFields="invalidFields",e.DocumentType="documentType",e.DocumentNumber="documentNumber",e.MRZText="mrzText",e.FirstName="firstName",e.LastName="lastName",e.Age="age",e.Sex="sex",e.IssuingState="issuingState",e.IssuingStateRaw="issuingStateRaw",e.Nationality="nationality",e.NationalityRaw="nationalityRaw",e.DateOfBirth="dateOfBirth",e.DateOfExpiry="dateOfExpiry",e.OptionalData1="optionalData1",e.OptionalData2="optionalData2"}(z||(z={}));const M={[z.InvalidFields]:"Invalid Fields",[z.DocumentType]:"Document Type",[z.DocumentNumber]:"Document Number",[z.MRZText]:"MRZ Text",[z.FirstName]:"Given Name(s)",[z.LastName]:"Surname",[z.Age]:"Age",[z.Sex]:"Sex",[z.IssuingState]:"Issuing State",[z.IssuingStateRaw]:"Issuing State (Raw Value)",[z.Nationality]:"Nationality",[z.NationalityRaw]:"Nationality State (Raw Value)",[z.DateOfBirth]:"Date Of Birth (YYYY-MM-DD)",[z.DateOfExpiry]:"Date Of Expiry (YYYY-MM-DD)",[z.OptionalData1]:"Optional Data 1",[z.OptionalData2]:"Optional Data 2"};function F(e,t,n,i=!1){const a=parseInt(e,10);let s;if(i)s=a>=60?1900+a:2e3+a;else{s=a>(new Date).getFullYear()%100?1900+a:2e3+a}return{year:s,month:parseInt(t,10),day:parseInt(n,10)}}function T(e){const t=e=>{var t;return 1===(null===(t=`${e}`)||void 0===t?void 0:t.length)?`0${e}`:e};return`${null==e?void 0:e.year}-${t(null==e?void 0:e.month)}${(null==e?void 0:e.day)&&`-${t(null==e?void 0:e.day)}`}`}function E(e){return"D<<"===e?"D":e}function P(t,n){const i=[],a=t=>n.getFieldValidationStatus(t)===e.VS_FAILED,s=n.codeType,r=function(e){switch(e){case"MRTD_TD1_ID":return C.TD1;case"MRTD_TD2_ID":case"MRTD_TD2_VISA":case"MRTD_TD2_FRENCH_ID":return C.TD2;case"MRTD_TD3_PASSPORT":case"MRTD_TD3_VISA":return C.Passport;default:throw new Error(`Unknown document type: ${e}`)}}(s),o=function(e){switch(e){case"MRTD_TD1_ID":return"ID (TD1)";case"MRTD_TD2_ID":return"ID (TD2)";case"MRTD_TD2_VISA":return"ID (VISA)";case"MRTD_TD2_FRENCH_ID":return"French ID (TD2)";case"MRTD_TD3_PASSPORT":return"Passport (TD3)";case"MRTD_TD3_VISA":return"Visa (TD3)";default:throw new Error(`Unknown document type: ${e}`)}}(s),l=r===C.Passport&&"MRTD_TD3_PASSPORT"===s?"passportNumber":"documentNumber",c=F(n.getFieldValue("birthYear"),n.getFieldValue("birthMonth"),n.getFieldValue("birthDay")),d=F(n.getFieldValue("expiryYear"),n.getFieldValue("expiryMonth"),n.getFieldValue("expiryDay"),!0);["birthYear","birthMonth","birthDay"].forEach(e=>{a(e)&&i.push(z.DateOfBirth)}),["expiryYear","expiryMonth","expiryDay"].forEach(e=>{a(e)&&i.push(z.DateOfExpiry)});const h={[z.LastName]:n.getFieldValue("primaryIdentifier"),[z.FirstName]:n.getFieldValue("secondaryIdentifier"),[z.Nationality]:n.getFieldValue("nationality"),[z.NationalityRaw]:E(n.getFieldRawValue("nationality")),[z.DocumentNumber]:n.getFieldValue(l)||n.getFieldValue("longDocumentNumber"),[z.IssuingState]:n.getFieldValue("issuingState"),[z.IssuingStateRaw]:E(n.getFieldRawValue("issuingState")),[z.Sex]:R(n.getFieldValue("sex"))};Object.keys(h).forEach(e=>{let t=!1;switch(e){case z.FirstName:t=a("secondaryIdentifier");break;case z.LastName:t=a("primaryIdentifier");break;case z.DocumentNumber:t=a(l)||a("longDocumentNumber");break;default:t=a(e)}t&&i.push(e)});const u=function(e){const t=new Date,n=t.getMonth()+1>e.month||t.getMonth()+1===e.month&&t.getDate()>=e.day;return t.getFullYear()-e.year-(n?0:1)}(c);u<1&&i.push(z.Age);return{[z.InvalidFields]:i,[z.FirstName]:h[z.FirstName],[z.LastName]:h[z.LastName],[z.Age]:u,[z.DateOfBirth]:c,[z.Sex]:h[z.Sex],[z.Nationality]:h[z.Nationality],[z.NationalityRaw]:h[z.NationalityRaw],[z.DocumentNumber]:h[z.DocumentNumber],[z.DateOfExpiry]:d,[z.IssuingState]:h[z.IssuingState],[z.IssuingStateRaw]:h[z.IssuingStateRaw],[z.DocumentType]:R(o),[z.MRZText]:t}}class Z{constructor(e){var t,n,i,a,s;this._primaryOriginalImage=null,this._secondaryOriginalImage=null,this._primaryDocumentImage=null,this._secondaryDocumentImage=null,this._portraitImage=null,this.status=e.status,this.data=e.data,this._primaryOriginalImage=null!==(t=e.primaryOriginalImage)&&void 0!==t?t:null,this._secondaryOriginalImage=null!==(n=e.secondaryOriginalImage)&&void 0!==n?n:null,this._primaryDocumentImage=null!==(i=e.primaryDocumentImage)&&void 0!==i?i:null,this._secondaryDocumentImage=null!==(a=e.secondaryDocumentImage)&&void 0!==a?a:null,this._portraitImage=null!==(s=e.portraitImage)&&void 0!==s?s:null}getDocumentImage(e){return e===w.MRZ?this._primaryDocumentImage:this._secondaryDocumentImage}getOriginalImage(e){return e===w.MRZ?this._primaryOriginalImage:this._secondaryOriginalImage}getPortraitImage(){return this._portraitImage}}const k='<svg width="354" height="221" viewBox="0 0 354 221" fill="none" xmlns="http://www.w3.org/2000/svg">\n<rect x="1" y="1" width="352" height="219" rx="15" stroke="currentColor" stroke-width="2"/>\n<rect width="338" height="42.4805" transform="translate(8 170.52)" fill="black" fill-opacity="0.1"/>\n<path d="M332.647 202.684L338.8 206.703V208.754L330.159 202.984V202.369L338.8 196.709V198.787L332.647 202.684Z" fill="white"/>\n<path d="M320.534 202.684L326.687 206.703V208.754L318.046 202.984V202.369L326.687 196.709V198.787L320.534 202.684Z" fill="white"/>\n<path d="M308.421 202.684L314.573 206.703V208.754L305.933 202.984V202.369L314.573 196.709V198.787L308.421 202.684Z" fill="white"/>\n<path d="M296.308 202.684L302.46 206.703V208.754L293.819 202.984V202.369L302.46 196.709V198.787L296.308 202.684Z" fill="white"/>\n<path d="M284.194 202.684L290.347 206.703V208.754L281.706 202.984V202.369L290.347 196.709V198.787L284.194 202.684Z" fill="white"/>\n<path d="M272.081 202.684L278.233 206.703V208.754L269.593 202.984V202.369L278.233 196.709V198.787L272.081 202.684Z" fill="white"/>\n<path d="M259.968 202.684L266.12 206.703V208.754L257.479 202.984V202.369L266.12 196.709V198.787L259.968 202.684Z" fill="white"/>\n<path d="M247.854 202.684L254.007 206.703V208.754L245.366 202.984V202.369L254.007 196.709V198.787L247.854 202.684Z" fill="white"/>\n<path d="M235.741 202.684L241.894 206.703V208.754L233.253 202.984V202.369L241.894 196.709V198.787L235.741 202.684Z" fill="white"/>\n<path d="M223.628 202.684L229.78 206.703V208.754L221.14 202.984V202.369L229.78 196.709V198.787L223.628 202.684Z" fill="white"/>\n<path d="M211.515 202.684L217.667 206.703V208.754L209.026 202.984V202.369L217.667 196.709V198.787L211.515 202.684Z" fill="white"/>\n<path d="M199.401 202.684L205.554 206.703V208.754L196.913 202.984V202.369L205.554 196.709V198.787L199.401 202.684Z" fill="white"/>\n<path d="M187.288 202.684L193.44 206.703V208.754L184.8 202.984V202.369L193.44 196.709V198.787L187.288 202.684Z" fill="white"/>\n<path d="M175.175 202.684L181.327 206.703V208.754L172.687 202.984V202.369L181.327 196.709V198.787L175.175 202.684Z" fill="white"/>\n<path d="M163.062 202.684L169.214 206.703V208.754L160.573 202.984V202.369L169.214 196.709V198.787L163.062 202.684Z" fill="white"/>\n<path d="M150.948 202.684L157.101 206.703V208.754L148.46 202.984V202.369L157.101 196.709V198.787L150.948 202.684Z" fill="white"/>\n<path d="M138.835 202.684L144.987 206.703V208.754L136.347 202.984V202.369L144.987 196.709V198.787L138.835 202.684Z" fill="white"/>\n<path d="M126.722 202.684L132.874 206.703V208.754L124.233 202.984V202.369L132.874 196.709V198.787L126.722 202.684Z" fill="white"/>\n<path d="M114.608 202.684L120.761 206.703V208.754L112.12 202.984V202.369L120.761 196.709V198.787L114.608 202.684Z" fill="white"/>\n<path d="M102.495 202.684L108.647 206.703V208.754L100.007 202.984V202.369L108.647 196.709V198.787L102.495 202.684Z" fill="white"/>\n<path d="M90.3818 202.684L96.5342 206.703V208.754L87.8936 202.984V202.369L96.5342 196.709V198.787L90.3818 202.684Z" fill="white"/>\n<path d="M80.415 200.729L81.1396 200.865C81.8096 201.016 82.3428 201.303 82.7529 201.727C83.6143 202.561 84.0518 203.559 84.0518 204.707V204.748C84.0518 205.91 83.71 206.826 83.04 207.496C82.1787 208.357 81.0986 208.85 79.7861 208.973C79.5811 208.986 79.3896 209 79.1846 209C78.0771 209 76.9561 208.727 75.8486 208.166V206.361L76.9561 206.936C77.5713 207.195 78.2275 207.318 78.9385 207.318C79.1299 207.318 79.335 207.305 79.54 207.291C80.4424 207.195 81.1533 206.881 81.6865 206.361C82.1787 205.896 82.4248 205.391 82.4248 204.844V204.762C82.4248 204.051 82.2061 203.477 81.7686 203.025C81.29 202.506 80.6338 202.246 79.7861 202.246H77.9951V200.893L81.5498 197.297H75.8486V195.656H83.6006V197.502L80.415 200.729Z" fill="white"/>\n<path d="M63.8994 208.891C63.8994 206.908 64.0498 205.664 64.3506 205.131C64.8154 204.133 65.8135 203.148 67.3447 202.164C68.5615 201.385 69.3818 200.674 69.8193 200.031C69.9834 199.799 70.0654 199.512 70.0654 199.17C70.0654 198.951 70.0381 198.719 69.9697 198.459C69.874 198.09 69.5732 197.762 69.0811 197.475C68.7529 197.27 68.3701 197.16 67.9189 197.16C66.8662 197.16 65.8955 197.42 65.0068 197.939C64.4053 198.295 64.1045 198.473 64.1045 198.486C64.0908 198.062 64.0908 197.68 64.0908 197.352C64.0908 197.01 64.0908 196.736 64.1045 196.504C65.4033 195.861 66.6748 195.533 67.9189 195.52C69.04 195.52 69.9697 195.848 70.708 196.49C71.46 197.133 71.8291 198.008 71.8291 199.143C71.8291 200.1 71.5146 200.906 70.8857 201.549C70.1885 202.273 69.4229 202.889 68.5889 203.395C67.249 204.215 66.4561 204.926 66.1963 205.514C65.9639 206.074 65.8408 206.648 65.8271 207.25H71.624V208.891H63.8994Z" fill="white"/>\n<path d="M56.7354 208.877V197.939L53.5908 200.646V198.268L56.708 195.725H58.6221V208.877H56.7354Z" fill="white"/>\n<path d="M45.7021 185.088H47.3701C47.3701 185.908 47.0967 186.578 46.5498 187.111C46.0029 187.631 45.2783 187.918 44.376 187.973H44.1709C43.4736 187.973 42.8447 187.768 42.2842 187.357C41.6416 186.879 41.1768 186.209 40.8623 185.348C40.4932 184.309 40.3154 183.119 40.3154 181.766C40.3154 180.412 40.4932 179.223 40.8486 178.197C41.1357 177.391 41.6006 176.748 42.2432 176.27C42.8721 175.805 43.583 175.572 44.376 175.572C45.251 175.572 45.8799 175.764 46.2627 176.146C46.9873 176.871 47.3428 177.596 47.3428 178.334H45.7842L45.7568 178.047C45.7158 177.883 45.5928 177.691 45.4014 177.473C45.2236 177.254 44.8408 177.145 44.2803 177.145C43.6104 177.145 43.0635 177.473 42.6533 178.129C42.2432 178.826 42.0381 179.934 42.0381 181.479V181.766C42.0791 183.475 42.3252 184.678 42.7764 185.389C43.2002 186.059 43.6924 186.4 44.2803 186.4C44.7725 186.4 45.1553 186.25 45.4287 185.949C45.5518 185.812 45.6338 185.607 45.6748 185.334L45.7021 185.088Z" fill="white"/>\n<path d="M45.7021 206.088H47.3701C47.3701 206.908 47.0967 207.578 46.5498 208.111C46.0029 208.631 45.2783 208.918 44.376 208.973H44.1709C43.4736 208.973 42.8447 208.768 42.2842 208.357C41.6416 207.879 41.1768 207.209 40.8623 206.348C40.4932 205.309 40.3154 204.119 40.3154 202.766C40.3154 201.412 40.4932 200.223 40.8486 199.197C41.1357 198.391 41.6006 197.748 42.2432 197.27C42.8721 196.805 43.583 196.572 44.376 196.572C45.251 196.572 45.8799 196.764 46.2627 197.146C46.9873 197.871 47.3428 198.596 47.3428 199.334H45.7842L45.7568 199.047C45.7158 198.883 45.5928 198.691 45.4014 198.473C45.2236 198.254 44.8408 198.145 44.2803 198.145C43.6104 198.145 43.0635 198.473 42.6533 199.129C42.2432 199.826 42.0381 200.934 42.0381 202.479V202.766C42.0791 204.475 42.3252 205.678 42.7764 206.389C43.2002 207.059 43.6924 207.4 44.2803 207.4C44.7725 207.4 45.1553 207.25 45.4287 206.949C45.5518 206.812 45.6338 206.607 45.6748 206.334L45.7021 206.088Z" fill="white"/>\n<path d="M29.1318 180.795H31.8115C32.4404 180.795 33.001 180.658 33.4795 180.371C33.9033 180.111 34.1084 179.701 34.1084 179.141V179.072C34.1084 178.594 33.8486 178.211 33.3428 177.896C32.9053 177.623 32.3994 177.486 31.8115 177.486H29.1318V180.795ZM29.1318 186.291H31.8115C32.4814 186.291 33.042 186.154 33.4795 185.881C34.0127 185.566 34.2725 185.102 34.2725 184.486C34.2725 183.871 34.04 183.365 33.5889 182.982C33.1514 182.586 32.5635 182.381 31.8115 182.381H29.1318V186.291ZM27.4365 187.877V175.9H31.8115C33.1514 175.9 34.1768 176.215 34.9014 176.857C35.5166 177.404 35.8311 178.102 35.8311 178.963C35.8311 179.797 35.667 180.412 35.3389 180.795C35.1475 181.027 34.915 181.246 34.6553 181.438L34.3271 181.643L34.6279 181.779C34.9697 181.984 35.2568 182.23 35.4756 182.518C35.8447 182.941 36.0225 183.557 36.0225 184.377C36.0088 185.457 35.6807 186.25 35.0518 186.77C34.1631 187.508 33.083 187.877 31.8115 187.877H27.4365Z" fill="white"/>\n<path d="M29.1318 201.795H31.8115C32.4404 201.795 33.001 201.658 33.4795 201.371C33.9033 201.111 34.1084 200.701 34.1084 200.141V200.072C34.1084 199.594 33.8486 199.211 33.3428 198.896C32.9053 198.623 32.3994 198.486 31.8115 198.486H29.1318V201.795ZM29.1318 207.291H31.8115C32.4814 207.291 33.042 207.154 33.4795 206.881C34.0127 206.566 34.2725 206.102 34.2725 205.486C34.2725 204.871 34.04 204.365 33.5889 203.982C33.1514 203.586 32.5635 203.381 31.8115 203.381H29.1318V207.291ZM27.4365 208.877V196.9H31.8115C33.1514 196.9 34.1768 197.215 34.9014 197.857C35.5166 198.404 35.8311 199.102 35.8311 199.963C35.8311 200.797 35.667 201.412 35.3389 201.795C35.1475 202.027 34.915 202.246 34.6553 202.438L34.3271 202.643L34.6279 202.779C34.9697 202.984 35.2568 203.23 35.4756 203.518C35.8447 203.941 36.0225 204.557 36.0225 205.377C36.0088 206.457 35.6807 207.25 35.0518 207.77C34.1631 208.508 33.083 208.877 31.8115 208.877H27.4365Z" fill="white"/>\n<path d="M18.167 182.777H21.1475L19.6709 177.322L18.167 182.777ZM15.2002 187.877L18.6045 175.559H20.9014L24.0322 187.877H22.3096L21.4072 184.432H17.7568L16.7725 187.877H15.2002Z" fill="white"/>\n<path d="M18.167 203.777H21.1475L19.6709 198.322L18.167 203.777ZM15.2002 208.877L18.6045 196.559H20.9014L24.0322 208.877H22.3096L21.4072 205.432H17.7568L16.7725 208.877H15.2002Z" fill="white"/>\n<path d="M56.7354 187.877V176.939L53.5908 179.646V177.268L56.708 174.725H58.6221V187.877H56.7354Z" fill="white"/>\n<path d="M63.8994 187.891C63.8994 185.908 64.0498 184.664 64.3506 184.131C64.8154 183.133 65.8135 182.148 67.3447 181.164C68.5615 180.385 69.3818 179.674 69.8193 179.031C69.9834 178.799 70.0654 178.512 70.0654 178.17C70.0654 177.951 70.0381 177.719 69.9697 177.459C69.874 177.09 69.5732 176.762 69.0811 176.475C68.7529 176.27 68.3701 176.16 67.9189 176.16C66.8662 176.16 65.8955 176.42 65.0068 176.939C64.4053 177.295 64.1045 177.473 64.1045 177.486C64.0908 177.062 64.0908 176.68 64.0908 176.352C64.0908 176.01 64.0908 175.736 64.1045 175.504C65.4033 174.861 66.6748 174.533 67.9189 174.52C69.04 174.52 69.9697 174.848 70.708 175.49C71.46 176.133 71.8291 177.008 71.8291 178.143C71.8291 179.1 71.5146 179.906 70.8857 180.549C70.1885 181.273 69.4229 181.889 68.5889 182.395C67.249 183.215 66.4561 183.926 66.1963 184.514C65.9639 185.074 65.8408 185.648 65.8271 186.25H71.624V187.891H63.8994Z" fill="white"/>\n<path d="M80.415 179.729L81.1396 179.865C81.8096 180.016 82.3428 180.303 82.7529 180.727C83.6143 181.561 84.0518 182.559 84.0518 183.707V183.748C84.0518 184.91 83.71 185.826 83.04 186.496C82.1787 187.357 81.0986 187.85 79.7861 187.973C79.5811 187.986 79.3896 188 79.1846 188C78.0771 188 76.9561 187.727 75.8486 187.166V185.361L76.9561 185.936C77.5713 186.195 78.2275 186.318 78.9385 186.318C79.1299 186.318 79.335 186.305 79.54 186.291C80.4424 186.195 81.1533 185.881 81.6865 185.361C82.1787 184.896 82.4248 184.391 82.4248 183.844V183.762C82.4248 183.051 82.2061 182.477 81.7686 182.025C81.29 181.506 80.6338 181.246 79.7861 181.246H77.9951V179.893L81.5498 176.297H75.8486V174.656H83.6006V176.502L80.415 179.729Z" fill="white"/>\n<path d="M332.647 181.684L338.8 185.703V187.754L330.159 181.984V181.369L338.8 175.709V177.787L332.647 181.684Z" fill="white"/>\n<path d="M320.534 181.684L326.687 185.703V187.754L318.046 181.984V181.369L326.687 175.709V177.787L320.534 181.684Z" fill="white"/>\n<path d="M308.421 181.684L314.573 185.703V187.754L305.933 181.984V181.369L314.573 175.709V177.787L308.421 181.684Z" fill="white"/>\n<path d="M296.308 181.684L302.46 185.703V187.754L293.819 181.984V181.369L302.46 175.709V177.787L296.308 181.684Z" fill="white"/>\n<path d="M284.194 181.684L290.347 185.703V187.754L281.706 181.984V181.369L290.347 175.709V177.787L284.194 181.684Z" fill="white"/>\n<path d="M272.081 181.684L278.233 185.703V187.754L269.593 181.984V181.369L278.233 175.709V177.787L272.081 181.684Z" fill="white"/>\n<path d="M259.968 181.684L266.12 185.703V187.754L257.479 181.984V181.369L266.12 175.709V177.787L259.968 181.684Z" fill="white"/>\n<path d="M247.854 181.684L254.007 185.703V187.754L245.366 181.984V181.369L254.007 175.709V177.787L247.854 181.684Z" fill="white"/>\n<path d="M235.741 181.684L241.894 185.703V187.754L233.253 181.984V181.369L241.894 175.709V177.787L235.741 181.684Z" fill="white"/>\n<path d="M223.628 181.684L229.78 185.703V187.754L221.14 181.984V181.369L229.78 175.709V177.787L223.628 181.684Z" fill="white"/>\n<path d="M211.515 181.684L217.667 185.703V187.754L209.026 181.984V181.369L217.667 175.709V177.787L211.515 181.684Z" fill="white"/>\n<path d="M199.401 181.684L205.554 185.703V187.754L196.913 181.984V181.369L205.554 175.709V177.787L199.401 181.684Z" fill="white"/>\n<path d="M187.288 181.684L193.44 185.703V187.754L184.8 181.984V181.369L193.44 175.709V177.787L187.288 181.684Z" fill="white"/>\n<path d="M175.175 181.684L181.327 185.703V187.754L172.687 181.984V181.369L181.327 175.709V177.787L175.175 181.684Z" fill="white"/>\n<path d="M163.062 181.684L169.214 185.703V187.754L160.573 181.984V181.369L169.214 175.709V177.787L163.062 181.684Z" fill="white"/>\n<path d="M150.948 181.684L157.101 185.703V187.754L148.46 181.984V181.369L157.101 175.709V177.787L150.948 181.684Z" fill="white"/>\n<path d="M138.835 181.684L144.987 185.703V187.754L136.347 181.984V181.369L144.987 175.709V177.787L138.835 181.684Z" fill="white"/>\n<path d="M126.722 181.684L132.874 185.703V187.754L124.233 181.984V181.369L132.874 175.709V177.787L126.722 181.684Z" fill="white"/>\n<path d="M114.608 181.684L120.761 185.703V187.754L112.12 181.984V181.369L120.761 175.709V177.787L114.608 181.684Z" fill="white"/>\n<path d="M102.495 181.684L108.647 185.703V187.754L100.007 181.984V181.369L108.647 175.709V177.787L102.495 181.684Z" fill="white"/>\n<path d="M90.3818 181.684L96.5342 185.703V187.754L87.8936 181.984V181.369L96.5342 175.709V177.787L90.3818 181.684Z" fill="white"/>\n</svg>';function O(e){e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})}function N(e,t,n){const i=document.createElement("div");return i.className=`mrz-icon-btn ${e}`,i.setAttribute("role","button"),i.setAttribute("aria-label",t),i.setAttribute("tabindex","0"),i.innerHTML=n,O(i),i}const A={[C.TD1]:{width:85.6,height:53.98},[C.TD2]:{width:105,height:74},[C.Passport]:{width:125,height:88}};class H{showScannerLoadingOverlay(e){const t=S(this.config.container);this.loadingScreen=b(t,{message:e}),t.style.display="block",t.style.position="relative"}hideScannerLoadingOverlay(e=!1){this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,e&&(S(this.config.container).style.display="none"))}constructor(e,t){this.resources=e,this.config=t,this.isSoundFeedbackOn=!1,this.isFlashOn=!1,this.scanModeManager={[C.Passport]:!0,[C.TD1]:!0,[C.TD2]:!0},this.currentScanMode=v.All,this.resizeTimer=null,this.defaultBackCameraId=null,this.capturedResultItems=[],this.originalImageData=null,this.initialized=!1,this.initializedUI=!1,this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.flipTimeoutHandle=null,this.flipCountdownHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null},this.ui=null,this.loadingScreen=null,this.handleResize=()=>{this.setGuideFrameVisible(!1),this.resizeTimer&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.setGuideFrameVisible(!0),this.updateScanRegion()},500)},this.firstFrame=!0}async initialize(){if(!this.initialized){this.initializeScanModeManager(),this.currentScanMode=this.getScanMode(),D("dynamsoft-mrz-loading-screen-style",x),D("dynamsoft-mrz-scanner-view-style",'\n  .mrz-scanner-overlay {\n    position: absolute;\n    top: 0; left: 0; right: 0; bottom: 0;\n    pointer-events: none;\n    z-index: 100;\n    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;\n    box-sizing: border-box;\n  }\n\n  /* ── Top bar ── */\n  .mrz-top-bar {\n    position: absolute;\n    top: 0; left: 0; right: 0;\n    height: calc(56px + env(safe-area-inset-top, 0px));\n    background: #000;\n    display: flex;\n    flex-direction: column;\n    pointer-events: auto;\n  }\n\n  /* Absorbs the notch / Dynamic Island zone — no buttons ever live here */\n  .mrz-top-safe-spacer {\n    height: env(safe-area-inset-top, 0px);\n    flex-shrink: 0;\n  }\n\n  /* Fixed-height row that always holds the buttons — centred unconditionally */\n  .mrz-top-bar-inner {\n    flex: 0 0 56px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 12px 0 8px;\n  }\n\n  .mrz-top-controls {\n    display: flex;\n    align-items: center;\n    gap: 2px;\n  }\n\n  .mrz-icon-btn {\n    background: none;\n    border: none;\n    outline: none;\n    box-shadow: none;\n    cursor: pointer;\n    color: #fff;\n    padding: 0 10px;\n    align-self: center;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    user-select: none;\n    -webkit-user-select: none;\n  }\n\n  .mrz-icon-btn:active {\n    opacity: 0.6;\n  }\n\n  /* Close button — tight 20×20 viewBox (~90% coverage), keep visually small */\n  .mrz-close-btn svg {\n    width: 22px;\n    height: 22px;\n    display: block;\n  }\n\n  /*\n   * Top-controls action icons — 24×24 viewBox rendered at 24 px.\n   */\n  .mrz-top-controls .mrz-icon-btn svg {\n    width: 24px;\n    height: 24px;\n    display: block;\n  }\n\n  /*\n   * Flash / sound buttons wrap their SVGs in <span> elements for dual-state\n   * toggling. Spans are inline by default which adds a descender gap below\n   * the SVG and shifts it off-centre. Make them flex containers to match the\n   * layout of buttons whose SVG is a direct child.\n   */\n  .mrz-icon-btn span {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .mrz-icon-btn.mrz-hidden {\n    display: none;\n  }\n\n  /* Hide a divider whose preceding button is hidden (prevents orphan / double dividers) */\n  .mrz-icon-btn.mrz-hidden + .mrz-top-divider {\n    display: none;\n  }\n\n  .mrz-top-divider {\n    width: 1px;\n    height: 24px;\n    background: rgba(255, 255, 255, 0.3);\n    margin: 0 4px;\n    flex-shrink: 0;\n    align-self: center;\n  }\n\n  /* ── Guide wrapper (positions frame + badge together) ── */\n  .mrz-guide-wrapper {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -46%);\n    width: min(88vw, 520px);\n    pointer-events: none;\n  }\n\n  /* ── Badge — floats just above the guide frame ── */\n  .mrz-badge {\n    position: absolute;\n    bottom: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    margin-bottom: 8px;\n    background: rgba(0, 0, 0, 0.72);\n    border-radius: 20px;\n    padding: 10px 20px;\n    text-align: center;\n    white-space: nowrap;\n    pointer-events: none;\n    display: none;\n    flex-direction: column;\n    gap: 3px;\n  }\n\n  .mrz-badge.mrz-badge-visible {\n    display: flex;\n  }\n\n  .mrz-badge-line {\n    font-size: 14px;\n    font-weight: 500;\n    color: #fff;\n    line-height: 1.4;\n    letter-spacing: 0.1px;\n  }\n\n  .mrz-badge-line.mrz-success {\n    color: #FF9F40;\n  }\n\n  /* ── Guide frame ── */\n  .mrz-guide-frame {\n    width: 100%;\n    color: #fff;\n    transition: color 0.35s ease;\n    pointer-events: none;\n  }\n\n  .mrz-guide-frame.mrz-guide-success {\n    color: #4CAF50;\n  }\n\n  .mrz-guide-frame svg {\n    width: 100%;\n    height: auto;\n    display: block;\n  }\n\n  /* ── Bottom bar / Format selector ── */\n  .mrz-format-selector {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0, 0, 0, 0.85);\n    border-radius: 16px 16px 0 0;\n    padding: 10px 0 calc(20px + env(safe-area-inset-bottom, 0px));\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 8px;\n    pointer-events: auto;\n  }\n\n  /* Row that holds the three format buttons plus the sliding indicator */\n  .mrz-format-buttons-row {\n    position: relative;\n    display: flex;\n    align-items: center;\n    width: 100%;\n    padding-top: 10px;\n  }\n\n  /* Sliding selection indicator (thin bar above the active button\'s text) */\n  .mrz-format-indicator {\n    position: absolute;\n    top: 0;\n    height: 3px;\n    width: 32px;\n    background: #fff;\n    border-radius: 2px;\n    pointer-events: none;\n    transition: left 0.25s ease;\n  }\n\n  .mrz-format-btn {\n    flex: 1;\n    text-align: center;\n    background: none;\n    border: none;\n    outline: none;\n    box-shadow: none;\n    color: rgba(255, 255, 255, 0.8);\n    font-size: 15px;\n    font-weight: 400;\n    padding: 8px 0;\n    cursor: pointer;\n    letter-spacing: 0.2px;\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n    user-select: none;\n    -webkit-user-select: none;\n    transition: color 0.15s ease, font-weight 0.15s ease;\n    font-family: inherit;\n  }\n\n  .mrz-format-btn.mrz-format-active {\n    color: #fff;\n    font-weight: 700;\n  }\n\n  @media (max-width: 400px) {\n    .mrz-format-btn {\n      padding: 8px 14px;\n      font-size: 14px;\n    }\n  }\n\n  @media (min-width: 1024px) {\n    .mrz-top-bar {\n      height: calc(60px + env(safe-area-inset-top, 0px));\n    }\n    .mrz-top-bar-inner {\n      flex-basis: 60px;\n    }\n    .mrz-badge {\n      font-size: 15px;\n    }\n    .mrz-guide-wrapper {\n      width: min(60vw, 600px);\n    }\n  }\n');try{const{cameraView:e,cameraEnhancer:a,cvRouter:s}=this.resources;if(e.setScanRegionMaskStyle({strokeStyle:"transparent",fillStyle:"transparent",lineWidth:0}),e.setVideoFit("cover"),s.setInput(a),!0===this.config.enableMultiFrameCrossFilter){const e=new t;e.enableResultCrossVerification(n.CRIT_TEXT_LINE,!0),await s.addResultFilter(e)}const r=new i;r.onCapturedResultReceived=e=>this.handleMRZResult(e),s.addResultReceiver(r),this.initialized=!0}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera();const n=new Z({status:L.RS_FAILED});this.currentScanResolver(n)}}}initializeUI(){const e=S(this.config.container),t=e.children[e.children.length-1];if((null==t?void 0:t.shadowRoot)&&!t.shadowRoot.querySelector("#mrz-dce-hide-style")){const e=document.createElement("style");e.id="mrz-dce-hide-style",e.textContent="\n  .dce-header,\n  .dce-footer,\n  .dce-mn-footer,\n  .dce-mn-resolution-box,\n  .dce-mn-select-camera-icon,\n  .dce-mn-camera-and-resolution-settings,\n  .dce-mn-upload-image-icon,\n  .dce-mn-sound-feedback,\n  .dce-mn-torch,\n  .dce-mn-close,\n  .dce-mn-scan-mode-select,\n  .dce-mn-zoom,\n  .dce-mn-toast,\n  .dce-mn-msg-poweredby,\n  .dce-mn-setting,\n  .dce-mn-settings,\n  .dce-mn-cog,\n  .dce-mn-camera-setting,\n  .dce-scanguide-passport,\n  .dce-scanguide-td1,\n  .dce-scanguide-td2,\n  .dce-mn-bg-mrz-passport,\n  .dce-mn-bg-mrz-td1,\n  .dce-mn-bg-mrz-td2 {\n    display: none !important;\n  }\n",t.shadowRoot.appendChild(e)}const n=!1!==this.config.showUploadImage,i=!1!==this.config.showFormatSelector&&this.shouldShowFormatSelector(),a=!1!==this.config.showSoundToggle;this.ui=function(e){const{showUpload:t,showFormatSelector:n,showSoundToggle:i}=e,a=document.createElement("div");a.className="mrz-scanner-overlay";const s=document.createElement("div");s.className="mrz-top-bar";const r=document.createElement("div");r.className="mrz-top-safe-spacer";const o=document.createElement("div");o.className="mrz-top-bar-inner";const l=N("mrz-close-btn","Close scanner",'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="2" y1="2" x2="18" y2="18"/><line x1="18" y1="2" x2="2" y2="18"/></svg>'),c=document.createElement("div");c.className="mrz-top-controls";const d=N("mrz-upload-btn","Upload image",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.25 3.75H6.75C6.35218 3.75 5.97064 3.90804 5.68934 4.18934C5.40804 4.47064 5.25 4.85218 5.25 5.25V6.75H3.75C3.35218 6.75 2.97064 6.90804 2.68934 7.18934C2.40804 7.47064 2.25 7.85218 2.25 8.25V18.75C2.25 19.1478 2.40804 19.5294 2.68934 19.8107C2.97064 20.092 3.35218 20.25 3.75 20.25H17.25C17.6478 20.25 18.0294 20.092 18.3107 19.8107C18.592 19.5294 18.75 19.1478 18.75 18.75V17.25H20.25C20.6478 17.25 21.0294 17.092 21.3107 16.8107C21.592 16.5294 21.75 16.1478 21.75 15.75V5.25C21.75 4.85218 21.592 4.47064 21.3107 4.18934C21.0294 3.90804 20.6478 3.75 20.25 3.75ZM16.125 6.75C16.3475 6.75 16.565 6.81598 16.75 6.9396C16.935 7.06321 17.0792 7.23891 17.1644 7.44448C17.2495 7.65005 17.2718 7.87625 17.2284 8.09448C17.185 8.31271 17.0778 8.51316 16.9205 8.6705C16.7632 8.82783 16.5627 8.93498 16.3445 8.97838C16.1262 9.02179 15.9 8.99951 15.6945 8.91436C15.4889 8.82922 15.3132 8.68502 15.1896 8.50002C15.066 8.31501 15 8.0975 15 7.875C15 7.57663 15.1185 7.29048 15.3295 7.0795C15.5405 6.86853 15.8266 6.75 16.125 6.75ZM17.25 18.75H3.75V8.25H5.25V15.75C5.25 16.1478 5.40804 16.5294 5.68934 16.8107C5.97064 17.092 6.35218 17.25 6.75 17.25H17.25V18.75ZM20.25 15.75H6.75V11.3147L9.59437 8.46937C9.66403 8.39964 9.74675 8.34432 9.83779 8.30658C9.92884 8.26884 10.0264 8.24941 10.125 8.24941C10.2236 8.24941 10.3212 8.26884 10.4122 8.30658C10.5033 8.34432 10.586 8.39964 10.6556 8.46937L15.3103 13.125L17.7188 10.7194C17.8594 10.5788 18.0501 10.4999 18.2489 10.4999C18.4477 10.4999 18.6384 10.5788 18.7791 10.7194L20.25 12.1941V15.75Z" fill="white"/></svg>');t||d.classList.add("mrz-hidden");const h=document.createElement("span");h.className="mrz-top-divider",t||h.classList.add("mrz-hidden");const u=N("mrz-camera-btn","Switch camera",'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.5 5.25H16.9012L15.6234 3.33375C15.555 3.23114 15.4623 3.147 15.3535 3.08879C15.2448 3.03057 15.1233 3.00007 15 3H9C8.87665 3.00007 8.75522 3.03057 8.64648 3.08879C8.53773 3.147 8.44502 3.23114 8.37656 3.33375L7.09781 5.25H4.5C3.90326 5.25 3.33097 5.48705 2.90901 5.90901C2.48705 6.33097 2.25 6.90326 2.25 7.5V18C2.25 18.5967 2.48705 19.169 2.90901 19.591C3.33097 20.0129 3.90326 20.25 4.5 20.25H19.5C20.0967 20.25 20.669 20.0129 21.091 19.591C21.5129 19.169 21.75 18.5967 21.75 18V7.5C21.75 6.90326 21.5129 6.33097 21.091 5.90901C20.669 5.48705 20.0967 5.25 19.5 5.25ZM14.7009 15.6C13.8672 16.2207 12.8451 16.5351 11.8066 16.4901C10.7682 16.4452 9.77701 16.0438 9 15.3534V15.75C9 15.9489 8.92098 16.1397 8.78033 16.2803C8.63968 16.421 8.44891 16.5 8.25 16.5C8.05109 16.5 7.86032 16.421 7.71967 16.2803C7.57902 16.1397 7.5 15.9489 7.5 15.75V13.5C7.5 13.3011 7.57902 13.1103 7.71967 12.9697C7.86032 12.829 8.05109 12.75 8.25 12.75H10.5C10.6989 12.75 10.8897 12.829 11.0303 12.9697C11.171 13.1103 11.25 13.3011 11.25 13.5C11.25 13.6989 11.171 13.8897 11.0303 14.0303C10.8897 14.171 10.6989 14.25 10.5 14.25H10.0172C10.5352 14.7039 11.1932 14.9664 11.8814 14.9939C12.5697 15.0214 13.2465 14.8121 13.7991 14.4009C13.9581 14.2813 14.1581 14.2298 14.3551 14.2577C14.5521 14.2855 14.7299 14.3905 14.8495 14.5495C14.9691 14.7085 15.0207 14.9085 14.9928 15.1055C14.9649 15.3025 14.8599 15.4804 14.7009 15.6ZM16.5 11.25C16.5 11.4489 16.421 11.6397 16.2803 11.7803C16.1397 11.921 15.9489 12 15.75 12H13.5C13.3011 12 13.1103 11.921 12.9697 11.7803C12.829 11.6397 12.75 11.4489 12.75 11.25C12.75 11.0511 12.829 10.8603 12.9697 10.7197C13.1103 10.579 13.3011 10.5 13.5 10.5H13.9828C13.4648 10.0461 12.8068 9.78356 12.1186 9.7561C11.4303 9.72863 10.7535 9.93792 10.2009 10.3491C10.0419 10.4687 9.84193 10.5202 9.64493 10.4923C9.44793 10.4645 9.27007 10.3595 9.15047 10.2005C9.03087 10.0415 8.97934 9.84146 9.00721 9.64446C9.03507 9.44746 9.14006 9.2696 9.29906 9.15C10.1328 8.52931 11.1549 8.21494 12.1934 8.25985C13.2318 8.30476 14.223 8.70621 15 9.39656V9C15 8.80109 15.079 8.61032 15.2197 8.46967C15.3603 8.32902 15.5511 8.25 15.75 8.25C15.9489 8.25 16.1397 8.32902 16.2803 8.46967C16.421 8.61032 16.5 8.80109 16.5 9V11.25Z" fill="white"/></svg>'),m=document.createElement("span");m.className="mrz-top-divider";const g=N("mrz-flash-btn","Toggle flash",""),p=document.createElement("span");p.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.25 1.5H6.75C6.35218 1.5 5.97064 1.65804 5.68934 1.93934C5.40804 2.22064 5.25 2.60218 5.25 3V7.24969C5.2508 7.57411 5.35599 7.88967 5.55 8.14969L7.5 10.7503V21C7.5 21.3978 7.65804 21.7794 7.93934 22.0607C8.22064 22.342 8.60218 22.5 9 22.5H15C15.3978 22.5 15.7794 22.342 16.0607 22.0607C16.342 21.7794 16.5 21.3978 16.5 21V10.7503L18.45 8.14969C18.644 7.88967 18.7492 7.57411 18.75 7.24969V3C18.75 2.60218 18.592 2.22064 18.3107 1.93934C18.0294 1.65804 17.6478 1.5 17.25 1.5ZM12.75 14.25C12.75 14.4489 12.671 14.6397 12.5303 14.7803C12.3897 14.921 12.1989 15 12 15C11.8011 15 11.6103 14.921 11.4697 14.7803C11.329 14.6397 11.25 14.4489 11.25 14.25V11.25C11.25 11.0511 11.329 10.8603 11.4697 10.7197C11.6103 10.579 11.8011 10.5 12 10.5C12.1989 10.5 12.3897 10.579 12.5303 10.7197C12.671 10.8603 12.75 11.0511 12.75 11.25V14.25ZM6.75 5.25V3H17.25V5.25H6.75Z" fill="white"/></svg>';const f=document.createElement("span");f.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.25 6.5H6.75C6.35218 6.5 5.97064 6.65804 5.68934 6.93934C5.40804 7.22064 5.25 7.60218 5.25 8V10.2497C5.2508 10.5741 5.35599 10.8897 5.55 11.1497L7.5 13.7503V21C7.5 21.3978 7.65804 21.7794 7.93934 22.0607C8.22064 22.342 8.60218 22.5 9 22.5H15C15.3978 22.5 15.7794 22.342 16.0607 22.0607C16.342 21.7794 16.5 21.3978 16.5 21V13.7503L18.45 11.1497C18.644 10.8897 18.7492 10.5741 18.75 10.2497V8C18.75 7.60218 18.592 7.22064 18.3107 6.93934C18.0294 6.65804 17.6478 6.5 17.25 6.5ZM12.75 17.25C12.75 17.4489 12.671 17.6397 12.5303 17.7803C12.3897 17.921 12.1989 18 12 18C11.8011 18 11.6103 17.921 11.4697 17.7803C11.329 17.6397 11.25 17.4489 11.25 17.25V14.25C11.25 14.0511 11.329 13.8603 11.4697 13.7197C11.6103 13.579 11.8011 13.5 12 13.5C12.1989 13.5 12.3897 13.579 12.5303 13.7197C12.671 13.8603 12.75 14.0511 12.75 14.25V17.25Z" fill="white"/><path d="M11.125 3.7V1.3C11.125 1.08783 11.2172 0.884344 11.3813 0.734315C11.5454 0.584285 11.7679 0.5 12 0.5C12.2321 0.5 12.4546 0.584285 12.6187 0.734315C12.7828 0.884344 12.875 1.08783 12.875 1.3V3.7C12.875 3.91217 12.7828 4.11566 12.6187 4.26569C12.4546 4.41571 12.2321 4.5 12 4.5C11.7679 4.5 11.5454 4.41571 11.3813 4.26569C11.2172 4.11566 11.125 3.91217 11.125 3.7Z" fill="white"/><path d="M6.09231 4.97685L4.89231 2.89839C4.78622 2.71464 4.76432 2.49232 4.83141 2.28035C4.89851 2.06837 5.04911 1.8841 5.25008 1.76807C5.45106 1.65203 5.68594 1.61375 5.90307 1.66163C6.12019 1.70951 6.30177 1.83964 6.40785 2.02339L7.60785 4.10185C7.71394 4.2856 7.73585 4.50791 7.66875 4.71989C7.60166 4.93186 7.45106 5.11614 7.25008 5.23217C7.04911 5.3482 6.81422 5.38649 6.5971 5.3386C6.37997 5.29072 6.1984 5.1606 6.09231 4.97685Z" fill="white"/><path d="M16.3922 4.10185L17.5922 2.02339C17.6983 1.83964 17.8799 1.70951 18.097 1.66163C18.3141 1.61375 18.549 1.65203 18.75 1.76807C18.9509 1.8841 19.1015 2.06837 19.1686 2.28035C19.2357 2.49232 19.2138 2.71464 19.1077 2.89839L17.9077 4.97685C17.8016 5.1606 17.6201 5.29072 17.4029 5.33861C17.1858 5.38649 16.9509 5.3482 16.75 5.23217C16.549 5.11614 16.3984 4.93186 16.3313 4.71989C16.2642 4.50791 16.2861 4.2856 16.3922 4.10185Z" fill="white"/></svg>',f.style.display="none",g.appendChild(p),g.appendChild(f);const w=N("mrz-sound-btn","Toggle sound","");i||w.classList.add("mrz-hidden");const v=document.createElement("span");v.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.98"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.52987 3.47025C4.76321 3.23691 5.11092 3.19215 5.3912 3.3306C5.42654 3.40214 5.47033 3.47125 5.52987 3.5308L21.4703 19.4703C21.5294 19.5292 21.5976 19.5728 21.6685 19.6079C21.8078 19.8885 21.7635 20.2366 21.5299 20.4703C21.237 20.7626 20.7621 20.7627 20.4693 20.4703L12.7496 12.7505V17.2505C12.7503 18.2809 12.3972 19.2801 11.7496 20.0816C11.1021 20.8829 10.1994 21.4381 9.19198 21.6538C8.1844 21.8694 7.13236 21.7333 6.21347 21.2671C5.29459 20.8009 4.56321 20.0328 4.14218 19.0923C3.72122 18.1519 3.6357 17.095 3.89999 16.0992C4.16433 15.1032 4.76337 14.2286 5.5953 13.6206C6.42729 13.0128 7.44312 12.7085 8.47226 12.7593C9.50127 12.8103 10.4816 13.2131 11.2496 13.8999V11.2505L4.52987 4.5308C4.23726 4.23807 4.23753 3.76315 4.52987 3.47025ZM11.8697 3.01127C11.9848 2.99106 12.1035 2.99824 12.2154 3.03178L19.7154 5.28178C19.8697 5.32808 20.0049 5.42317 20.1012 5.55228C20.1974 5.68164 20.2496 5.83929 20.2496 6.00053V10.5005C20.2495 10.6172 20.2219 10.7322 20.1695 10.8365C20.117 10.9408 20.0406 11.0324 19.9469 11.1021C19.8532 11.1716 19.7444 11.2186 19.6295 11.2388C19.5145 11.259 19.3956 11.2519 19.2838 11.2183L13.65 9.52787L11.2496 7.12748V3.75053C11.2496 3.63371 11.2772 3.518 11.3297 3.41361C11.3821 3.30928 11.4587 3.2187 11.5523 3.14896C11.646 3.07929 11.7547 3.03155 11.8697 3.01127Z" fill="white"/></g></svg>';const C=document.createElement("span");C.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g opacity="0.98"><path d="M19.7156 5.28185L12.2156 3.03185C12.1037 2.99824 11.9854 2.99127 11.8702 3.0115C11.7551 3.03173 11.6462 3.0786 11.5524 3.14837C11.4586 3.21813 11.3824 3.30887 11.3299 3.41332C11.2774 3.51778 11.25 3.63306 11.25 3.74997V13.8993C10.4819 13.2123 9.5013 12.8098 8.47206 12.7589C7.44282 12.7081 6.4273 13.012 5.59523 13.62C4.76317 14.2279 4.16496 15.103 3.9006 16.099C3.63624 17.095 3.72173 18.1516 4.14279 19.0922C4.56386 20.0327 5.29498 20.8002 6.21396 21.2665C7.13295 21.7327 8.18412 21.8695 9.1918 21.6538C10.1995 21.4381 11.1026 20.8831 11.7502 20.0816C12.3979 19.28 12.7508 18.2805 12.75 17.25V9.25779L19.2844 11.2181C19.3964 11.2517 19.5146 11.2587 19.6298 11.2384C19.7449 11.2182 19.8538 11.1713 19.9476 11.1016C20.0414 11.0318 20.1176 10.9411 20.1701 10.8366C20.2226 10.7322 20.25 10.6169 20.25 10.5V5.99997C20.25 5.83873 20.198 5.6818 20.1017 5.55245C20.0054 5.42309 19.8701 5.3282 19.7156 5.28185Z" fill="white"/></g></svg>',C.style.display="none",w.appendChild(v),w.appendChild(C),c.append(d,h,u,m,g,w),o.append(l,c),s.append(r,o);const y=document.createElement("div");y.className="mrz-guide-wrapper";const V=document.createElement("div");V.className="mrz-badge";const L=document.createElement("span");L.className="mrz-badge-line";const S=document.createElement("span");S.className="mrz-badge-line",S.style.display="none",V.append(L,S);const D=document.createElement("div");D.className="mrz-guide-frame",D.innerHTML=k,y.append(V,D);let I=null,R=null,b=null,x=null,z=null;if(n){I=document.createElement("div"),I.className="mrz-format-selector";const e=document.createElement("div");e.className="mrz-format-buttons-row",R=document.createElement("div"),R.className="mrz-format-btn",R.setAttribute("role","button"),R.setAttribute("tabindex","0"),R.textContent="ID",O(R),b=document.createElement("div"),b.className="mrz-format-btn mrz-format-active",b.setAttribute("role","button"),b.setAttribute("tabindex","0"),b.textContent="Both",O(b),x=document.createElement("div"),x.className="mrz-format-btn",x.setAttribute("role","button"),x.setAttribute("tabindex","0"),x.textContent="Passport",O(x),z=document.createElement("div"),z.className="mrz-format-indicator",e.append(z,R,b,x),I.append(e)}return a.append(s,y),I&&a.appendChild(I),{overlay:a,closeBtn:l,uploadBtn:d,cameraSwitchBtn:u,flashBtn:g,flashOnIcon:f,flashOffIcon:p,soundBtn:w,soundOnIcon:C,soundOffIcon:v,badge:V,badgeLine1:L,badgeLine2:S,guideFrame:D,formatSelector:I,formatIdBtn:R,formatBothBtn:b,formatPassportBtn:x,formatIndicator:z}}({showUpload:n,showFormatSelector:i,showSoundToggle:a}),e.appendChild(this.ui.overlay),this.ui.closeBtn.addEventListener("click",()=>this.handleCloseBtn()),this.ui.uploadBtn.addEventListener("click",()=>this.uploadFile()),this.ui.cameraSwitchBtn.addEventListener("click",()=>this.switchCamera()),this.ui.flashBtn.addEventListener("click",()=>this.toggleFlash()),this.ui.soundBtn.addEventListener("click",()=>this.toggleSoundFeedback()),this.ui.formatIdBtn&&this.ui.formatIdBtn.addEventListener("click",()=>this.setFormatMode("id")),this.ui.formatBothBtn&&this.ui.formatBothBtn.addEventListener("click",()=>this.setFormatMode("both")),this.ui.formatPassportBtn&&this.ui.formatPassportBtn.addEventListener("click",()=>this.setFormatMode("passport")),this.toggleSoundFeedback(!1),this.syncFormatButtons(),this.ui.flashBtn.classList.add("mrz-hidden"),this.initializedUI=!0}shouldShowFormatSelector(){return Object.values(this.scanModeManager).filter(Boolean).length>1}async toggleFlash(){var e;try{const{cameraEnhancer:e}=this.resources;this.isFlashOn?(await e.turnOffTorch(),this.isFlashOn=!1):(await e.turnOnTorch(),this.isFlashOn=!0),this.syncFlashIcon()}catch(t){null===(e=this.ui)||void 0===e||e.flashBtn.classList.add("mrz-hidden")}}syncFlashIcon(){this.ui&&(this.ui.flashOnIcon.style.display=this.isFlashOn?"inline":"none",this.ui.flashOffIcon.style.display=this.isFlashOn?"none":"inline")}async probeFlashSupport(){var e,t;try{const{cameraEnhancer:t}=this.resources;await t.turnOffTorch(),null===(e=this.ui)||void 0===e||e.flashBtn.classList.remove("mrz-hidden")}catch(e){null===(t=this.ui)||void 0===t||t.flashBtn.classList.add("mrz-hidden")}}async switchCamera(){var e,t;try{const{cameraEnhancer:n}=this.resources,i=await n.getAllCameras();if(i.length<=1)return void(null===(e=this.ui)||void 0===e||e.cameraSwitchBtn.classList.add("mrz-hidden"));const a=n.getSelectedCamera();let s;if(s=(null==a?void 0:a.deviceId)===this.defaultBackCameraId?null!==(t=i.find(e=>/front|user|selfie/i.test(e.label)))&&void 0!==t?t:i.find(e=>e.deviceId!==this.defaultBackCameraId):i.find(e=>e.deviceId===this.defaultBackCameraId),!s)return;await n.selectCamera(s.deviceId),this.setGuideFrameVisible(!1),window.setTimeout(()=>{this.setGuideFrameVisible(!0),this.updateScanRegion()},300)}catch(e){console.warn("Camera switch failed:",(null==e?void 0:e.message)||e)}}toggleSoundFeedback(e){this.isSoundFeedbackOn=void 0!==e?e:!this.isSoundFeedbackOn,this.ui&&(this.ui.soundOnIcon.style.display=this.isSoundFeedbackOn?"inline":"none",this.ui.soundOffIcon.style.display=this.isSoundFeedbackOn?"none":"inline")}setGuideFrame(e){this.ui&&(this.ui.guideFrame.innerHTML="mrz"===e?k:'<svg width="354" height="221" viewBox="0 0 354 221" fill="none" xmlns="http://www.w3.org/2000/svg">\n<rect x="1" y="1" width="352" height="219" rx="15" stroke="currentColor" stroke-width="2"/>\n</svg>')}setGuideFrameVisible(e){this.ui&&(this.ui.guideFrame.style.visibility=e?"visible":"hidden")}showGuideSuccessBorder(e=1e3){this.ui&&(this.ui.guideFrame.classList.add("mrz-guide-success"),window.setTimeout(()=>{var e;null===(e=this.ui)||void 0===e||e.guideFrame.classList.remove("mrz-guide-success")},e))}showBadge(e,t,n,i){if(!this.ui)return;const{badge:a,badgeLine1:s,badgeLine2:r}=this.ui;s.textContent=e,s.className="mrz-badge-line"+(t?" mrz-success":""),void 0!==n?(r.textContent=n,r.className="mrz-badge-line"+(i?" mrz-success":""),r.style.display="block"):r.style.display="none",a.classList.add("mrz-badge-visible")}async setFormatMode(e){var t;const n={id:v.TD1,both:v.All,passport:v.Passport},i={id:{[C.Passport]:!1,[C.TD1]:!0,[C.TD2]:!0},both:{[C.Passport]:!0,[C.TD1]:!0,[C.TD2]:!0},passport:{[C.Passport]:!0,[C.TD1]:!1,[C.TD2]:!1}};try{this.scanModeManager=i[e],this.currentScanMode=n[e],this.stopCapturing(),this.updateScanRegion(),await this.startCapturing(),this.syncFormatButtons()}catch(e){console.error("MRZ Scanner switch scan mode error:",(null==e?void 0:e.message)||e),this.closeCamera(),null===(t=this.currentScanResolver)||void 0===t||t.call(this,new Z({status:L.RS_FAILED}))}}syncFormatButtons(){if(!this.ui)return;const{formatIdBtn:e,formatBothBtn:t,formatPassportBtn:n}=this.ui;if(!e||!t||!n)return;const i=this.scanModeManager[C.Passport]&&!this.scanModeManager[C.TD1]&&!this.scanModeManager[C.TD2],a=!this.scanModeManager[C.Passport]&&(this.scanModeManager[C.TD1]||this.scanModeManager[C.TD2]);e.className="mrz-format-btn"+(a?" mrz-format-active":""),n.className="mrz-format-btn"+(i?" mrz-format-active":""),t.className="mrz-format-btn"+(a||i?"":" mrz-format-active"),a?(n.style.order="1",e.style.order="2",t.style.order="3"):i?(t.style.order="1",n.style.order="2",e.style.order="3"):(e.style.order="1",t.style.order="2",n.style.order="3");const{formatIndicator:s}=this.ui;if(s){!function(e,t){const n=e.offsetWidth||32,i=t.offsetLeft+t.offsetWidth/2;e.style.left=i-n/2+"px"}(s,a?e:i?n:t)}}updateScanRegion(){if(!1===this.config.showScanGuide)return;let e=C.Passport;this.currentScanMode===v.TD1||this.currentScanMode===v.TD1AndTD2?e=C.TD1:this.currentScanMode===v.TD2&&(e=C.TD2),this.calculateScanRegion(e)}calculateScanRegion(e){const{cameraEnhancer:t,cameraView:n}=this.resources;if(!t||!t.isOpen())return;const i=A[e].width/A[e].height,a=n.getVisibleRegionOfVideo({inPixels:!0});if(!a)return;const{width:s,height:r}=a;let o;if(s>r){const e=.5*r*i,t=Math.round(e/s*100),n=(100-t)/2;o={left:n,right:n+t,top:25,bottom:75,isMeasuredInPercentage:!0}}else{const e=.9*s/i,t=Math.round(e/r*100),n=(100-t)/2;o={left:5,right:95,top:n,bottom:n+t,isMeasuredInPercentage:!0}}n.setScanRegionMaskVisible(!0),n.getDrawingLayer(1).setVisible(!1),n.getDrawingLayer(3).setVisible(!1),t.setScanRegion(o)}async openCamera(){var e,t,n;try{const{cameraEnhancer:n,cameraView:i}=this.resources,s=S(this.config.container);if(s.style.display="block",n.isOpen())n.isPaused()&&await n.resume();else{const e=i.getUIElement();e.parentElement||s.append(e),n.setPixelFormat(a.IPF_ABGR_8888),await n.open();const t=n.getSelectedCamera();t&&(this.defaultBackCameraId=t.deviceId);const r=e.shadowRoot;if(r){const e=r.querySelector(".dce-macro-use-mobile-native-like-ui");e&&(e.style.display="block")}}await n.setResolution({width:2560,height:1440}),!this.initializedUI&&n.isOpen()&&this.initializeUI();const r=await n.getAllCameras(),o=r.find(e=>/front|user|selfie/i.test(e.label));r.length>1&&(o||r.some(e=>e.deviceId!==this.defaultBackCameraId))?null===(e=this.ui)||void 0===e||e.cameraSwitchBtn.classList.remove("mrz-hidden"):null===(t=this.ui)||void 0===t||t.cameraSwitchBtn.classList.add("mrz-hidden"),await this.probeFlashSupport(),window.addEventListener("resize",this.handleResize)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),null===(n=this.currentScanResolver)||void 0===n||n.call(this,new Z({status:L.RS_FAILED}))}}async closeCamera(e=!0){var t;try{window.removeEventListener("resize",this.handleResize),this.resizeTimer&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null),this.defaultBackCameraId=null;const{cameraEnhancer:n,cameraView:i}=this.resources,a=S(this.config.container);a.style.display=e?"none":"block",(null==i?void 0:i.getUIElement().parentElement)&&a.removeChild(i.getUIElement()),(null===(t=this.ui)||void 0===t?void 0:t.overlay.parentElement)&&a.removeChild(this.ui.overlay),this.ui=null,this.initializedUI=!1,n.close(),this.stopCapturing()}catch(e){console.error(`Close Camera error: ${(null==e?void 0:e.message)||e}`)}}pauseCamera(){this.resources.cameraEnhancer.pause()}stopCapturing(){const{cameraView:e,cvRouter:t}=this.resources;t.stopCapturing(),e.clearAllInnerDrawingItems()}handleCloseBtn(){if(this.closeCamera(),this.currentScanResolver)if(this.isMRZScanned&&!this.isPortraitScanned&&(this.areSidesDifferent||this.isWaitingForPortraitAfterMRZ)){const e=new Z({status:L.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:this.mrzSideData.portraitImage});this.currentScanResolver(e),this.resetScanningState()}else this.currentScanResolver(new Z({status:L.RS_CANCELLED})),this.resetScanningState()}async uploadFile(){var e,t,i,a,d,h,u,m;const{cvRouter:g}=this.resources,p=document.createElement("input");p.type="file",p.accept=null!==(e=this.config.uploadAcceptedTypes)&&void 0!==e?e:"image/*",p.style.display="none",document.body.appendChild(p);try{this.showScannerLoadingOverlay("Processing file..."),await this.closeCamera(!1);const e=await new Promise((e,t)=>{p.onchange=n=>{var i;const a=null===(i=n.target.files)||void 0===i?void 0:i[0];a?e(a):t(new Error("No file selected"))},p.addEventListener("cancel",async()=>{this.hideScannerLoadingOverlay(!1),this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.setGuideFrameVisible(!0),this.updateScanRegion(),await this.startCapturing(),this.hideScannerLoadingOverlay()}),p.click()});if(!e)return;let m;if(this.config.uploadFileConverter&&!e.type.startsWith("image/"))try{m=await this.config.uploadFileConverter(e)}catch(e){throw new Error(`Error converting file: ${e.message}`)}else{if(!e.type.startsWith("image/"))throw new Error("Unsupported file type. Please provide a converter function for this file type.");m=e}const f=this.config.utilizedTemplateNames[this.currentScanMode],w=await g.capture(m,f);this.capturedResultItems=w.items;const v=this.capturedResultItems.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(0===v.length)throw new Error("No image data found in the captured result");const C=v[0].imageData;C.toCanvas=()=>s(C),C.toBlob=async()=>await r("image/png",C),this.originalImageData=C;const y=null===(t=null==w?void 0:w.parsedResult)||void 0===t?void 0:t.parsedResultItems;let V={};if(null==y?void 0:y.length){const e=(null===(a=null===(i=y[0])||void 0===i?void 0:i.referenceItem)||void 0===a?void 0:a.text)||"";V=P(e,y[0])}let S=null,D=null;if(this.resources.returnDocumentImage)try{const e=w.processedDocumentResult;if((null===(d=null==e?void 0:e.detectedQuadResultItems)||void 0===d?void 0:d.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==o.CVS_FAILED&&(D=t.location,S=await l.cropAndDeskewImage(this.originalImageData,D),S.toCanvas=()=>s(S),S.toBlob=async()=>await r("image/png",S))}}catch(e){console.warn("Error extracting document image from file upload:",e)}let I=null;if(this.resources.returnPortraitImage)try{const e=await c.findPortraitZone();if(e&&!e.errorCode){(!D||this.validatePortraitLocation(e,D))&&(I=await l.cropAndDeskewImage(this.originalImageData,e),I.toCanvas=()=>s(I),I.toBlob=async()=>await r("image/png",I))}}catch(e){console.warn("Error finding portrait zone in file upload:",e)}const R=new Z({status:L.RS_SUCCESS,data:V,primaryOriginalImage:this.originalImageData,primaryDocumentImage:S,portraitImage:I});null===(u=(h=this.resources).onResultUpdated)||void 0===u||u.call(h,R),this.currentScanResolver(R)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),null===(m=this.currentScanResolver)||void 0===m||m.call(this,new Z({status:L.RS_FAILED}))}finally{this.hideScannerLoadingOverlay(!0),document.body.removeChild(p)}}initializeScanModeManager(){const{mrzFormatType:e}=this.config;if(this.scanModeManager={[C.Passport]:!0,[C.TD1]:!0,[C.TD2]:!0},!e||Array.isArray(e)&&0===e.length)return;Object.keys(this.scanModeManager).forEach(e=>{this.scanModeManager[e]=!1});(Array.isArray(e)?e:[e]).forEach(e=>{this.scanModeManager[e]=!0})}getScanMode(){const e=Object.entries(this.scanModeManager).filter(([e,t])=>t).map(([e])=>e).sort().join(",");return{[C.Passport]:v.Passport,[C.TD1]:v.TD1,[C.TD2]:v.TD2,[`${C.Passport},${C.TD1}`]:v.PassportAndTD1,[`${C.Passport},${C.TD2}`]:v.PassportAndTD2,[`${C.TD1},${C.TD2}`]:v.TD1AndTD2,[`${C.Passport},${C.TD1},${C.TD2}`]:v.All,"":v.All}[e]}async startCapturing(){var e;const{cvRouter:t}=this.resources,n=this.config.utilizedTemplateNames[this.currentScanMode];try{this.firstFrame=!0,await t.startCapturing(n)}catch(t){let n=(null==t?void 0:t.message)||t;console.error("Failed to start capturing:",n),this.closeCamera(),null===(e=this.currentScanResolver)||void 0===e||e.call(this,new Z({status:L.RS_FAILED}))}}async launch(){var e;try{return this.resetScanningState(),await this.initialize(),new Promise(async e=>{this.currentScanResolver=e,this.showScannerLoadingOverlay("Initializing camera..."),await this.openCamera(),this.setGuideFrame("mrz"),this.setGuideFrameVisible(!0),this.updateScanRegion(),await this.startCapturing(),this.hideScannerLoadingOverlay(),this.resources.returnPortraitImage?this.showBadge("Scan the MRZ side first",!1):this.showBadge("Scan the MRZ side of the document",!1)})}catch(t){let n=(null==t?void 0:t.message)||t;console.error("MRZ Scanner launch error:",n),this.closeCamera(),null===(e=this.currentScanResolver)||void 0===e||e.call(this,new Z({status:L.RS_FAILED}))}}async handleMRZResult(e){var t,i,a,c,h;if(this.firstFrame)this.firstFrame=!1;else{if(this.isMRZScanned&&!this.isPortraitScanned&&this.isWaitingForPortraitAfterMRZ){const{onResultUpdated:t}=this.resources;return void await this.tryPortraitOnSameSide(e,t)}if(this.isMRZScanned&&!this.isPortraitScanned&&this.areSidesDifferent&&!this.isWaitingForFlip){const t=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(t.length>0){const e=t[0].imageData;e.toCanvas=()=>s(e),e.toBlob=async()=>await r("image/png",e),this.originalImageData=e}return void await this.handlePortraitSideScan(e,this.resources.onResultUpdated)}if(!(e.items.length<=1)){this.capturedResultItems=e.items;try{const{onResultUpdated:h}=this.resources,u=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(u.length>0){const e=u[0].imageData;e.toCanvas=()=>s(e),e.toBlob=async()=>await r("image/png",e),this.originalImageData=e}const m=null===(t=null==e?void 0:e.parsedResult)||void 0===t?void 0:t.parsedResultItems;if(null==m?void 0:m.length){this.isSoundFeedbackOn&&d.beep();const t=(null===(a=null===(i=m[0])||void 0===i?void 0:i.referenceItem)||void 0===a?void 0:a.text)||"",n=P(t,m[0]);let u=null;if(this.resources.returnDocumentImage||this.resources.returnPortraitImage){const t=e.processedDocumentResult;if((null===(c=null==t?void 0:t.detectedQuadResultItems)||void 0===c?void 0:c.length)>0){const e=t.detectedQuadResultItems[0];e.CrossVerificationStatus!==o.CVS_FAILED&&(u=e.location)}if(this.resources.returnDocumentImage&&!u)return}let g=null;if(this.resources.returnDocumentImage&&u&&this.originalImageData)try{g=await l.cropAndDeskewImage(this.originalImageData,u),g.toCanvas=()=>s(g),g.toBlob=async()=>await r("image/png",g)}catch(e){console.warn("Error extracting document image:",e)}this.isMRZScanned||await this.handleMRZSideScan(n,g,u,h)}}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t),this.closeCamera(),null===(h=this.currentScanResolver)||void 0===h||h.call(this,new Z({status:L.RS_FAILED}))}}}}async handleMRZSideScan(e,t,n,i){let a=null,o=!1;if(this.resources.returnPortraitImage)try{const e=await c.findPortraitZone();if(e&&!e.errorCode){(!n||this.validatePortraitLocation(e,n))&&this.originalImageData&&(a=await l.cropAndDeskewImage(this.originalImageData,e),a.toCanvas=()=>s(a),a.toBlob=async()=>await r("image/png",a),o=!0)}}catch(e){console.warn("Error finding portrait zone:",e)}if(this.isMRZScanned=!0,this.mrzSideData={processedData:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:a},this.resources.returnPortraitImage&&!o)this.isWaitingForPortraitAfterMRZ=!0,this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Scanning portrait...",!1),this.flipTimeoutHandle=window.setTimeout(()=>{var e;if(this.flipTimeoutHandle=null,this.isWaitingForPortraitAfterMRZ=!1,this.isPortraitScanned)return;this.areSidesDifferent=!0,this.isWaitingForFlip=!0;const t=null!==(e=this.config.flipDocumentTimeout)&&void 0!==e?e:3e3;let n=Math.ceil(t/1e3);this.setGuideFrame("portrait"),this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,`Flip and scan the other side (${n}s)`,!1),this.flipCountdownHandle=window.setInterval(()=>{n--,n>0&&this.showBadge("MRZ scanned ✓",!0,`Flip and scan the other side (${n}s)`,!1)},1e3),this.flipTimeoutHandle=window.setTimeout(()=>{window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null,this.flipTimeoutHandle=null,this.isWaitingForFlip=!1,this.showBadge("MRZ scanned ✓",!0,"Now scan the portrait side",!1)},t)},1500);else{this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.showGuideSuccessBorder(1e3);const n=a?"Portrait scanned ✓":void 0;this.showBadge("MRZ scanned ✓",!0,n,!!n),setTimeout(()=>{var n;this.closeCamera();const s=new Z({status:L.RS_SUCCESS,data:e,primaryOriginalImage:this.originalImageData,primaryDocumentImage:t,portraitImage:a});null==i||i(s),null===(n=this.currentScanResolver)||void 0===n||n.call(this,s),this.resetScanningState()},1e3)}}async tryPortraitOnSameSide(e,t){var i;if(!this.isWaitingForPortraitAfterMRZ)return;this.isWaitingForPortraitAfterMRZ=!1;let a=!1;try{const d=e.items.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE);if(d.length>0){const e=d[0].imageData;e.toCanvas=()=>s(e),e.toBlob=async()=>await r("image/png",e),this.originalImageData=e}const h=await c.findPortraitZone();if(this.isPortraitScanned)return;if(h&&!h.errorCode){let n=null;const c=e.processedDocumentResult;if((null===(i=null==c?void 0:c.detectedQuadResultItems)||void 0===i?void 0:i.length)>0){const e=c.detectedQuadResultItems[0];e.CrossVerificationStatus!==o.CVS_FAILED&&(n=e.location)}if((!n||this.validatePortraitLocation(h,n))&&this.originalImageData){a=!0;const e=await l.cropAndDeskewImage(this.originalImageData,h);e.toCanvas=()=>s(e),e.toBlob=async()=>await r("image/png",e),null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),this.areSidesDifferent=!1,this.isPortraitScanned=!0,this.mrzSideData.portraitImage=e,this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Portrait scanned ✓",!0),setTimeout(()=>{var n;this.closeCamera();const i=new Z({status:L.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,portraitImage:e});null==t||t(i),null===(n=this.currentScanResolver)||void 0===n||n.call(this,i),this.resetScanningState()},1e3)}}}catch(e){console.warn("tryPortraitOnSameSide error:",e)}finally{a||null===this.flipTimeoutHandle||(this.isWaitingForPortraitAfterMRZ=!0)}}async handlePortraitSideScan(e,t){var n;if(this.isProcessingPortraitFrame)return;this.isProcessingPortraitFrame=!0;let i=!1;try{const a=await c.findPortraitZone();if(a&&!a.errorCode&&this.originalImageData){i=!0,this.isPortraitScanned=!0;let c=this.originalImageData,d=null;if(this.resources.returnDocumentImage)try{const t=e.processedDocumentResult;if((null===(n=null==t?void 0:t.detectedQuadResultItems)||void 0===n?void 0:n.length)>0){const e=t.detectedQuadResultItems[0];e.CrossVerificationStatus!==o.CVS_FAILED&&(d=await l.cropAndDeskewImage(this.originalImageData,e.location),d.toCanvas=()=>s(d),d.toBlob=async()=>await r("image/png",d))}}catch(e){console.warn("Error extracting secondary document image:",e)}let h=null;try{h=await l.cropAndDeskewImage(this.originalImageData,a),h.toCanvas=()=>s(h),h.toBlob=async()=>await r("image/png",h)}catch(e){console.warn("Error cropping portrait image:",e)}this.showGuideSuccessBorder(1e3),this.showBadge("MRZ scanned ✓",!0,"Both sides scanned ✓",!0),setTimeout(()=>{var e;this.closeCamera();const n=new Z({status:L.RS_SUCCESS,data:this.mrzSideData.processedData,primaryOriginalImage:this.mrzSideData.primaryOriginalImage,secondaryOriginalImage:c,primaryDocumentImage:this.mrzSideData.primaryDocumentImage,secondaryDocumentImage:d,portraitImage:h||this.mrzSideData.portraitImage});null==t||t(n),null===(e=this.currentScanResolver)||void 0===e||e.call(this,n),this.resetScanningState()},1e3)}}catch(e){console.warn("Error finding portrait on second side:",e)}finally{i||(this.isProcessingPortraitFrame=!1)}}resetScanningState(){this.isMRZScanned=!1,this.isPortraitScanned=!1,this.areSidesDifferent=!1,this.isWaitingForFlip=!1,this.isWaitingForPortraitAfterMRZ=!1,this.isProcessingPortraitFrame=!1,null!==this.flipTimeoutHandle&&(window.clearTimeout(this.flipTimeoutHandle),this.flipTimeoutHandle=null),null!==this.flipCountdownHandle&&(window.clearInterval(this.flipCountdownHandle),this.flipCountdownHandle=null),this.mrzSideData={processedData:null,primaryOriginalImage:null,primaryDocumentImage:null,portraitImage:null}}validatePortraitLocation(e,t){return!!e.points.every(e=>this.isPointInQuadrilateral(e,t))&&t.area/e.area>=3}isPointInQuadrilateral(e,t){const n=t.points;let i=!1;for(let t=0,a=n.length-1;t<n.length;a=t++){const s=n[t].x,r=n[t].y,o=n[a].x,l=n[a].y;r>e.y!=l>e.y&&e.x<(o-s)*(e.y-r)/(l-r)+s&&(i=!i)}return i}}const B={cancel:'\n<svg id="cancel" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n  <defs>\n    <clipPath id="cancelclip-path">\n      <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n    </clipPath>\n  </defs>\n  <g id="Group_582" data-name="Group 582" clip-path="url(#cancelclip-path)" transform="rotate(180 12 12)">\n    <path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n    <path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n  </g>\n</svg>  \n  ',rescan:'<svg id="re-take" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="28.761" height="23" viewBox="0 0 28.761 23">\n<defs>\n<clipPath id="retakeclip-path">\n  <rect id="Rectangle_2773" data-name="Rectangle 2773" width="28.761" height="23" fill="#fff"/>\n</clipPath>\n</defs>\n<g id="Group_580" data-name="Group 580" clip-path="url(#retakeclip-path)">\n<path id="Path_1522" data-name="Path 1522" d="M25.877,3.639H21.663a.7.7,0,0,1-.575-.288l-.575-.764C19.264.961,18.59,0,17.44,0H11.4C10.151,0,9.486.961,8.336,2.588l-.674.764a.7.7,0,0,1-.575.288H2.875C.476,3.639,0,5.077,0,6.227v13.9C0,22.041,1.051,23,2.974,23H25.787c1.914,0,2.974-.961,2.974-2.776v-14c-.008-1.147-.485-2.585-2.884-2.585m-.1,18.411H2.974c-1.339,0-2.013-.575-2.013-1.824v-14c0-.863.189-1.626,1.914-1.626H7.188a1.666,1.666,0,0,0,1.339-.674L9.1,3.162c1.15-1.626,1.536-2.2,2.2-2.2H17.34c.674,0,1.15.575,2.3,2.2l.575.764a1.562,1.562,0,0,0,1.339.674h4.313c1.725,0,1.914.764,1.914,1.626v14h.009c0,1.249-.673,1.824-2.012,1.824" fill="#fff"/>\n<path id="Path_1523" data-name="Path 1523" d="M15.978,9.16H9.462l1.745-1.743A.5.5,0,0,0,10.5,6.71l-2.6,2.6a.484.484,0,0,0-.108.162.5.5,0,0,0,0,.382.479.479,0,0,0,.108.163l2.6,2.6a.5.5,0,0,0,.708-.708L9.462,10.16h6.516a4.028,4.028,0,0,1,0,8.055H10.255a.5.5,0,1,0,0,1h5.723a5.028,5.028,0,0,0,0-10.055" fill="#fff"/>\n</g>\n</svg>\n',complete:'\n<svg id="continue" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24">\n<defs>\n<clipPath id="continueclip-path">\n  <rect id="Rectangle_2774" data-name="Rectangle 2774" width="24" height="24" fill="currentColor"/>\n</clipPath>\n</defs>\n<g id="Group_582" data-name="Group 582" clip-path="url(#continueclip-path)">\n<path id="Path_1524" data-name="Path 1524" d="M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0m0,23A11,11,0,1,1,23,12,11.013,11.013,0,0,1,12,23" fill="currentColor"/>\n<path id="Path_1525" data-name="Path 1525" d="M19.862,12a.17.17,0,0,0,0-.024.512.512,0,0,0-.033-.168.532.532,0,0,0-.113-.17l-4.219-4.29a.5.5,0,0,0-.714,0,.51.51,0,0,0,0,.719l3.371,3.428H4.643a.509.509,0,0,0,0,1.018h13.5l-3.373,3.428a.512.512,0,0,0,0,.72.5.5,0,0,0,.714,0l4.224-4.295a.438.438,0,0,0,.056-.086.5.5,0,0,0,.051-.078A.521.521,0,0,0,19.862,12h0" fill="currentColor"/>\n</g>\n</svg>\n',failed:'\n  <svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="20"\n  height="20"\n  viewBox="0 0 20 20"\n  fill="none"\n  stroke="#ef4444"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M18 6l-12 12" />\n  <path d="M6 6l12 12" />\n</svg>\n',info:'\n<svg\n  xmlns="http://www.w3.org/2000/svg"\n  width="24"\n  height="24"\n  viewBox="0 0 24 24"\n  fill="none"\n  stroke="white"\n  stroke-width="2"\n  stroke-linecap="round"\n  stroke-linejoin="round"\n>\n  <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />\n  <path d="M12 9h.01" />\n  <path d="M11 12h1v4h1" />\n</svg>\n'};class _{constructor(e,t,n){this.resources=e,this.config=t,this.scannerView=n,this.editedFields={}}async launch(){try{return S(this.config.container).textContent="",await this.initialize(),S(this.config.container).style.display="flex",new Promise(e=>{this.currentScanResultViewResolver=e})}catch(e){let t=(null==e?void 0:e.message)||e;throw console.error(t),t}}async handleRescan(){try{if(!this.scannerView)return void console.error("Scanner View not initialized");this.hideView();const e=await this.scannerView.launch();if((null==e?void 0:e.status)===L.RS_FAILED)return void(this.currentScanResultViewResolver&&this.currentScanResultViewResolver(e));this.resources.onResultUpdated&&((null==e?void 0:e.status)===L.RS_CANCELLED?this.resources.onResultUpdated(this.resources.result):(null==e?void 0:e.status)===L.RS_SUCCESS&&this.resources.onResultUpdated(e)),this.dispose(!0),await this.initialize(),S(this.config.container).style.display="flex"}catch(e){throw console.error("Error in rescan handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Z({status:L.RS_FAILED})),e}}async handleCancel(){var e;try{(null===(e=this.config)||void 0===e?void 0:e.onCancel)&&await this.config.onCancel(this.resources.result),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Z({status:L.RS_CANCELLED})),this.hideView(),this.dispose()}catch(e){throw console.error("Error in cancel handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Z({status:L.RS_FAILED})),e}}async handleDone(){var e,t;try{(null===(e=this.resources.result)||void 0===e?void 0:e.data)&&!I(this.editedFields)&&(this.resources.result.data=Object.assign(Object.assign({},this.resources.result.data),this.editedFields),this.resources.onResultUpdated&&this.resources.onResultUpdated(this.resources.result)),(null===(t=this.config)||void 0===t?void 0:t.onDone)&&await this.config.onDone(this.resources.result),this.currentScanResultViewResolver&&this.resources.result&&this.currentScanResultViewResolver(this.resources.result),this.hideView(),this.dispose()}catch(e){throw console.error("Error in done handler:",e),this.currentScanResultViewResolver&&this.currentScanResultViewResolver(new Z({status:L.RS_FAILED})),e}}createControls(){var e,t,n,i,a,s,r,o,l,c,d,h;const{toolbarButtonsConfig:u}=this.config;return function(e){D("dynamsoft-mrz-controls-style","\n  .dynamsoft-mrz-controls {\n    display: flex;\n    height: 6rem;\n    background-color: #323234;\n    align-items: center;\n    font-size: 12px;\n    font-family: Verdana;\n    color: white;\n    width: 100%;\n  }\n\n  .dynamsoft-mrz-control-btn {\n    background-color: #323234;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    height: 100%;\n    width: 100%;\n    gap: 0.5rem;\n    text-align: center;\n    user-select: none;\n  }\n\n  .dynamsoft-mrz-control-btn.hide {\n    display: none;\n  }\n\n  .dynamsoft-mrz-control-btn.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n    cursor: default;\n  }\n\n  .dynamsoft-mrz-control-icon-wrapper {\n    flex: 0.75;\n    display: flex;\n    align-items: flex-end;\n    justify-content: center;\n    min-height: 40px;\n  }\n\n  .dynamsoft-mrz-control-icon img,\n  .dynamsoft-mrz-control-icon svg {\n    width: 32px;\n    height: 32px;\n    fill: #fe8e14;\n  }\n\n  .dynamsoft-mrz-control-text {\n    flex: 0.5;\n    display: flex;\n    align-items: flex-start;\n    justify-content: center;\n    padding-bottom: 0.5rem;\n  }\n\n  \n    @media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-controls {\n      flex-direction: column;\n      height: 100%;\n      width: 5rem;\n    }\n\n    .dynamsoft-mrz-control-text {\n      padding: 0 0.5rem 0.5rem;\n    }\n  }\n");const t=document.createElement("div");return t.className="dynamsoft-mrz-controls",e.forEach(e=>{const n=document.createElement("div");n.className=`dynamsoft-mrz-control-btn ${null==e?void 0:e.className}`;const i=document.createElement("div");if(i.className="dynamsoft-mrz-control-icon-wrapper",(a=e.icon).trim().startsWith("<svg")&&a.trim().endsWith("</svg>"))i.innerHTML=e.icon;else{const t=document.createElement("img");t.src=e.icon,t.alt=e.label,t.width=24,t.height=24,i.appendChild(t)}var a;const s=document.createElement("div");s.className="dynamsoft-mrz-control-text",s.textContent=e.label,e.isDisabled&&n.classList.add("disabled"),e.isHidden&&n.classList.add("hide"),n.appendChild(i),n.appendChild(s),e.onClick&&!e.isDisabled&&n.addEventListener("click",e.onClick),t.appendChild(n)}),t}([this.config._isFileMode?{id:"dynamsoft-mrz-scanResult-cancel",icon:(null===(e=null==u?void 0:u.cancel)||void 0===e?void 0:e.icon)||B.cancel,label:(null===(t=null==u?void 0:u.cancel)||void 0===t?void 0:t.label)||"Cancel",onClick:()=>this.handleCancel(),className:`${(null===(n=null==u?void 0:u.cancel)||void 0===n?void 0:n.className)||""}`,isHidden:(null===(i=null==u?void 0:u.cancel)||void 0===i?void 0:i.isHidden)||!1}:{id:"dynamsoft-mrz-scanResult-rescan",icon:(null===(a=null==u?void 0:u.rescan)||void 0===a?void 0:a.icon)||B.rescan,label:(null===(s=null==u?void 0:u.rescan)||void 0===s?void 0:s.label)||"Re-scan",onClick:()=>this.handleRescan(),className:`${(null===(r=null==u?void 0:u.rescan)||void 0===r?void 0:r.className)||""}`,isHidden:(null===(o=null==u?void 0:u.rescan)||void 0===o?void 0:o.isHidden)||!1,isDisabled:!this.scannerView},{id:"dynamsoft-mrz-scanResult-done",icon:(null===(l=null==u?void 0:u.done)||void 0===l?void 0:l.icon)||B.complete,label:(null===(c=null==u?void 0:u.done)||void 0===c?void 0:c.label)||"Done",className:`${(null===(d=null==u?void 0:u.done)||void 0===d?void 0:d.className)||""}`,isHidden:(null===(h=null==u?void 0:u.done)||void 0===h?void 0:h.isHidden)||!1,onClick:()=>this.handleDone()}])}getImagesToDisplay(){const e=[],t=this.resources.result;if(!t)return e;if(this.resources.returnOriginalImage){const n=t.getOriginalImage(w.MRZ);n&&e.push({imageData:n,label:"Original Image (MRZ Side)"});const i=t.getOriginalImage(w.Opposite);i&&e.push({imageData:i,label:"Original Image (Portrait Side)"})}if(this.resources.returnDocumentImage){const n=t.getDocumentImage(w.MRZ);n&&e.push({imageData:n,label:"Document Image (MRZ Side)"});const i=t.getDocumentImage(w.Opposite);i&&e.push({imageData:i,label:"Document Image (Portrait Side)"})}if(this.resources.returnPortraitImage){const n=t.getPortraitImage();n&&e.push({imageData:n,label:"Portrait Image"})}return e}createImagesDisplay(){const e=this.getImagesToDisplay();if(0===e.length)return null;const t=document.createElement("div");return t.className="dynamsoft-mrz-images-container",e.forEach(({imageData:e,label:n})=>{const i=document.createElement("div");i.className="dynamsoft-mrz-image-wrapper";const a=document.createElement("div");let s;a.className="dynamsoft-mrz-image-label",a.textContent=n,i.appendChild(a),(null==e?void 0:e.toCanvas)&&(s=e.toCanvas()),s&&(Object.assign(s.style,{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),i.appendChild(s)),t.appendChild(i)}),t}handleFieldEdit(e,t){if(e===z.DateOfBirth||e===z.DateOfExpiry)try{const[n,i,a]=t.split(/[\/\-\.]/);a&&i&&n&&(this.editedFields[e]={day:parseInt(a,10),month:parseInt(i,10),year:parseInt(n,10)})}catch(e){console.error("Error parsing date",e)}else this.editedFields[e]=t}createMRZDataDisplay(){var e,t,n,i;const a=(null===(e=this.resources.result)||void 0===e?void 0:e.data)||{},s=!!this.config.allowResultEditing,r=a.invalidFields||[],o=[z.InvalidFields,z.IssuingStateRaw,z.NationalityRaw];!1===(null===(t=this.config)||void 0===t?void 0:t.showMRZText)&&o.push(z.MRZText);const l=document.createElement("div");if(l.className="dynamsoft-mrz-data-container",I(a)){const e=document.createElement("div");return e.className="dynamsoft-mrz-data-row empty",e.innerText=null!==(i=null===(n=this.config)||void 0===n?void 0:n.emptyResultMessage)&&void 0!==i?i:"The necessary information could not be detected. Please try again.",l.appendChild(e),l}if(r.length>0){const e=document.createElement("div");e.className="dynamsoft-mrz-error-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-error-icon">${B.failed}</div>\n          <div class="dynamsoft-mrz-error-message">\n            ${s?"Some fields require correction. Please review highlighted fields.":"Some fields contain invalid information. Please rescan the document."}\n          </div>\n        `,l.appendChild(e)}else if(0===r.length&&s){const e=document.createElement("div");e.className="dynamsoft-mrz-info-notification",e.innerHTML=`\n          <div class="dynamsoft-mrz-info-icon">${B.info}</div>\n          <div class="dynamsoft-mrz-info-message">\n            Please review all fields to ensure the information is correct.\n          </div>\n        `,l.appendChild(e)}return Object.entries(a).forEach(([e,t])=>{if(o.includes(e)||!t)return;const n=document.createElement("div");n.className="dynamsoft-mrz-data-row";const i=r.includes(e);i&&n.classList.add("invalid-field");const a=[z.MRZText,z.DocumentType,z.IssuingStateRaw,z.NationalityRaw],c=document.createElement("span");if(c.className="dynamsoft-mrz-data-label",c.innerText=M[e]||e,i){const e=document.createElement("span");if(e.className="dynamsoft-mrz-error-icon",e.innerHTML=B.failed,c.appendChild(e),s){const e=document.createElement("span");e.className="dynamsoft-mrz-error-hint",e.textContent="Please correct this field",c.appendChild(e)}}const d=document.createElement("div");if(d.className="dynamsoft-mrz-data-value",s&&!a.includes(e)){const a=document.createElement("input");a.className="dynamsoft-mrz-data-input",i&&a.classList.add("invalid"),e===z.DateOfBirth||e===z.DateOfExpiry?(a.value=T(t),a.setAttribute("placeholder","YYYY-MM-DD")):a.value=t,a.addEventListener("input",t=>{if(this.handleFieldEdit(e,t.target.value),i){a.classList.remove("invalid"),n.classList.remove("invalid-field"),this.editedFields.invalidFields||(this.editedFields.invalidFields=[...r]);const t=this.editedFields.invalidFields.indexOf(e);t>-1&&this.editedFields.invalidFields.splice(t,1)}}),d.appendChild(a)}else e===z.MRZText?(d.classList.add("code"),d.innerText=t):e===z.DateOfBirth||e===z.DateOfExpiry?d.innerText=T(t):d.innerText=t,i&&d.classList.add("invalid-value");n.appendChild(c),n.appendChild(d),l.appendChild(n)}),l}async initialize(){try{if(!this.resources.result)throw Error("Captured image is missing. Please capture an image first!");if(!this.config.container)throw new Error("Please create a Scan Result View Container element");D("dynamsoft-mrz-result-view-style",U);const e=document.createElement("div");e.className="dynamsoft-mrz-result-view-container";const t=this.createImagesDisplay();t&&e.appendChild(t);const n=this.createMRZDataDisplay();e.appendChild(n);const i=this.createControls();e.appendChild(i),S(this.config.container).appendChild(e)}catch(e){let t=(null==e?void 0:e.message)||e;console.error(t),alert(t)}}hideView(){S(this.config.container).style.display="none"}dispose(e=!1){S(this.config.container).textContent="",e||(this.currentScanResultViewResolver=void 0)}}const U="\n .dynamsoft-mrz-result-view-container {\n    display: flex;\n    width: 100%;\n    height: 100%;\n    background-color:#575757;\n    font-size: 12px;\n    flex-direction: column;\n    align-items: center;\n  }\n\n  .dynamsoft-mrz-images-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    width: 100%;\n    max-height: 300px;\n    overflow-y: auto;\n    padding: 1rem;\n    background-color: #323234;\n  }\n\n  .dynamsoft-mrz-image-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    background: #2a2a2c;\n    padding: 0.75rem;\n    border-radius: 6px;\n    border: 1px solid #404042;\n  }\n\n  .dynamsoft-mrz-image-label {\n    font-size: 0.85rem;\n    color: #aaa;\n    text-align: center;\n    font-weight: 500;\n    margin-bottom: 0.25rem;\n  }\n\n    \n.dynamsoft-mrz-data-container {\n  font-size: 16px;\n  font-family: Verdana;\n  color: white;\n  overflow: auto;\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  margin: 1rem 0;\n}\n\n.dynamsoft-mrz-data-row {\n  padding: 0.5rem 2rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  transition: background-color 0.3s ease;\n}\n\n.dynamsoft-mrz-data-row.invalid-field {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-left: 3px solid #e74c3c;\n  padding-left: calc(2rem - 3px);\n}\n\n.dynamsoft-mrz-data-label {\n  color: #aaa;\n  display: flex;\n  gap: 0.5rem;\n  align-items: end;\n  flex-wrap: wrap;\n}\n\n.dynamsoft-mrz-error-notification,\n.dynamsoft-mrz-info-notification {\n  color: white;\n  padding: 1rem;\n  margin: 0.5rem 2rem;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  text-align: start;\n}\n\n.dynamsoft-mrz-error-notification {\n  background-color: rgba(231, 76, 60, 0.2);\n}\n\n.dynamsoft-mrz-info-notification {\n  background-color: #fe8e14;\n}\n\n.dynamsoft-mrz-edit-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #aaa;\n}\n\n.dynamsoft-mrz-error-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-info-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.dynamsoft-mrz-info-message,\n.dynamsoft-mrz-error-message {\n  flex: 1;\n}\n\n.dynamsoft-mrz-error-hint {\n  font-size: 0.8rem;\n  color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-value {\n  word-wrap: break-word;\n  text-align: start;\n}\n\n.dynamsoft-mrz-data-value.code {\n  font-family: monospace;\n}\n\n.dynamsoft-mrz-data-value.invalid-value {\n  color: #e74c3c;\n  text-decoration: wavy underline #e74c3c;\n  text-decoration-skip-ink: none;\n}\n\n.dynamsoft-mrz-data-input {\n  width: 100%;\n  padding: 5px;\n  background-color: rgba(255, 255, 255, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  color: white;\n  border-radius: 4px;\n  font-size: 14px;\n  transition: all 0.3s ease;\n}\n\n.dynamsoft-mrz-data-input.invalid {\n  background-color: rgba(231, 76, 60, 0.1);\n  border-color: #e74c3c;\n}\n\n.dynamsoft-mrz-data-input:focus {\n  background-color: rgba(255, 255, 255, 0.2);\n  border-color: #fe8e14;\n  outline: none;\n}\n\n@media screen and (orientation: landscape) and (max-width: 1024px) and (max-height: 600px) {\n    .dynamsoft-mrz-result-view-container {\n      flex-direction: row;\n    }\n\n    .dynamsoft-mrz-images-container{\n      flex: 1;\n      height: 100%;\n      max-height: none;\n    }\n\n    .dynamsoft-mrz-data-container{\n      flex: 1;\n    }\n\n    .dynamsoft-mrz-data-row:first-of-type    {\n    padding-top: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row:last-of-type {\n      padding-bottom: 2rem;\n    }\n\n    .dynamsoft-mrz-data-row.empty {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 100%;\n      padding-top: 0;\n      padding-bottom: 0;\n    }\n}\n",G={rootDirectory:"./resources/",dcvBundle:"./resources/dynamsoft-capture-vision-bundle@3.4.1000-dev-20260214095351/dist/",dcvData:"./resources/dynamsoft-capture-vision-data@1.2.0-dev-20260121170704/"};class j{showLoadingOverlay(e){var t,n;const i=S(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||S(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen=b(i,{message:e}),i.style.display="block",i.style.position="relative"}hideLoadingOverlay(e=!1){var t,n,i;const a=S(null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.container)||S(null===(n=this.config.resultViewConfig)||void 0===n?void 0:n.container);this.loadingScreen&&(this.loadingScreen.hide(),this.loadingScreen=null,a.style.display="none",e&&(null===(i=this.config)||void 0===i?void 0:i.container)&&(S(this.config.container).style.display="none"))}constructor(e){this.config=e,this.resources={},this.isInitialized=!1,this.isCapturing=!1,this.loadingScreen=null,this.isDynamsoftResourcesLoaded=!1,this.isFileMode=!1,this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources()}async initialize(){var e,t,n;if(this.isInitialized)return{resources:this.resources,components:{scannerView:this.scannerView,resultView:this.resultView}};try{if(!this.initializeMRZScannerConfig())return console.error("Failed to initialize mrz scanner config"),{resources:this.resources,components:{}};D("dynamsoft-mrz-loading-screen-style",x),this.showLoadingOverlay("Loading..."),await this.initializeDCVResources(),this.resources.onResultUpdated=e=>{this.resources.result=e},this.resources.returnOriginalImage=null!==(e=this.config.returnOriginalImage)&&void 0!==e&&e,this.resources.returnDocumentImage=null===(t=this.config.returnDocumentImage)||void 0===t||t,this.resources.returnPortraitImage=null===(n=this.config.returnPortraitImage)||void 0===n||n;const i={};return!this.isFileMode&&this.config.scannerViewConfig&&(this.scannerView=new H(this.resources,this.config.scannerViewConfig),i.scannerView=this.scannerView,await this.scannerView.initialize()),this.config.resultViewConfig&&(this.resultView=new _(this.resources,this.config.resultViewConfig,this.scannerView),i.resultView=this.resultView),this.isInitialized=!0,{resources:this.resources,components:i}}catch(e){this.isInitialized=!1;const t=`Initialization Failed: ${(null==e?void 0:e.message)||e}`;throw console.error(t),new Error(t)}finally{this.hideLoadingOverlay(!0)}}initializeDynamsoftResources(){var e;h.engineResourcePaths=I(null===(e=this.config)||void 0===e?void 0:e.engineResourcePaths)?G:this.config.engineResourcePaths,h.loadWasm(),u.loadSpec("MRTD"),this.isDynamsoftResourcesLoaded=!0}async initializeDCVResources(){var e,t,n,i;try{this.isDynamsoftResourcesLoaded||this.initializeDynamsoftResources(),m._onAuthMessage=e=>e.replace("(https://www.dynamsoft.com/customer/license/trialLicense?product=unknown&deploymenttype=unknown)","(https://www.dynamsoft.com/customer/license/trialLicense?product=mrz&deploymenttype=web)"),await m.initLicense((null===(e=this.config)||void 0===e?void 0:e.license)||"",{executeNow:!0}),this.isFileMode||(this.resources.cameraView=await g.createInstance((null===(t=this.config.scannerViewConfig)||void 0===t?void 0:t.uiPath)||(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.cameraEnhancerUIPath)),this.resources.cameraEnhancer=await p.createInstance(this.resources.cameraView)),this.resources.cvRouter=await f.createInstance(),await this.resources.cvRouter.initSettings(this.config.templateFilePath)}catch(e){let t="string"==typeof e?e:null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"object"==typeof e?JSON.stringify(e):String(e);const n=(null==t?void 0:t.toLowerCase().includes("license"))?"The MRZ Scanner license is invalid or has expired. Please contact the site administrator to resolve this issue.":`Resource Initialization Failed: ${t}`;throw console.error(n),new Error(n)}}shouldCreateDefaultContainer(){var e,t;const n=!this.config.container,i=!((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)||(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container));return n&&i}createDefaultMRZScannerContainer(){const e=document.createElement("div");return e.className="mrz-scanner-main-container",Object.assign(e.style,{height:"100dvh",width:"100%",position:"absolute",left:"0",top:"0",zIndex:"999"}),document.body.append(e),e}checkForTemporaryLicense(e){return!(null==e?void 0:e.length)||(null==e?void 0:e.startsWith("A"))||(null==e?void 0:e.startsWith("L"))||(null==e?void 0:e.startsWith("P"))||(null==e?void 0:e.startsWith("Y"))?"DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9":e}validateViewConfigs(){var e,t,n,i,a,s,r,o;if(!this.config.container){if((null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container)&&this.config.showResultView&&!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container)){const e="MRZResultView container is required when showResultView is true";return alert(e),console.error(e),!1}if(!(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)&&(null===(i=this.config.resultViewConfig)||void 0===i?void 0:i.container)&&!this.resources.result){const e="Result is needed to create MRZResultView without a scanner view";return alert(e),console.error(e),!1}}try{if(this.config.container&&!S(this.config.container)){const e="Invalid main container reference";return alert(e),console.error(e),!1}if((null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.container)&&!S(null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.container)){const e="Invalid scanner view container reference";return alert(e),console.error(e),!1}if((null===(r=this.config.resultViewConfig)||void 0===r?void 0:r.container)&&!S(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)){const e="Invalid result view container reference";return alert(e),console.error(e),!1}}catch(e){const t=`Error accessing container references: ${e.message}`;return alert(t),console.error(t),!1}return!0}showResultView(){var e,t;return!1!==this.config.showResultView&&(this.config.container?!(void 0!==this.config.showResultView||!(null===(e=this.config.resultViewConfig)||void 0===e?void 0:e.container)&&!this.config.container)||!!this.config.showResultView:this.config.showResultView&&!!(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container))}initializeMRZScannerConfig(){var e,t,n,i,a,s,r,o;this.config=null!==(e=this.config)&&void 0!==e?e:{};if(!this.validateViewConfigs())return!1;this.shouldCreateDefaultContainer()?this.config.container=this.createDefaultMRZScannerContainer():this.config.container&&(this.config.container=S(this.config.container));const l=this.config.container?this.createViewContainers(S(this.config.container)):{},c={license:this.checkForTemporaryLicense(this.config.license),utilizedTemplateNames:Object.fromEntries(Object.values(v).map(e=>{var t;return[e,(null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t[e])||V[e]]})),templateFilePath:(null===(t=this.config)||void 0===t?void 0:t.templateFilePath)||"./dist/mrz-scanner.template.json"},d=Object.assign(Object.assign({},this.config.scannerViewConfig),{container:l[y.Scanner]||S(null===(n=this.config.scannerViewConfig)||void 0===n?void 0:n.container)||null,cameraEnhancerUIPath:(null===(i=this.config.scannerViewConfig)||void 0===i?void 0:i.uiPath)||(null===(a=this.config.scannerViewConfig)||void 0===a?void 0:a.cameraEnhancerUIPath)||"./dist/mrz-scanner.ui.html",templateFilePath:c.templateFilePath,utilizedTemplateNames:c.utilizedTemplateNames,enableMultiFrameCrossFilter:null===(r=null===(s=this.config.scannerViewConfig)||void 0===s?void 0:s.enableMultiFrameCrossFilter)||void 0===r||r,mrzFormatType:this.config.mrzFormatType}),h=this.showResultView()?Object.assign(Object.assign({},this.config.resultViewConfig),{_isFileMode:this.isFileMode,container:l[y.Result]||S(null===(o=this.config.resultViewConfig)||void 0===o?void 0:o.container)||null}):void 0;return Object.assign(this.config,Object.assign(Object.assign({},c),{scannerViewConfig:d,resultViewConfig:h})),!0}createViewContainers(e){e.textContent="";const t=[y.Scanner];return this.showResultView()&&t.push(y.Result),t.reduce((t,n)=>{const i=document.createElement("div");return i.className=`mrz-scanner-${n}-view-container`,Object.assign(i.style,{height:"100%",width:"100%",display:"none",position:"relative"}),e.append(i),t[n]=i,t},{})}dispose(){var e,t;this.resultView&&(this.resultView.dispose(),this.resultView=null),this.scannerView=null,this.resources.cameraEnhancer&&(this.resources.cameraEnhancer.dispose(),this.resources.cameraEnhancer=null),this.resources.cameraView&&(this.resources.cameraView.dispose(),this.resources.cameraView=null),this.resources.cvRouter&&(this.resources.cvRouter.dispose(),this.resources.cvRouter=null),this.resources.result=null,this.resources.onResultUpdated=null;const n=e=>{const t=S(e);t&&(t.style.display="none",t.textContent="")};n(this.config.container),n(null===(e=this.config.scannerViewConfig)||void 0===e?void 0:e.container),n(null===(t=this.config.resultViewConfig)||void 0===t?void 0:t.container),this.isInitialized=!1}async processUploadedFile(e){var t,i,a,d,h,u,m;try{this.showLoadingOverlay("Processing File...");const{cvRouter:g}=this.resources,p=null===(t=this.config.utilizedTemplateNames)||void 0===t?void 0:t.all,f=await g.getSimplifiedSettings(p);f.roiMeasuredInPercentage=!0,f.roi.points=[{x:0,y:0},{x:100,y:0},{x:100,y:100},{x:0,y:100}],await g.updateSettings(p,f);const w=await g.capture(e,p),v=w.items,C=v.filter(e=>e.type===n.CRIT_ORIGINAL_IMAGE)[0].imageData;C.toCanvas=()=>s(C),C.toBlob=async()=>await r("image/png",C);const y=null===(i=null==w?void 0:w.parsedResult)||void 0===i?void 0:i.parsedResultItems;let V={};if(null==y?void 0:y.length){const e=(null===(d=null===(a=y[0])||void 0===a?void 0:a.referenceItem)||void 0===d?void 0:d.text)||"";V=P(e,y[0])}let S=null,D=null;if(this.resources.returnDocumentImage)try{const e=w.processedDocumentResult;if((null===(h=null==e?void 0:e.detectedQuadResultItems)||void 0===h?void 0:h.length)>0){const t=e.detectedQuadResultItems[0];t.CrossVerificationStatus!==o.CVS_FAILED&&(D=t.location,S=await l.cropAndDeskewImage(C,D),S.toCanvas=()=>s(S),S.toBlob=async()=>await r("image/png",S))}}catch(e){console.warn("Error extracting document image from static file:",e)}let I=null;if(this.resources.returnPortraitImage)try{const e=await c.findPortraitZone();if(e&&!e.errorCode){let t=!0;if(D){const n=D.points;t=e.points.every(e=>{let t=!1;for(let i=0,a=n.length-1;i<n.length;a=i++){const s=n[i].x,r=n[i].y,o=n[a].x,l=n[a].y;r>e.y!=l>e.y&&e.x<(o-s)*(e.y-r)/(l-r)+s&&(t=!t)}return t})&&D.area/e.area>=3}t&&(I=await l.cropAndDeskewImage(C,e),I.toCanvas=()=>s(I),I.toBlob=async()=>await r("image/png",I))}}catch(e){console.warn("Error finding portrait zone in static file:",e)}const R=new Z({status:L.RS_SUCCESS,data:V,primaryOriginalImage:C,primaryDocumentImage:S,portraitImage:I});null===(m=(u=this.resources).onResultUpdated)||void 0===m||m.call(u,R)}catch(e){return console.error("Failed to process uploaded file:",e),new Z({status:L.RS_FAILED})}finally{this.hideLoadingOverlay(!1)}}async launch(e){var t;if(this.isCapturing)throw new Error("Capture session already in progress");try{this.isCapturing=!0,this.isFileMode=!!e;const{components:n}=await this.initialize();if(this.config.container&&(S(this.config.container).style.display="block"),this.isFileMode)return await this.processUploadedFile(e),n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView&&this.resources.result)return n.resultView?await n.resultView.launch():this.resources.result;if(!n.scannerView)throw new Error("Scanner view is required when no previous result exists");const i=await n.scannerView.launch();return(null==i?void 0:i.status)!==L.RS_SUCCESS?new Z({status:null!==(t=null==i?void 0:i.status)&&void 0!==t?t:L.RS_FAILED}):n.resultView?await n.resultView.launch():this.resources.result}catch(e){return alert((null==e?void 0:e.message)||e),console.error((null==e?void 0:e.message)||e),new Z({status:L.RS_FAILED})}finally{this.isCapturing=!1,this.dispose()}}}const $={MRZScanner:j,MRZScannerView:H,MRZResultView:_};export{V as DEFAULT_TEMPLATE_NAMES,$ as DynamsoftMRZScanner,w as EnumDocumentSide,z as EnumMRZData,C as EnumMRZDocumentType,v as EnumMRZScanMode,y as EnumMRZScannerViews,L as EnumResultStatus,M as MRZDataLabel,_ as MRZResultView,j as MRZScanner,H as MRZScannerView,T as displayMRZDate};
