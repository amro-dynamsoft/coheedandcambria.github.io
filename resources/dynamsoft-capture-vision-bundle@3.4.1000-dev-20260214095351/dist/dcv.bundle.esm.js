/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Capture Vision JS Edition Bundle
* @website http://www.dynamsoft.com
* @copyright Copyright 2026, Dynamsoft Corporation
* @author Dynamsoft
* @version 3.4.1000-dev-20260214095351
* @fileoverview Dynamsoft JavaScript Library for Capture Vision
* More info on DCV JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/
*/
const e=e=>e&&"object"==typeof e&&"function"==typeof e.then,t=(async()=>{})().constructor;let i=class extends t{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(i){let n;this._task=i,e(i)?n=i:"function"==typeof i&&(n=new t(i)),n&&(async()=>{try{const e=await n;i===this._task&&this.resolve(e)}catch(e){i===this._task&&this.reject(e)}})()}get isEmpty(){return null==this._task}constructor(t){let i,n;super((e,t)=>{i=e,n=t}),this._s="pending",this.resolve=t=>{this.isPending&&(e(t)?this.task=t:(this._s="fulfilled",i(t)))},this.reject=e=>{this.isPending&&(this._s="rejected",n(e))},this.task=t}};function n(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function r(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}var s,a,o;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.BOPM_BLOCK=0]="BOPM_BLOCK",e[e.BOPM_UPDATE=1]="BOPM_UPDATE"}(s||(s={})),function(e){e[e.CCUT_AUTO=0]="CCUT_AUTO",e[e.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",e[e.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",e[e.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",e[e.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",e[e.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(a||(a={})),function(e){e[e.IPF_BINARY=0]="IPF_BINARY",e[e.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",e[e.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888",e[e.IPF_BINARY_8=13]="IPF_BINARY_8",e[e.IPF_NV12=14]="IPF_NV12",e[e.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(o||(o={}));const l="undefined"==typeof self,c="function"==typeof importScripts,d=(()=>{if(!c){if(!l&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),h=e=>{if(null==e&&(e="./"),l||c);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e},u=e=>Object.prototype.toString.call(e),g=e=>Array.isArray?Array.isArray(e):"[object Array]"===u(e),_=e=>"number"==typeof e&&!Number.isNaN(e),p=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),f=e=>!(!p(e)||!_(e.x)||!_(e.y)||!_(e.radius)||e.radius<0||!_(e.startAngle)||!_(e.endAngle)),m=e=>!!p(e)&&!!g(e.points)&&0!=e.points.length&&!e.points.some(e=>!v(e)),E=e=>!(!p(e)||!_(e.width)||e.width<=0||!_(e.height)||e.height<=0||!_(e.stride)||e.stride<=0||!("format"in e)||"tag"in e&&!C(e.tag)),I=(e,t)=>"bytes"===e&&"object"==typeof t&&"number"==typeof t.ptr&&"number"==typeof t.length,y=e=>!(!E(e)||!_(e.bytes.length)&&!_(e.bytes.ptr)),R=e=>!!E(e)&&e.bytes instanceof Uint8Array,T=e=>!(!p(e)||!_(e.left)||e.left<0||!_(e.top)||e.top<0||!_(e.right)||e.right<0||!_(e.bottom)||e.bottom<0||e.left>=e.right||e.top>=e.bottom),C=e=>null===e||!!p(e)&&!!_(e.imageId)&&"type"in e,w=e=>!(!p(e)||!v(e.startPoint)||!v(e.endPoint)||e.startPoint.x==e.endPoint.x&&e.startPoint.y==e.endPoint.y),v=e=>!!p(e)&&!!_(e.x)&&!!_(e.y),S=e=>!!p(e)&&!!g(e.points)&&0!=e.points.length&&!e.points.some(e=>!v(e)),A=e=>!!p(e)&&!!g(e.points)&&0!=e.points.length&&4==e.points.length&&!e.points.some(e=>!v(e)),b=e=>!(!p(e)||!_(e.x)||!_(e.y)||!_(e.width)||e.width<0||!_(e.height)||e.height<0),D=async(e,t,i)=>await new Promise((n,r)=>{let s=new XMLHttpRequest;s.responseType=t,s.onloadstart=()=>{i&&i.loadstartCallback&&i.loadstartCallback()},s.onloadend=async e=>{i&&i.loadendCallback&&i.loadendCallback(),s.status<200||s.status>=300?r(s.status):n(s.response)},s.onprogress=e=>{i&&i.progressCallback&&i.progressCallback(e)},s.onerror=e=>{r(e)},s.open("GET",e,!0),s.send()}),O=e=>/^(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)|^[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})(\.[a-zA-Z0-9]{2,})?/.test(e),L=(e,t)=>{let i=e.split("."),n=t.split(".");for(let e=0;e<i.length&&e<n.length;++e){let t=i[e],r=n[e];if(t===r)continue;let s=parseInt(i[e]),a=parseInt(n[e]);return s===a||Number.isNaN(s)&&Number.isNaN(a)?t<r?-1:1:s<a||Number.isNaN(s)&&Number.isInteger(a)?-1:1}return i.length===n.length?0:i.length<n.length?-1:1},N=e=>{const t={};for(let i in e){if("rootDirectory"===i)continue;let n=i,r=e[n],s=r&&"object"==typeof r&&r.path?r.path:r,a=e.rootDirectory;if(a&&!a.endsWith("/")&&(a+="/"),"object"==typeof r&&r.isInternal)a&&(s=e[n].version?`${a}${H[n]}@${e[n].version}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`:`${a}${H[n]}/${"dcvData"===n?"":"dist/"}${"ddv"===n?"engine":""}`);else{const i=/^@engineRootDirectory(\/?)/;if("string"==typeof s&&(s=s.replace(i,a||"")),"object"==typeof s&&"dwt"===n){const r=e[n].resourcesPath,s=e[n].serviceInstallerLocation;t[n]={resourcesPath:r.replace(i,a||""),serviceInstallerLocation:s.replace(i,a||"")};continue}}t[n]=h(s)}return t},M=async(e,t,i)=>await new Promise(async(n,r)=>{try{const r=t.split(".");let s=r[r.length-1];const a=await B(`image/${s}`,e);r.length<=1&&(s="png");const o=new File([a],t,{type:`image/${s}`});if(i){const e=URL.createObjectURL(o),i=document.createElement("a");i.href=e,i.download=t,i.click()}n(o)}catch(e){r()}}),P=e=>{R(e)&&(e=F(e));const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d",{willReadFrequently:!0}).putImageData(e,0,0),t},x=(e,t)=>{R(t)&&(t=F(t));const i=P(t);let n=new Image,r=i.toDataURL(e);return n.src=r,n},B=async(e,t)=>{R(t)&&(t=F(t));const i=P(t);if("image/bmp"===e){const e=i.getContext("2d"),t=k(e.getImageData(0,0,i.width,i.height));return new Blob([t],{type:"image/bmp"})}return new Promise((t,n)=>{i.toBlob(e=>t(e),e)})},k=e=>{const t=e.width,i=e.height,n=e.data,r=4*Math.floor((24*t+31)/32),s=r*i,a=54+s,o=new ArrayBuffer(a),l=new DataView(o);l.setUint16(0,19778,!0),l.setUint32(2,a,!0),l.setUint16(6,0,!0),l.setUint16(8,0,!0),l.setUint32(10,54,!0),l.setUint32(14,40,!0),l.setInt32(18,t,!0),l.setInt32(22,-i,!0),l.setUint16(26,1,!0),l.setUint16(28,24,!0),l.setUint32(30,0,!0),l.setUint32(34,s,!0),l.setInt32(38,2835,!0),l.setInt32(42,2835,!0),l.setUint32(46,0,!0),l.setUint32(50,0,!0);let c=54;const d=r-3*t;for(let e=0;e<i;e++){for(let i=0;i<t;i++){const r=4*(e*t+i),s=n[r],a=n[r+1],o=n[r+2];l.setUint8(c++,o),l.setUint8(c++,a),l.setUint8(c++,s)}for(let e=0;e<d;e++)l.setUint8(c++,0)}return o},F=e=>{let t,i=e.bytes;if(!(i&&i instanceof Uint8Array))throw Error("Parameter type error");if(Number(e.format)===o.IPF_BGR_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n+2],t[4*n+3]=255}else if(Number(e.format)===o.IPF_RGB_888){const e=i.length/3;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;++n)t[4*n]=i[3*n+2],t[4*n+1]=i[3*n+1],t[4*n+2]=i[3*n],t[4*n+3]=255}else if(Number(e.format)===o.IPF_GRAYSCALED){const e=i.length;t=new Uint8ClampedArray(4*e);for(let n=0;n<e;n++)t[4*n]=t[4*n+1]=t[4*n+2]=i[n],t[4*n+3]=255}else if(Number(e.format)===o.IPF_BINARY_8||Number(e.format)===o.IPF_BINARY_8_INVERTED){const n=i.length,r=e.width,s=e.height,a=e.stride;t=new Uint8ClampedArray(r*s*4);for(let e=0;e<n;e++){let n=i[e],s=e%a,o=Math.floor(e/a);for(let e=0;e<8;e++){let i=s+e,a=4*(o*r+i);if(i>=r)break;t[a]=t[a+1]=t[a+2]=(128&n)/128*255,t[a+3]=255,n<<=1}}}else if(Number(e.format)===o.IPF_ABGR_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n+2],t[4*n+3]=i[4*n+3]}else if(Number(e.format)===o.IPF_ARGB_8888){const e=i.length/4;t=new Uint8ClampedArray(i.length);for(let n=0;n<e;++n)t[4*n]=i[4*n+2],t[4*n+1]=i[4*n+1],t[4*n+2]=i[4*n],t[4*n+3]=i[4*n+3]}else Number(e.format),o.IPF_BINARY_8_INVERTED;return new ImageData(t,e.width,e.height)},U=()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),G=async e=>{let t=URL.createObjectURL(e);try{const e=await new Promise((e,i)=>{const n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=t}),i=document.createElement("canvas"),n=i.getContext("2d");i.width=e.width,i.height=e.height,n.drawImage(e,0,0);return{bytes:Uint8Array.from(n.getImageData(0,0,i.width,i.height).data),width:i.width,height:i.height,stride:4*i.width,format:o.IPF_ABGR_8888}}finally{URL.revokeObjectURL(t)}},V=async(e,t)=>{const i=new TextEncoder,n=await crypto.subtle.importKey("raw",i.encode(t),"PBKDF2",!1,["deriveKey"]),r=await crypto.subtle.deriveKey({name:"PBKDF2",salt:i.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),s=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:128},r,i.encode(e)),o=new Uint8Array(s.length+a.byteLength);return o.set(s),o.set(new Uint8Array(a),s.length),btoa(String.fromCharCode.apply(null,o))},W=async(e,t)=>{const i=atob(e),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const r=n.slice(0,12),s=n.slice(12),a=new TextEncoder,o=await crypto.subtle.importKey("raw",a.encode(t),"PBKDF2",!1,["deriveKey"]),l=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a.encode("salt-for-key-derivation"),iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:r,tagLength:128},l,s);return(new TextDecoder).decode(c)},H={std:"dynamsoft-capture-vision-std",dip:"dynamsoft-image-processing",core:"dynamsoft-core",dnn:"dynamsoft-capture-vision-dnn",license:"dynamsoft-license",utility:"dynamsoft-utility",cvr:"dynamsoft-capture-vision-router",dbr:"dynamsoft-barcode-reader",dlr:"dynamsoft-label-recognizer",ddn:"dynamsoft-document-normalizer",dcp:"dynamsoft-code-parser",dcvData:"dynamsoft-capture-vision-data",dce:"dynamsoft-camera-enhancer",identityutility:"dynamsoft-identity-utility",ddv:"dynamsoft-document-viewer",dwt:"dwt",dbrBundle:"dynamsoft-barcode-reader-bundle",dcvBundle:"dynamsoft-capture-vision-bundle"};var j,Y,Z,q,X,K,Q,$;let z,J,ee,te,ie,ne=class e{get _isFetchingStarted(){return n(this,X,"f")}constructor(){j.add(this),Y.set(this,[]),Z.set(this,1),q.set(this,s.BOPM_BLOCK),X.set(this,!1),K.set(this,void 0),Q.set(this,a.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var t;if(!R(e))throw new TypeError("Invalid 'image'.");if((null===(t=e.imageTag)||void 0===t?void 0:t.hasOwnProperty("imageId"))&&"number"==typeof e.imageTag.imageId&&this.hasImage(e.imageTag.imageId))throw new Error("Existed imageId.");if(n(this,Y,"f").length>=n(this,Z,"f"))switch(n(this,q,"f")){case s.BOPM_BLOCK:break;case s.BOPM_UPDATE:if(n(this,Y,"f").push(e),p(n(this,K,"f"))&&_(n(this,K,"f").imageId)&&1==n(this,K,"f").keepInBuffer)for(;n(this,Y,"f").length>n(this,Z,"f");){const e=n(this,Y,"f").findIndex(e=>{var t;return(null===(t=e.imageTag)||void 0===t?void 0:t.imageId)!==n(this,K,"f").imageId});n(this,Y,"f").splice(e,1)}else n(this,Y,"f").splice(0,n(this,Y,"f").length-n(this,Z,"f"))}else n(this,Y,"f").push(e)}getImage(){if(0===n(this,Y,"f").length)return null;let t;if(n(this,K,"f")&&_(n(this,K,"f").imageId)){const e=n(this,j,"m",$).call(this,n(this,K,"f").imageId);if(e<0)throw new Error(`Image with id ${n(this,K,"f").imageId} doesn't exist.`);t=n(this,Y,"f").slice(e,e+1)[0]}else t=n(this,Y,"f").pop();if([o.IPF_RGB_565,o.IPF_RGB_555,o.IPF_RGB_888,o.IPF_ARGB_8888,o.IPF_RGB_161616,o.IPF_ARGB_16161616,o.IPF_ABGR_8888,o.IPF_ABGR_16161616,o.IPF_BGR_888].includes(t.format)){if(n(this,Q,"f")===a.CCUT_RGB_R_CHANNEL_ONLY){e._onLog&&e._onLog("only get R channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:i[e]=t.bytes[3*e+2];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:i[e]=t.bytes[4*e+2];break;case o.IPF_BGR_888:i[e]=t.bytes[3*e];break;case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}else if(n(this,Q,"f")===a.CCUT_RGB_G_CHANNEL_ONLY){e._onLog&&e._onLog("only get G channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:case o.IPF_BGR_888:i[e]=t.bytes[3*e+1];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e+1]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}else if(n(this,Q,"f")===a.CCUT_RGB_B_CHANNEL_ONLY){e._onLog&&e._onLog("only get B channel data.");const i=new Uint8Array(t.width*t.height);for(let e=0;e<i.length;e++)switch(t.format){case o.IPF_RGB_565:case o.IPF_RGB_555:case o.IPF_RGB_888:case o.IPF_RGB_161616:i[e]=t.bytes[3*e];break;case o.IPF_ARGB_8888:case o.IPF_ARGB_16161616:i[e]=t.bytes[4*e];break;case o.IPF_BGR_888:i[e]=t.bytes[3*e+2];break;case o.IPF_ABGR_8888:case o.IPF_ABGR_16161616:i[e]=t.bytes[4*e+2]}t.bytes=i,t.stride=t.width,t.format=o.IPF_GRAYSCALED}}else[o.IPF_NV21,o.IPF_NV12].includes(t.format)&&e._onLog&&e._onLog("NV21 or NV12 is not supported.");return t}setNextImageToReturn(e,t){if(!((...e)=>0!==e.length&&e.every(e=>_(e)))(e))throw new TypeError("Invalid 'imageId'.");if(void 0!==t&&"[object Boolean]"!==u(t))throw new TypeError("Invalid 'keepInBuffer'.");r(this,K,{imageId:e,keepInBuffer:t},"f")}_resetNextReturnedImage(){r(this,K,null,"f")}hasImage(e){return n(this,j,"m",$).call(this,e)>=0}startFetching(){r(this,X,!0,"f")}stopFetching(){r(this,X,!1,"f")}setMaxImageCount(e){if("number"!=typeof e)throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(r(this,Z,e,"f");n(this,Y,"f")&&n(this,Y,"f").length>e;)n(this,Y,"f").shift()}getMaxImageCount(){return n(this,Z,"f")}getImageCount(){return n(this,Y,"f").length}clearBuffer(){n(this,Y,"f").length=0}isBufferEmpty(){return 0===n(this,Y,"f").length}setBufferOverflowProtectionMode(e){r(this,q,e,"f")}getBufferOverflowProtectionMode(){return n(this,q,"f")}setColourChannelUsageType(e){r(this,Q,e,"f")}getColourChannelUsageType(){return n(this,Q,"f")}};Y=new WeakMap,Z=new WeakMap,q=new WeakMap,X=new WeakMap,K=new WeakMap,Q=new WeakMap,j=new WeakSet,$=function(e){if("number"!=typeof e)throw new TypeError("Invalid 'imageId'.");return n(this,Y,"f").findIndex(t=>{var i;return(null===(i=t.imageTag)||void 0===i?void 0:i.imageId)===e})},"undefined"!=typeof navigator&&(z=navigator,J=z.userAgent,ee=z.platform,te=z.mediaDevices),function(){if(!l){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:z.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:ee,search:"Win"},Mac:{str:ee},Linux:{str:ee}};let i="unknownBrowser",n=0,r="unknownOS";for(let t in e){const r=e[t]||{};let s=r.str||J,a=r.search||t,o=r.verStr||J,l=r.verSearch||t;if(l instanceof Array||(l=[l]),-1!=s.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||J,s=i.search||e;if(-1!=n.indexOf(s)){r=e;break}}"Linux"==r&&-1!=J.indexOf("Windows NT")&&(r="HarmonyOS"),ie={browser:i,version:n,OS:r}}l&&(ie={browser:"ssr",version:0,OS:"ssr"})}();const re="undefined"!=typeof WebAssembly&&J&&!(/Safari/.test(J)&&!/Chrome/.test(J)&&/\(.+\s11_2_([2-6]).*\)/.test(J)),se=!("undefined"==typeof Worker),ae=!(!te||!te.getUserMedia),oe=async()=>{let e=!1;if(ae)try{(await te.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),e=!0}catch(e){}return e};var le,ce,de,he,ue,ge,_e,pe,fe;"Chrome"===ie.browser&&ie.version>66||"Safari"===ie.browser&&ie.version>13||"OPR"===ie.browser&&ie.version>43||"Edge"===ie.browser&&ie.version,function(e){e[e.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",e[e.CRIT_BARCODE=2]="CRIT_BARCODE",e[e.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",e[e.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",e[e.CRIT_DESKEWED_IMAGE=16]="CRIT_DESKEWED_IMAGE",e[e.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT",e[e.CRIT_ENHANCED_IMAGE=64]="CRIT_ENHANCED_IMAGE"}(le||(le={})),function(e){e[e.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",e[e.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",e[e.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",e[e.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(ce||(ce={})),function(e){e[e.EC_OK=0]="EC_OK",e[e.EC_UNKNOWN=-1e4]="EC_UNKNOWN",e[e.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",e[e.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",e[e.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",e[e.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",e[e.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",e[e.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",e[e.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",e[e.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",e[e.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",e[e.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",e[e.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",e[e.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",e[e.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",e[e.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",e[e.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",e[e.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",e[e.EC_TIMEOUT=-10026]="EC_TIMEOUT",e[e.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",e[e.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",e[e.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",e[e.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",e[e.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",e[e.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",e[e.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",e[e.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",e[e.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",e[e.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",e[e.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",e[e.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",e[e.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",e[e.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",e[e.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",e[e.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",e[e.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",e[e.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",e[e.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",e[e.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",e[e.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",e[e.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",e[e.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",e[e.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",e[e.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",e[e.EC_IMAGE_DATA_INVALID=-10069]="EC_IMAGE_DATA_INVALID",e[e.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",e[e.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",e[e.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",e[e.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",e[e.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",e[e.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",e[e.EC_UNSUPPORTED_JSON_KEY_WARNING=-10077]="EC_UNSUPPORTED_JSON_KEY_WARNING",e[e.EC_MODEL_FILE_NOT_FOUND=-10078]="EC_MODEL_FILE_NOT_FOUND",e[e.EC_PDF_LICENSE_NOT_FOUND=-10079]="EC_PDF_LICENSE_NOT_FOUND",e[e.EC_RECT_INVALID=-10080]="EC_RECT_INVALID",e[e.EC_TEMPLATE_VERSION_INCOMPATIBLE=-10081]="EC_TEMPLATE_VERSION_INCOMPATIBLE",e[e.EC_PORTRAIT_ZONE_NOT_FOUND=-10082]="EC_PORTRAIT_ZONE_NOT_FOUND",e[e.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",e[e.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",e[e.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",e[e.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",e[e.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",e[e.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",e[e.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",e[e.EC_LICENSE_VERSION_NOT_MATCH=-20011]="EC_LICENSE_VERSION_NOT_MATCH",e[e.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",e[e.EC_LICENSE_AUTH_QUOTA_EXCEEDED=-20013]="EC_LICENSE_AUTH_QUOTA_EXCEEDED",e[e.EC_LICENSE_RESULTS_LIMIT_EXCEEDED=-20014]="EC_LICENSE_RESULTS_LIMIT_EXCEEDED",e[e.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",e[e.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",e[e.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",e[e.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",e[e.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",e[e.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",e[e.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",e[e.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",e[e.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",e[e.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",e[e.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",e[e.EC_LICENSE_WARNING=-10076]="EC_LICENSE_WARNING",e[e.EC_BARCODE_READER_LICENSE_NOT_FOUND=-30063]="EC_BARCODE_READER_LICENSE_NOT_FOUND",e[e.EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND=-40103]="EC_LABEL_RECOGNIZER_LICENSE_NOT_FOUND",e[e.EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND=-50058]="EC_DOCUMENT_NORMALIZER_LICENSE_NOT_FOUND",e[e.EC_CODE_PARSER_LICENSE_NOT_FOUND=-90012]="EC_CODE_PARSER_LICENSE_NOT_FOUND"}(de||(de={})),function(e){e[e.GEM_SKIP=0]="GEM_SKIP",e[e.GEM_AUTO=1]="GEM_AUTO",e[e.GEM_GENERAL=2]="GEM_GENERAL",e[e.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",e[e.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",e[e.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",e[e.GEM_REV=-2147483648]="GEM_REV",e[e.GEM_END=-1]="GEM_END"}(he||(he={})),function(e){e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_AUTO=4]="GTM_AUTO",e[e.GTM_REV=-2147483648]="GTM_REV",e[e.GTM_END=-1]="GTM_END"}(ue||(ue={})),function(e){e[e.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",e[e.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(ge||(ge={})),function(e){e[e.PDFRM_VECTOR=1]="PDFRM_VECTOR",e[e.PDFRM_RASTER=2]="PDFRM_RASTER",e[e.PDFRM_REV=-2147483648]="PDFRM_REV"}(_e||(_e={})),function(e){e[e.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",e[e.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(pe||(pe={})),function(e){e[e.CVS_NOT_VERIFIED=0]="CVS_NOT_VERIFIED",e[e.CVS_PASSED=1]="CVS_PASSED",e[e.CVS_FAILED=2]="CVS_FAILED"}(fe||(fe={}));const me={IRUT_NULL:BigInt(0),IRUT_COLOUR_IMAGE:BigInt(1),IRUT_SCALED_COLOUR_IMAGE:BigInt(2),IRUT_GRAYSCALE_IMAGE:BigInt(4),IRUT_TRANSOFORMED_GRAYSCALE_IMAGE:BigInt(8),IRUT_ENHANCED_GRAYSCALE_IMAGE:BigInt(16),IRUT_PREDETECTED_REGIONS:BigInt(32),IRUT_BINARY_IMAGE:BigInt(64),IRUT_TEXTURE_DETECTION_RESULT:BigInt(128),IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE:BigInt(256),IRUT_TEXTURE_REMOVED_BINARY_IMAGE:BigInt(512),IRUT_CONTOURS:BigInt(1024),IRUT_LINE_SEGMENTS:BigInt(2048),IRUT_TEXT_ZONES:BigInt(4096),IRUT_TEXT_REMOVED_BINARY_IMAGE:BigInt(8192),IRUT_CANDIDATE_BARCODE_ZONES:BigInt(16384),IRUT_LOCALIZED_BARCODES:BigInt(32768),IRUT_SCALED_BARCODE_IMAGE:BigInt(65536),IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE:BigInt(1<<17),IRUT_COMPLEMENTED_BARCODE_IMAGE:BigInt(1<<18),IRUT_DECODED_BARCODES:BigInt(1<<19),IRUT_LONG_LINES:BigInt(1<<20),IRUT_CORNERS:BigInt(1<<21),IRUT_CANDIDATE_QUAD_EDGES:BigInt(1<<22),IRUT_DETECTED_QUADS:BigInt(1<<23),IRUT_LOCALIZED_TEXT_LINES:BigInt(1<<24),IRUT_RECOGNIZED_TEXT_LINES:BigInt(1<<25),IRUT_DESKEWED_IMAGE:BigInt(1<<26),IRUT_SHORT_LINES:BigInt(1<<27),IRUT_RAW_TEXT_LINES:BigInt(1<<28),IRUT_LOGIC_LINES:BigInt(1<<29),IRUT_ENHANCED_IMAGE:BigInt(Math.pow(2,30)),IRUT_ALL:BigInt("0xFFFFFFFFFFFFFFFF")};var Ee,Ie,ye,Re,Te;!function(e){e[e.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",e[e.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",e[e.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",e[e.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",e[e.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",e[e.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",e[e.ROET_DESKEWED_IMAGE=6]="ROET_DESKEWED_IMAGE",e[e.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",e[e.ROET_TARGET_ROI=8]="ROET_TARGET_ROI",e[e.ROET_ENHANCED_IMAGE=9]="ROET_ENHANCED_IMAGE",e[e.ROET_AUXILIARY_REGION=10]="ROET_AUXILIARY_REGION"}(Ee||(Ee={})),function(e){e[e.ST_NULL=0]="ST_NULL",e[e.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",e[e.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",e[e.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",e[e.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",e[e.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",e[e.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",e[e.ST_DOCUMENT_DESKEWING=7]="ST_DOCUMENT_DESKEWING",e[e.ST_IMAGE_ENHANCEMENT=8]="ST_IMAGE_ENHANCEMENT"}(Ie||(Ie={})),function(e){e[e.IFF_JPEG=0]="IFF_JPEG",e[e.IFF_PNG=1]="IFF_PNG",e[e.IFF_BMP=2]="IFF_BMP",e[e.IFF_PDF=3]="IFF_PDF"}(ye||(ye={})),function(e){e[e.ICDM_NEAR=0]="ICDM_NEAR",e[e.ICDM_FAR=1]="ICDM_FAR"}(Re||(Re={})),function(e){e.MN_DYNAMSOFT_CAPTURE_VISION_ROUTER="cvr",e.MN_DYNAMSOFT_CORE="core",e.MN_DYNAMSOFT_LICENSE="license",e.MN_DYNAMSOFT_IMAGE_PROCESSING="dip",e.MN_DYNAMSOFT_UTILITY="utility",e.MN_DYNAMSOFT_BARCODE_READER="dbr",e.MN_DYNAMSOFT_DOCUMENT_NORMALIZER="ddn",e.MN_DYNAMSOFT_LABEL_RECOGNIZER="dlr",e.MN_DYNAMSOFT_CAPTURE_VISION_DATA="dcvData",e.MN_DYNAMSOFT_NEURAL_NETWORK="dnn",e.MN_DYNAMSOFT_CODE_PARSER="dcp",e.MN_DYNAMSOFT_CAMERA_ENHANCER="dce",e.MN_DYNAMSOFT_CAPTURE_VISION_STD="std"}(Te||(Te={}));const Ce={},we=async e=>{let t="string"==typeof e?[e]:e,n=[];for(let e of t)n.push(Ce[e]=Ce[e]||new i);await Promise.all(n)},ve=async(e,t)=>{let n,r="string"==typeof e?[e]:e,s=[];for(let e of r){let r;s.push(r=Ce[e]=Ce[e]||new i(n=n||t())),r.isEmpty&&(r.task=n=n||t())}await Promise.all(s)},Se=async e=>await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(e.u8);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},be.postMessage({type:"imagePtrToUint8Array",id:n,body:{data:e}})}),Ae=async e=>await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(e.result);{const t=Error(e.message);e.stack&&(t.stack=e.stack),i(t)}},be.postMessage({type:"resolveDsImageData",id:n,body:{point:e}})});let be,De=0;const Oe=()=>De++,Le={};let Ne;const Me=e=>{Ne=e,be&&be.postMessage({type:"setBLog",body:{value:!!e}})};let Pe=!1;const xe=e=>{Pe=e,be&&be.postMessage({type:"setBDebug",body:{value:!!e}})},Be={},ke={},Fe={dip:{wasm:!0}},Ue={std:{version:"2.0.0",path:h(d+"../../dynamsoft-capture-vision-std@2.0.0/dist/"),isInternal:!0},core:{version:"4.4.10-dev-20260129110706",path:d,isInternal:!0}};let Ge=5;"undefined"!=typeof navigator&&(Ge=navigator.hardwareConcurrency?navigator.hardwareConcurrency-1:5),Le[-3]=async e=>{Ve.onWasmLoadProgressChanged&&Ve.onWasmLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Ve{static get engineResourcePaths(){return Ue}static set engineResourcePaths(e){Object.assign(Ue,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Ne}static set _onLog(e){Me(e)}static get _bDebug(){return Pe}static set _bDebug(e){xe(e)}static get _workerName(){return`${Ve._bundleEnv.toLowerCase()}.bundle.worker.js`}static get wasmLoadOptions(){return Ve._wasmLoadOptions}static set wasmLoadOptions(e){Object.assign(Ve._wasmLoadOptions,e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!Ce[e]&&Ce[e].isFulfilled}static async loadWasm(){return await(async()=>{let e,t;e instanceof Array||(e=e?[e]:[]);let n=Ce.core;t=!n||n.isEmpty,t||await we("core");let r=new Map;const s=e=>{if(e=e.toLowerCase(),Te.MN_DYNAMSOFT_CAPTURE_VISION_STD==e||Te.MN_DYNAMSOFT_CORE==e)return;let t=Fe[e].deps;if(null==t?void 0:t.length)for(let e of t)s(e);let i=Ce[e];r.has(e)||r.set(e,!i||i.isEmpty)};for(let t of e)s(t);let a=[];t&&a.push("core"),a.push(...r.keys());const o=[...r.entries()].filter(e=>!e[1]).map(e=>e[0]);await ve(a,async()=>{const e=[...r.entries()].filter(e=>e[1]).map(e=>e[0]);await we(o);const n=N(Ue),s={};for(let t of e)s[t]=Fe[t];const a={engineResourcePaths:n,autoResources:s,names:e,_bundleEnv:Ve._bundleEnv,wasmLoadOptions:Ve.wasmLoadOptions};let l=new i;if(t){a.needLoadCore=!0;let e=n[`${Ve._bundleEnv.toLowerCase()}Bundle`]+Ve._workerName;e.startsWith(location.origin)||(e=await fetch(e).then(e=>e.blob()).then(e=>URL.createObjectURL(e))),be=new Worker(e),be.onerror=e=>{let t=new Error(e.message);l.reject(t)},be.addEventListener("message",e=>{let t=e.data?e.data:e,i=t.type,n=t.id,r=t.body;switch(i){case"log":Ne&&Ne(t.message);break;case"warning":console.warn(t.message);break;case"task":try{Le[n](r),delete Le[n]}catch(e){throw delete Le[n],e}break;case"event":try{Le[n](r)}catch(e){throw e}break;default:console.log(e)}}),a.bLog=!!Ne,a.bd=Pe,a.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await we("core");let c=De++;Le[c]=e=>{if(e.success)Object.assign(Be,e.versions),"{}"!==JSON.stringify(e.versions)&&(Ve._versions=e.versions),Ve.loadedWasmType=e.loadedWasmType,l.resolve(void 0);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),l.reject(t)}},be.postMessage({type:"loadWasm",id:c,body:a}),await l})})()}static async detectEnvironment(){return await(async()=>({wasm:re,worker:se,getUserMedia:ae,camera:await oe(),browser:ie.browser,version:ie.version,OS:ie.OS}))()}static async getModuleVersion(){return await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e(i.versions);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"getModuleVersion",id:i})})}static getVersion(){return`4.4.10-dev-20260129110706(Worker: ${Be.core&&Be.core.worker||"Not Loaded"}, Wasm: ${Be.core&&Be.core.wasm||"Not Loaded"})`}static enableLogging(){ne._onLog=console.log,Ve._onLog=console.log}static disableLogging(){ne._onLog=null,Ve._onLog=null}static async cfd(e){return await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},be.postMessage({type:"cfd",id:n,body:{count:e}})})}}Ve._bSupportDce4Module=-1,Ve._bSupportIRTModule=-1,Ve._versions=null,Ve._bundleEnv="DCV",Ve._wasmLoadOptions={wasmType:"auto",pthreadPoolSize:Ge},Ve.loadedWasmType="ml-simd-pthread",Ve.browserInfo=ie;const We="undefined"==typeof self,He="function"==typeof importScripts,je=(()=>{if(!He){if(!We&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),Ye=/<style>([\s\S]*?)<\/style>/g,Ze=/style="([\s\S]*?)"/g,qe=(e,t)=>{const{inlineScript2Blob:i,internalCss2Blob:n,insertInternalCss2ExistedSheet:r}=t||{};if(r){let t,i;for(let e=0;e<document.styleSheets.length;++e){const n=document.styleSheets[e];try{i=n.cssRules,t=n;break}catch(e){}}t&&(e=e.replace(Ye,(e,n,r,s)=>{let a=n.split("}");const o=a.length-1;let l=[],c=null,d=0;for(let e=0;e<o;++e){let t=0;for(;-1!==(t=a[e].indexOf("{",t));)d+=1,t+=1;if(c)1===d?(l.push(c+a[e]+"}"),c=null,d=0):(c+=a[e]+"}",--d);else{if(d<1)throw new Error("invalid style");1===d?(l.push(a[e].trimStart()+"}"),d=0):(c=a[e].trimStart()+"}",--d)}}if(c||d)throw new Error("invalid style");for(let e of l)t.insertRule(e,i.length);return""}))}const s=[];n&&(e=e.replace(Ye,(e,t,i,n)=>(s.push(new Blob([t],{type:"text/css"})),"<HasStyle></HasStyle>")));const a=[];e=e.replace(Ze,(e,t,i,n)=>(a.push(t),"hasstyle"));const o=document.createElement("div");if(o.insertAdjacentHTML("beforeend",e),o.normalize(),n){const e=o.querySelectorAll("HasStyle");for(let t=0;t<s.length;t++){const i=s[t],n=e[t],r=document.createElement("link");r.rel="stylesheet",r.href=URL.createObjectURL(i),n.replaceWith(r)}}const l=o.querySelectorAll("[hasstyle]");for(let e=0;e<a.length;e++){const t=a[e],i=l[e];i.removeAttribute("hasstyle");const n=t.split(";").map(e=>e.trim()).filter(e=>e);if(i.style)for(let e of n){const t=e.split(":");i.style[t[0].trim()]=t[1].trim()}}for(let e of o.querySelectorAll("script")){const t=document.createElement("script");e.textContent&&(i&&!e.src?(t.src=URL.createObjectURL(new Blob([e.textContent],{type:"text/javascript"})),t.addEventListener("load",()=>URL.revokeObjectURL(t.src))):t.textContent=e.textContent);for(let i of e.attributes)t.setAttribute(i.name,i.value);e.replaceWith(t)}let c=new DocumentFragment;return c.append(...o.childNodes),1===c.childNodes.length?c.firstChild:c},Xe=[["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],["camera2 0,"],["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"]],Ke=e=>e&&"object"==typeof e&&"function"==typeof e.then,Qe=(async()=>{})().constructor;class $e extends Qe{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Ke(e)?t=e:"function"==typeof e&&(t=new Qe(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Ke(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}const ze={width:1280,height:720},Je=function(){const e=this,t=MediaDeviceInfo.prototype.toJSON.apply(e);return t.trackLabel=e.trackLabel,t.capabilities=e.capabilities,t},et="The camera feature is available only in secure contexts (HTTPS)";let tt=class e{static _cameraNameMatcher=Xe;static _mapDeviceInfo;_coreShell;_video;_coreInnerLayer;_coreOuterLayer;_regionBoxWrapper;_regionBoxMask;_regionBoxBorder;_objectFit="contain";_uiInlineScript2Blob=!0;_uiInternalCss2Blob=!0;_uiInternalCss2ExistedSheet=!1;_ui;_pOpen;_paused=!1;_shouldClose=!1;_cameraChangedWhenPaused=!1;_resolutionChangedWhenPaused=!1;_requestedCamera="back";_requestedResolution=ze;_regionBox={unit:"view-size",center:{x:0,y:0},maskStyle:{background:"rgba(0, 0, 0, 0.5)"},borderStyle:{border:"1px solid #00ff7f"}};_eventListeners={};static _arrConstructors=[];static _arrOnOpen=[];static _arrBeforeClose=[];static _arrOnClose=[];constructor(){const t=this._coreShell=document.createElement("div");Object.assign(t.style,{width:"100%",height:"100%",minWidth:"100px",minHeight:"100px",backgroundColor:"black",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative"});const i=this._coreOuterLayer=document.createElement("div");Object.assign(i.style,{width:"auto",height:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"relative",overflow:"hidden"});const n=this._coreInnerLayer=document.createElement("div");Object.assign(n.style,{width:"100%",height:"100%",position:"relative",transformOrigin:"center"});const r=this._video=document.createElement("video");Object.assign(r.style,{width:"100%",height:"100%",position:"absolute",left:"0",top:"0",objectFit:"fill"}),r.muted=!0,r.playsInline=!0,n.append(r),i.append(n),t.append(i),new ResizeObserver(()=>{this._updateObjectFit()}).observe(t);for(let t of e._arrConstructors)t.call(this)}_updateObjectFit(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video,t=this._coreOuterLayer.style,i=this._regionBoxWrapper?.style;if("fill"===this._objectFit)return"100%"!==t.width&&(t.width="100%"),"100%"!==t.height&&(t.height="100%"),void(i&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%")));const{width:n,height:r}=this._coreShell.getBoundingClientRect(),s=`${e.videoWidth} / ${e.videoHeight}`;s!=t.aspectRatio&&(t.aspectRatio=s),i&&s!=i.aspectRatio&&(i.aspectRatio=s);let a=!1;n/r>e.videoWidth/e.videoHeight&&(a=!a),"cover"===this._objectFit&&(a=!a);const o=i&&"contain"===this._objectFit,l=i&&"cover"===this._objectFit;a?("auto"!=t.width&&(t.width="auto"),"100%"!=t.height&&(t.height="100%"),o&&("auto"!=i.width&&(i.width="auto"),"100%"!=i.height&&(i.height="100%"))):("100%"!=t.width&&(t.width="100%"),"auto"!=t.height&&(t.height="auto"),o&&("100%"!=i.width&&(i.width="100%"),"auto"!=i.height&&(i.height="auto"))),l&&("100%"!==i.width&&(i.width="100%"),"100%"!==i.height&&(i.height="100%"))}get video(){return this._video}get track(){return this._video?.srcObject?.getTracks()[0]}get objectFit(){return this._objectFit}set objectFit(e){this._objectFit=e,this._updateObjectFit()}get ui(){return this._ui||this._coreShell}set ui(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if("string"==typeof e){if(!e.trim().startsWith("<"))throw Error("Invalid html string.");e=qe(e,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet})}let t;if(e instanceof HTMLElement)t=e;else{if(!(e instanceof DocumentFragment))throw Error("Seems no HTMLElement.");t=document.createElement("div"),Object.assign(t.style,{width:"100%",height:"100%"}),t.append(e)}const i="dm-camera-core-container",n=t.classList.contains(i)?t:t.querySelector(`.${i}`);if(!n)throw Error(`Can't find element with class \`${i}\`.`);this._ui=t;for(let e of t.querySelectorAll("script"))e.currentDMCamera=this;n.append(this._coreShell)}get status(){return this._pOpen?this._pOpen.isPending?this._shouldClose?"closing":"opening":this._paused?"paused":"opened":"closed"}get requestedCamera(){return this._requestedCamera}get requestedResolution(){return this._requestedResolution}get currentCamera(){return"opened"!==this.status&&"paused"!==this.status?null:e._mapDeviceInfo?.[this.track?.getSettings()?.deviceId]}get currentResolution(){return{width:this.video?.videoWidth,height:this.video?.videoHeight}}get regionBox(){return this._regionBox}onOpened;static async hasCamera(){return!!navigator?.mediaDevices&&!!(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind).length}static async hasMacroCamera(){return!!navigator?.mediaDevices&&!!(await e.getDeviceInfos()).find(e=>e.capabilities?.facingMode?.includes("environment")&&e.capabilities?.focusDistance?.min<.061)}static async getDeviceInfos(){if(!navigator?.mediaDevices)throw Error(et);let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);if(!t.length)return[];if(t.some(e=>!e.deviceId)){let e;try{e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind),t.some(e=>!e.deviceId)&&console.warn("Some camera does not have deviceId.")}catch(t){console.warn("Failed to get device ID by opening camera.",t)}if(e){const i=e.getTracks().filter(e=>"video"===e.kind)[0],n=i.getSettings().deviceId;let r=t.find(e=>e.deviceId===n);r?(r.trackLabel=i.label,r.capabilities=i.getCapabilities?.(),r.toJSON=Je):console.warn("Can't find current device by `track.getSettings().deviceId`."),e.getTracks().forEach(e=>e.stop())}}await e._setCapabilities(t);const i=t.reduce((e,t)=>(e[t.deviceId]=t,e),{});return e._mapDeviceInfo=i,[...t]}static async _setCapabilities(t){for(let i of t){if(!i.deviceId)continue;if(Je===i.toJSON)continue;let n=e._mapDeviceInfo?.[i.deviceId];if(n)i.trackLabel=n.trackLabel,i.capabilities=n.capabilities;else try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:i.deviceId},audio:!1}),t=e.getTracks().filter(e=>"video"===e.kind)[0];i.trackLabel=t.label,i.capabilities=t.getCapabilities?.(),e.getTracks().forEach(e=>e.stop())}catch(t){console.warn("Failed to get `trackLabel` and `capabilities`, by opening camera.",t)}i.toJSON=Je}}async open(){if("opened"!==this.status)if("closed"===this.status||"paused"===this.status)try{if("paused"===this.status&&this._cameraChangedWhenPaused&&(await this.close(),this._cameraChangedWhenPaused=!1),"closed"===this.status){if(this._pOpen=new $e,"customized-video"!==this._requestedCamera){let t;if("string"==typeof this._requestedCamera){switch(this._requestedCamera){case"front":t={facingMode:"user"};break;case"quick-back":t={facingMode:"environment"};break;case"back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");for(let n of e._cameraNameMatcher){for(let e of i){const i=(e.trackLabel||e.label)?.toLowerCase();for(let r of n)if(i.includes(r)){t={deviceId:e.deviceId};break}if(t)break}if(t)break}if(t)break;i.reverse();for(let e of i)if(e.capabilities?.facingMode?.includes("environment")){t={deviceId:e.deviceId};break}if(t)break;t={deviceId:i[0].deviceId};break}case"macro-back":{const i=await e.getDeviceInfos();if(!i.length)throw Error("No camera found.");const n=i.reduce((e,t)=>t?.capabilities?.facingMode?.includes("environment")?e&&e?.capabilities?.focusDistance?.min?t?.capabilities?.focusDistance?.min<e?.capabilities?.focusDistance?.min?t:e:t:e);t={deviceId:n?.deviceId||i[i.length-1].deviceId};break}default:throw Error(`Unknown camera preset: ${this._requestedCamera}`)}this._requestedCamera=t}else t=this._requestedCamera;const i={video:Object.assign({},t,this._requestedResolution),audio:!1};if(!navigator?.mediaDevices)throw Error(et);const n=await navigator.mediaDevices.getUserMedia(i);if("closing"===this.status)throw Error("Camera closed.");this._video.srcObject=n}if(await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this.track){const e=this.track.getSettings();let t=0;for(;++t<10&&(e.width!==this.video.videoWidth||e.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));if("closing"===this.status)throw Error("Camera closed.")}this._pOpen.resolve();try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}}else{if(this._pOpen=new $e,await this._video.play(),"closing"===this.status)throw Error("Camera closed.");if(this._paused=!1,this._pOpen.resolve(),this._resolutionChangedWhenPaused){try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._resolutionChangedWhenPaused=!1}}for(let t of e._arrOnOpen)t.call(this);this._callOpenedListeners()}catch(e){let t=this._video?.srcObject?.getTracks?.();if(t)for(let e of t)e?.stop();this._video.srcObject=null;const i=this._pOpen;throw this._pOpen=null,this._shouldClose=!1,i.reject(),Error(`Error opening camera: ${e?.message}`,{cause:e})}else{if("opening"!==this.status&&"closing"!==this.status)throw Error("Never");await this._pOpen}}async pause(){try{await this._pOpen}catch(e){}"opened"===this.status&&(this._video.pause(),this._paused=!0)}async close(){for(let t of e._arrBeforeClose)t.call(this);if("closed"===this.status)return;if("opening"===this.status&&(this._shouldClose=!0),"closing"===this.status){try{await this._pOpen}catch(t){}return}let t=this._video?.srcObject?.getTracks?.();if(t){for(let e of t)e?.stop();this._video.srcObject=null}this._pOpen=null,this._paused=!1;for(let t of e._arrOnClose)t.call(this);this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility="hidden"),this._eventListeners.closed?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}async requestCamera(e){if("string"==typeof e)it.includes(e)?this._requestedCamera=e:this._requestedCamera={deviceId:e};else if(e)if("videoinput"===e.kind)e.deviceId?this._requestedCamera={deviceId:e.deviceId}:this._requestedCamera="back";else{const t=this._requestedCamera=JSON.parse(JSON.stringify(e));if(t.width||t.height||t.aspectRatio){const e=this._requestedResolution={};t.width&&(e.width=t.width,delete t.width),t.height&&(e.height=t.height,delete t.height),t.aspectRatio&&(e.aspectRatio=t.aspectRatio,delete t.aspectRatio)}}else null===e?this._requestedCamera=null:void 0===e&&(this._requestedCamera="back");"opened"===this.status?(await this.close(),await this.open()):"paused"===this.status&&(this._cameraChangedWhenPaused=!0)}async requestResolution(e,t){let i={};if("number"==typeof e?(i.width=e,"number"==typeof t&&(i.height=t)):Array.isArray(e)?(e[0]&&(i.width=e[0]),e[1]&&(i.height=e[1])):e?((e=JSON.parse(JSON.stringify(e))).width&&(i.width=e.width),e.height&&(i.height=e.height),e.aspectRatio&&(i.aspectRatio=e.aspectRatio)):null===e?i=null:void 0===e&&(i=ze),this._requestedResolution=i,"opened"===this.status){await this.track.applyConstraints({...i});const t=this.track.getSettings();let n=0;for(;++n<10&&(t.width!==this.video.videoWidth||t.height!==this.video.videoHeight);)await new Promise(e=>setTimeout(e,100));try{this._updateObjectFit()}catch(e){console.error(e)}try{this._updateCanvasSize()}catch(e){console.error(e)}this._callOpenedListeners()}else"paused"===this.status&&(this._resolutionChangedWhenPaused=!0,await this.track.applyConstraints({...i}))}getFrame(e){if("opened"!==this.status&&"paused"!==this.status)throw Error("Camera is not opened");let{x:t=0,y:i=0,width:n=this._video.videoWidth,height:r=this._video.videoHeight,reusedContext:s}=e||{};n=Math.round(n+t)-Math.round(t),r=Math.round(r+i)-Math.round(i),t=Math.round(t),i=Math.round(i);const a=s?.canvas||document.createElement("canvas");return a.width!=n&&(a.width=n),a.height!=r&&(a.height=r),(s||a.getContext("2d")).drawImage(this._video,t,i,n,r,0,0,n,r),a}setRegionBox(e){if(!(e=Object.assign(this._regionBox,e)).width||!e.height){if(!e.innerUi)return this._regionBoxWrapper?.remove(),this._regionBoxWrapper=null,this._regionBoxMask=null,void(this._regionBoxBorder=null);Object.assign(e,{width:1,height:1,unit:"view-size",center:{x:0,y:0}})}this._regionBoxWrapper||(this._regionBoxWrapper=document.createElement("div"),Object.assign(this._regionBoxWrapper.style,{width:"auto",height:"100%",maxWidth:"100%",maxHeight:"100%",minWidth:"100px",minHeight:"100px",aspectRatio:"1",flex:"none",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",containerType:"size",visibility:"opened"===this.status?"":"hidden"}),this._regionBoxMask=document.createElement("div"),Object.assign(this._regionBoxMask.style,{width:"100%",height:"100%",flex:"none"}),this._regionBoxWrapper.append(this._regionBoxMask),this._regionBoxBorder=document.createElement("div"),Object.assign(this._regionBoxBorder.style,{flex:"none",boxSizing:"content-box",position:"absolute",transform:"translate(-50%,-50%)"}),this._regionBoxWrapper.append(this._regionBoxBorder),this._coreShell.append(this._regionBoxWrapper)),"string"==typeof e.innerUi&&(e.innerUi=qe(e.innerUi)),e.innerUi instanceof DocumentFragment?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Node?1==this._regionBoxBorder.childNodes.length&&this._regionBoxBorder.firstChild==e.innerUi||(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(e.innerUi)):e.innerUi instanceof NodeList?this._regionBoxBorder.childNodes!==e.innerUi&&(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):e.innerUi instanceof Array?(this._regionBoxBorder.innerHTML="",this._regionBoxBorder.append(...e.innerUi),e.innerUi=this._regionBoxBorder.childNodes):this._regionBoxBorder.innerHTML="";let t=100*e.center.y-50*e.height+50+"%",i=100*e.center.x+50*e.width+50+"%",n=100*e.center.y+50*e.height+50+"%",r=100*e.center.x-50*e.width+50+"%";Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${r} ${t}, ${r} ${n}, ${i} ${n}, ${i} ${t}, ${r} ${t})`}),"view-min"===e.unit&&(t=`calc(${100*e.center.y+50}% + max(-${50*e.height}cqmin, -${50*e.height}cqmax))`,i=`calc(${100*e.center.x+50}% + ${50*e.width}cqmin)`,n=`calc(${100*e.center.y+50}% + ${50*e.height}cqmin)`,r=`calc(${100*e.center.x+50}% + max(-${50*e.width}cqmin, -${50*e.width}cqmax))`,Object.assign(this._regionBoxMask.style,{clipPath:`polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, ${r} ${t}, ${r} ${n}, ${i} ${n}, ${i} ${t}, ${r} ${t})`})),Object.assign(this._regionBoxMask.style,{...e.maskStyle}),Object.assign(this._regionBoxBorder.style,{width:100*e.width+"%",height:100*e.height+"%"}),"view-min"===e.unit&&Object.assign(this._regionBoxBorder.style,{width:100*e.width+"cqmin",height:100*e.height+"cqmin"}),Object.assign(this._regionBoxBorder.style,{top:100*e.center.y+50+"%",left:100*e.center.x+50+"%",...e.borderStyle}),"view-size"===e.unit&&1===e.width&&1===e.height&&(this._regionBoxBorder.style.borderWidth="0"),this._updateObjectFit()}addCanvas(){const e=document.createElement("canvas");return Object.assign(e.style,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),"opened"!==this.status&&"paused"!==this.status||(e.width=this._video.videoWidth,e.height=this._video.videoHeight),this._video.parentElement.append(e),e}_updateCanvasSize(){if("opened"!==this.status&&"paused"!==this.status)return;const e=this._video;this._video.parentElement.querySelectorAll("canvas").forEach(t=>{t.width!==e.videoWidth&&(t.width=e.videoWidth),t.height!==e.videoHeight&&(t.height=e.videoHeight)})}addEventListener(e,t){(this._eventListeners[e]??=new Set).add(t)}removeEventListener(e,t){this._eventListeners[e]?.delete(t)}_callOpenedListeners(){try{this.onOpened?.(this)}catch(e){console.error(e)}this._regionBoxWrapper&&(this._regionBoxWrapper.style.visibility=""),this._eventListeners.opened?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}videoXY2AbsoluteLT(e){const t=this._video,i=t.getBoundingClientRect(),n=getComputedStyle(document.body);if("static"===n.position){const n=document.documentElement.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-n.x,top:e.y/t.videoHeight*i.height+i.y-n.y}))}{const r=document.body.getBoundingClientRect(),s=parseFloat(n.borderLeftWidth),a=parseFloat(n.borderTopWidth);return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x-r.x-s,top:e.y/t.videoHeight*i.height+i.y-r.y-a}))}}videoXY2FixedLT(e){const t=this._video,i=t.getBoundingClientRect();return e.map(e=>({left:(this._isMirrored?t.videoWidth-e.x:e.x)/t.videoWidth*i.width+i.x,top:e.y/t.videoHeight*i.height+i.y}))}getVisibleAreaInVideoXY(e){const{isConsiderRegionBox:t=!1,rounded:i=!1}=e||{};let n;if(t&&this._regionBoxBorder){const e=this._regionBoxBorder.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height};const t=getComputedStyle(this._regionBoxBorder),i=parseFloat(t.borderLeftWidth),r=parseFloat(t.borderTopWidth),s=parseFloat(t.borderRightWidth),a=parseFloat(t.borderBottomWidth);n.x+=i,n.y+=r,n.width-=i+s,n.height-=r+a}else{const e=this._coreShell.getBoundingClientRect();n={x:e.x,y:e.y,width:e.width,height:e.height}}const r=this._video.getBoundingClientRect(),s={x:(n.x-r.x)/r.width,y:(n.y-r.y)/r.height,width:n.width/r.width,height:n.height/r.height};s.x<0&&(s.width+=s.x,s.x=0),s.x>1&&(s.width-=s.x-1,s.x=1),s.y<0&&(s.height+=s.y,s.y=0),s.y>1&&(s.height-=s.y-1,s.y=1),s.x+s.width>1&&(s.width=1-s.x),s.x+s.width<0&&(s.width=-s.x),s.y+s.height>1&&(s.height=1-s.y),s.y+s.height<0&&(s.height=-s.y);const a=this._video.videoWidth,o=this._video.videoHeight;let l=(this.isMirrored?1-s.x-s.width:s.x)*a,c=s.y*o,d=s.width*a,h=s.height*o;return i&&(d=Math.round(d+l)-Math.round(l),h=Math.round(h+c)-Math.round(c),l=Math.round(l),c=Math.round(c)),{x:l,y:c,width:d,height:h}}};const it=["back","front","macro-back","quick-back","customized-video"];tt._arrConstructors.push(function(){const e=this;e._softZoom={zoom:1,center:{x:0,y:0}},e.maxZoom4GestureWheel=20,e._lastZoomTime=-1/0,e._mapZoomTouchs=new Map,e.enableGestureZoom=!0,e.enableWheelZoom=!1}),Object.defineProperty(tt.prototype,"softZoom",{get(){return this._softZoom}}),Object.defineProperty(tt.prototype,"isMirrored",{get(){return this._isMirrored},set(e){const t=this;t._isMirrored=e,t.setSoftZoom(t.softZoom.zoom,{center:t.softZoom.center})}}),Object.defineProperty(tt.prototype,"enableGestureZoom",{get(){return!!this._gestureZoomListener},set(e){const t=this;e?t._gestureZoomListener||(t._gestureZoomListener=e=>{t._changeZoomByTouch(e)},t._coreShell.addEventListener("touchstart",t._gestureZoomListener),t._coreShell.addEventListener("touchmove",t._gestureZoomListener),t._coreShell.addEventListener("touchend",t._gestureZoomListener),t._coreShell.addEventListener("touchcancel",t._gestureZoomListener)):t._gestureZoomListener&&(t._coreShell.removeEventListener("touchstart",t._gestureZoomListener),t._coreShell.removeEventListener("touchmove",t._gestureZoomListener),t._coreShell.removeEventListener("touchend",t._gestureZoomListener),t._coreShell.removeEventListener("touchcancel",t._gestureZoomListener),t._gestureZoomListener=null)}}),Object.defineProperty(tt.prototype,"enableWheelZoom",{get(){return!!this._wheelZoomListener},set(e){const t=this;e?t._wheelZoomListener||(t._wheelZoomListener=e=>{t._changeZoomByWheel(e)},t._coreShell.addEventListener("wheel",t._wheelZoomListener)):t._wheelZoomListener&&(t._coreShell.removeEventListener("wheel",t._wheelZoomListener),t._wheelZoomListener=null)}}),tt.prototype.getZoomRange=function(){if("opened"!==this.status)throw Error("Camera is not opened");return this.track.getCapabilities?.()?.zoom},tt.prototype.setZoom=async function(e){if("opened"!==this.status)throw Error("Camera is not opened");await this.track.applyConstraints({advanced:[{zoom:e}]})},tt.prototype.setSoftZoom=function(e,t){const i=this;let{center:n,limit:r}=t||{},{x:s=0,y:a=0}=n||{};r&&e<1&&(e=1);let o=i._isMirrored?`scale(${-e},${e})`:`scale(${e})`;if(n){if(r){const t=.5-.5/e;s<-t?s=-t:s>t&&(s=t),a<-t?a=-t:a>t&&(a=t)}o+=` translate(${s*=-100}%, ${a*=-100}%)`}i._softZoom={zoom:e,center:{x:s,y:a}},i._coreInnerLayer.style.transform=o},tt.prototype._changeZoomByWheel=function(e){const t=this,i=Date.now();let n=t._softZoom.zoom,r=n-e.deltaY/200;r>t.maxZoom4GestureWheel&&(r=t.maxZoom4GestureWheel),r<1&&(r=1),r!==n&&(t.setSoftZoom(r,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,e.preventDefault(),t._eventListeners.zoom?.forEach(e=>{try{e.call(t,JSON.parse(JSON.stringify(t._softZoom)))}catch(e){console.error(e)}}))},tt.prototype._changeZoomByTouch=function(e){const t=this;for(e.touches.length>=2&&"touchmove"==e.type&&e.preventDefault();e.changedTouches.length>1&&2==e.touches.length;){let i=Date.now();if(i-t._lastZoomTime<100)return;let n=e.touches[0],r=e.touches[1],s=t._mapZoomTouchs.get(n.identifier),a=t._mapZoomTouchs.get(r.identifier);if(!s||!a)break;let o=Math.pow(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2),.5),l=Math.pow(Math.pow(n.clientX-r.clientX,2)+Math.pow(n.clientY-r.clientY,2),.5),c=t._softZoom.zoom;c*=l/o,c>t.maxZoom4GestureWheel&&(c=t.maxZoom4GestureWheel),c<1&&(c=1),t.setSoftZoom(c,{center:t._softZoom.center,limit:!0}),t._lastZoomTime=i,t._eventListeners.zoom?.forEach(e=>{try{e(t)}catch(e){console.error(e)}});break}t._mapZoomTouchs.clear();for(let i of e.touches)t._mapZoomTouchs.set(i.identifier,{x:i.clientX,y:i.clientY})},tt._arrConstructors.push(function(){const e=this;e._isFocusing=!1,e._advancedFocusParameters={minFocusDistanceLimit:.01,maxFocusDistanceLimit:10,firstStepWaitDuration:500,coarseStepWaitDuration:350,switchStepWaitDuration:400,fineStepWaitDuration:350,maxStepCount:30,backToContinousDuration:5e3,focusWH:.2,coarseTuneRate:.5,coarseTuneTolerance:.5,fineTuneRate:1.1},e._advancedFocusTaskId=0,e.enableTapToFocus="simple"}),tt._getImageContrast=(e,t,i)=>{let n=0;for(let r=0;r<i-1;r++)for(let i=0;i<t-1;i++){const s=4*(r*t+i),a=s+4,o=s+4*t,l=e[s]-e[a],c=e[s+1]-e[a+1],d=e[s+2]-e[a+2],h=e[s]-e[o],u=e[s+1]-e[o+1],g=e[s+2]-e[o+2];n+=l*l+c*c+d*d+h*h+u*u+g*g}return n},tt.prototype._simpleFocus=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(e._isFocusing)return;const t=e.currentCamera?.capabilities;let i,n;if(t?.focusMode?.includes("manual"))if(t?.focusMode?.includes("continuous"))i="manual",n="continuous";else{if(!t?.focusMode?.includes("single-shot"))return void e._advancedFocus();i="manual",n="single-shot"}else if(t?.focusMode?.includes("single-shot"))t?.focusMode?.includes("continuous")?(i="continuous",n="single-shot"):(i=null,n="single-shot");else{if(!t?.focusMode?.includes("continuous"))return;i=null,n="continuous"}e._isFocusing=!0;try{i&&("manual"===i?await e.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:t?.focusDistance?.max||10}]}):await e.track.applyConstraints({advanced:[{focusMode:i}]}),await new Promise(e=>setTimeout(e,500))),await e.track.applyConstraints({advanced:[{focusMode:n}]}),await new Promise(e=>setTimeout(e,500))}catch(t){"opened"===e.status&&console.warn("Error while do simple focus",t)}e._isFocusing=!1},tt.prototype._advancedFocus=async function(e,t,i){const n=this;if("opened"!==n.status)throw Error("Camera is not opened");if(n._isFocusing)return;const r=n.currentCamera?.capabilities;if(!r?.focusMode?.includes("manual"))return void n._simpleFocus();const s=n._advancedFocusParameters,a=n._video.videoWidth,o=n._video.videoHeight;if(a<2||o<2)return;let l,c=0;e?(e.x=Math.round(e.x),e.y=Math.round(e.y),t||(t=Math.min(a,o)*s.focusWH),t<2&&(t=2),t>a&&(t=a),t=2*Math.round(t/2),i||(i=t),i<2&&(i=2),i>o&&(i=o),i=2*Math.round(i/2),e.x<t/2&&(e.x=t/2),e.x>a-t/2&&(e.x=a-t/2),e.y<i/2&&(e.y=i/2),e.y>o-i/2&&(e.y=o-i/2),c=e.x-t/2,l=e.y-i/2):(t=a,i=o),n._isFocusing=!0;const d=++n._advancedFocusTaskId;let h=r?.focusDistance?.min;(!h||h<s.minFocusDistanceLimit)&&(h=s.minFocusDistanceLimit);let u=r?.focusDistance?.max;(!u||u>s.maxFocusDistanceLimit)&&(u=s.maxFocusDistanceLimit);let g=-1/0,_=-1/0,p=1/0,f=u,m=!1,E=!0;const I=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});let y=0;try{for(;++y<s.maxStepCount;){let e;await n.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:f}]}),m?E?(E=!1,e=s.switchStepWaitDuration):e=s.fineStepWaitDuration:E?(E=!1,e=s.firstStepWaitDuration):e=s.coarseStepWaitDuration,await new Promise(t=>setTimeout(t,e)),n.getFrame({x:c,y:l,width:t,height:i,reusedContext:I});const r=I.getImageData(0,0,t,i).data,a=tt._getImageContrast(r,t,i);if(m){if(a<=g){await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]}),await n.track.applyConstraints({advanced:[{focusMode:"manual",bestFocusDistance:p}]});break}if(u===f)break;g=a,a>_&&(_=a,p=f),f*=s.fineTuneRate,f>u&&(f=u)}else(a<=_*s.coarseTuneTolerance||h===f)&&(m=!0),g=a,a>_&&(_=a,p=f),m?(f=Math.sqrt(f*p),E=!0):(f*=s.coarseTuneRate,f<h&&(f=h))}}catch(e){"opened"===n.status&&console.warn("Error while do advanced focus",e)}n._isFocusing=!1,s.backToContinousDuration>0&&setTimeout(async()=>{if(n._advancedFocusTaskId===d)try{await n.track.applyConstraints({advanced:[{focusMode:"continuous"}]})}catch(e){}},s.backToContinousDuration)},Object.defineProperty(tt.prototype,"enableTapToFocus",{get(){return this._enableTapToFocus},set(e){const t=this;t._enableTapToFocus=e,e?t._tapToFocusListner||(t._tapToFocusListner=async e=>{if(!("opened"!==t.status||!t._enableTapToFocus||!e.isPrimary||e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||"touch"===e.pointerType&&t.enableGestureZoom&&(await new Promise(e=>setTimeout(e,300)),"opened"!==t.status||!t._enableTapToFocus||t._lastZoomTime>Date.now()-1e3||t._mapZoomTouchs.size>1)))if("experimental-advanced"===t._enableTapToFocus){const[{left:i,top:n},{left:r,top:s}]=t.videoXY2FixedLT([{x:0,y:0},{x:t._video.videoWidth,y:t._video.videoHeight}]);t._advancedFocus({x:(e.clientX-i)/(r-i)*t._video.videoWidth,y:(e.clientY-n)/(s-n)*t._video.videoHeight})}else t._simpleFocus()},t._coreShell.addEventListener("pointerdown",t._tapToFocusListner)):t._tapToFocusListner&&(t._coreShell.removeEventListener("pointerdown",t._tapToFocusListner),t._tapToFocusListner=null)}}),tt._arrConstructors.push(function(){this._isTorchOn=!1,this._autoTorchParameters={shortDelay:250,longDelay:1e3,shortLongDelaySwitchCount:10,maxErrorCount:10,grayThreshold:20,maxDarkCount:3}}),tt._arrOnClose.push(function(){this._isTorchOn=!1}),Object.defineProperty(tt.prototype,"isSupportTorch",{get(){return!!this.currentCamera?.capabilities?.torch}}),Object.defineProperty(tt.prototype,"isTorchOn",{get(){return this._isTorchOn}}),tt.prototype.turnOnTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");try{await e.track.applyConstraints({advanced:[{torch:!0}]})}catch(t){throw e._isTorchOn=!1,t}e._isTorchOn=!0},tt.prototype.turnOffTorch=async function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");await e.track.applyConstraints({advanced:[{torch:!1}]}),e._isTorchOn=!1},tt.prototype.turnAutoTorch=function(){const e=this;if("opened"!==e.status)throw Error("Camera is not opened");if(null==e._isTorchOn)return;e._isTorchOn=void 0;const t=e._autoTorchParameters,i=document.createElement("canvas"),n=i.getContext("2d",{willReadFrequently:!0});let r=0,s=0,a=0;(async()=>{for(;null==e._isTorchOn;){try{e.getFrame({reusedContext:n})}catch(i){if("opened"===e.status&&++r<t.maxErrorCount){await new Promise(e=>setTimeout(e,1e3));continue}e._isTorchOn=!1;break}const o=n.getImageData(0,0,i.width,i.height).data;let l=0;for(let e=0;e<o.length;e+=4)l+=o[e]+o[e+1]+o[e+2];if(l/=o.length/4*3,l<t.grayThreshold&&++s>=t.maxDarkCount){try{await e.turnOnTorch(),e._eventListeners.torchAutoOn?.forEach(t=>{try{t.call(e)}catch(e){console.error(e)}})}catch(e){}break}await new Promise(e=>setTimeout(e,a<t.shortLongDelaySwitchCount?t.shortDelay:t.longDelay)),++a}})()},tt._arrConstructors.push(function(){this._shouldCloseWhenHide=!0,this._maxReopenTry4CloseWhenHide=4}),tt._arrOnOpen.push(function(){const e=this;e._shouldCloseWhenHide&&(e._closeWhenHideListener||(e._closeWhenHideListener=()=>{e._closeWhenHide()},document.addEventListener("visibilitychange",e._closeWhenHideListener)))}),tt._arrBeforeClose.push(function(){const e=this;e._closeWhenHideListener&&!e._isDuringCloseWhenHide&&(document.removeEventListener("visibilitychange",e._closeWhenHideListener),e._closeWhenHideListener=null,e._isOpenBeforeHide=!1)}),Object.defineProperty(tt.prototype,"shouldCloseWhenHide",{get(){return this._shouldCloseWhenHide},set(e){const t=this;t._shouldCloseWhenHide=e,"opened"===t.status&&(e?t._closeWhenHideListener||(t._closeWhenHideListener=()=>{t._closeWhenHide()},document.addEventListener("visibilitychange",t._closeWhenHideListener)):t._closeWhenHideListener&&(document.removeEventListener("visibilitychange",t._closeWhenHideListener),t._closeWhenHideListener=null,t._isOpenBeforeHide=!1))}}),tt.prototype._closeWhenHide=async function(){const e=this;if("hidden"===document.visibilityState)"opened"===e.status&&(e._isDuringCloseWhenHide=!0,e._isOpenBeforeHide=!0,await e.close(),e._isDuringCloseWhenHide=!1);else if(e._isOpenBeforeHide){let t=0;for(;t++<e._maxReopenTry4CloseWhenHide&&"visible"===document.visibilityState;){try{await e.open()}catch(e){await new Promise(e=>setTimeout(e,300));continue}e._isOpenBeforeHide=!1;break}}},tt.showFilePicker=async function(e){let t=document.createElement("input");t.type="file",t.accept="image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff",t.multiple=!0;let i=new Promise(function(e){t.addEventListener("change",function(){e(Array.from(t.files))})});Object.assign(t,e);let n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});return t.dispatchEvent(n),i};let nt,rt=class{camera;_ctx;_data;_dataTime=-1/0;_x;_y;_w;_h;_type;maxTimeout=500;_pipeTaskId;isSaveOriginalRgba=!1;originalRgba;constructor(e){this.camera=e;const t=document.createElement("canvas");this._ctx=t.getContext("2d",{willReadFrequently:!0})}_getData(){if("opened"!==this.camera.status)return null;this.camera.getFrame({x:this._x,y:this._y,width:this._w,height:this._h,reusedContext:this._ctx});const e=this._ctx.getImageData(0,0,this._w,this._h).data;if(this.originalRgba=this.isSaveOriginalRgba?e:null,"rgba"===this._type)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const t=new Uint8Array(e.length/4);for(let i=0;i<e.length;i+=4)t[i/4]=.3*e[i]+.59*e[i+1]+.11*e[i+2];return t}getData(e){let{x:t=0,y:i=0,width:n=this.camera._video.videoWidth,height:r=this.camera._video.videoHeight,type:s="rgba"}=e||{};if(n=Math.round(n+t)-Math.round(t),r=Math.round(r+i)-Math.round(i),t=Math.round(t),i=Math.round(i),0===n||0===r||isNaN(n)||isNaN(r))return null;const a=t!==this._x||i!==this._y||n!==this._w||r!==this._h||s!==this._type;let o;return a&&(this._x=t,this._y=i,this._w=n,this._h=r,this._type=s),!a&&this._dataTime+this.maxTimeout>Date.now()&&this._data?(o=this._data,this._data=null):o=this._getData(),this._pipeTaskId||(this._pipeTaskId=setTimeout(()=>{this._pipeTaskId=null,this._data=this._getData(),this._dataTime=Date.now()},0)),o}},st=class{_stAudioFree=new Set;_stAudioPlaying=new Set;_timeLastPlay=0;_bWarnedMaxTrack=!1;maxPlayingBeep=16;beepSoundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";beep(){if(!this.beepSoundSource)return;let e,t=Date.now();if(!(t-this._timeLastPlay<100)){if(this._timeLastPlay=t,this._stAudioFree.size&&(e=this._stAudioFree.values().next().value,this.beepSoundSource==e.src?(this._stAudioFree.delete(e),e.play()):e=null),!e)if(this._stAudioPlaying.size<this.maxPlayingBeep){e=new Audio(this.beepSoundSource);let t=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),t=setTimeout(()=>{this._stAudioPlaying.delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",()=>{null!=t&&(clearTimeout(t),t=null),e.pause(),e.currentTime=0,this._stAudioPlaying.delete(e),this._stAudioFree.add(e)})}else this._bWarnedMaxTrack||(this._bWarnedMaxTrack=!0,console.warn(`The requested audio tracks exceed ${this.maxPlayingBeep} and will not be played.`));e&&this._stAudioPlaying.add(e)}}};const at=()=>{(nt??=new st).beep()},ot=(e=300)=>{if(!navigator?.vibrate)throw new Error("Not supported.");navigator.vibrate(e)},lt=tt,ct=tt;if(document?.head){const e=new Blob(["@keyframes dce-scanlight{from{top:0;}to{top:97%;}}"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}lt.createInstance=async function(e){let t;if(e instanceof tt?(t=e,e=void 0):t=new tt,void 0===t.disposed){if(t.disposed=!1,t._cameraEnhancer=t._cameraView=t,t._framePipeline=new rt(t),t._dceScanRegion={x:0,y:0,width:100,height:100,isMeasuredInPercentage:!0},t._dceEventListeners={},t._oriOpen=t.open,t.open=dt,t._dceZoom=1,t._dceEnhancedFeatures=0,t._dceAutoZoomRange={min:1,max:10},t._oriSetZoom=t.setZoom,t.setZoom=ht,t.singleFrameMode="disabled",t.addImageToBuffer=t.clearBuffer=t.getBufferOverflowProtectionMode=t.getColourChannelUsageType=t.getImageCount=t.getImageFetchInterval=t.getMaxImageCount=t.hasImage=t.setBufferOverflowProtectionMode=t.setErrorListener=t.setImageFetchInterval=t.setMaxImageCount=t.setNextImageToReturn=()=>{},e??=ct.defaultUIElementURL,e&&await t.setUIElement(e),t._dceRegionMaskStyle={lineWidth:parseFloat(t.regionBox.borderStyle.border?.split(" ")[0]),strokeStyle:t.regionBox.borderStyle.border?.split(" ")[2],fillStyle:t.regionBox.maskStyle.background},t._dceRegionMaskVisible=!0,t._dceTipDuration=3e3,t._drawingLayers=[],t._drawingLayers.length=4,t._capturedResultReceiver={onCapturedResultReceived:Dt.bind(t)},!t.regionBox.innerUi){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",width:"100%",height:"3%",borderRadius:"50%",boxShadow:"0px 0px 2vw 1px #00e5ff",background:"#fff",animation:"3s infinite dce-scanlight",pointerEvents:"none",userSelect:"none",display:"none"}),t.setRegionBox({innerUi:e})}t.addEventListener("opened",function(){this._dceEventListeners.cameraOpen?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}),this._dceEventListeners.played?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});const e=t.currentCamera?.deviceId;e!==t._dceLastDeviceId&&(t._dceLastDeviceId=e,this._dceEventListeners.cameraChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}));const i=t.currentResolution;i.width===t._dceLastResolution?.width&&i.height===t._dceLastResolution?.height||(t._dceLastResolution=i,this._dceEventListeners.resolutionChange?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}}))}),t.addEventListener("closed",function(){this._dceEventListeners.cameraClose?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}),["mousedown","mouseup","dblclick"].forEach(e=>{t._coreShell.addEventListener(e,function(e){const i=[e.clientX,e.clientY],n=t._drawingLayers.filter(e=>e?._visible).map(e=>e._drawingItems).flat(),r=t.videoXY2AbsoluteLT(n.map(e=>{if(e instanceof vt)return e.quad.points;if(e instanceof St||e instanceof At||e instanceof At){let{x:t,y:i,width:n,height:r}=e.rect,s=t+n,a=i+r;return[{x:t,y:i},{x:t,y:a},{x:s,y:a},{x:s,y:i}]}return e instanceof wt?[e.line.startPoint,e.line.endPoint]:void 0}).flat()).map(e=>[e.left,e.top]);let s=0;n.forEach(t=>{let n=!1;t instanceof vt||t instanceof St||t instanceof At||t instanceof At?(n=Tt(i,[r[s],r[s+1],r[s+2],r[s+3]]),s+=4):t instanceof wt&&(n=Tt(i,[r[s],r[s+1]]),s+=2),n&&t._dceEventListeners[e.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})})})})}return t},lt.defaultUIElementURL="@engineResourcePath/ui/dce.ui.xml";const dt=async function(){const e=this;if("camera"===e.singleFrameMode||"image"===e.singleFrameMode){const t={multiple:!1};"camera"===e.singleFrameMode&&(t.capture="environment");const i=(await tt.showFilePicker(t))[0],n=document.createElement("canvas"),r=n.getContext("2d"),s=URL.createObjectURL(i),a=new Image;a.src=s,await a.decode(),n.width=a.width,n.height=a.height,r.drawImage(a,0,0),URL.revokeObjectURL(s);const o=r.getImageData(0,0,n.width,n.height).data,l={bytes:new Uint8Array(o.buffer,o.byteOffset,o.length),width:n.width,height:n.height,stride:4*n.width,format:10,toCanvas:()=>n,imageTag:{imageId:++gt,type:0}};return void e._dceEventListeners.singleFrameAcquired?.forEach(e=>{try{e.call(this,l)}catch(e){console.error(e)}})}const t=e.ui.querySelector(".dce-bg-loading");t&&(t.style.display="");try{await e._oriOpen()}catch(e){throw lt.onWarning&&lt.onWarning(e?.message),e}return t&&(t.style.display="none"),await new Promise(e=>setTimeout(e,0)),{deviceId:e.currentCamera?.deviceId,...e.currentResolution}};lt.prototype.dispose=function(){this.disposed=!0,this.close(),this.setScanLaserVisible(!1)},lt.prototype.getAllCameras=async function(){return(await tt.getDeviceInfos()).map(e=>({deviceId:e.deviceId,label:e.label}))},lt.prototype.getAvailableResolutions=async function(){const e=this,t=[];await e._oriOpen();for(let i of[[160,120],[320,240],[480,360],[640,480],[800,600],[960,720],[1280,720],[1920,1080],[2560,1440],[3840,2160]])await e.requestResolution(i),(e.currentResolution?.width===i[0]&&e.currentResolution?.height===i[1]||e.currentResolution?.width===i[1]&&e.currentResolution?.height===i[0])&&t.push({width:i[0],height:i[1]});return await e.close(),t},lt.prototype.getCameraStatus=function(){let e=this.status;return"closing"!==e&&"paused"!==e||(e="closed"),e},lt.prototype.getResolution=function(){return"opened"===this.status?this.currentResolution:this.requestedResolution},lt.prototype.getSelectedCamera=function(){return"opened"===this.status?{deviceId:this.currentCamera?.deviceId,label:this.currentCamera?.label}:null},lt.prototype.getVideoSettings=function(){let e="string"==typeof this.requestedCamera?{video:!0}:this.requestedCamera;return Object.assign(e,this.requestedResolution),e},Object.defineProperty(lt.prototype,"ifSkipCameraInspection",{get(){return"quick-back"===this.requestedCamera},set(e){e?this.requestCamera("quick-back"):this.requestCamera("back")}}),lt.prototype.isOpen=function(){return"opened"===this.status},lt.prototype.isPaused=function(){return"paused"===this.status},lt.prototype.resume=async function(){await this._oriOpen()},lt.prototype.selectCamera=async function(e){return await this.requestCamera("string"==typeof e?e:e.deviceId),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},lt.prototype.setResolution=async function(e){return await this.requestResolution(e),{deviceId:this.currentCamera?.deviceId,...this.currentResolution}},lt.testCameraAccess=async function(){let e,t=!0;try{await tt.getDeviceInfos()}catch(i){t=!1,e=i.message||i}return{ok:t,message:e}},lt.prototype.updateVideoSettings=async function(e){await this.requestCamera(e)},Object.defineProperty(lt.prototype,"videoSrc",{get(){return this._dceVideoSrc},set(e){const t=this;t._dceVideoSrc=e,e?(t.video.src=e,t.requestCamera("customized-video")):(t.video.src="",t.requestCamera(void 0))}}),lt.prototype.disableEnhancedFeatures=function(e){this._dceEnhancedFeatures=this._dceEnhancedFeatures-(this._dceEnhancedFeatures&e)},lt.prototype.enableEnhancedFeatures=function(e){this._dceEnhancedFeatures|=e},lt.prototype.getCameraSettings=function(){return this.track.getSettings()},lt.prototype.getCapabilities=function(){return this.track.getCapabilities()},lt.prototype.getColorTemperature=function(){return this.track?.getSettings()?.colorTemperature},lt.prototype.getExposureCompensation=function(){return this.track?.getSettings()?.exposureCompensation},lt.prototype.getFrameRate=function(){return this.track?.getSettings()?.frameRate},lt.prototype.setColorTemperature=function(e){this.track?.applyConstraints?.({advanced:[{colorTemperature:{ideal:e}}]})},lt.prototype.setExposureCompensation=function(e){this.track?.applyConstraints?.({advanced:[{exposureCompensation:{ideal:e}}]})},lt.prototype.setFrameRate=function(e){this.track?.applyConstraints?.({advanced:[{frameRate:{ideal:e}}]})},lt.prototype.getZoomSettings=function(){return{factor:this._dceZoom}};const ht=async function(e){const t=this;if("number"==typeof e)return void await t._oriSetZoom(e);let i,n=e.factor;try{i=t.getZoomRange().max}catch(e){i=null}i?n<i?(await t._oriSetZoom(n),t.setSoftZoom(1)):(await t._oriSetZoom(i),t.setSoftZoom(n/i)):t.setSoftZoom(n),t._dceZoom=n};function ut(e,t,i,n){const r=document.createElement("canvas");r.width=t,r.height=i;const s=r.getContext("2d");if(10!==n){let n=new Uint8Array(t*i*4);for(let t=0;t<e.length;++t){let i=4*t;n[i+2]=n[i+1]=n[i]=e[t],n[i+3]=255}e=n}const a=new Uint8ClampedArray(e),o=new ImageData(a,t,i);return s.putImageData(o,0,0),r}lt.prototype.resetZoom=function(){this.setZoom(1),this.setSoftZoom(1,{center:{x:0,y:0}})},lt.prototype.getFocusSettings=function(){return this._dceFocusSettings},lt.prototype.setFocus=async function(e){const t=this;if(t._dceFocusSettings=e,"manual"!==e.mode)await t.track.applyConstraints({advanced:[{focusMode:e.mode}]});else if(e.distance)await t.track.applyConstraints({advanced:[{focusMode:"manual",focusDistance:e.distance}]});else{let{x:i,y:n}=e.area.centerPoint,r=e.area.width,s=e.area.height,a=t.currentResolution.width,o=t.currentResolution.height;"string"==typeof i&&(i=i.endsWith("%")?parseFloat(i)*a:parseFloat(i)),"string"==typeof n&&(n=n.endsWith("%")?parseFloat(n)*o:parseFloat(n)),"string"==typeof r&&(r=r.endsWith("%")?parseFloat(r)*a:parseFloat(r)),"string"==typeof s&&(s=s.endsWith("%")?parseFloat(s)*o:parseFloat(s)),await t._advancedFocus({x:i,y:n},r,s)}},lt.prototype.setAutoZoomRange=function(e){this._dceAutoZoomRange=e},lt.prototype.getAutoZoomRange=function(){return this._dceAutoZoomRange};let gt=0;lt.prototype.fetchImage=lt.prototype.getImage=lt.prototype.takePhoto=function(){const e=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),t=2!=this._pixelFormat,i=this._framePipeline.getData({...e,type:t?"rgba":"gray"});if(!i)return null;this._dceEventListeners.frameAddedToBuffer?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});let{width:n,height:r}=e,s=t?10:2;return{bytes:i,width:n,height:r,stride:e.width*(t?4:1),format:s,toCanvas:()=>ut(i,n,r,s),imageTag:{imageId:++gt,type:1}}},Object.defineProperty(lt.prototype,"singleFrameMode",{get(){return this._singleFrameMode},set(e){const t=this;t._singleFrameMode=e;const i=t.ui.querySelector(".dce-bg-camera");i&&("disabled"!==e?(t._singleFrameModeClickCallback||(t._singleFrameModeClickCallback=()=>{t.open()},i.addEventListener("click",t._singleFrameModeClickCallback)),i.style.display=""):(t._singleFrameModeClickCallback&&(i.removeEventListener("click",t._singleFrameModeClickCallback),t._singleFrameModeClickCallback=null),i.style.display="none"))}}),lt.prototype.getScanRegion=function(){return this._dceScanRegion},lt.prototype.hasNextImageToFetch=function(){return"opened"===this.status},lt.prototype.isBufferEmpty=function(){return"opened"!==this.status},lt.prototype.setColourChannelUsageType=function(e){},lt.prototype.startFetching=function(){},lt.prototype.setPixelFormat=function(){return this._pixelFormat},lt.prototype.setPixelFormat=function(e){this._pixelFormat=e},lt.prototype.setScanRegion=function(e){this._dceScanRegion=e;const t=this._dceRegionMaskVisible,i=this._dceRegionMaskStyle;if(e.isMeasuredInPercentage)if(void 0!==e.x){let n=e;this.setRegionBox({width:n.width/100,height:n.height/100,center:{x:(n.x+n.width/2-50)/100,y:(n.y+n.height/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=e;this.setRegionBox({width:(n.right-n.left)/100,height:(n.bottom-n.top)/100,center:{x:((n.left+n.right)/2-50)/100,y:((n.top+n.bottom)/2-50)/100},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let n=this.video.videoWidth||720,r=this.video.videoHeight||1280;if(void 0!==e.x){let s=e;this.setRegionBox({width:Math.min(s.width/n,1),height:Math.min(s.height/r,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}else{let s=e;this.setRegionBox({width:Math.min((s.right-s.left)/n,1),height:Math.min((s.bottom-s.top)/r,1),center:{x:0,y:0},maskStyle:{background:t?i.fillStyle:""},borderStyle:{border:t?`${i.lineWidth}px solid ${i.strokeStyle}`:""}})}}},lt.prototype.stopFetching=function(){},lt.prototype.setCameraView=function(e){if(e===this)return;const t=e.ui.parentElement;e.ui.parentElement&&(e.ui.remove(),t.append(this.ui));let i=[];for(let t in e)"function"==typeof e[t]&&i.push(t);for(let t of i)e[t]=this[t].bind(this)},lt.prototype.getCameraView=function(){return this},lt.prototype.getVideoEl=function(){return this.video},lt.prototype.convertToPageCoordinates=function(e){return this.videoXY2AbsoluteLT([e]).map(e=>({x:e.left,y:e.top}))[0]},lt.prototype.convertToClientCoordinates=function(e){return this.videoXY2FixedLT([e]).map(e=>({x:e.left,y:e.top}))[0]},lt.prototype.convertToScanRegionCoordinates=function(e){const t=this,{x:i,y:n,width:r,height:s}=t.getVisibleAreaInVideoXY({isConsiderRegionBox:!0});if(isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},lt.prototype.convertToContainCoordinates=function(e){const t=this,{x:i,y:n,width:r,height:s}=t.getVisibleAreaInVideoXY();if(isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s))return{x:0,y:0};const a=t.video.videoWidth,o=t.video.videoHeight;let l=t.videoXY2AbsoluteLT([{x:0,y:0},{x:a,y:o}]);return{x:(e.x-i)/a*(l[1].left-l[0].left),y:(e.y-n)/o*(l[1].top-l[0].top)}},lt.prototype.on=function(e,t){(this._dceEventListeners[e]??=new Set).add(t)},lt.prototype.off=function(e,t){this._dceEventListeners[e]?.delete(t)},ct.prototype.getUIElement=function(){return this.ui},ct.prototype.setUIElement=async function(e){if(!e)return void(this._ui=void 0);if(e instanceof HTMLElement&&e.contains(this._coreShell))return void(this._ui=e);if(e instanceof HTMLElement&&!e.childElementCount)return await this.setUIElement(ct.defaultUIElementURL),e.append(this.getUIElement()),void(this.ui=e);if("string"==typeof e){let t=e.trim();if(!t.trimStart().startsWith("<")){if(t.includes("@engineResourcePath/")){const e=lt.handleEngineResourcePaths(lt.CoreModule.engineResourcePaths);t=t.replace("@engineResourcePath/","DBR"===lt.CoreModule._bundleEnv?e.dbrBundle:e.dcvData)}t=await fetch(t).then(e=>e.text()),t=t.trim()}if(!t.startsWith("<"))throw Error("Invalid html string.");if(t.startsWith("<template>")&&(t=t.substring(10,t.length-11).trim()),!t.startsWith("<"))throw Error("Invalid html string.");let i,n=qe(t,{inlineScript2Blob:this._uiInlineScript2Blob,internalCss2Blob:this._uiInternalCss2Blob,insertInternalCss2ExistedSheet:this._uiInternalCss2ExistedSheet});if(n instanceof HTMLElement)i=n;else{if(!(n instanceof DocumentFragment))throw Error("Seems no HTMLElement.");i=document.createElement("div"),Object.assign(i.style,{width:"100%",height:"100%"}),i.append(n)}e=i,Object.defineProperty(e,"shadowRoot",{value:e,writable:!0})}if(!(e instanceof HTMLElement))throw Error("Invalid html string.");const t="dm-camera-core-container";let i=e.classList.contains(t)?e:e.querySelector(`.${t}`);if(!i){const n="dce-video-container";i=e.classList.contains(n)?e:e.querySelector(`.${n}`),i&&(e.style.overflow="hidden",e.querySelector("select.dce-sel-camera")?.remove(),e.querySelector("select.dce-sel-resolution")?.remove(),i.classList.add(t))}i||e.classList.add(t),this.ui=e},ct.prototype.getVideoElement=function(){return this.video},ct.prototype.setVideoFit=function(e){this.objectFit=e},ct.prototype.getVideoFit=function(){return this.objectFit},ct.prototype.getVisibleRegionOfVideo=function(e){let{inPixels:t}=e||{inPixels:!1};const i=this.getVisibleAreaInVideoXY();if(t)return{...i,isMeasuredInPercentage:!1};{let{width:e,height:t}=this.currentResolution;return{x:i.x/e*100,y:i.y/t*100,width:i.width/e*100,height:i.height/t*100,isMeasuredInPercentage:!0}}},ct.prototype.setScanRegionMaskStyle=function(e){const t=this._dceRegionMaskVisible;this._dceRegionMaskStyle={...e},this.setRegionBox({maskStyle:{background:t?e.fillStyle:""},borderStyle:{border:t?`${e.lineWidth}px solid ${e.strokeStyle}`:""}})},ct.prototype.getScanRegionMaskStyle=function(){return this._dceRegionMaskStyle},ct.prototype.setScanRegionMaskVisible=function(e){this._dceRegionMaskVisible=e;const t=this._dceRegionMaskStyle;this.setRegionBox({maskStyle:{background:e?t.fillStyle:""},borderStyle:{border:e?`${t.lineWidth}px solid ${t.strokeStyle}`:""}})},ct.prototype.isScanRegionMaskVisible=function(){return this._dceRegionMaskVisible},ct.prototype.setScanLaserVisible=function(e){const t=this.regionBox.innerUi.style;t.display=e?"":"none",setTimeout(()=>{t.display="none",e&&(t.display="")},0)},ct.prototype.isScanLaserVisible=function(){return"none"!==this.regionBox.innerUi.style.display},ct.prototype.setPowerByMessageVisible=function(e){let t=this.ui.querySelector("dce-msg-poweredby,dm-camera-mn-msg-poweredby");t&&(e?"none"!==t.style.display&&(t.style.display=""):t.style.display="none")},ct.prototype.isPowerByMessageVisible=function(){let e=this.ui.querySelector("dce-msg-poweredby");return e&&"none"!==e.style.display},ct.prototype.getTipConfig=function(){return{duration:this._dceTipDuration}},ct.prototype.setTipConfig=function(e){this._dceTipDuration=e.duration},ct.prototype.setTipVisible=function(e){if(e)this.funcShowToast?.(this._dceTipMessage,this._dceTipDuration);else{const e=this.ui.querySelector(".dm-camera-mn-toast");e&&(e.style.display="none")}},ct.prototype.isTipVisible=function(){const e=this.ui.querySelector(".dm-camera-mn-toast");return!!e&&"none"!=e.style.display},ct.prototype.updateTipMessage=function(e){this._dceTipMessage=e},ct.prototype.createDrawingLayer=function(){const e=new Rt;return e._ctx=this.addCanvas().getContext("2d"),this._drawingLayers.push(e),e},ct.prototype.getDrawingLayer=function(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=new Rt,t._ctx=this.addCanvas().getContext("2d"),this._drawingLayers[e]=t,1===e?t._defaultStyle=yt.STYLE_BLUE_STROKE:2===e?t._defaultStyle=yt.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=yt.STYLE_GREEN_STROKE_FILL)),t},ct.prototype.getAllDrawingLayers=function(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)},ct.prototype.clearUserDefinedDrawingLayers=function(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4},ct.prototype.deleteUserDefinedDrawingLayer=function(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])},ct.prototype.clearAllInnerDrawingItems=function(){for(let e of this._drawingLayers.slice(1,4))e?.clearDrawingItems()};let _t=class{static _beepInstance;static beep(){null!=this._beepInstance?this._beepInstance.beep():at()}static get beepSoundSource(){return this._beepInstance?.beepSoundSource}static set beepSoundSource(e){this._beepInstance??=new st,this._beepInstance.beepSoundSource=e}static vibrate(){null!=this.vibrateDuration?ot(this.vibrateDuration):ot()}static vibrateDuration};const pt="73,245,73",ft="73,173,245",mt="254,180,32",Et="245,236,73",It=(e,t)=>{let i,n;return"f"===t?(i="strokeAndFill",n="0.3"):"t"===t?(i="fill",n="0.2"):(i="stroke",n="0.3"),{lineWidth:2,fillStyle:`rgba(${e},${n})`,strokeStyle:`rgba(${e},0.9)`,fontFamily:"consolas",fontSize:40,paintMode:i}},yt={STYLE_GREEN_STROKE:It(pt),STYLE_GREEN_STROKE_FILL:It(pt,"f"),STYLE_GREEN_STROKE_TRANSPARENT:It(pt,"t"),STYLE_BLUE_STROKE:It(ft),STYLE_BLUE_STROKE_FILL:It(ft,"f"),STYLE_BLUE_STROKE_TRANSPARENT:It(ft,"t"),STYLE_ORANGE_STROKE:It(mt),STYLE_ORANGE_STROKE_FILL:It(mt,"f"),STYLE_ORANGE_STROKE_TRANSPARENT:It(mt,"t"),STYLE_YELLOW_STROKE:It(Et),STYLE_YELLOW_STROKE_FILL:It(Et,"f"),STYLE_YELLOW_STROKE_TRANSPARENT:It(Et,"t"),createDrawingStyle(e){let t=Object.assign({},this.STYLE_YELLOW_STROKE_FILL,e);return Object.assign(e,t),e},getDrawingStyle(e){return"number"==typeof e?this.STYLE_GREEN_STROKE:e},getAllDrawingStyles:()=>[],updateDrawingStyle(e,t){Object.keys(e).forEach(t=>{delete e[t]}),Object.assign(e,t)}};let Rt=class{_visible=!0;_ctx;_defaultStyle=yt.STYLE_YELLOW_STROKE_FILL;_drawingItems=[];_mode="viewer";_renderTask;getId(){return this}isVisible(){return this._visible}setVisible(e){this._visible=e;const t=this._ctx;if(!t)return;const i=t.canvas;t.clearRect(0,0,i.width,i.height)}setDefaultStyle(e,t,i){this._defaultStyle=yt.getDrawingStyle(e),this._delayRenderAll()}addDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=this._drawingItems.concat(e),this._delayRenderAll()}removeDrawingItems(e){this._drawingItems=this._drawingItems.filter(t=>!e.includes(t))}setDrawingItems(e){for(let t of e)t.drawingLayerId=this;this._drawingItems=[...e],this._delayRenderAll()}getDrawingItems(e){return this._drawingItems.filter(t=>!e||e(t))}hasDrawingItem(e){return this._drawingItems.includes(e)}clearDrawingItems(){this._drawingItems=[],this._delayRenderAll()}_delayRenderAll(){this._renderTask||(this._renderTask=setTimeout(()=>{this.renderAll(),this._renderTask=null},0))}renderAll(){if(!this._visible||!this._ctx)return;const e=this._ctx,t=e.canvas;e.clearRect(0,0,t.width,t.height);for(let t of this._drawingItems){const i=yt.getDrawingStyle(t.drawingStyleId||this._defaultStyle);if(t instanceof At){e.font=`${i.fontSize}px ${i.fontFamily}`;const{x:n,y:r,width:s,height:a}=t.rect;e.fillText(t.text,n,r,s)}else if(t instanceof bt){const i=t.image,n=i.naturalWidth||i.videoWidth||i.width||0,r=i.naturalHeight||i.videoHeight||i.height||0;if(!n||!r)continue;let{x:s,y:a,width:o,height:l}=t.rect;t.maintainAspectRatio&&(l=o/n*r),e.drawImage(i,s,a,o,l)}else{if(e.fillStyle=i.fillStyle,e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,e.setLineDash([]),t._bSelected&&(e.strokeStyle="#0f0",e.lineWidth=4,e.setLineDash([4,4])),e.beginPath(),t instanceof vt){const i=t.quad.points;e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.lineTo(i[3].x,i[3].y)}else if(t instanceof wt){const i=t.line.startPoint,n=t.line.endPoint;e.moveTo(i.x,i.y),e.lineTo(n.x,n.y)}else if(t instanceof St){const{x:i,y:n,width:r,height:s}=t.rect;e.moveTo(i,n),e.lineTo(i+r,n),e.lineTo(i+r,n+s),e.lineTo(i,n+s)}i.paintMode.toLowerCase().includes("fill")&&e.fill(),e.closePath(),i.paintMode.toLowerCase().includes("stroke")&&e.stroke()}}}getMode(){return this._mode}setMode(e){}};function Tt(e,t){const[i,n]=e;let r=!1;for(let e=0,s=t.length-1;e<t.length;s=e++){const[a,o]=t[e],[l,c]=t[s];if((i-a)*(n-o)==(i-l)*(n-c))return!0;o>n!=c>n&&i<(l-a)*(n-o)/(c-o)+a&&(r=!r)}return r}let Ct=class{coordinateBase="image";drawingLayerId;drawingStyleId;mediaType;_state=Lt.DIS_DEFAULT;_notes=[];_bSelected=!1;_dceEventListeners={};getState(){return this._state}addNote(e,t){if(t){let t=!1;for(let i=0;i<this._notes.length;++i)this._notes[i].name===e.name&&(this._notes.splice(i,1,e),t=!0);t||this._notes.push(e)}else this._notes.push(e)}getNote(e){for(let t of this._notes)if(e===t.name)return t;return null}getNotes(){return[...this._notes]}hasNote(e){for(let t of this._notes)if(e===t.name)return!0;return!1}updateNote(e,t,i){for(let n of this._notes)e===n.name&&(i&&"object"==typeof n.content&&"object"==typeof t?n.content={...n.content,content:t}:n.content=t)}deleteNote(e){this._notes=this._notes.filter(t=>t.name!==e)}clearNotes(){this._notes=[]}_delayRenderAll(){this.drawingLayerId?._delayRenderAll()}_setSelected(e){this._bSelected=e,this._delayRenderAll()}on(e,t){(this._dceEventListeners[e]??=new Set).add(t)}off(e,t){this._dceEventListeners[e]?.delete(t)}},wt=class extends Ct{line;constructor(e,t){super(),this.mediaType=Ot.DIMT_LINE,this.line=e,this.drawingStyleId=t}getLine(){return this.line}setLine(e){this.line=e,this._delayRenderAll()}},vt=class extends Ct{quad;constructor(e,t){super(),this.mediaType=Ot.DIMT_QUADRILATERAL,this.quad=e,this.drawingStyleId=t}getQuad(){return this.quad}setQuad(e){this.quad=e,this._delayRenderAll()}},St=class extends Ct{rect;constructor(e,t){super(),this.mediaType=Ot.DIMT_RECTANGLE,this.rect=e,this.drawingStyleId=t}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},At=class extends Ct{text;rect;constructor(e,t,i){super(),this.mediaType=Ot.DIMT_TEXT,this.text=e,this.rect=t,this.drawingStyleId=i}getText(){return this.text}setText(e){this.text=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}},bt=class extends Ct{image;rect;maintainAspectRatio;constructor(e,t,i,n){super(),this.mediaType=Ot.DIMT_IMAGE,e.bytes&&e.format&&(e=ut(e.bytes,e.width,e.height,e.format)),this.image=e,this.rect=t,this.maintainAspectRatio=i,this.drawingStyleId=n}getImage(){return this.image}setImage(e){this.image=e,this._delayRenderAll()}getRect(){return this.rect}setRect(e){this.rect=e,this._delayRenderAll()}};const Dt=function(e,t){if(this.disposed)return;this.clearAllInnerDrawingItems();const i=e?.items;if(!i?.length)return;const n=this.getVisibleAreaInVideoXY({isConsiderRegionBox:!0,rounded:!0}),r=n.x,s=n.y;for(let e of i){let i,n,a;switch(e.type){case 2:i=this.getDrawingLayer(2),n=e.location.points.map(e=>({x:r+e.x,y:s+e.y})),t?.isBarcodeVerifyOpen&&!e.verified&&(a=yt.STYLE_ORANGE_STROKE_TRANSPARENT);break;case 4:i=this.getDrawingLayer(3),n=e.location.points.map(e=>({x:r+e.x,y:s+e.y})),t?.isLabelVerifyOpen&&!e.verified&&(a=yt.STYLE_GREEN_STROKE_TRANSPARENT);break;case 8:i=this.getDrawingLayer(1),n=e.location.points.map(e=>({x:r+e.x,y:s+e.y})),t?.isDetectVerifyOpen&&1!==e.crossVerificationStatus&&(a=yt.STYLE_BLUE_STROKE_TRANSPARENT);break;case 16:i=this.getDrawingLayer(1),n=e.sourceLocation.points.map(e=>({x:r+e.x,y:s+e.y})),t?.isNormalizeVerifyOpen&&1!==e.crossVerificationStatus&&(a=yt.STYLE_BLUE_STROKE_TRANSPARENT);break;default:continue}i.addDrawingItems([new vt({points:n})],a)}};var Ot,Lt,Nt,Mt;!function(e){e[e.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",e[e.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",e[e.DIMT_TEXT=4]="DIMT_TEXT",e[e.DIMT_ARC=8]="DIMT_ARC",e[e.DIMT_IMAGE=16]="DIMT_IMAGE",e[e.DIMT_POLYGON=32]="DIMT_POLYGON",e[e.DIMT_LINE=64]="DIMT_LINE",e[e.DIMT_GROUP=128]="DIMT_GROUP"}(Ot||(Ot={})),function(e){e[e.DIS_DEFAULT=1]="DIS_DEFAULT",e[e.DIS_SELECTED=2]="DIS_SELECTED"}(Lt||(Lt={})),function(e){e[e.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",e[e.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",e[e.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Nt||(Nt={})),function(e){e.GREY="grey",e.GREY32="grey32",e.RGBA="rgba",e.RBGA="rbga",e.GRBA="grba",e.GBRA="gbra",e.BRGA="brga",e.BGRA="bgra"}(Mt||(Mt={}));let Pt=function(){let e=this,t=1e5,i=function(e,t,i){return new Promise(function(n){if(e.toBlob)e.toBlob(function(e){n(e)},t,i);else{let r=e.toDataURL(t,i),s=xt.convertBase64ToBlob(r.substring(r.indexOf(",")+1),t);n(s)}})},n=Pt._doCallbackNoBreak,r=qe(['<div style="width:100%;height:100%;border:1px solid #ccc;">','<div class="kPainterBox">','<div class="kPainterImgsDiv">','<canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas>',"</div",'><div class="kPainterCroper" style="width:50px;height:50px;display:none;">','<div class="kPainterCells">',"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","</div",'><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div','><div class="kPainterEdges">','<div data-orient="-1,0"></div','><div data-orient="0,-1"></div','><div data-orient="1,0"></div','><div data-orient="0,1"></div>',"</div",'><div class="kPainterCorners">','<div data-orient="-1,-1"><i></i></div','><div data-orient="1,-1"><i></i></div','><div data-orient="1,1"><i></i></div','><div data-orient="-1,1"><i></i></div>',"</div",'><div class="kPainterMover" data-orient="0,0">',"<div></div>",'<svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg>',"</div>","</div",'><div class="kPainterPerspect" style="display:none;">','<canvas class="kPainterPerspectCvs"></canvas','><div class="kPainterPerspectCorner" data-index="0"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="1"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="2"><canvas style="display:none"></div','><div class="kPainterPerspectCorner" data-index="3"><canvas style="display:none"></div>',"</div",'><div class="kPainterGesturePanel"></div>',"</div>","</div>"].join("")),s=r.firstChild,a=s.querySelector(".kPainterImgsDiv > .kPainterCanvas");e.getHtmlElement=function(){return r};let o=-1,l=[],c=null,d=null,h=!1,u="view";e.getCurIndex=function(){return o},e.getCount=function(){return l.length},e.isEditing=function(){return h},e.getMode=function(){return u},e.getImage=function(e,t){if(null==t&&(t=o),isNaN(t))return;if((t=Math.round(t))<0||t>=l.length)return;let i;return e?i=l[t]:(i=document.createElement("img"),i.src=l[t].src,i.setAttribute("style","")),i},e.onStartLoading=null,e.onFinishLoading=null;let g=function(){n(e.onStartLoading)},_=function(){n(e.onFinishLoading)},p=new function(){let r=this,a=new Vt,c=e.addImage=function(e){return new Promise(function(t,i){if(h)return i(Error("`addImage(imgData)`: The function is only valid in `view` mode."));if(e instanceof Blob);else if(e instanceof HTMLCanvasElement);else if("string"==typeof e||e instanceof String);else if(!(e instanceof HTMLImageElement)){if(e instanceof Array||e instanceof FileList){let n=[],r=!1;for(let s=0;s<e.length;++s)c(e[s]).then(function(i){n.push(i),r=!0,n.length==e.length&&t(n)},function(s){n.push(s),n.length==e.length&&(r?t(n):(Error("`addImage(imgData)`: No img added in this array. Get more info in `<this error object>.addImgErrArr`.").addImgErrArr=n,i(Error("`addImage(imgData)`: No img added in this array."))))});return}return i(Error("`addImage(imgData)`: Type of `imgData` should be `Blob`, `HTMLCanvasElement`, `HTMLImageElement`, `String(url)`, `Array(a array of source)`, `FileList`."))}g(),a.push(d,null,[e,function(e){"string"!=typeof e?t(e):i(Error("`addImage(imgData)`: "+e)),a.next(),a.isWorking||_()}])})},d=function(e,t){u(e,function(e,i){e instanceof Blob?n(function(){m(e,i,t)}):t(e)})},u=r.getBlobAndFormatFromAnyImgData=function(e,t){let n=function(e){t(e,"image/png")};if(e instanceof Blob)n(e);else if(e instanceof HTMLCanvasElement)i(e).then(n);else if("string"==typeof e||e instanceof String){let i=e;if("data:"==i.substring(0,5)){let e="";"image/"==i.substring(5,11)&&(e=i.substring(5,i.indexOf(";",11)));let t=xt.convertBase64ToBlob(i.substring(i.indexOf("base64,")+7),e);n(t)}else xt.convertURLToBlob(i,function(e){e?n(e):t("Network error.")})}else if(e instanceof HTMLImageElement){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)return void t("Cors error.");let r=e.src;u(r,function(s,a){if(s instanceof Blob)t(s,a);else{let t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0);let s,a="",o=r.lastIndexOf("?"),l=-1;-1!=o?(l=r.lastIndexOf(".",o),-1!=l&&o-l<=5&&(a=r.substring(l+1,o))):(l=r.lastIndexOf("."),-1!=l&&(a=r.length-l<=5?r.substring(l+1):r.substring(l+1,l+5))),s=-1!=a.indexOf("webp")?"image/webp":-1!=a.indexOf("png")||-1!=a.indexOf("gif")||-1!=a.indexOf("svg")?"image/png":"image/jpeg",i(t,s).then(n)}})}else t("Type of `imgData` not support.")};e.addedImageMaxWH=4096,e.isShowNewImgWhenAdd=!0;let p,m=function(t,n,r){let a=new Image;a.kPainterOriBlob=a.kPainterBlob=t,a.kPainterSaveFormat=n;let c=URL.createObjectURL(a.kPainterBlob);a.onload=a.onerror=function(){if(e._noAnyUseButForIosSafariBug0=a.naturalWidth,e._noAnyUseButForIosSafariBug1=a.naturalHeight,a.kPainterWidth=a.naturalWidth,a.kPainterHeight=a.naturalHeight,a.kPainterOriWidth=a.kPainterWidth,a.kPainterOriHeight=a.kPainterHeight,a.kPainterWidth>e.addedImageMaxWH||a.kPainterHeight>e.addedImageMaxWH)i(function(e,t,i){t=t||new xt.Matrix(1,0,0,1,0,0);let n=document.createElement("canvas"),r=!1;0!=t.a*t.d&&0==t.b*t.c?(n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height):(r=!0,n.width=e.naturalHeight||e.height,n.height=e.naturalWidth||e.width);let s=1;(n.width>i||n.height>i)&&(s=i/Math.max(n.width,n.height),n.width=Math.min(n.width*s),n.height=Math.min(n.height*s));let a=n.getContext("2d");return a.setTransform(t.a,t.b,t.c,t.d,t.e*n.width,t.f*n.height),r?a.drawImage(e,0,0,n.height,n.width):a.drawImage(e,0,0,n.width,n.height),n}(a,null,e.addedImageMaxWH),n).then(function(e){URL.revokeObjectURL(c),a.kPainterOriBlob=a.kPainterBlob=e,c=URL.createObjectURL(a.kPainterBlob),a.src=c});else{a.onload=a.onerror=null,s.querySelector(".kPainterImgsDiv").append(a),(e.isShowNewImgWhenAdd||-1==o)&&R(l.length-1);try{!function(){for(let e=0;e<d.length;++e){let t=d[e].cvs,i=d[e].mwh,n=Math.min(i/a.naturalWidth,i/a.naturalHeight,1);t.width=Math.round(a.naturalWidth*n),t.height=Math.round(a.naturalHeight*n),t.getContext("2d").drawImage(a,0,0,t.width,t.height)}}()}catch(e){setTimeout(function(){throw e},0)}r&&r(l.length-1)}};let d=[];try{!function(){for(let e=0;e<C.length;++e){let t=C[e],i=t.kPainterFunWrap,n=document.createElement("canvas");n.className="kPainterThumbnailCanvas",d.push({cvs:n,mwh:t.kPainterMaxWH});let r=null;try{r=i?i(n):n}catch(e){setTimeout(function(){throw e},0);break}r&&(r.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(r),t.appendChild(r))}}()}catch(e){setTimeout(function(){throw e},0)}a.style.display="none",l.push(a),a.src=c},E=function(){let i=l[o],r=s;kt(r);let a=Ft(r),c=i.kPainterZoom=Math.min(a.width/i.kPainterWidth,a.height/i.kPainterHeight);if(i.style.width=(Math.round(i.kPainterWidth*c)||1)+"px",i.style.height=(Math.round(i.kPainterHeight*c)||1)+"px",i.style.left=i.style.right=i.style.top=i.style.bottom="-100000px",l.length>=2){let e=l[(l.length+o-1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.right=t+"px",e.style.left=e.style.top=e.style.bottom="-100000px"}if(l.length>=3){let e=l[(l.length+o+1)%l.length];c=Math.min(a.width/e.kPainterWidth,a.height/e.kPainterHeight),e.style.width=(Math.round(e.kPainterWidth*c)||1)+"px",e.style.height=(Math.round(e.kPainterHeight*c)||1)+"px",e.style.left=t+"px",e.style.right=e.style.top=e.style.bottom="-100000px"}n(e.onUpdateImgPosZoom)},I=null,y=null;e.updateUIOnResize=function(t){if(null!=I&&(clearTimeout(I),I=null,y()),t)return new Promise(function(t,i){p=h,I=setTimeout(function(){if(-1==o)I=null,t();else if(p!=h)I=null,t();else{if(h){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();I=null,t()}},500),y=i});if(-1!=o){if(h){let t=e.getFreeTransformCornerPos();f.setImgStyleFit(),e.setFreeTransformCornerPos(t)}else E();return!0}return!1};let R=r.showImg=function(t){let i=l[t];i.parentElement.childNodes.forEach(function(e){e.style.display="none"}),o=t,i.style.display="",l.length>=2&&(t>0||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t-1)%l.length].style.display=""),l.length>=3&&(t<l.length-1||e.allowedTouchMoveSwitchImgOverBoundary)&&(l[(l.length+t+1)%l.length].style.display=""),E(),T()};e.onNumChange=null;let T=function(){let t,i;return function(){t==o&&i==l.length||(t=o,i=l.length,n(e.onNumChange,[o,l.length]))}}();e.changePage=function(e){if(h)return!1;let t;switch(e){case"f":t=0;break;case"p":t=o-1;break;case"n":t=o+1;break;case"l":t=l.length-1;break;default:if(arguments.length<1||isNaN(e))return!1;t=Math.round(e)}return!(t<0||t>=l.length||t==o||(R(t),0))},e.movePage=function(){if(h)return!1;let e,t;if(1==arguments.length?t=arguments[0]:arguments.length>=2&&(e=arguments[0],t=arguments[1]),null==e&&(e=o),isNaN(t))return!1;if(t=Math.round(t),t<0||t>l.length)return!1;if(isNaN(e))return!1;if(e=Math.round(e),e<0||e>=l.length)return!1;if(e==t)return!0;let i=l.splice(e,1)[0];t>e?l.splice(t-1,0,i):l.splice(t,0,i),e==o?o=t>e?t-1:t:e<o&&t>o?--o:e>o&&t<o&&++o,T();try{for(let i=0;i<C.length;++i){let n=C[i],r=n.kPainterThumbBoxArr[e];n.kPainterThumbBoxArr.length==t?n.append(r):n.kPainterThumbBoxArr[t].before(r),n.kPainterThumbBoxArr.splice(e,1),t>e?n.kPainterThumbBoxArr.splice(t-1,0,r):n.kPainterThumbBoxArr.splice(t,0,r)}}catch(e){setTimeout(function(){throw e},0)}return!0},e.del=function(e){if(h)return!1;if(arguments.length<1&&(e=o),isNaN(e))return!1;if((e=Math.round(e))<0||e>=l.length)return!1;URL.revokeObjectURL(l[e].src),l[e].remove(),l.splice(e,1);try{for(let t=0;t<C.length;++t){let i=C[t];i.kPainterThumbBoxArr[e].remove(),i.kPainterThumbBoxArr.splice(e,1)}}catch(e){setTimeout(function(){throw e},0)}return e<o?(--o,T()):e==o?(o==l.length&&--o,o>=0?R(o):T()):T(),!0},e.getWidth=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterWidth},e.getHeight=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?NaN:l[e].kPainterHeight},e.getBlob=function(e){return arguments.length<1&&(e=o),isNaN(e)||(e=Math.round(e))<0||e>=l.length?null:l[e].kPainterBlob};let C=r.thumbnailBoxArr=[];e.bindThumbnailBox=function(t,i,n){if(h)return!1;if(!(t instanceof HTMLElement))return!1;e.unbindThumbnailBox(t),t.innerHTML="",t.kPainterFunWrap=i,t.kPainterMaxWH=n||256,t.kPainterThumbBoxArr=[];for(let n=0;n<l.length;++n){let r=l[n];e._noAnyUseButForIosSafariBug0=r.naturalWidth,e._noAnyUseButForIosSafariBug1=r.naturalHeight;let s=Math.min(t.kPainterMaxWH/r.naturalWidth,t.kPainterMaxWH/r.naturalHeight,1),a=document.createElement("canvas");a.width=Math.round(r.naturalWidth*s),a.height=Math.round(r.naturalHeight*s),a.getContext("2d").drawImage(r,0,0,a.width,a.height),a.className="kPainterThumbnailCanvas";let o=null;try{o=i?i(a):a}catch(e){return setTimeout(function(){throw e},0),!1}o&&(o.getKPainterIndex=function(){return t.kPainterThumbBoxArr.indexOf(this)},t.kPainterThumbBoxArr.push(o),t.appendChild(o))}return C.push(t),!0},e.unbindThumbnailBox=function(e){if(h)return!1;if(e){for(let t=0;t<C.length;++t)if(C[t]==e)return e.innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0,C.splice(t,1),!0;return!1}for(let t=0;t<C.length;++t)(e=C[t]).innerHTML="",e.kPainterFunWrap=void 0,e.kPainterThumbBoxArr=void 0;return C.length=0,!0}},f=new function(){let i,r,u,g,_,f=Number.NEGATIVE_INFINITY;e.leftDoubleClickZoomRate=2,e.rightDoubleClickZoomRate=.5;let m,I,y,R,T,C,w,v,S,A,b,D,O,L,N,M,P,x,B=function(t){if(-1==o)return;let n,a=t.targetTouches;if(a){if(a.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";a=[{pageX:t.clientX,pageY:t.clientY}],n=t.buttons}if(1==a.length){m=r=a[0].pageX,I=u=a[0].pageY,F();let t=f;f=(new Date).getTime();let o=i;if(i=n||(Math.abs(M-P)/P<.01?1:2),f-t<1e3&&i==o&&(1==i||2==i)&&Math.abs(a[0].pageX-g)<8&&Math.abs(a[0].pageY-_)<8){f=Number.NEGATIVE_INFINITY;let t=m,n=I,r=M,s=1==i?e.leftDoubleClickZoomRate:e.rightDoubleClickZoomRate;M*=s,M>4&&(M=4,s=4/r),M<P&&(M=P,s=P/r);let a=L+v.pageX0+v.width/2,o=N+v.pageY0+v.height/2;L-=(s-1)*(t-a),N-=(s-1)*(n-o),G()}if(null!=c)return;c="posZoom",s.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),s.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),s.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),s.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),x=a[0].identifier}else if(2==a.length){if(m=r=a[0].pageX,I=u=a[0].pageY,null==c&&(c="posZoom"),"posZoom"!=c)return;F(),s.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),s.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="unset")),s.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="unset"),s.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="unset"),T=a[1].pageX,C=a[1].pageY,y=(m+T)/2,R=(I+C)/2,w=Math.sqrt(Math.pow(m-T,2)+Math.pow(I-C,2))}else 0==a.length&&(g=m,_=I,k())};e.allowedTouchMoveSwitchImgOverBoundary=!0;let k=function(){if(-1!=o&&"posZoom"==c){if(d=null,c=null,s.querySelectorAll(".kPainterCroper > .kPainterEdges").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),s.querySelectorAll(".kPainterCroper > .kPainterCorners").forEach(e=>e.childNodes.forEach(e=>e.style.zIndex="1")),s.querySelectorAll(".kPainterCroper > .kPainterMover").forEach(e=>e.style.zIndex="1"),s.querySelectorAll(".kPainterCroper > .kPainterBigMover").forEach(e=>e.style.zIndex="1"),!h&&1!=l.length){let t,i,n=!1;if(M/P<1.2&&(n=!0,t=Math.sqrt(Math.pow(m-r,2)+Math.pow(I-u,2)),i=t/(((new Date).getTime()-f)/1e3)),L<-(Math.round(D*M)||1)/2||n&&t<-50&&i<-200){if(o+1<l.length||e.allowedTouchMoveSwitchImgOverBoundary)return void p.showImg((l.length+o+1)%l.length)}else if((L>(Math.round(D*M)||1)/2||n&&t>50&&i>200)&&(o-1>=0||e.allowedTouchMoveSwitchImgOverBoundary))return void p.showImg((l.length+o-1)%l.length)}G(),U()}},F=function(e){let i=s;if(h?(A=a,D=A.width,O=A.height):(A=l[o],D=A.kPainterWidth,O=A.kPainterHeight),L=parseFloat(A.style.left)+t,N=parseFloat(A.style.top)+t,b=Ut(A),0!=b.a*b.d&&0==b.b*b.c);else{let e=D;D=O,O=e}if(M=A.kPainterZoom||1,v=kt(i),S=Ft(i),P=Math.min(S.width/D,S.height/O),h&&E.isCropRectShowing&&!e){let e=E.getNeededRect();P=Math.max(Math.max(e.width,D*P)/D,Math.max(e.height,O*P)/O)}};e.onUpdateImgPosZoom=null;let U=function(){if(A.style.left=L-t+"px",A.style.right=-L-t+"px",A.style.top=N-t+"px",A.style.bottom=-N-t+"px",A.kPainterZoom=M,0!=b.a*b.d&&0==b.b*b.c?(A.style.width=(Math.round(D*M)||1)+"px",A.style.height=(Math.round(O*M)||1)+"px"):(A.style.height=(Math.round(D*M)||1)+"px",A.style.width=(Math.round(O*M)||1)+"px"),!h&&1!=l.length){let e=Math.max(0,((Math.round(D*M)||1)-v.width)/2);if(l.length>2||L>e){let t=l[(l.length+o-1)%l.length];t.style.left=L-e-v.width+"px",t.style.right=-L+e+v.width+"px"}if(l.length>2||L<=-e){let t=l[(l.length+o+1)%l.length];t.style.left=L+e+v.width+"px",t.style.right=-L-e-v.width+"px"}}n(e.onUpdateImgPosZoom)},G=function(e,t){if(M>4&&(M=4),M<P&&(M=P),!e){let e=Math.round(D*M)||1;if(S.width>e)L=0;else{let t=(e-S.width)/2;L<-t?L=-t:L>t&&(L=t)}}{let e=Math.round(O*M)||1;if(S.height>e)N=0;else{let t=(e-S.height)/2;N<-t?N=-t:N>t&&(N=t)}}};e.getZoom=function(){if(0!=l.length)return F(),M},e.setZoom=function(e,t){return 0==l.length||(e=parseFloat(e))!=e?null:(F(),t?M*=e:M=e,G(),U(),M)},this.setImgStyleFit=function(){F(!0),M=P,G(),U(),e.setCropRectArea()},["touchstart","touchcancel","touchend","mousedown"].forEach(e=>s.addEventListener(e,B)),s.addEventListener("mouseup",function(e){"mouse"==d&&(g=e.clientX,_=e.clientY,k())}),s.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&(g=m,_=I,k())}),s.addEventListener("contextmenu",function(e){e.preventDefault()}),["touchmove","mousemove"].forEach(e=>s.addEventListener(e,function(e){let t=e.targetTouches;if(t){if("touch"!=d)return}else{if("mouse"!=d)return;t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("posZoom"!=c||x!=t[0].identifier)return;let i=m,n=I;m=t[0].pageX,I=t[0].pageY,L+=m-i,N+=I-n,G(!h),U(),e.preventDefault()}else if(2==t.length){if("posZoom"!=c)return;let i=y,n=R,r=w,s=M;m=t[0].pageX,I=t[0].pageY,T=t[1].pageX,C=t[1].pageY,y=(m+T)/2,R=(I+C)/2,w=Math.sqrt(Math.pow(m-T,2)+Math.pow(I-C,2));let a=w/r;M*=a,M>4&&(M=4,a=4/s),M<P&&(M=P,a=P/s);let o=L+v.pageX0+v.width/2,l=N+v.pageY0+v.height/2;L-=(a-1)*(i-o),N-=(a-1)*(n-l),G(),U(),e.preventDefault()}}))},m=new function(){let t,n=this,r=[];e.stepImgsGCThreshold=10;let m=[],y=[];e.addProtectedStep=function(e){return!!h&&(e=parseInt(e))==e&&(-1!=y.indexOf(e)||(y.push(e),y.sort(function(e,t){return e-t})),!0)},e.removeProtectedStep=function(e){if(!h)return!1;if((e=parseInt(e))!=e)return!1;let t=y.indexOf(e);return-1!=t&&(y.splice(t,1),!0)},e.getProtectedSteps=function(){return h?y.concat():null};let R=n.pushStack=function(i){r.length=t+1;for(let e=m.length-1;e>0&&m[e].beginStep>t;--e)--m.length;let n;if(i.srcBlob){n={crop:{left:0,top:0,width:1,height:1},transform:new xt.Matrix(1,0,0,1,0,0),srcBlob:i.srcBlob,saveFormat:i.saveFormat};for(let t=0;m.length>=e.stepImgsGCThreshold;){if(y.filter(function(e){return m[t].beginStep<=e&&e<m[t].endStep}).length){if(++t<m.length)continue;break}{let e=m[t].beginStep,i=m[t].endStep;for(let t=e;t<i;++t)r[t]=null;m.splice(t,1)}}r.push(n),++t;let s={blob:n.srcBlob,beginStep:t,endStep:t+1};m.push(s)}else{let e,s=r[t],a=s.crop,c=i.transform,d=i.crop,h={};e=c||s.transform,h.left=a.left,h.top=a.top,h.width=a.width,h.height=a.height,0!=e.a*e.d&&0==e.b*e.c?(c&&(e=new xt.Matrix(Math.sign(c.a),0,0,Math.sign(c.d),0,0)),d&&(1==e.a?h.left+=d.left*a.width:h.left+=(1-d.left-d.width)*a.width,1==e.d?h.top+=d.top*a.height:h.top+=(1-d.top-d.height)*a.height,h.width*=d.width,h.height*=d.height)):(c&&(e=new xt.Matrix(0,Math.sign(c.b),Math.sign(c.c),0,0,0)),d&&(1==e.b?h.left+=d.top*a.width:h.left+=(1-d.top-d.height)*a.width,1==e.c?h.top+=d.left*a.height:h.top+=(1-d.left-d.width)*a.height,h.width*=d.height,h.height*=d.width));let u=l[o],g=Math.pow(10,Math.ceil(Math.max(u.kPainterWidth,u.kPainterHeight)).toString().length+2);h.left=Math.round(h.left*g)/g,h.top=Math.round(h.top*g)/g,h.width=Math.round(h.width*g)/g,h.height=Math.round(h.height*g)/g,n={crop:h,transform:e,srcBlob:s.srcBlob,saveFormat:s.saveFormat},r.push(n),++t,n.srcBlob&&(m[m.length-1].endStep=t+1)}};e.undo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t>0){let i=t-1;for(;null==r[i];)--i;C(t,i,function(){return e()})}})},e.redo=function(){return new Promise(function(e,i){if(!h)return i(Error("`undo()`: The function is invalid in current mode."));if(t<r.length-1){let i=t+1;for(;null==r[i];)++i;C(t,i,function(){return e()})}})},e.getStepCount=function(){return h?r.length:NaN},e.getCurStep=function(){return h?t:NaN},e.setCurStep=function(e){return new Promise(function(i,n){return arguments.length<1||isNaN(e)||(e=Math.round(e))<0||e>=r.length||null==r[e]?n(Error("`setCurStep(index)`: The parameter `index` is invalid.")):void C(t,e,function(){return i()})})},n.needAlwaysTrueTransform=!1;let T,C=function(e,i,s){t=i;let o=r[e].crop,l=r[t].crop;o.left==l.left&&o.top==l.top&&o.width==l.width&&o.bottom==l.bottom&&r[e].srcBlob==r[t].srcBlob?(Gt(a,r[t].transform.dot(r[e].transform.inversion()).dot(Ut(a))),f.setImgStyleFit(),s&&s()):w(n.needAlwaysTrueTransform,!1,s)};!function(){let e=window.devicePixelRatio||1,t=screen.width,i=screen.height;T=Math.min(t,i)*e}();let w=n.updateCvsAsync=function(e,i,n){a.style.display="none";let s=r[t],c=s.srcBlob||l[o].kPainterOriBlob,d=function(){let t=URL.createObjectURL(c),r=new Image;r.onload=r.onerror=function(){r.onload=r.onerror=null,v(r,s,e,i),URL.revokeObjectURL(t),n&&n()},r.src=t};window.createImageBitmap?createImageBitmap(c).then(function(t){v(t,s,e,i),n&&n()}).catch(function(){d()}):d()},v=function(t,i,n,r){e._noAnyUseButForIosSafariBug0=t.naturalWidth,e._noAnyUseButForIosSafariBug1=t.naturalHeight;let s=t.naturalWidth||t.width,o=t.naturalHeight||t.height,l=i.crop,c=i.transform,d=a.getContext("2d"),h=a.fullQualityWidth=Math.round(s*l.width)||1,u=a.fullQualityHeight=Math.round(o*l.height)||1,g=!1;if(0!=c.a*c.d&&0==c.b*c.c?(a.fullQualityWidth=h,a.fullQualityHeight=u):(a.fullQualityWidth=u,a.fullQualityHeight=h,n&&(g=!0)),a.hasCompressed=!1,n){let e,t;g?(e=u,t=h):(e=h,t=u),a.width=e,a.height=t;let i=e/2*(1-c.a-c.c),n=t/2*(1-c.b-c.d);d.setTransform(c.a,c.b,c.c,c.d,i,n)}else if(h>T||u>T){let e=T/Math.max(h,u);a.width=Math.round(h*e)||1,a.height=Math.round(u*e)||1,a.hasCompressed=!0}else a.width=h,a.height=u;let _,p,m=Math.round(s*l.left),E=Math.round(o*l.top);if(m==s&&--m,E==o&&--E,g?(_=a.height,p=a.width):(_=a.width,p=a.height),h/_<=2)d.drawImage(t,m,E,h,u,0,0,_,p);else{let e=document.createElement("canvas");e.width=Math.round(h/2),e.height=Math.round(u/2);let i,n,r=e.getContext("2d"),s=Math.round(h/2),a=Math.round(u/2);for(r.drawImage(t,m,E,h,u,0,0,s,a);i=s,n=a,s=Math.round(i/2),a=Math.round(n/2),!(s<=_||a<=p);)r.drawImage(e,0,0,i,n,0,0,s,a);d.drawImage(e,0,0,i,n,0,0,_,p)}Gt(a,n?new xt.Matrix(1,0,0,1,0,0):c),r||(f.setImgStyleFit(),a.style.display="")};e.enterEdit=function(){return new Promise(function(i,n){if(h)return n(Error("`enterEdit()`: The function is invalid in current mode."));if(-1==o)return n(Error("`enterEdit()`: There is no image in the instance."));u="",g(),h=!0;let s=l[o].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new xt.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};var p;r.push(s),t=0,p=function(){return _(),d=null,c=null,u="basicEdit",i()},a.parentElement.childNodes.forEach(function(e){e!==a&&(e.style.display="none")}),w(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),p()})})};let S=e.cancelEdit=function(){return!!h&&(h=!1,r.length=0,m.length=0,p.showImg(o),a.style.display="none",E.hideCropRect(),I.hideFreeTransformBorderDirectly(),d=null,c=null,u="view",!0)},A=!1;e.saveEdit=function(n){return new Promise(function(f,m){if(!h||A)return m(Error("`saveEdit(isCover)`: The function is invalid in current mode."));u="",A=!0,g(),setTimeout(function(){!function(e,n){let c=r[t].crop,d=r[t].transform,h=r[0].crop,u=r[0].transform,g=l[o];if(r[t].srcBlob||u.a!=d.a||u.b!=d.b||u.c!=d.c||u.d!=d.d||Math.round(g.kPainterOriWidth*c.left)!=Math.round(g.kPainterOriWidth*h.left)||Math.round(g.kPainterOriHeight*c.top)!=Math.round(g.kPainterOriHeight*h.top)||Math.round(g.kPainterOriWidth*(c.left+c.width))!=Math.round(g.kPainterOriWidth*(h.left+h.width))||Math.round(g.kPainterOriHeight*(c.top+c.height))!=Math.round(g.kPainterOriHeight*(h.top+h.height))){URL.revokeObjectURL(g.src);let c=new Image,h=function(){c.onload=c.onerror=function(){c.onload=c.onerror=null,n?(l[o].remove(),l.splice(o,1,c)):l.splice(++o,0,c),s.querySelector(".kPainterImgsDiv").append(c),e()},i(a,r[t].saveFormat||g.kPainterSaveFormat).then(function(e){c.kPainterBlob=e,c.kPainterWidth=a.width,c.kPainterHeight=a.height,r[t].srcBlob?(c.kPainterOriBlob=e,c.kPainterOriWidth=a.width,c.kPainterOriHeight=a.height,c.kPainterSaveFormat=r[t].saveFormat):(c.kPainterOriBlob=g.kPainterOriBlob,c.kPainterOriWidth=g.kPainterOriWidth,c.kPainterOriHeight=g.kPainterOriHeight,c.kPainterProcess=r[t],c.kPainterSaveFormat=g.kPainterSaveFormat);let i=URL.createObjectURL(e);c.src=i})};a.hasCompressed||1!=d.a||0!=d.b||0!=d.c||1!=d.d||0!=d.e||0!=d.f?(a.style.display="none",w(!0,!0,h)):h()}else e()}(function(){S(),_(),A=!1,d=null,c=null;try{!function(){for(let t=0;t<p.thumbnailBoxArr.length;++t){let i=p.thumbnailBoxArr[t],r=l[o];e._noAnyUseButForIosSafariBug0=r.naturalWidth,e._noAnyUseButForIosSafariBug1=r.naturalHeight;let s,a=Math.min(i.kPainterMaxWH/r.naturalWidth,i.kPainterMaxWH/r.naturalHeight,1);if(n){let e=i.kPainterThumbBoxArr[o];s=e.classList.contains("kPainterThumbnailCanvas")?e:e.querySelector(".kPainterThumbnailCanvas")}else s=document.createElement("canvas"),s.className="kPainterThumbnailCanvas";if(s.width=Math.round(r.naturalWidth*a),s.height=Math.round(r.naturalHeight*a),s.getContext("2d").drawImage(r,0,0,s.width,s.height),!n){let e=i.kPainterFunWrap,t=null;try{t=e?e(s):s}catch(e){return setTimeout(function(){throw e},0),!1}t&&(t.getKPainterIndex=function(){return i.kPainterThumbBoxArr.indexOf(this)},i.kPainterThumbBoxArr.splice(o,0,t),i.kPainterThumbBoxArr[o-1].after(t))}}}()}catch(e){setTimeout(function(){throw e},0)}return u="view",f()},n)},100)})},e.rotateRight=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(0,1,-1,0,0,0),e);Gt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.rotateLeft=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(0,-1,1,0,0,0),e);Gt(a,t),R({transform:t});let i=a.fullQualityWidth;return a.fullQualityWidth=a.fullQualityHeight,a.fullQualityHeight=i,f.setImgStyleFit(),!0},e.mirror=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(-1,0,0,1,0,0),e);return Gt(a,t),R({transform:t}),f.setImgStyleFit(),!0},e.flip=function(){if(!h)return!1;let e=Ut(a),t=xt.Matrix.dot(new xt.Matrix(1,0,0,-1,0,0),e);return Gt(a,t),R({transform:t}),f.setImgStyleFit(),!0},e.resize=function(e,t){return new Promise(function(r,s){return h?(e=parseInt(e),t=parseInt(t),e!=e||e<1?s(Error("`resize`: The parameter `newWidth` is invaild.")):t!=t||t<1?s(Error("`resize`: The parameter `newHeight` is invaild.")):(g(),void n.updateCvsAsync(!0,!0,function(){n.needAlwaysTrueTransform=!0;let s=e,o=t;for(;2*s<a.width;)s*=2;for(;2*o<a.height;)o*=2;let l,c=a;for(;;){l=document.createElement("canvas"),l.width=s,l.height=o,l.getContext("2d").drawImage(c,0,0,s,o);let i=!1;if(e!=s&&(s/=2,i=!0),t!=o&&(o/=2,i=!0),!i)break}i(l).then(function(e){n.pushStack({srcBlob:e,saveFormat:"image/jpeg"}),n.updateCvs(!1,!1,function(){return n.needAlwaysTrueTransform=!1,_(),r()})})}))):s(Error("`resize`: The function is invaild in this mode."))})},e.getEditWidth=function(){return h?a.fullQualityWidth:NaN},e.getEditHeight=function(){return h?a.fullQualityHeight:NaN}},E=new function(){let i=this;e.isAutoShowCropUI=!0;let r,o,l,u,g,_,p,f,E,I,y,R,T,C,w,v,S,A,b,D,O=s.querySelector(".kPainterCroper");i.isCropRectShowing=!1,e.showCropRect=i.showCropRect=function(){h&&(i.isCropRectShowing=!0,B(),O.style.display="")},e.hideCropRect=i.hideCropRect=function(){i.isCropRectShowing=!1,O.style.display="none"},Object.assign(O.style,{"border-left-width":t+"px","border-top-width":t+"px","border-right-width":t+"px","border-bottom-width":t+"px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"}),e.setCropRectStyle=function(e){switch(parseInt(e)){case 0:return O.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display="none"),O.querySelectorAll(".kPainterMover").forEach(e=>e.style.display=""),!0;case 1:return O.querySelectorAll(".kPainterMover").forEach(e=>e.style.display="none"),O.querySelectorAll(".kPainterBigMover").forEach(e=>e.style.display=""),!0;default:return!1}},e.cropRectMinW=50,e.cropRectMinH=50;let L=function(e){e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if(null!=c)return;c="crop",l=t[0].identifier,r=t[0].pageX,o=t[0].pageY;let e=this.getAttribute("data-orient").split(",");u=e[0],g=e[1],M()}else 0==t.length&&N()},N=function(){"crop"==c&&(d=null,c=null)},M=function(){_=Ft(s),P(),w=parseFloat(O.style.width),v=parseFloat(O.style.height),T=parseFloat(O.style.left)-w/2+t,C=parseFloat(O.style.top)-v/2+t,S=Math.max(-_.width/2,p),A=Math.max(-_.height/2,f),b=Math.min(_.width/2,E),D=Math.min(_.height/2,I)},P=function(){let e=Ut(a),i=parseFloat(a.style.left)+t,n=parseFloat(a.style.top)+t;0!=e.a*e.d&&0==e.b*e.c?(y=parseFloat(a.style.width),R=parseFloat(a.style.height)):(y=parseFloat(a.style.height),R=parseFloat(a.style.width));let r=y/2,s=R/2;p=i-r,f=n-s,E=i+r,I=n+s};s.querySelectorAll(".kPainterCroper > .kPainterEdges > div, .kPainterCroper > .kPainterCorners > div, .kPainterCroper > .kPainterMover, .kPainterCroper > .kPainterBigMover").forEach(e=>{["touchstart","touchcancel","touchend","mousedown"].forEach(t=>e.addEventListener(t,L))}),s.addEventListener("mouseup",function(){"mouse"==d&&N()}),s.addEventListener("mouseleave",function(e){"mouse"==d&&e.buttons&&N()}),e.onCropRectChange=null;let x=function(){O.style.left=T+w/2-t+"px",O.style.right=-T-w/2-t+"px",O.style.top=C+v/2-t+"px",O.style.bottom=-C-v/2-t+"px",O.style.width=w+"px",O.style.height=v+"px",n(e.onCropRectChange)};["touchmove","mousemove"].forEach(t=>s.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if("crop"!=c||l!=i[0].identifier)return;let n=r,s=o;r=i[0].pageX,o=i[0].pageY;let a=r-n,d=o-s;-1==u?(w-a<e.cropRectMinW&&(a=w-e.cropRectMinW),T+a<S&&(a=S-T),w-=a,T+=a):1==u&&(w+a<e.cropRectMinW&&(a=-w+e.cropRectMinW),T+w+a>b&&(a=b-w-T),w+=a),-1==g?(v-d<e.cropRectMinH&&(d=v-e.cropRectMinH),C+d<A&&(d=A-C),v-=d,C+=d):1==g&&(v+d<e.cropRectMinH&&(d=-v+e.cropRectMinH),C+v+d>D&&(d=D-v-C),v+=d),0==u&&0==g&&(T+a<S?a=S-T:T+w+a>b&&(a=b-w-T),C+d<A?d=A-C:C+v+d>D&&(d=D-v-C),T+=a,C+=d),x(),t.preventDefault()}}));let B=e.setCropRectArea=function(e,t,n,r){if(!i.isCropRectShowing)return!1;e>=-.5||(e=-.5),t>=-.5||(t=-.5),n<=.5||(n=.5),r<=.5||(r=.5),e>n&&(e=n=(e+n)/2),t>r&&(t=r=(t+r)/2),M(),T=p+(e+.5)*y,T<S&&(T=S),C=f+(t+.5)*R,C<A&&(C=A);let s=p+(n+.5)*y;s>b&&(s=b),w=s-T;let a=f+(r+.5)*R;return a>D&&(a=D),v=a-C,x(),!0},k=e.getCropRectArea=function(e){if(!i.isCropRectShowing)return null;!function(){let e,t=Ut(a);e=0!=t.a*t.d&&0==t.b*t.c?parseFloat(a.style.width):parseFloat(a.style.height),e!=y&&M()}();let t=(T-p)/y-.5,n=(C-f)/R-.5,r=t+w/y,s=n+v/R;return e&&(t=Math.round(t*a.fullQualityWidth*2)/2,n=Math.round(n*a.fullQualityHeight*2)/2,r=Math.round(r*a.fullQualityWidth*2)/2,s=Math.round(s*a.fullQualityHeight*2)/2),[t,n,r,s]};i.getNeededRect=function(){M();let e={};return e.width=2*Math.max(-T,T+w),e.height=2*Math.max(-C,C+v),e},e.crop=function(e){return new Promise(function(t,i){if(!h)return i(Error("crop([ltrb])`: The function is invalid in this mode."));if(M(),!(e=e||k()))return i(Error("crop([ltrb])`: No thing can be cropped."));let n=e[0],r=e[1],s=e[2],o=e[3];if((n+.5)*a.fullQualityWidth<.5&&(.5-s)*a.fullQualityWidth<=.5&&(r+.5)*a.fullQualityHeight<.5&&(.5-o)*a.fullQualityHeight<=.5)return t([n,r,s,o]);m.pushStack({crop:{left:n+.5,top:r+.5,width:s-n,height:o-r}}),m.updateCvsAsync(m.needAlwaysTrueTransform,!1,function(){return t([n,r,s,o])})})}},I=new function(){let t=this;!function(){let i=s.querySelector(".kPainterPerspect");t.hideFreeTransformBorderDirectly=function(){i.style.display="none"};let r=s.querySelector(".kPainterPerspect > .kPainterPerspectCvs");e.onFreeTransformCornerPosChange=null;let o=e.setFreeTransformCornerPos=function(e){if("freeTransform"!=u)return;let t=a.kPainterZoom,n=Ut(a),r=a.width*t,s=a.height*t;if(0==n.a*n.d||0!=n.b*n.c){let e=r;r=s,s=e}let o=a.width*t/2,l=a.height*t/2;for(let t=0;t<y.length;++t){let i=y[t],n=e[i.getAttribute("data-index")],a=r*n[0],c=s*n[1];a<-o?a=-o:a>o&&(a=o),c<-l?c=-l:c>l&&(c=l),i.style.left=a+"px",i.style.right=-a+"px",i.style.top=c+"px",i.style.bottom=-c+"px"}p(),i.style.display=""},l=e.getFreeTransformCornerPos=function(){let e=a.kPainterZoom,t=Ut(a),i=a.width*e,n=a.height*e;if(0==t.a*t.d||0!=t.b*t.c){let e=i;i=n,n=e}let r=[];for(let e=0;e<y.length;++e){let t=y[e];r.push([parseFloat(t.style.left)/i,parseFloat(t.style.top)/n])}return r},p=function(){let t=Bt(s);r.width=Math.round(t.width),r.height=Math.round(t.height);let i=[];for(let e=0;e<y.length;++e)i.push([Math.round(parseFloat(y[e].style.left)+t.width/2),Math.round(parseFloat(y[e].style.top)+t.height/2)]);let a,o=r.getContext("2d"),l=Number.POSITIVE_INFINITY;for(let e=0;e<4;++e){let t=i[e][0]*i[e][0]+i[e][1]*i[e][1];t<l&&(l=t,a=e)}let c=[];for(let e=0;e<4;++e)c.push([i[(a+e)%4][0],i[(a+e)%4][1]]);o.fillStyle="rgba(0,0,0,0.3)",o.beginPath(),o.moveTo(0,0),o.lineTo(c[0][0],c[0][1]);let d=[];for(let e=0;e<4;++e)d.push((h=c[e][0],u=c[e][1],g=c[(e+1)%4][0],_=c[(e+1)%4][1],p=c[(e+2)%4][0],f=c[(e+2)%4][1],m=c[(e+3)%4][0],E=c[(e+3)%4][1],[Math.sign((_-u)*p+(h-g)*f+g*u-h*_),Math.sign((_-u)*m+(h-g)*E+g*u-h*_)]));var h,u,g,_,p,f,m,E;let I,R=function(e,t,i,n,r,s,a,o){let l=n-t,c=e-i,d=i*t-e*n,h=o-s,u=r-a,g=a*s-r*o,_=c*h-u*l;return[(d*u-g*c)/_,(g*l-d*h)/_]},T=function(){let e,t,i=c[1][0]-c[0][0];i&&(e=(c[1][1]-c[0][1])/i);let n=c[3][0]-c[0][0];return n&&(t=(c[3][1]-c[0][1])/n),i>0?!(n>0)||e<=t:0==i?!(n>0):!(n>=0)&&e<=t}();d[0][0]*d[0][1]<0?d[2][0]*d[2][1]<0&&(I=R(c[0][0],c[0][1],c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1]),T?(o.lineTo(I[0],I[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(I[0],I[1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(I[0],I[1]),o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(I[0],I[1]))):d[1][0]*d[1][1]<0&&d[3][0]*d[3][1]<0&&(I=R(c[1][0],c[1][1],c[2][0],c[2][1],c[3][0],c[3][1],c[0][0],c[0][1]),T?(o.lineTo(c[1][0],c[1][1]),o.lineTo(I[0],I[1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(I[0],I[1])):(o.lineTo(I[0],I[1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1]),o.lineTo(I[0],I[1]),o.lineTo(c[1][0],c[1][1]))),I||(T?(o.lineTo(c[1][0],c[1][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[3][0],c[3][1])):(o.lineTo(c[3][0],c[3][1]),o.lineTo(c[2][0],c[2][1]),o.lineTo(c[1][0],c[1][1]))),o.lineTo(c[0][0],c[0][1]),o.lineTo(0,0),o.lineTo(0,r.height),o.lineTo(r.width,r.height),o.lineTo(r.width,0),o.lineTo(0,0),o.fill(),n(e.onFreeTransformCornerPosChange)};e.isShowMagnifier=!0,e.magnifierZoom=2;let f=function(){if(!e.isShowMagnifier)return;const t=C.querySelector("canvas");100!=t.width&&(t.width=100),100!=t.height&&(t.height=100);const i=t.getContext("2d"),n=parseInt(C.getAttribute("data-index")),[r,s]=l()[n],o=e.magnifierZoom;i.fillStyle="#aaa",i.strokeStyle="#0f0",i.lineWidth=1;let c=a.width*(.5+r)-50/o,d=a.height*(.5+s)-50/o,h=100/o,u=100/o,g=0,_=0,p=100,f=100;{const e=p/h,t=f/u;if(c<0){const t=-c*e;g+=t,p-=t,h+=c,c=0}if(d<0){const e=-d*t;_+=e,f-=e,u+=d,d=0}if(c+h>a.width){const t=c+h-a.width;p-=t*e,h-=t}if(d+u>a.height){const e=d+u-a.height;f-=e*t,u-=e}}i.fillRect(0,0,t.width,t.height),i.drawImage(a,c,d,h,u,g,_,p,f),i.beginPath(),i.moveTo(40,50),i.lineTo(60,50),i.moveTo(50,40),i.lineTo(50,60),i.closePath(),i.stroke();for(let e of w)e!==t&&"none"!==e.style.display&&(e.style.display="none");"none"===t.style.display&&(t.style.display="")},I=function(){e.isShowMagnifier&&w.forEach(e=>{"none"!==e.style.display&&(e.style.display="none")})},y=[...s.querySelectorAll(".kPainterPerspect > .kPainterPerspectCorner")];y.forEach(e=>{e.style.left="0"}),y.forEach(e=>{e.style.top="0"}),y.forEach(e=>{e.style.right="0"}),y.forEach(e=>{e.style.bottom="0"});let R,T,C,w=y.map(e=>e.querySelector("canvas")),v=null,S=function(t){let i,n=a.kPainterZoom,r=a.width*n/2,s=a.height*n/2,o=!1;i=t?y:[C];for(let e=0;e<i.length;++e){let t=i[e],n=parseFloat(t.style.left),a=parseFloat(t.style.top),l=!0,c=!0;n<-r?n=-r:n>r?n=r:l=!1,a<-s?a=-s:a>s?a=s:c=!1,l&&(t.style.left=n+"px",t.style.right=-n+"px"),c&&(t.style.top=a+"px",t.style.bottom=-a+"px"),(l||c)&&(o=!0)}if(o&&p(),e._dceGetQuads){let t,i=e._dceSelectedItemIdxs,n=a.width,r=a.height;t=i.size?[...i.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x<0?t.x=0:t.x>n&&(t.x=n),t.y<0?t.y=0:t.y>r&&(t.y=r);e.setQuad(e.quad)}}};["touchstart","touchcancel","touchend","mousedown"].forEach(e=>y.forEach(t=>t.addEventListener(e,function(e){C=this,e.preventDefault();let t=e.targetTouches;if(t){if(t.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";t=[{pageX:e.clientX,pageY:e.clientY}]}if(1==t.length){if("perspect"!=c)return;c="perspectCornerMoving",S(),f(),v=t[0].identifier,R=t[0].pageX,T=t[0].pageY}else 0==t.length&&"perspectCornerMoving"==c&&(S(),I(),d=null,c="perspect")}))),["touchmove","mousemove"].forEach(t=>s.addEventListener(t,function(t){let i=t.targetTouches;if(i){if("touch"!=d)return}else{if("mouse"!=d)return;i=[{pageX:t.clientX,pageY:t.clientY}]}if(1==i.length){if(v!=i[0].identifier)return;if("perspectCornerMoving"!=c&&"perspectQuadMoving"!=c)return;let n=R,r=T;R=i[0].pageX,T=i[0].pageY;let s=R-n,o=T-r;if("perspectCornerMoving"===c){let t=parseFloat(C.style.left)+s,i=parseFloat(C.style.top)+o;if(C.style.left=t+"px",C.style.right=-t+"px",C.style.top=i+"px",C.style.bottom=-i+"px",e._dceGetQuads){let t=a.kPainterZoom,i=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(i){let e=parseInt(C.getAttribute("data-index")),n=i.quad.points[e];n.x+=s/t,n.y+=o/t,i.setQuad(i.quad)}}p(),f()}else if("perspectQuadMoving"===c){for(let e=0;e<y.length;++e){let t=y[e],i=parseFloat(t.style.left)+s,n=parseFloat(t.style.top)+o;t.style.left=i+"px",t.style.right=-i+"px",t.style.top=n+"px",t.style.bottom=-n+"px"}if(e._dceGetQuads){let t,i=a.kPainterZoom,n=e._dceSelectedItemIdxs;t=n.size?[...n.keys()].map(t=>e._dceGetQuads()?.[t]):[e._dceGetQuads()?.[e._dceSelectedItemIdx]];for(let e of t)if(e){for(let t of e.quad.points)t.x+=s/i,t.y+=o/i;e.setQuad(e.quad)}}p()}t.preventDefault()}})),["touchstart","touchcancel","touchend","mousedown"].forEach(t=>s.addEventListener(t,function(t){let n=t.targetTouches;if(n){if(n.length)if(d){if("touch"!=d)return}else d="touch"}else{if(d){if("mouse"!=d)return}else d="mouse";n=[{pageX:t.clientX,pageY:t.clientY}]}if(1==n.length){if("perspect"!=c)return;let r=Ft(i),s=(r.pageX0+r.pageX1)/2,o=(r.pageY0+r.pageY1)/2,d=a.kPainterZoom,h=a.width*d,u=a.height*d,g=(n[0].pageX-s)/h,_=(n[0].pageY-o)/u;if(e._dceGetQuads){(t.shiftKey||t.ctrlKey)&&(e._dceThisClickShouldKeepMultiSelect=!0);const i=e._dceGetQuads(),n=e._dceSelectedItemIdxs;let r=!1;for(let s=i.length-1;s>=0;--s){let a=i[s].quad.points,o=e.getWidth(),l=e.getHeight(),c=a.map(({x:e,y:t})=>[e/o-.5,t/l-.5]);if(Tt([g,_],c)){t.shiftKey||t.ctrlKey?(n.add(e._dceSelectedItemIdx),i[e._dceSelectedItemIdx]?._setSelected(!0),n.add(s),i[s]?._setSelected(!0)):n.has(s)&&(e._dceThisClickShouldKeepMultiSelect=!0),e._dceSelectedItemIdx=s,e.setFreeTransformCornerPos(c),r=!0,i[s]._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}});break}}if(!r)return}else if(!Tt([g,_],l()))return;c="perspectQuadMoving",v=n[0].identifier,R=n[0].pageX,T=n[0].pageY,t.preventDefault()}else 0==n.length&&"perspectQuadMoving"==c&&(S(!0),d=null,c="perspect")})),["mouseup","mouseleave"].forEach(t=>s.addEventListener(t,function(t){if("mouse"==d){if(e._dceGetQuads){if("perspectQuadMoving"==c&&!e._dceThisClickShouldKeepMultiSelect||"perspect"==c){const t=e._dceGetQuads();for(let i of e._dceSelectedItemIdxs)t[i]?._setSelected(!1);e._dceSelectedItemIdxs.clear()}e._dceThisClickShouldKeepMultiSelect=!1}if("perspectCornerMoving"==c)S(),I(),d=null,c="perspect";else if("perspectQuadMoving"==c){if(e._dceGetQuads){const i=e._dceGetQuads();i[e._dceSelectedItemIdx]?._dceEventListeners[t.type]?.forEach(e=>{try{e.call(this)}catch(e){console.error(e)}})}S(!0),d=null,c="perspect"}}})),e.enterFreeTransformMode=function(){return new Promise(function(e,t){if(!h)return t(Error("`enterFreeTransformMode`: The function is only valid in edit mode."));u="",d=null,c="perspect",g(),setTimeout(function(){E.hideCropRect(),m.updateCvsAsync(!0,!1,async()=>{m.needAlwaysTrueTransform=!0,u="freeTransform",o([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]),i.style.display="",_(),e()})},0)})},e.exitFreeTransformMode=function(){return new Promise(function(t,n){if("freeTransform"!=u)return n(Error("`exitFreeTransformMode`: It is not in `freeTransform` mode."));u="",i.style.display="none",m.updateCvsAsync(!1,!1,function(){e.isAutoShowCropUI&&E.showCropRect(),d=null,c=null,m.needAlwaysTrueTransform=!1,u="basicEdit",t()})})}}()}};Pt._doCallbackNoBreak=function(e,t){if(e)try{e.apply(window,t||[])}catch(e){setTimeout(function(){throw e},0)}};let xt={};Math.sign||(Math.sign=function(e){return e>0?1:0==e?1/e<0?-0:0:e<0?-1:NaN}),xt.Matrix=function(e,t,i,n,r,s){this.a=e,this.b=t,this.c=i,this.d=n,this.e=r,this.f=s},xt.Matrix.dot=function(e,t){let i=e,n=t;return new xt.Matrix(i.a*n.a+i.c*n.b,i.b*n.a+i.d*n.b,i.a*n.c+i.c*n.d,i.b*n.c+i.d*n.d,i.a*n.e+i.c*n.f+i.e,i.b*n.e+i.d*n.f+i.f)},xt.Matrix.prototype.dot=function(e){return xt.Matrix.dot(this,e)},xt.Matrix.equals=function(e,t){let i=e,n=t;return i.a==n.a&&i.b==n.b&&i.c==n.c&&i.d==n.d&&i.e==n.e&&i.f==n.f},xt.Matrix.prototype.equals=function(e){return xt.Matrix.equals(this,e)},xt.Matrix.prototype.inversion=function(){let e=this.a,t=this.b,i=this.c,n=this.d,r=this.e,s=this.f,a=e*n-t*i;return new xt.Matrix(n/a,-t/a,-i/a,e/a,(i*s-n*r)/a,(t*r-e*s)/a)},xt.convertURLToBlob=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onloadend=function(){t(this.response)},i.send()},xt.convertBase64ToBlob=function(e,t){let i=atob(e),n=new Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);let r=new Uint8Array(n);return new Blob([r],{type:t})};let Bt=function(e){let t=getComputedStyle(e);const i=e.getBoundingClientRect();let n={};return n.pageX0=i.left+window.scrollX,n.pageY0=i.top+window.scrollY,n.width=t?parseFloat(t.width):i.width,n.height=t?parseFloat(t.height):i.height,n.pageX1=n.pageX0+n.width,n.pageY1=n.pageY0+n.height,n},kt=function(e){let t=Bt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("border-left-width"))||0,i.top=parseFloat(t.getPropertyValue("border-top-width"))||0,i.right=parseFloat(t.getPropertyValue("border-right-width"))||0,i.bottom=parseFloat(t.getPropertyValue("border-bottom-width"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Ft=function(e){let t=kt(e),i=function(e){let t=getComputedStyle(e),i={};return i.left=parseFloat(t.getPropertyValue("padding-left"))||0,i.top=parseFloat(t.getPropertyValue("padding-top"))||0,i.right=parseFloat(t.getPropertyValue("padding-right"))||0,i.bottom=parseFloat(t.getPropertyValue("padding-bottom"))||0,i}(e),n={};return n.pageX0=t.pageX0+i.left,n.pageY0=t.pageY0+i.top,n.width=t.width-(i.left+i.right),n.height=t.height-(i.top+i.bottom),n.pageX1=t.pageX1-i.right,n.pageY1=t.pageY1-i.bottom,n},Ut=function(e){let t=e.style.transform,i="matrix(",n=t.indexOf(i);if(-1!=n){n+=i.length;let e=t.substring(n,t.indexOf(")",n)).split(",");for(let t=0;t<e.length;++t)e[t]=parseFloat(e[t]);return new xt.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])}i="scale(";let r=t.indexOf(i);if(-1!=r){r+=i.length;let e=parseFloat(t.substring(r));return new xt.Matrix(e,0,0,e,0,0)}return new xt.Matrix(1,0,0,1,0,0)},Gt=function(e,t){let i=t,n="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";e.style.transform=n},Vt=function(){this._queue=[],this.isWorking=!1,this.timeout=100};if(Vt.prototype.push=function(e,t,i,n){this._queue.push({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Vt.prototype.unshift=function(e,t,i,n){this._queue.unshift({task:e,context:t,args:i,handleReturn:n}),this.isWorking||this.next()},Vt.prototype.next=function(){if(0==this._queue.length)return void(this.isWorking=!1);this.isWorking=!0;let e=this._queue.shift(),t=e.task,i=e.context?e.context:self,n=e.args?e.args:[],r=e.handleReturn;setTimeout(function(){let e=t.apply(i,n);"function"==typeof r&&r(e)},this.timeout)},document?.head){const e=new Blob(["\n.kPainterBox, .kPainterBox *{box-sizing: border-box;}\n.kPainterBox{width:100%;height:100%;border-bottom:none;position:relative;padding:15px;}\n.kPainterBox > .kPainterImgsDiv{width:100%;height:100%;}\n.kPainterBox > .kPainterImgsDiv > canvas, .kPainterBox > .kPainterImgsDiv > img{position:absolute;margin:auto;/*left:0;top:0;right:0;bottom:0;transform-origin:left top;*/pointer-events:none;}\n/*.kPainterBox > .center{margin:auto;left:0;right:0;top:0;bottom:0;}*/\n.kPainterBox > .kPainterCroper{position:absolute;margin:auto;border-style:solid;border-color:rgba(0,0,0,0.3);/*border-right-width:100vw;border-bottom-width:100vh;*/box-sizing:content-box;}\n.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;line-height:0;position:relative;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div{display:inline-block;width:33.33%;height:33.33%;border-style:solid;border-color:rgba(255,255,255,0.5);position:absolute;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(1){border-width:1px 0 0 1px;left:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(2){border-width:1px 1px 0 1px;left:0;top:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(3){border-width:1px 1px 0 0;right:0;top:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(4){border-width:1px 0 1px 1px;left:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(5){border-width:1px 1px 1px 1px;left:0;top:0;right:0;bottom:0;margin:auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(6){border-width:1px 1px 1px 0;right:0;top:0;bottom:0;margin:auto 0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(7){border-width:0 0 1px 1px;left:0;bottom:0;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(8){border-width:0 1px 1px 1px;left:0;bottom:0;right:0;margin:0 auto;}\n.kPainterBox > .kPainterCroper > .kPainterCells > div:nth-child(9){border-width:0 1px 1px 0;right:0;bottom:0;}\n/*.kPainterBox > .kPainterCroper > .kPainterCells{width:100%;height:100%;overflow:hidden;}\n.kPainterBox > .kPainterCroper > .kPainterCells > table{width:100%;height:100%;}\n.kPainterBox > .kPainterCroper > .kPainterCells td{border:1px solid white;}*/\n.kPainterBox > .kPainterCroper > .kPainterBigMover{position:absolute;width:100%;height:100%;left:0;top:0;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div{position:absolute;border-color:white;border-style:solid;border:0;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(1){width:30px;height:100%;left:-15px;top:0;z-index:1;cursor:w-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(2){width:100%;height:30px;left:0;top:-15px;z-index:1;cursor:n-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(3){width:30px;height:100%;right:-15px;top:0;z-index:1;cursor:e-resize;}\n.kPainterBox > .kPainterCroper > .kPainterEdges > div:nth-child(4){width:100%;height:30px;left:0;bottom:-15px;z-index:1;cursor:s-resize;}\n/*.kPainterBox > .kPainterCroper > .kPainterEdges > div > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterCroper > .kPainterCorners > div{position:absolute;width:16px;height:16px;border-color:white;border-style:solid;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1){left:0;top:0;border-width:2px 0 0 2px;z-index:1;cursor:nw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2){right:0;top:0;border-width:2px 2px 0 0;z-index:1;cursor:ne-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3){right:0;bottom:0;border-width:0 2px 2px 0;z-index:1;cursor:se-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4){left:0;bottom:0;border-width:0 0 2px 2px;z-index:1;cursor:sw-resize;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div > i{width:32px;height:32px;position:absolute;display:inline-block;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(1) > i{left:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(2) > i{right:-16px;top:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(3) > i{right:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterCorners > div:nth-child(4) > i{left:-16px;bottom:-16px;}\n.kPainterBox > .kPainterCroper > .kPainterMover{display:inline-block;position:absolute;border:solid 12px rgba(0,0,0,0.15);border-radius:12px;left: 13px;top:13px;z-index:1;cursor:move;}\n.kPainterBox > .kPainterCroper > .kPainterMover > div{display:inline-block;position:absolute;border:solid 15px transparent;border-radius:15px;left:-15px;top:-15px;}\n.kPainterBox > .kPainterCroper > .kPainterMover > svg{display:inline-block;position:absolute;left:-10px;top:-10px;}\n/*.kPainterBox > .kPainterCroper > .kPainterCorners > div > i > span{width:16px;height:16px;display:inline-block;position:fixed;}*/\n.kPainterBox > .kPainterPerspect{position:absolute;width:100%;height:100%;left:0;top:0;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCvs{position:absolute;margin:auto;left:-100000px;top:-100000px;right:-100000px;bottom:-100000px;}\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner{position:absolute;margin:auto;width:20px;height:20px;border-radius:10px;border:2px solid #0f0;color:#fff;background:rgba(0,0,0,0.3);text-align:center;line-height:16px;font-size:12px;font-family:Arial,sans-serif;z-index:1;cursor:move;}\n.kPainterBox > .kPainterGesturePanel{position:absolute;left:0;top:0;width:100%;height:100%;}\n\n.kPainterVideoMdl, .kPainterVideoMdl *{box-sizing: border-box;}\n.kPainterVideoMdl{position:fixed;left:0px;top:0px;width:100%;height:100%;display:none;background:black;}\n.kPainterVideoMdl > .kPainterVideo{width:100%;height:100%;}\n.kPainterVideoMdl > .kPainterCameraSelect{height:20px;position:absolute;left:4px;top:4px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterResolutionSelect{height:20px;position:absolute;left:4px;top:28px;border-radius:3px;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo{position:absolute;margin:0 auto;left:0;right:0;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnGrabVideo > svg{vertical-align:middle;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo{position:absolute;right:20px;bottom:20px;width:64px;height:64px;border:0;border-radius:32px;background:rgba(255,255,255,0.5);text-align:center;}\n.kPainterVideoMdl > .kPainterBtnCloseVideo > svg{vertical-align:middle;}\n\n.kPainterBox > .kPainterPerspect > .kPainterPerspectCorner > canvas{position:absolute;left:-43px;top:-113px;border-radius:50px;border:1px solid #0f0;pointer-events:none;user-select:none;z-index:2}\n"],{type:"text/css"}),t=document.createElement("link");t.rel="stylesheet",t.href=URL.createObjectURL(e),document.head.append(t)}let Wt=class e{_painter;_oriImage;_drawingLayers=[];static async createInstance(t){const i=new e,n=i._painter=new Pt;return n._dceGetQuads=()=>i._drawingLayers.filter(e=>e).map(e=>e._drawingItems.filter(e=>e instanceof vt)).flat(),n._dceSelectedItemIdx=0,n._dceSelectedItemIdxs=new Set,t&&await i.setUIElement(t),i}disposed;dispose(){this.disposed=!0}getUIElement(){const e=this._painter.getHtmlElement();return e.parentElement||e}setUIElement(e){const t=this._painter.getHtmlElement();if(e!==t)return e.append(t),Promise.resolve()}async setOriginalImage(e){this._oriImage=e,e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||(e=ut(e.bytes,e.width,e.height,e.format));const t=this._painter;t.cancelEdit(),t.del(),await t.addImage(e),await t.enterEdit(),await t.enterFreeTransformMode(),this._updateCvsToPainter(),this._updateFreeTransformWhenInitImgOrItem()}_updateCvsToPainter(){const e=this._painter;if("freeTransform"!==e.getMode())return;const t=e.getHtmlElement(),i=t.querySelector(".kPainterCanvas").style,n=e.getWidth(),r=e.getHeight();for(let e of this._drawingLayers){if(!e)continue;const s=e._ctx.canvas;s.width!==n&&(s.width=n),s.height!==r&&(s.height=r);for(let e of["left","top","right","bottom","width","height","transform"])s.style[e]=i[e];s.style.display="",t.querySelector(".kPainterImgsDiv").append(s)}}_updateFreeTransformWhenInitImgOrItem(){const e=this._painter;if("freeTransform"!==e.getMode())return;e._dceSelectedItemIdx=0,e._dceSelectedItemIdxs.clear();let t=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(t){let i=t.quad.points,n=e.getWidth(),r=e.getHeight();e.setFreeTransformCornerPos(i.map(({x:e,y:t})=>[e/n-.5,t/r-.5]))}else e.setFreeTransformCornerPos([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]])}getOriginalImage(){return this._oriImage}_createDrawingLayer(){const e=new Rt;return e._ctx=document.createElement("canvas").getContext("2d"),e._mode="editor",e._oriAddDrawingItems=e.addDrawingItems,e.addDrawingItems=t=>{e._oriAddDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e._oriSetDrawingItems=e.setDrawingItems,e.setDrawingItems=t=>{e._oriSetDrawingItems(t),this._updateFreeTransformWhenInitImgOrItem()},e}createDrawingLayer(){const e=this._createDrawingLayer();return this._drawingLayers.push(e),this._updateCvsToPainter(),e}getDrawingLayer(e){let t=this._drawingLayers[e];return t||1!==e&&2!==e&&3!==e||(t=this._createDrawingLayer(),1===e?t._defaultStyle=yt.STYLE_BLUE_STROKE:2===e?t._defaultStyle=yt.STYLE_ORANGE_STROKE_FILL:3===e&&(t._defaultStyle=yt.STYLE_GREEN_STROKE_FILL),this._drawingLayers[e]=t,this._updateCvsToPainter()),t}getAllDrawingLayers(){for(let e=1;e<=3;e++)this.getDrawingLayer(e);return this._drawingLayers.filter(e=>e)}clearUserDefinedDrawingLayers(){for(let e=4;e<this._drawingLayers.length;++e)this._drawingLayers[e]?._ctx?.canvas.remove();this._drawingLayers.length=4}deleteUserDefinedDrawingLayer(e){1!==e&&2!==e&&3!==e&&(this._drawingLayers[e]?._ctx?.canvas.remove(),delete this._drawingLayers[e])}getSelectedDrawingItems(){const e=this._painter,t=e._dceGetQuads();let i=e._dceSelectedItemIdxs;if(t.length&&i.size)return t.filter((e,t)=>i.has(t));let n=e._dceGetQuads()?.[e._dceSelectedItemIdx];if(!n){const e=this._painter;if("freeTransform"!==e.getMode())return null;n=new vt({points:null});let t=e.getWidth(),i=e.getHeight();n.quad.points=e.getFreeTransformCornerPos().map(e=>({x:(e[0]+.5)*t,y:(e[1]+.5)*i}))}return[n]}};function Ht(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}function jt(e,t,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,i):r?r.value=i:t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;const Yt=e=>e&&"object"==typeof e&&"function"==typeof e.then,Zt=(async()=>{})().constructor;let qt=class extends Zt{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Yt(e)?t=e:"function"==typeof e&&(t=new Zt(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Yt(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}},Xt=class{constructor(e){this._cvr=e}async getMaxBufferedItems(){return await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e(i.count);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})}async setMaxBufferedItems(e){return await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},be.postMessage({type:"cvr_setMaxBufferedItems",id:n,instanceID:this._cvr._instanceID,body:{count:e}})})}async getBufferedCharacterItemSet(){return await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e(i.itemSet);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})}};var Kt={onTaskResultsReceived:!1,onTargetROIResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onDeskewedImageReceived:!1,onEnhancedImageReceived:!1,onColourImageUnitReceived:!1,onScaledColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onRawTextLinesUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1,onLogicLinesUnitReceived:!1};const Qt=e=>{for(let t in e._irrRegistryState)e._irrRegistryState[t]=!1;for(let t of e._intermediateResultReceiverSet)if(t.isDce||t.isFilter)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in t)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!t[i])};let $t=class{constructor(e){this._irrRegistryState=Kt,this._intermediateResultReceiverSet=new Set,this._cvr=e}async addResultReceiver(e){if("object"!=typeof e)throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(e),Qt(this);let t=-1,i={};if(!e.isDce&&!e.isFilter){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");t=e._observedResultUnitTypes,e._observedTaskMap.forEach((e,t)=>{i[t]=e}),e._observedTaskMap.clear()}return await new Promise((e,n)=>{let r=Oe();Le[r]=async t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,n(e)}},be.postMessage({type:"cvr_setIrrRegistry",id:r,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:t.toString(),observedTaskMap:i}})})}async removeResultReceiver(e){return this._intermediateResultReceiverSet.delete(e),Qt(this),await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"cvr_setIrrRegistry",id:i,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})}getOriginalImage(){return this._cvr.privideDsImage}};const zt="undefined"==typeof self,Jt="function"==typeof importScripts,ei=(()=>{if(!Jt){if(!zt&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ti=e=>{if(null==e&&(e="./"),zt||Jt);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var ii;Ve.engineResourcePaths.cvr={version:"3.4.10-dev-20260129110712",path:ei,isInternal:!0},Fe.cvr={js:!0,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE,Te.MN_DYNAMSOFT_IMAGE_PROCESSING,Te.MN_DYNAMSOFT_NEURAL_NETWORK]},Fe.dnn={wasm:!0,deps:[Te.MN_DYNAMSOFT_IMAGE_PROCESSING]},ke.cvr={};const ni="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,ni)<0&&(Ve.engineResourcePaths.std={version:ni,path:ti(ei+`../../dynamsoft-capture-vision-std@${ni}/dist/`),isInternal:!0});const ri="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,ri)<0)&&(Ve.engineResourcePaths.dip={version:ri,path:ti(ei+`../../dynamsoft-image-processing@${ri}/dist/`),isInternal:!0});const si="2.0.10";(!Ve.engineResourcePaths.dnn||"string"!=typeof Ve.engineResourcePaths.dnn&&L(Ve.engineResourcePaths.dnn.version,si)<0)&&(Ve.engineResourcePaths.dnn={version:si,path:ti(ei+`../../dynamsoft-capture-vision-dnn@${si}/dist/`),isInternal:!0});let ai=class{static getVersion(){return this._version}};var oi,li,ci,di,hi,ui,gi,_i,pi,fi,mi,Ei,Ii,yi,Ri,Ti,Ci,wi,vi,Si,Ai,bi,Di,Oi;function Li(e,t){if(e){if(e.sourceLocation){const i=e.sourceLocation.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}if(e.location){const i=e.location.points;for(let e of i)e.x=e.x/t,e.y=e.y/t}Li(e.referencedItem,t)}}function Ni(e){if(e.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}function Mi(e){return{type:le.CRIT_ORIGINAL_IMAGE,referenceItem:null,targetROIDefName:"",taskName:"",imageData:e,toCanvas:()=>P(e),toImage:t=>x(t,e),toBlob:t=>B(t,e)}}function Pi(e){let t=!1;const i=[de.EC_UNSUPPORTED_JSON_KEY_WARNING,de.EC_LICENSE_AUTH_QUOTA_EXCEEDED,de.EC_LICENSE_RESULTS_LIMIT_EXCEEDED];if(e.errorCode&&i.includes(e.errorCode))return void console.warn(e.message);let n=new Error(e.errorCode?`[${e.functionName}] [${e.errorCode}] ${e.message}`:`[${e.functionName}] ${e.message}`);if(n.stack&&(n.stack=e.stack),e.isShouldThrow)throw n;return e.rj&&e.rj(n),t=!0,true}ai._version=`3.4.10-dev-20260129110712(Worker: ${null===(ii=Be.cvr)||void 0===ii?void 0:ii.worker}, Wasm: loading...`,function(e){e[e.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",e[e.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(oi||(oi={}));const xi={onTaskResultsReceived:()=>{},isFilter:!0};Le[-2]=async e=>{Bi.onDataLoadProgressChanged&&Bi.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};class Bi{constructor(){li.add(this),this.maxImageSideLength=["iPhone","Android","HarmonyOS"].includes(Ve.browserInfo.OS)?2048:4096,this.onCaptureError=null,this._instanceID=void 0,this.privideDsImage=null,this._isPauseScan=!0,this._isOutputOriginalImage=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1,this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._dynamsoft=!0,ci.set(this,null),di.set(this,null),hi.set(this,null),ui.set(this,null),gi.set(this,null),_i.set(this,new Set),pi.set(this,new Set),fi.set(this,new Set),mi.set(this,500),Ei.set(this,0),Ii.set(this,0),yi.set(this,!1),Ri.set(this,!1),Ti.set(this,!1),Ci.set(this,null),this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this)}get disposed(){return Ht(this,Ti,"f")}static async createInstance(e=!0){if(!ke.license)throw Error("The `license` module cannot be found.");return await ke.license.dynamsoft(),await Ve.loadWasm(),await new Promise((t,i)=>{const n=new Bi;let r=Oe();Le[r]=async e=>{e.success?(n._instanceID=e.instanceID,n._currentSettings=JSON.parse(JSON.parse(e.outputSettings).data),Bi._isNoOnnx=e.isNoOnnx,ai._version=`3.4.10-dev-20260129110712(Worker: ${Be.cvr.worker}, Wasm: ${e.version})`,jt(n,Ri,!0,"f"),jt(n,ui,n.getIntermediateResultManager(),"f"),jt(n,Ri,!1,"f"),t(n)):Pi({message:e.message,rj:i,stack:e.stack,functionName:"createInstance"})},be.postMessage({type:"cvr_createInstance",id:r,body:{loadPresetTemplates:e}})})}static async appendDLModelBuffer(e,t){return await Ve.loadWasm(),Bi._isNoOnnx?Promise.reject("Model not supported in the current environment."):await new Promise((i,n)=>{let r=Oe();const s=N(Ve.engineResourcePaths);let a;Le[r]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Pi({message:t.errorString?t.errorString:"Append Model Buffer Failed.",rj:n,errorCode:t.errorCode,functionName:"appendDLModelBuffer"}),i(t)}Pi({message:e.message,rj:n,stack:e.stack,functionName:"appendDLModelBuffer"})},t?a=t.endsWith("/")?t:t+"/":"DCV"===Ve._bundleEnv?a=s.dcvData+"models/":"DBR"===Ve._bundleEnv&&(a=s.dbrBundle+"models/");let o=Array.isArray(e)?e:[e];o=o.map(e=>e.replace(/\.data$/i,"")),be.postMessage({type:"cvr_appendDLModelBuffer",id:r,body:{modelNames:o,path:a}})})}static async clearDLModelBuffers(){return await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e();Pi({message:i.message,rj:t,stack:i.stack,functionName:"clearDLModelBuffers"})},be.postMessage({type:"cvr_clearDLModelBuffers",id:i})})}async _singleFrameModeCallback(e){const t={bytes:e.bytes,width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.imageTag};for(let e of Ht(this,_i,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(Mi(t));this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);const i=await this.capture(t,this._templateName);i.originalImageTag=e.imageTag,Ht(this,ci,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1}),Ht(this,li,"m",Si).call(this,i)}setInput(e){Ni(this),jt(this,ci,e,"f"),e||Ht(this,Ci,"f")&&(Ht(this,ui,"f").removeResultReceiver(Ht(this,Ci,"f")),jt(this,Ci,null,"f"))}getInput(){return Ht(this,ci,"f")}addImageSourceStateListener(e){if(Ni(this),"object"!=typeof e)return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&Ht(this,pi,"f").add(e)}removeImageSourceStateListener(e){return Ni(this),Ht(this,pi,"f").delete(e)}addResultReceiver(e){if(Ni(this),"object"!=typeof e)throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(Ht(this,_i,"f").add(e),this._setCrrRegistry())}removeResultReceiver(e){Ni(this),Ht(this,_i,"f").delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onProcessedDocumentResultReceived:!1,onParsedResultsReceived:!1};for(let t of Ht(this,_i,"f"))t.isDce||(e.onCapturedResultReceived=!!t.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!t.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!t.onRecognizedTextLinesReceived,e.onProcessedDocumentResultReceived=!!t.onProcessedDocumentResultReceived,e.onParsedResultsReceived=!!t.onParsedResultsReceived);let t=Oe();return await new Promise((i,n)=>{Le[t]=async e=>{e.success?i():Pi({message:e.message,rj:n,stack:e.stack,functionName:"addResultReceiver"})},be.postMessage({type:"cvr_setCrrRegistry",id:t,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}})})}async addResultFilter(e){if(Ni(this),!e._dynamsoft)throw new Error("User defined CapturedResultFilter is not supported.");if(!e||"object"!=typeof e||!Object.keys(e).length)return console.warn("Invalid filter.");Ht(this,fi,"f").add(e),e._dynamsoft(),await this._handleFilterUpdate()}async removeResultFilter(e){Ni(this),Ht(this,fi,"f").delete(e),await this._handleFilterUpdate()}async _handleFilterUpdate(){if(Ht(this,ui,"f").removeResultReceiver(xi),0===Ht(this,fi,"f").size){this._isOpenBarcodeVerify=!1,this._isOpenLabelVerify=!1,this._isOpenDetectVerify=!1,this._isOpenNormalizeVerify=!1;const e={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1,[le.CRIT_ENHANCED_IMAGE]:!1},t={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1,[le.CRIT_ENHANCED_IMAGE]:!1};return await Ht(this,li,"m",Ai).call(this,e),void await Ht(this,li,"m",bi).call(this,t)}for(let e of Ht(this,fi,"f"))this._isOpenBarcodeVerify=e.isResultCrossVerificationEnabled(le.CRIT_BARCODE),this._isOpenLabelVerify=e.isResultCrossVerificationEnabled(le.CRIT_TEXT_LINE),this._isOpenDetectVerify=e.isResultCrossVerificationEnabled(le.CRIT_DETECTED_QUAD),this._isOpenNormalizeVerify=e.isResultCrossVerificationEnabled(le.CRIT_DESKEWED_IMAGE),e.isLatestOverlappingEnabled(le.CRIT_BARCODE)&&([...Ht(this,ui,"f")._intermediateResultReceiverSet.values()].find(e=>e.isFilter)||Ht(this,ui,"f").addResultReceiver(xi)),await Ht(this,li,"m",Ai).call(this,e.verificationEnabled),await Ht(this,li,"m",bi).call(this,e.duplicateFilterEnabled),await Ht(this,li,"m",Di).call(this,e.duplicateForgetTime),await Ht(this,li,"m",Oi).call(this,e.crossVerificationCriteria)}async startCapturing(e){if(Ni(this),!this._isPauseScan)return;if(!Ht(this,ci,"f"))throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=Bi._defaultTemplate);for(let e of Ht(this,fi,"f"))await this.addResultFilter(e);const t=N(Ve.engineResourcePaths);return void 0!==Ht(this,ci,"f").singleFrameMode&&"disabled"!==Ht(this,ci,"f").singleFrameMode?(this._templateName=e,void Ht(this,ci,"f").on("singleFrameAcquired",this._singleFrameModeCallbackBind)):Ht(this,hi,"f")&&Ht(this,hi,"f").isPending?Ht(this,hi,"f"):(jt(this,hi,new qt((i,n)=>{if(this.disposed)return;let r=Oe();Le[r]=async t=>{Ht(this,hi,"f")&&!Ht(this,hi,"f").isFulfilled&&(t.success?(this._isPauseScan=!1,this._isOutputOriginalImage=t.isOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{-1!==this._minImageCaptureInterval&&Ht(this,ci,"f").startFetching(),this._loopReadVideo(e),i()},0)):Pi({message:t.message,rj:n,stack:t.stack,functionName:"startCapturing"}))},be.postMessage({type:"cvr_startCapturing",id:r,instanceID:this._instanceID,body:{templateName:e,engineResourcePaths:t}})}),"f"),await Ht(this,hi,"f"))}stopCapturing(){if(Ni(this),!Ht(this,ci,"f"))return;Ht(this,ci,"f").stopFetching(),this._averageProcessintTimeArray=[],this._averageTime=999,this._isPauseScan=!0,jt(this,hi,null,"f"),Ht(this,ci,"f").setColourChannelUsageType(a.CCUT_AUTO);const e=Oe();Le[e]=()=>{},be.postMessage({type:"cvr_stopCapturing",id:e,instanceID:this._instanceID})}async containsTask(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(JSON.parse(e.tasks));Pi({message:e.message,rj:i,stack:e.stack,functionName:"containsTask"})},be.postMessage({type:"cvr_containsTask",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async switchCapturingTemplate(e){this.stopCapturing(),await this.startCapturing(e)}async _loopReadVideo(e){if(this.disposed||this._isPauseScan)return;if(jt(this,yi,!0,"f"),Ht(this,ci,"f").isBufferEmpty())if(Ht(this,ci,"f").hasNextImageToFetch())for(let e of Ht(this,pi,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(oi.ISS_BUFFER_EMPTY);else if(!Ht(this,ci,"f").hasNextImageToFetch())for(let e of Ht(this,pi,"f"))e.onImageSourceStateReceived&&e.onImageSourceStateReceived(oi.ISS_EXHAUSTED);const t=Ht(this,ci,"f").getImage();if(t&&t.imageTag&&Date.now()-t.imageTag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!t)return void this._reRunCurrnetFunc(e);for(let e of Ht(this,_i,"f"))this._isOutputOriginalImage&&e.onOriginalImageResultReceived&&e.onOriginalImageResultReceived(Mi(t));const i=Date.now();this._captureDsimage(t,e).then(async n=>{if(Bi._onLog&&Bi._onLog("no js handle time: "+(Date.now()-i)),this._isPauseScan)return void this._reRunCurrnetFunc(e);n.originalImageTag=t.imageTag?t.imageTag:null,Ht(this,ci,"f")._capturedResultReceiver&&Ht(this,ci,"f")._cameraView._capturedResultReceiver.onCapturedResultReceived(n,{isDetectVerifyOpen:this._isOpenDetectVerify,isNormalizeVerifyOpen:this._isOpenNormalizeVerify,isBarcodeVerifyOpen:this._isOpenBarcodeVerify,isLabelVerifyOpen:this._isOpenLabelVerify});for(let e of Ht(this,fi,"f")){const t=e;t.onOriginalImageResultReceived(n),t.onDecodedBarcodesReceived(n),t.onRecognizedTextLinesReceived(n),t.onProcessedDocumentResultReceived(n),t.onParsedResultsReceived(n)}Ht(this,li,"m",Si).call(this,n);const r=Date.now();if(this._minImageCaptureInterval>-1&&(5===this._averageProcessintTimeArray.length&&this._averageProcessintTimeArray.shift(),5===this._averageFetchImageTimeArray.length&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-i),this._averageFetchImageTimeArray.push(t&&t.imageTag?t.imageTag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Bi._onLog&&(Bi._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Bi._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Bi._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Bi._onLog(`averageTime: ${this._averageTime}`))),Bi._onLog){const e=Date.now()-r;e>10&&Bi._onLog(`fetch image calculate time: ${e}`)}Bi._onLog&&Bi._onLog(`time finish decode: ${Date.now()}`),Bi._onLog&&Bi._onLog("main time: "+(Date.now()-i)),Bi._onLog&&Bi._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(t=>{Ht(this,ci,"f").stopFetching(),"platform error"!==t.message&&(t.errorCode&&0===t.errorCode&&(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{Ht(this,ci,"f").startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3))),setTimeout(()=>{if(!this.onCaptureError)throw t;this.onCaptureError(t)},0))})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async getClarity(e,t,i,n,r){const{bytes:s,width:a,height:o,stride:l,format:c}=e;let d=Oe();return new Promise((e,h)=>{Le[d]=async t=>{t.success?e(t.clarity):Pi({message:t.message,rj:h,stack:t.stack,functionName:"getClarity"})},be.postMessage({type:"cvr_getClarity",id:d,instanceID:this._instanceID,body:{bytes:s,width:a,height:o,stride:l,format:c,bitcount:t,wr:i,hr:n,grayThreshold:r}},[s.buffer])})}async capture(e,t){let i;if(Ni(this),t||(t=Bi._defaultTemplate),jt(this,yi,!1,"f"),R(e))i=await this._captureDsimage(e,t);else if("string"==typeof e)i="data:image/"==e.substring(0,11)?await this._captureBase64(e,t):await this._captureUrl(e,t);else if(e instanceof Blob)i=await this._captureBlob(e,t);else if(e instanceof HTMLImageElement)i=await this._captureImage(e,t);else if(e instanceof HTMLCanvasElement)i=await this._captureCanvas(e,t);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");i=await this._captureVideo(e,t)}return i}async _captureDsimage(e,t){return await this._captureInWorker(e,t)}async _captureUrl(e,t){let i=await D(e,"blob");return await this._captureBlob(i,t)}async _captureBase64(e,t){e=e.substring(e.indexOf(",")+1);let i=atob(e),n=i.length,r=new Uint8Array(n);for(;n--;)r[n]=i.charCodeAt(n);return await this._captureBlob(new Blob([r]),t)}async _captureBlob(e,t){let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await async function(t){return await new Promise((i,n)=>{let r=URL.createObjectURL(t),s=new Image;s.src=r,s.onload=()=>{URL.revokeObjectURL(s.dbrObjUrl),i(s)},s.onerror=()=>{let t="Unsupported image format. Please upload files in one of the following formats: .jpg,.jpeg,.ico,.gif,.svg,.webp,.png,.bmp";"image/svg+xml"===e.type&&(t="Invalid SVG file. The file appears to be malformed or contains invalid XML."),n(new Error(t))}})}(e));let r=await this._captureImage(i||n,t);return i&&i.close(),r}async _captureImage(e,t){let i,n,r=e instanceof HTMLImageElement?e.naturalWidth:e.width,s=e instanceof HTMLImageElement?e.naturalHeight:e.height,a=Math.max(r,s);a>this.maxImageSideLength?(jt(this,Ii,this.maxImageSideLength/a,"f"),i=Math.round(r*Ht(this,Ii,"f")),n=Math.round(s*Ht(this,Ii,"f"))):(i=r,n=s),Ht(this,di,"f")||jt(this,di,document.createElement("canvas"),"f");const o=Ht(this,di,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,r,s,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(o,t)}async _captureCanvas(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),n={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:o.IPF_ABGR_8888};return await this._captureInWorker(n,t)}async _captureVideo(e,t){if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";let i,n,r=e.videoWidth,s=e.videoHeight,a=Math.max(r,s);a>this.maxImageSideLength?(jt(this,Ii,this.maxImageSideLength/a,"f"),i=Math.round(r*Ht(this,Ii,"f")),n=Math.round(s*Ht(this,Ii,"f"))):(i=r,n=s),Ht(this,di,"f")||jt(this,di,document.createElement("canvas"),"f");const o=Ht(this,di,"f");return o.width===i&&o.height===n||(o.width=i,o.height=n),o.ctx2d||(o.ctx2d=o.getContext("2d",{willReadFrequently:!0})),o.ctx2d.drawImage(e,0,0,r,s,0,0,i,n),await this._captureCanvas(o,t)}async _captureInWorker(e,t){let{bytes:i,width:n,height:r,stride:s,format:a,imageTag:o}=e,l=Oe();return await new Promise((c,d)=>{this.privideDsImage=e,Le[l]=t=>{if(t.success){const i=Date.now();Bi._onLog&&(Bi._onLog(`get result time from worker: ${i}`),Bi._onLog("worker to main time consume: "+(i-t.workerReturnMsgTime)));try{Ht(this,li,"m",wi).call(this,t.captureResult,e),e.bytes=t.bytes,t.isScanner||jt(this,Ii,0,"f"),Ht(this,li,"m",vi).call(this,t.intermediateResult,o);const i=Date.now();return i-Ht(this,Ei,"f")>Ht(this,mi,"f")&&null!==t.mliRecord&&(null===localStorage||void 0===localStorage||localStorage.setItem("dynamsoft",t.mliRecord),jt(this,Ei,i,"f")),c(t.captureResult)}catch(e){Pi({message:e.message,rj:d,stack:e.stack,functionName:"capture"})}}else Pi({message:t.message,rj:d,stack:t.stack,functionName:"capture"})},Bi._onLog&&Bi._onLog(`send buffer to worker: ${Date.now()}`),be.postMessage({type:"cvr_capture",id:l,instanceID:this._instanceID,body:{bytes:i,width:n,height:r,stride:s,format:a,templateName:t||"",isScanner:Ht(this,yi,"f"),dynamsoft:this._dynamsoft}},[i.buffer])})}async initSettings(e){if(Ni(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await D(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=Oe();Le[n]=async n=>{if(n.success){const r=JSON.parse(n.response);if(0!==r.errorCode&&Pi({message:r.errorString?r.errorString:"Init Settings Failed.",rj:i,errorCode:r.errorCode,functionName:"initSettings"}))return;const s=JSON.parse(e);return this._currentSettings=s,this._isOutputOriginalImage=1===this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage,Bi._defaultTemplate=this._currentSettings.CaptureVisionTemplates[0].Name,t(r)}Pi({message:n.message,rj:i,stack:n.stack,functionName:"initSettings"})},be.postMessage({type:"cvr_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid template.")}async outputSettings(e,t){return Ni(this),await new Promise((i,n)=>{let r=Oe();Le[r]=async e=>{if(e.success){const t=JSON.parse(e.response);return 0!==t.errorCode&&Pi({message:t.errorString,rj:n,errorCode:t.errorCode,functionName:"outputSettings"}),i(JSON.parse(t.data))}Pi({message:e.message,rj:n,stack:e.stack,functionName:"outputSettings"})},be.postMessage({type:"cvr_outputSettings",id:r,instanceID:this._instanceID,body:{templateName:e,includeDefaultValues:!!t}})})}async outputSettingsToFile(e,t,i,n){const r=await this.outputSettings(e,n),s=new Blob([JSON.stringify(r,null,2,function(e,t){return t instanceof Array?JSON.stringify(t):t},2)],{type:"application/json"});if(i){const e=document.createElement("a");e.href=URL.createObjectURL(s),t.endsWith(".json")&&(t=t.replace(".json","")),e.download=`${t}.json`,e.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(e.href)},500)},e.click()}return s}async getTemplateNames(){return Ni(this),await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Pi({message:n.errorString,rj:t,errorCode:n.errorCode,functionName:"getTemplateNames"}),e(JSON.parse(n.data))}Pi({message:i.message,rj:t,stack:i.stack,functionName:"getTemplateNames"})},be.postMessage({type:"cvr_getTemplateNames",id:i,instanceID:this._instanceID})})}async getSimplifiedSettings(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success){const n=JSON.parse(e.response);0!==n.errorCode&&Pi({message:n.errorString,rj:i,errorCode:n.errorCode,functionName:"getSimplifiedSettings"});const r=JSON.parse(n.data,(e,t)=>"barcodeFormatIds"===e?BigInt(t):t);return r.minImageCaptureInterval=this._minImageCaptureInterval,t(r)}Pi({message:e.message,rj:i,stack:e.stack,functionName:"getSimplifiedSettings"})},be.postMessage({type:"cvr_getSimplifiedSettings",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,t){return Ni(this),await new Promise((i,n)=>{let r=Oe();Le[r]=async e=>{if(e.success){const r=JSON.parse(e.response);return t.minImageCaptureInterval&&t.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=t.minImageCaptureInterval),this._isOutputOriginalImage=e.isOutputOriginalImage,0!==r.errorCode&&Pi({message:r.errorString?r.errorString:"Update Settings Failed.",rj:n,errorCode:r.errorCode,functionName:"updateSettings"}),this._currentSettings=await this.outputSettings("*"),i(r)}Pi({message:e.message,rj:n,stack:e.stack,functionName:"updateSettings"})},be.postMessage({type:"cvr_updateSettings",id:r,instanceID:this._instanceID,body:{settings:t,templateName:e}})})}async resetSettings(){return Ni(this),await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success){const n=JSON.parse(i.response);return 0!==n.errorCode&&Pi({message:n.errorString?n.errorString:"Reset Settings Failed.",rj:t,errorCode:n.errorCode,functionName:"resetSettings"}),this._currentSettings=await this.outputSettings("*"),e(n)}Pi({message:i.message,rj:t,stack:i.stack,functionName:"resetSettings"})},be.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})}getBufferedItemsManager(){return Ht(this,gi,"f")||jt(this,gi,new Xt(this),"f"),Ht(this,gi,"f")}getIntermediateResultManager(){if(Ni(this),!Ht(this,Ri,"f")&&0!==Ve.bSupportIRTModule)throw new Error("The current license does not support the use of intermediate results.");return Ht(this,ui,"f")||jt(this,ui,new $t(this),"f"),Ht(this,ui,"f")}static async setGlobalIntraOpNumThreads(e=0){return e>4||e<0?Promise.reject(new RangeError("'intraOpNumThreads' should be between 0 and 4.")):(await Ve.loadWasm(),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t();Pi({message:e.message,rj:i,stack:e.stack,functionName:"setGlobalIntraOpNumThreads"})},be.postMessage({type:"cvr_setGlobalIntraOpNumThreads",id:n,body:{intraOpNumThreads:e}})}))}async parseRequiredResources(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(JSON.parse(e.resources));Pi({message:e.message,rj:i,stack:e.stack,functionName:"parseRequiredResources"})},be.postMessage({type:"cvr_parseRequiredResources",id:n,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){Ni(this),Ht(this,hi,"f")&&this.stopCapturing(),jt(this,ci,null,"f"),Ht(this,_i,"f").clear(),Ht(this,pi,"f").clear(),Ht(this,fi,"f").clear(),Ht(this,ui,"f")._intermediateResultReceiverSet.clear(),jt(this,Ti,!0,"f");let e=Oe();Le[e]=e=>{e.success||Pi({message:e.message,stack:e.stack,isShouldThrow:!0,functionName:"dispose"})},be.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}_getInternalData(){return{isa:Ht(this,ci,"f"),promiseStartScan:Ht(this,hi,"f"),intermediateResultManager:Ht(this,ui,"f"),bufferdItemsManager:Ht(this,gi,"f"),resultReceiverSet:Ht(this,_i,"f"),isaStateListenerSet:Ht(this,pi,"f"),resultFilterSet:Ht(this,fi,"f"),compressRate:Ht(this,Ii,"f"),canvas:Ht(this,di,"f"),isScanner:Ht(this,yi,"f"),innerUseTag:Ht(this,Ri,"f"),isDestroyed:Ht(this,Ti,"f")}}async _getWasmFilterState(){return await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success){const t=JSON.parse(i.response);return e(t)}Pi({message:i.message,rj:t,stack:i.stack,functionName:""})},be.postMessage({type:"cvr_getWasmFilterState",id:i,instanceID:this._instanceID})})}}ci=new WeakMap,di=new WeakMap,hi=new WeakMap,ui=new WeakMap,gi=new WeakMap,_i=new WeakMap,pi=new WeakMap,fi=new WeakMap,mi=new WeakMap,Ei=new WeakMap,Ii=new WeakMap,yi=new WeakMap,Ri=new WeakMap,Ti=new WeakMap,Ci=new WeakMap,li=new WeakSet,wi=function(e,t){var i,n,r,s,a,o,l,c,d,h,u,g;for(let _=0;_<e.items.length;_++){const p=e.items[_];switch(0!==Ht(this,Ii,"f")&&Li(p,Ht(this,Ii,"f")),p.type){case le.CRIT_ORIGINAL_IMAGE:e.items[_]=Mi(t);break;case le.CRIT_BARCODE:null!==(i=(l=e.decodedBarcodesResult).barcodeResultItems)&&void 0!==i||(l.barcodeResultItems=[]),e.decodedBarcodesResult.barcodeResultItems.push(p);break;case le.CRIT_TEXT_LINE:null!==(n=(c=e.recognizedTextLinesResult).textLineResultItems)&&void 0!==n||(c.textLineResultItems=[]),e.recognizedTextLinesResult.textLineResultItems.push(p);break;case le.CRIT_DETECTED_QUAD:null!==(r=(d=e.processedDocumentResult).detectedQuadResultItems)&&void 0!==r||(d.detectedQuadResultItems=[]),e.processedDocumentResult.detectedQuadResultItems.push(p);break;case le.CRIT_DESKEWED_IMAGE:ke.ddn&&ke.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(s=(h=e.processedDocumentResult).deskewedImageResultItems)&&void 0!==s||(h.deskewedImageResultItems=[]),e.processedDocumentResult.deskewedImageResultItems.push(p);break;case le.CRIT_ENHANCED_IMAGE:ke.ddn&&ke.ddn.handleDeskewedAndEnhancedImageResultItem(p),null!==(a=(u=e.processedDocumentResult).enhancedImageResultItems)&&void 0!==a||(u.enhancedImageResultItems=[]),e.processedDocumentResult.enhancedImageResultItems.push(p);break;case le.CRIT_PARSED_RESULT:ke.dcp&&ke.dcp.handleParsedResultItem(p),null!==(o=(g=e.parsedResult).parsedResultItems)&&void 0!==o||(g.parsedResultItems=[]),e.parsedResult.parsedResultItems.push(p)}}},vi=function(e,t){const i=e;if(i){let e=0;for(let n of Ht(this,ui,"f")._intermediateResultReceiverSet){e++;for(let r of i){if(["onTaskResultsReceived","onTargetROIResultsReceived"].includes(r.info.callbackName)){for(let e of r.intermediateResultUnits)e.originalImageTag=t||null;n[r.info.callbackName]&&n[r.info.callbackName]({intermediateResultUnits:r.intermediateResultUnits},r.info)}else n[r.info.callbackName]&&n[r.info.callbackName](r.result,r.info);e===Ht(this,ui,"f")._intermediateResultReceiverSet.size&&delete r.info.callbackName}}}},Si=function(e){for(let t of Ht(this,_i,"f"))e.decodedBarcodesResult&&t.onDecodedBarcodesReceived&&t.onDecodedBarcodesReceived(e.decodedBarcodesResult),e.recognizedTextLinesResult&&t.onRecognizedTextLinesReceived&&t.onRecognizedTextLinesReceived(e.recognizedTextLinesResult),e.processedDocumentResult&&t.onProcessedDocumentResultReceived&&t.onProcessedDocumentResultReceived(e.processedDocumentResult),e.parsedResult&&t.onParsedResultsReceived&&t.onParsedResultsReceived(e.parsedResult),t.onCapturedResultReceived&&t.onCapturedResultReceived(e)},Ai=async function(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},be.postMessage({type:"cvr_enableResultCrossVerification",id:n,instanceID:this._instanceID,body:{verificationEnabled:e}})})},bi=async function(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},be.postMessage({type:"cvr_enableResultDeduplication",id:n,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})},Di=async function(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t(e.result);Pi({message:e.message,rj:i,stack:e.stack,functionName:"addResultFilter"})},be.postMessage({type:"cvr_setDuplicateForgetTime",id:n,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})},Oi=async function(e){return Ni(this),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success)return t();Pi({message:e.message,rj:i,stack:e.stack,functionName:"setResultCrossVerificationCriteria"})},be.postMessage({type:"cvr_setResultCrossVerificationCriteria",id:n,instanceID:this._instanceID,body:{criteria:e}})})},Bi._defaultTemplate="Default",Bi._isNoOnnx=!1;class ki{constructor(){this.onCapturedResultReceived=null,this.onOriginalImageResultReceived=null}}class Fi{constructor(){this._observedResultUnitTypes=me.IRUT_ALL,this._observedTaskMap=new Map,this._parameters={setObservedResultUnitTypes:e=>{this._observedResultUnitTypes=e},getObservedResultUnitTypes:()=>this._observedResultUnitTypes,isResultUnitTypeObserved:e=>!!(e&this._observedResultUnitTypes),addObservedTask:e=>{this._observedTaskMap.set(e,!0)},removeObservedTask:e=>{this._observedTaskMap.set(e,!1)},isTaskObserved:e=>0===this._observedTaskMap.size||!!this._observedTaskMap.get(e)},this.onTaskResultsReceived=null,this.onPredetectedRegionsReceived=null,this.onColourImageUnitReceived=null,this.onScaledColourImageUnitReceived=null,this.onGrayscaleImageUnitReceived=null,this.onTransformedGrayscaleImageUnitReceived=null,this.onEnhancedGrayscaleImageUnitReceived=null,this.onBinaryImageUnitReceived=null,this.onTextureDetectionResultUnitReceived=null,this.onTextureRemovedGrayscaleImageUnitReceived=null,this.onTextureRemovedBinaryImageUnitReceived=null,this.onContoursUnitReceived=null,this.onLineSegmentsUnitReceived=null,this.onTextZonesUnitReceived=null,this.onTextRemovedBinaryImageUnitReceived=null,this.onShortLinesUnitReceived=null}getObservationParameters(){return this._parameters}}var Ui;!function(e){e.PT_DEFAULT="Default",e.PT_READ_BARCODES="ReadBarcodes_Default",e.PT_RECOGNIZE_TEXT_LINES="RecognizeTextLines_Default",e.PT_DETECT_DOCUMENT_BOUNDARIES="DetectDocumentBoundaries_Default",e.PT_DETECT_AND_NORMALIZE_DOCUMENT="DetectAndNormalizeDocument_Default",e.PT_NORMALIZE_DOCUMENT="NormalizeDocument_Default",e.PT_READ_BARCODES_SPEED_FIRST="ReadBarcodes_SpeedFirst",e.PT_READ_BARCODES_READ_RATE_FIRST="ReadBarcodes_ReadRateFirst",e.PT_READ_BARCODES_BALANCE="ReadBarcodes_Balance",e.PT_READ_SINGLE_BARCODE="ReadSingleBarcode",e.PT_READ_DENSE_BARCODES="ReadDenseBarcodes",e.PT_READ_DISTANT_BARCODES="ReadDistantBarcodes",e.PT_RECOGNIZE_NUMBERS="RecognizeNumbers",e.PT_RECOGNIZE_LETTERS="RecognizeLetters",e.PT_RECOGNIZE_NUMBERS_AND_LETTERS="RecognizeNumbersAndLetters",e.PT_RECOGNIZE_NUMBERS_AND_UPPERCASE_LETTERS="RecognizeNumbersAndUppercaseLetters",e.PT_RECOGNIZE_UPPERCASE_LETTERS="RecognizeUppercaseLetters"}(Ui||(Ui={}));const Gi="undefined"==typeof self,Vi=Gi?{}:self,Wi="function"==typeof importScripts,Hi=(()=>{if(!Wi){if(!Gi&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ji=e=>e&&"object"==typeof e&&"function"==typeof e.then,Yi=(async()=>{})().constructor;let Zi=class extends Yi{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,ji(e)?t=e:"function"==typeof e&&(t=new Yi(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(ji(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}};const qi=" is not allowed to change after `createInstance` or `loadWasm` is called.",Xi=!Gi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Ki=(e,t)=>{const i=e;if(i._license!==t){if(!i._pLoad.isEmpty)throw new Error("`license`"+qi);i._license=t}};!Gi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Qi=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let t=0;t<e.length;++t){if(!Gi){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}}return e},$i=(e,t)=>{t=Qi(t);const i=e;if(i._licenseServer!==t){if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+qi);i._licenseServer=t}},zi=(e,t)=>{t=t||"";const i=e;if(i._deviceFriendlyName!==t){if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+qi);i._deviceFriendlyName=t}};let Ji,en,tn,nn,rn;"undefined"!=typeof navigator&&(Ji=navigator,en=Ji.userAgent,tn=Ji.platform,nn=Ji.mediaDevices),function(){if(!Gi){const e={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Ji.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},t={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:tn,search:"Win"},Mac:{str:tn},Linux:{str:tn}};let i="unknownBrowser",n=0,r="unknownOS";for(let t in e){const r=e[t]||{};let s=r.str||en,a=r.search||t,o=r.verStr||en,l=r.verSearch||t;if(l instanceof Array||(l=[l]),-1!=s.indexOf(a)){i=t;for(let e of l){let t=o.indexOf(e);if(-1!=t){n=parseFloat(o.substring(t+e.length+1));break}}break}}for(let e in t){const i=t[e]||{};let n=i.str||en,s=i.search||e;if(-1!=n.indexOf(s)){r=e;break}}"Linux"==r&&-1!=en.indexOf("Windows NT")&&(r="HarmonyOS"),rn={browser:i,version:n,OS:r}}Gi&&(rn={browser:"ssr",version:0,OS:"ssr"})}(),nn&&nn.getUserMedia,"Chrome"===rn.browser&&rn.version>66||"Safari"===rn.browser&&rn.version>13||"OPR"===rn.browser&&rn.version>43||"Edge"===rn.browser&&rn.version;const sn=()=>(Ve.loadWasm(),ve("dynamsoft_inited",async()=>{let{lt:e,l:t,ls:i,sp:n,rmk:r,cv:s}=((e,t=!1)=>{const i=on;if(i._pLoad.isEmpty){let n,r,s,a=i._license||"",o=JSON.parse(JSON.stringify(i._licenseServer)),l=i._sessionPassword,c=0;if(a.startsWith("t")||a.startsWith("f"))c=0;else if(0===a.length||a.startsWith("P")||a.startsWith("L")||a.startsWith("Y")||a.startsWith("A"))c=1;else{c=2;const t=a.indexOf(":");-1!=t&&(a=a.substring(t+1));const i=a.indexOf("?");if(-1!=i&&(r=a.substring(i+1),a=a.substring(0,i)),a.startsWith("DLC2"))c=0;else{if(a.startsWith("DLS2")){let t;try{let e=a.substring(4);e=atob(e),t=JSON.parse(e)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(a=t.handshakeCode?t.handshakeCode:t.organizationID?t.organizationID:"","number"==typeof a&&(a=JSON.stringify(a)),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),o=Qi(e)}!l&&t.sessionPassword&&(l=t.sessionPassword),n=t.remark}a&&"200001"!==a&&!a.startsWith("200001-")||(c=1)}}if(c&&(t||(Vi.crypto||(s="Please upgrade your browser to support online key."),Vi.crypto.subtle||(s="Require https to use online key in this browser."))),s)throw new Error(s);return 1===c&&(a="",console.warn("Applying for a public trial license ...")),{lt:c,l:a,ls:o,sp:l,rmk:n,cv:r}}throw new Error("Can't preprocess license again"+qi)})(),a=new Zi;on._pLoad.task=a,(async()=>{try{await on._pLoad}catch(e){}})();let o=Oe();Le[o]=t=>{if(t.message&&on._onAuthMessage){let e=on._onAuthMessage(t.message);null!=e&&(t.message=e)}let i,n=!1;if(1===e&&(n=!0),t.success?(Ne&&Ne("init license success"),t.message&&console.warn(t.message),Ve._bSupportIRTModule=t.bSupportIRTModule,Ve._bSupportDce4Module=t.bSupportDce4Module,on.bPassValidation=!0,[0,-10076].includes(t.initLicenseInfo.errorCode)?[-10076].includes(t.initLicenseInfo.errorCode)&&console.warn(t.initLicenseInfo.errorString):a.reject(new Error(t.initLicenseInfo.errorString))):(i=Error(t.message),t.stack&&(i.stack=t.stack),t.ltsErrorCode&&(i.ltsErrorCode=t.ltsErrorCode),n||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(n=!0)),n){const e=N(Ve.engineResourcePaths),i=("DCV"===Ve._bundleEnv?e.dcvData:e.dbrBundle)+"ui/";(async(e,t,i)=>{if(!e._bNeverShowDialog)try{let n=await fetch(e.engineResourcePath+"dls.license.dialog.html");if(!n.ok)throw Error("Get license dialog fail. Network Error: "+n.statusText);let r=await n.text();if(!r.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let s=document.createElement("div");s.insertAdjacentHTML("beforeend",r);let a=[];for(let e=0;e<s.childElementCount;++e){let t=s.children[e];t instanceof HTMLStyleElement&&(a.push(t),document.head.append(t))}let o=1==s.childElementCount?s.children[0]:s;o.remove();let l,c,d,h,u,g=[o],_=o.children;for(let e of _)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let e of g)if(!l&&e.classList.contains("dls-license-mask"))l=e,e.addEventListener("click",t=>{if(e==t.target){o.remove();for(let e of a)e.remove()}});else if(!c&&e.classList.contains("dls-license-icon-close"))c=e,e.addEventListener("click",()=>{o.remove();for(let e of a)e.remove()});else if(!d&&e.classList.contains("dls-license-icon-error"))d=e,"error"!=t&&e.remove();else if(!h&&e.classList.contains("dls-license-icon-warn"))h=e,"warn"!=t&&e.remove();else if(!u&&e.classList.contains("dls-license-msg-content")){u=e;let t=i;for(;t;){let i=t.indexOf("["),n=t.indexOf("]",i),r=t.indexOf("(",n),s=t.indexOf(")",r);if(-1==i||-1==n||-1==r||-1==s){e.appendChild(new Text(t));break}i>0&&e.appendChild(new Text(t.substring(0,i)));let a=document.createElement("a"),o=t.substring(i+1,n);a.innerText=o;let l=t.substring(r+1,s);a.setAttribute("href",l),a.setAttribute("target","_blank"),e.appendChild(a),t=t.substring(s+1)}}document.body.appendChild(o)}catch(t){e._onLog&&e._onLog(t.message||t)}})({_bNeverShowDialog:on._bNeverShowDialog,engineResourcePath:i,_onLog:Ne},t.success?"warn":"error",t.message)}t.success?a.resolve(void 0):a.reject(i)},await we("core");const l=await Ve.getModuleVersion();be.postMessage({type:"license_dynamsoft",body:{v:"DCV"===Ve._bundleEnv?l.CVR.replace(/\.\d+$/,""):l.DBR.replace(/\.\d+$/,""),brtk:!!e,bptk:1===e,l:t,os:rn,fn:on.deviceFriendlyName,ls:i,sp:n,rmk:r,cv:s,_e:on._e,mliRecord:null===localStorage||void 0===localStorage?void 0:localStorage.getItem("dynamsoft")},id:o}),on.bCallInitLicense=!0,await a}));let an;ke.license={},ke.license.dynamsoft=sn,ke.license.getAR=async()=>{{let e=Ce.dynamsoft_inited;e&&e.isRejected&&await e}return be?new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success){delete i.success;{let e=on.license;e&&(e.startsWith("t")||e.startsWith("f"))&&(i.pk=e)}if(Object.keys(i).length){if(i.lem){let e=Error(i.lem);e.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=e}e(i)}else e(null)}else{let e=Error(i.message);i.stack&&(e.stack=i.stack),t(e)}},be.postMessage({type:"license_getAR",id:i})}):null};let on=class e{static setLicenseServer(t){$i(e,t)}static get license(){return this._license}static set license(t){Ki(e,t)}static get licenseServer(){return this._licenseServer}static set licenseServer(t){$i(e,t)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(t){zi(e,t)}static initLicense(t,i){if(Ki(e,t),e.bCallInitLicense=!0,"boolean"==typeof i&&i||"object"==typeof i&&i.executeNow)return sn()}static setDeviceFriendlyName(t){zi(e,t)}static getDeviceFriendlyName(){return e._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await ve("dynamsoft_uuid",async()=>{await Ve.loadWasm();let e=new Zi,t=Oe();Le[t]=t=>{if(t.success)e.resolve(t.uuid);else{const i=Error(t.message);t.stack&&(i.stack=t.stack),e.reject(i)}},be.postMessage({type:"license_getDeviceUUID",id:t}),an=await e}),an))()}};on._pLoad=new Zi,on.bPassValidation=!1,on.bCallInitLicense=!1,on._license=Xi,on._licenseServer=[],on._deviceFriendlyName="",on._e=!0,Ve.engineResourcePaths.license={version:"4.4.10-dev-20260129110719",path:Hi,isInternal:!0},Fe.license={wasm:!0,js:!0},ke.license.LicenseManager=on;const ln="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,ln)<0&&(Ve.engineResourcePaths.std={version:ln,path:(e=>{if(null==e&&(e="./"),Gi||Wi);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Hi+`../../dynamsoft-capture-vision-std@${ln}/dist/`),isInternal:!0});let cn=class{static getVersion(){return`4.4.10-dev-20260129110719(Worker: ${Be.license&&Be.license.worker||"Not Loaded"}, Wasm: ${Be.license&&Be.license.wasm||"Not Loaded"})`}};const dn="undefined"==typeof self,hn="function"==typeof importScripts,un=(()=>{if(!hn){if(!dn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),gn=e=>{if(null==e&&(e="./"),dn||hn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ve.engineResourcePaths.dbr={version:"11.4.10-dev-20260129110729",path:un,isInternal:!0},Fe.dbr={js:!1,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE,Te.MN_DYNAMSOFT_IMAGE_PROCESSING]},ke.dbr={};const _n="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,_n)<0&&(Ve.engineResourcePaths.std={version:_n,path:gn(un+`../../dynamsoft-capture-vision-std@${_n}/dist/`),isInternal:!0});const pn="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,pn)<0)&&(Ve.engineResourcePaths.dip={version:pn,path:gn(un+`../../dynamsoft-image-processing@${pn}/dist/`),isInternal:!0});let fn=class{static getVersion(){const e=Be.dbr&&Be.dbr.wasm;return`11.4.10-dev-20260129110729(Worker: ${Be.dbr&&Be.dbr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}};const mn={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var En,In,yn,Rn;function Tn(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}!function(e){e[e.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",e[e.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",e[e.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"}(En||(En={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(In||(In={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_NEURAL_NETWORK=512]="LM_NEURAL_NETWORK",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=-1]="LM_END"}(yn||(yn={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=-1]="DM_END"}(Rn||(Rn={})),"function"==typeof SuppressedError&&SuppressedError;const Cn="undefined"==typeof self,wn=(()=>{if(!Cn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),vn=e=>{if(null==e&&(e="./"),Cn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};var Sn,An;Ve.engineResourcePaths.dlr={version:"4.4.10-dev-20260129110735",path:wn,isInternal:!0},Fe.dlr={js:!0,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE,Te.MN_DYNAMSOFT_IMAGE_PROCESSING]};const bn="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,bn)<0&&(Ve.engineResourcePaths.std={version:bn,path:vn(wn+`../../dynamsoft-capture-vision-std@${bn}/dist/`),isInternal:!0});const Dn="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,Dn)<0)&&(Ve.engineResourcePaths.dip={version:Dn,path:vn(wn+`../../dynamsoft-image-processing@${Dn}/dist/`),isInternal:!0});let On=class e{static getVersion(){const e=Be.dlr&&Be.dlr.wasm;return`4.4.10-dev-20260129110735(Worker: ${Be.dlr&&Be.dlr.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadConfusableCharsData(t,i){return Tn(e,Sn,"m",An).call(e,"confusable",t,i)}static async loadOverlappingCharsData(t,i){return Tn(e,Sn,"m",An).call(e,"overlapping",t,i)}};Sn=On,An=async function(e,t,i){return await Ve.loadWasm(),await new Promise((n,r)=>{let s=Oe();Le[s]=async e=>{if(e.success){const t=JSON.parse(e.result);if(0!==t.errorCode){let e=new Error(t.errorString);return e.errorCode=t.errorCode,r(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}},i&&!i.endsWith("/")&&(i+="/");const a=N(Ve.engineResourcePaths);be.postMessage({type:"dlr_loadData",id:s,body:{type:e,dataName:t,dataPath:i||a.dcvData+"char-resources/"}})})},ke.dlr={loadConfusableCharsData:On.loadConfusableCharsData,loadOverlappingCharsData:On.loadOverlappingCharsData};const Ln={filterVINResult:function(e){let t="";if(18===e.characterResults.length){let t=e.characterResults[9].location.points[0].x-e.characterResults[8].location.points[1].x;t<2&&(t=2);let i=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,n=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,r=2===t?3:t;i-t>=r&&n-t<r?e.characterResults.shift():n-t>=r&&i-t<r||e.characterResults[0].characterHConfidence>e.characterResults[17].characterHConfidence?e.characterResults.pop():e.characterResults.shift()}else if(19===e.characterResults.length){let t=e.characterResults[10].location.points[0].x-e.characterResults[9].location.points[1].x;t<2&&(t=2);let i,n,r,s=e.characterResults[1].location.points[0].x-e.characterResults[0].location.points[1].x,a=e.characterResults[18].location.points[0].x-e.characterResults[17].location.points[1].x,o=e.characterResults[2].location.points[0].x-e.characterResults[1].location.points[1].x,l=e.characterResults[17].location.points[0].x-e.characterResults[16].location.points[1].x,c=2===t?3:t;if("1"===e.characterResults[1].characterH||"1"===e.characterResults[2].characterH||"1"===e.characterResults[16].characterH||"1"===e.characterResults[17].characterH){for(let t=9;t<e.characterResults.length;t++)if("1"!==e.characterResults[t].characterH){r=e.characterResults[t].location.points[1].x-e.characterResults[t].location.points[0].x;break}"1"===e.characterResults[1].characterH&&(i=r-(e.characterResults[1].location.points[1].x-e.characterResults[1].location.points[0].x)+3),"1"===e.characterResults[2].characterH&&(i=r-(e.characterResults[2].location.points[1].x-e.characterResults[2].location.points[0].x)+3),"1"===e.characterResults[16].characterH&&(n=r-(e.characterResults[16].location.points[1].x-e.characterResults[16].location.points[0].x)+3),"1"===e.characterResults[17].characterH&&(n=r-(e.characterResults[17].location.points[1].x-e.characterResults[17].location.points[0].x)+3)}if(o-t>=(i||c)&&l-t<(n||c))e.characterResults.splice(0,2);else if(l-t>=(n||c)&&o-t<(i||c))e.characterResults.splice(17,2);else if(s>t&&a>t)e.characterResults.pop(),e.characterResults.shift();else{let t=e.characterResults[0].characterHConfidence+e.characterResults[1].characterHConfidence,i=e.characterResults[17].characterHConfidence+e.characterResults[18].characterHConfidence,n=e.characterResults[0].characterHConfidence+e.characterResults[18].characterHConfidence,r=Math.min(t,i,n);r===t?e.characterResults.splice(0,2):r===i?e.characterResults.splice(17,2):r===n&&(e.characterResults.pop(),e.characterResults.shift())}}for(let i of e.characterResults)t+=i.characterH;return t},checkValidVIN:function(e){return!(!e||17!=e.length)&&(e=>{const t=new Map([["A",1],["B",2],["C",3],["D",4],["E",5],["F",6],["G",7],["H",8],["J",1],["K",2],["L",3],["M",4],["N",5],["P",7],["R",9],["S",2],["T",3],["U",4],["V",5],["W",6],["X",7],["Y",8],["Z",9],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9]]),i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2];let n=0;for(let r=0;r<e.length;r++){let s=t.get(e[r]);s&&(n+=s*i[r])}return n%11})(e).toString()===e[8]},checkValidMRP:function(e){if(!e||44!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),r=[7,3,1];let s=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(s+=t*r[o%3]),o++}return s%10},i=e.slice(0,10)+e.slice(13,20)+e.slice(21,43),n=t(e,0,8).toString(),r=t(e,13,18).toString(),s=t(e,21,26).toString(),a=t(e,28,41).toString(),o=t(i,0,i.length).toString();return n===e[9]&&r===e[19]&&s===e[27]&&a===e[42]&&o===e[43]},checkValidMRV:function(e){if(!e||44!=e.length&&36!=e.length)return!1;const t=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),r=[7,3,1];let s=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(s+=t*r[o%3]),o++}return s%10},i=t(e,0,8).toString(),n=t(e,13,18).toString(),r=t(e,21,26).toString();return i===e[9]&&n===e[19]&&r===e[27]},checkValidIDCard:function(e,t){if(!e||30!=e.length&&36!=e.length)return!1;const i=(e,t,i)=>{const n=new Map([["<",0],["0",0],["1",1],["2",2],["3",3],["4",4],["5",5],["6",6],["7",7],["8",8],["9",9],["A",10],["B",11],["C",12],["D",13],["E",14],["F",15],["G",16],["H",17],["I",18],["J",19],["K",20],["L",21],["M",22],["N",23],["O",24],["P",25],["Q",26],["R",27],["S",28],["T",29],["U",30],["V",31],["W",32],["X",33],["Y",34],["Z",35]]),r=[7,3,1];let s=0;for(let a=t,o=0;a<=i;a++){let t=n.get(e[a]);t&&(s+=t*r[o%3]),o++}return s%10};if(30===e.length){if(t&&e===t)return i(e,5,13).toString()===e[14];if(t&&e!==t){const n=`${t.substring(5,30)}${e.substring(0,7)}${e.substring(8,15)}${e.substring(18,29)}`;return i(n,0,n.length-1).toString()===e[29]}}else if(36===e.length){const t=i(e,0,8).toString(),n=i(e,13,18).toString(),r=i(e,21,26).toString(),s=`${e.substring(0,10)}${e.substring(13,20)}${e.substring(21,28)}`,a=i(s,0,s.length-1).toString();return t===e[9]&&n===e[19]&&r===e[27]&&a===e[35]}}};var Nn,Mn,Pn;function xn(e){delete e.moduleId;const t=JSON.parse(e.jsonString).ResultInfo,i=e.fullCodeString;e.getFieldValue=e=>"fullcodestring"===e.toLowerCase()?i:Bn(t,e,"map"),e.getFieldRawValue=e=>"fullcodestring"===e.toLowerCase()?i:Bn(t,e,"raw"),e.getFieldMappingStatus=e=>kn(t,e),e.getFieldValidationStatus=e=>Fn(t,e),e.getAllFieldNames=()=>function(e){const t=[],i=e=>{const t=[];for(let n of e)for(let e of n)e.FieldName&&t.push(e.FieldName),e.ChildFields&&e.ChildFields.length>0&&t.push(...i(e.ChildFields));return t};for(let n of e)n.FieldName&&t.push(n.FieldName),n.ChildFields&&n.ChildFields.length>0&&t.push(...i(n.ChildFields));return t}(t),delete e.fullCodeString}function Bn(e,t,i){for(let n of e){if(n.FieldName===t)return"raw"===i&&n.RawValue?n.RawValue:n.Value;if(n.ChildFields&&n.ChildFields.length>0){let e;for(let r of n.ChildFields)e=Bn(r,t,i);if(void 0!==e)return e}}}function kn(e,t){for(let i of e){if(i.FieldName===t)return i.MappingStatus?Number(Mn[i.MappingStatus]):Mn.MS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=kn(n,t);if(void 0!==e)return e}}return Mn.MS_NONE}function Fn(e,t){for(let i of e){if(i.FieldName===t&&i.ValidationStatus)return i.ValidationStatus?Number(Pn[i.ValidationStatus]):Pn.VS_NONE;if(i.ChildFields&&i.ChildFields.length>0){let e;for(let n of i.ChildFields)e=Fn(n,t);if(void 0!==e)return e}}return Pn.VS_NONE}function Un(e){if(e.disposed)throw new Error('"CodeParser" instance has been disposed')}!function(e){e[e.RTLS_LOCALIZED=0]="RTLS_LOCALIZED",e[e.RTLS_RECOGNITION_FAILED=1]="RTLS_RECOGNITION_FAILED",e[e.RTLS_RECOGNITION_SUCCEEDED=2]="RTLS_RECOGNITION_SUCCEEDED"}(Nn||(Nn={})),Le[-1]=async e=>{On.onDataLoadProgressChanged&&On.onDataLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})},function(e){e[e.MS_NONE=0]="MS_NONE",e[e.MS_SUCCEEDED=1]="MS_SUCCEEDED",e[e.MS_FAILED=2]="MS_FAILED"}(Mn||(Mn={})),function(e){e[e.VS_NONE=0]="VS_NONE",e[e.VS_SUCCEEDED=1]="VS_SUCCEEDED",e[e.VS_FAILED=2]="VS_FAILED"}(Pn||(Pn={}));const Gn=e=>e&&"object"==typeof e&&"function"==typeof e.then,Vn=(async()=>{})().constructor;class Wn extends Vn{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,Gn(e)?t=e:"function"==typeof e&&(t=new Vn(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}constructor(e){let t,i;super((e,n)=>{t=e,i=n}),this._s="pending",this.resolve=e=>{this.isPending&&(Gn(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}}let Hn=class e{constructor(){this._instanceID=void 0,this.bDestroyed=!1}static async createInstance(){await ke.license.dynamsoft(),await Ve.loadWasm();const t=new e,i=new Wn;let n=Oe();return Le[n]=async e=>{if(e.success)t._instanceID=e.instanceID,i.resolve(t);else{const t=Error(e.message);e.stack&&(t.stack=e.stack),i.reject(t)}},be.postMessage({type:"dcp_createInstance",id:n}),i}async dispose(){Un(this);let e=Oe();this.bDestroyed=!0,Le[e]=e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}},be.postMessage({type:"dcp_dispose",id:e,instanceID:this._instanceID})}get disposed(){return this.bDestroyed}async initSettings(e){if(Un(this),e&&["string","object"].includes(typeof e))return"string"==typeof e?e.trimStart().startsWith("{")||(e=await D(e,"text")):"object"==typeof e&&(e=JSON.stringify(e)),await new Promise((t,i)=>{let n=Oe();Le[n]=async e=>{if(e.success){const n=JSON.parse(e.response);if(0!==n.errorCode){let e=new Error(n.errorString?n.errorString:"Init Settings Failed.");return e.errorCode=n.errorCode,i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}},be.postMessage({type:"dcp_initSettings",id:n,instanceID:this._instanceID,body:{settings:e}})});console.error("Invalid settings.")}async resetSettings(){return Un(this),await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"dcp_resetSettings",id:i,instanceID:this._instanceID})})}async parse(e,t=""){if(Un(this),!e||!(e instanceof Array||e instanceof Uint8Array||"string"==typeof e))throw new Error("`parse` must pass in an Array or Uint8Array or string");return await new Promise((i,n)=>{let r=Oe();e instanceof Array&&(e=Uint8Array.from(e)),"string"==typeof e&&(e=Uint8Array.from(function(e){let t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e))),Le[r]=async e=>{if(e.success){let t=JSON.parse(e.parseResponse);return t.errorCode?n(new Error(t.errorString)):(xn(t),i(t))}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},be.postMessage({type:"dcp_parse",id:r,instanceID:this._instanceID,body:{source:e,taskSettingName:t}})})}};const jn="undefined"==typeof self,Yn="function"==typeof importScripts,Zn=(()=>{if(!Yn){if(!jn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})();Ve.engineResourcePaths.dcp={version:"3.4.10-dev-20260129110745",path:Zn,isInternal:!0},Fe.dcp={js:!0,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE]},ke.dcp={handleParsedResultItem:xn};const qn="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,qn)<0&&(Ve.engineResourcePaths.std={version:qn,path:(e=>{if(null==e&&(e="./"),jn||Yn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(Zn+`../../dynamsoft-capture-vision-std@${qn}/dist/`),isInternal:!0}),Le[-4]=async e=>{Xn.onSpecLoadProgressChanged&&Xn.onSpecLoadProgressChanged(e.resourcesPath,e.tag,{loaded:e.loaded,total:e.total})};let Xn=class{static getVersion(){const e=Be.dcp&&Be.dcp.wasm;return`3.4.10-dev-20260129110745(Worker: ${Be.dcp&&Be.dcp.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}static async loadSpec(e,t){return await Ve.loadWasm(),await new Promise((i,n)=>{let r=Oe();Le[r]=async e=>{if(e.success)return i(e.result);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}},t&&!t.endsWith("/")&&(t+="/");let s=(e instanceof Array?e:[e]).map(e=>e.replace(/^MRTD.*$/,"MRTD"));s=s.map(e=>e.replace(/\.data$/i,""));let a=N(Ve.engineResourcePaths);be.postMessage({type:"dcp_appendResourceBuffer",id:r,body:{specificationPath:t||`${"DBR"===Ve._bundleEnv?a.dbrBundle:a.dcvData}parser-resources/`,specificationNames:s}})})}};const Kn="undefined"==typeof self,Qn="function"==typeof importScripts,$n=(()=>{if(!Qn){if(!Kn&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),zn=e=>{if(null==e&&(e="./"),Kn||Qn);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ve.engineResourcePaths.ddn={version:"3.4.10-dev-20260129110740",path:$n,isInternal:!0},Fe.ddn={js:!0,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE,Te.MN_DYNAMSOFT_IMAGE_PROCESSING]},ke.ddn={handleDeskewedAndEnhancedImageResultItem:function(e){let t=e,i=F(t.imageData);t.toCanvas=()=>P(i),t.toImage=e=>x(e,i),t.toBlob=e=>B(e,i)}};const Jn="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,Jn)<0&&(Ve.engineResourcePaths.std={version:Jn,path:zn($n+`../../dynamsoft-capture-vision-std@${Jn}/dist/`),isInternal:!0});const er="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,er)<0)&&(Ve.engineResourcePaths.dip={version:er,path:zn($n+`../../dynamsoft-image-processing@${er}/dist/`),isInternal:!0});let tr=class{static getVersion(){const e=Be.ddn&&Be.ddn.wasm;return`3.4.10-dev-20260129110740(Worker: ${Be.ddn&&Be.ddn.worker||"Not Loaded"}, Wasm: ${e||"Not Loaded"})`}};var ir;!function(e){e[e.ICM_COLOUR=0]="ICM_COLOUR",e[e.ICM_GRAYSCALE=1]="ICM_GRAYSCALE",e[e.ICM_BINARY=2]="ICM_BINARY"}(ir||(ir={}));const nr="undefined"==typeof self,rr="function"==typeof importScripts,sr=(()=>{if(!rr){if(!nr&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),ar=e=>{if(null==e&&(e="./"),nr||rr);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ve.engineResourcePaths.utility={version:"2.4.10-dev-20260129110724",path:sr,isInternal:!0},Fe.utility={js:!0,wasm:!0};const or="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,or)<0&&(Ve.engineResourcePaths.std={version:or,path:ar(sr+`../../dynamsoft-capture-vision-std@${or}/dist/`),isInternal:!0});const lr="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,lr)<0)&&(Ve.engineResourcePaths.dip={version:lr,path:ar(sr+`../../dynamsoft-image-processing@${lr}/dist/`),isInternal:!0});class cr{static getVersion(){return`2.4.10-dev-20260129110724(Worker: ${Be.utility&&Be.utility.worker||"Not Loaded"}, Wasm: ${Be.utility&&Be.utility.wasm||"Not Loaded"})`}}function dr(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)}"function"==typeof SuppressedError&&SuppressedError;const hr="undefined"==typeof self,ur="function"==typeof importScripts,gr=(()=>{if(!ur){if(!hr&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}})(),_r=e=>{if(null==e&&(e="./"),hr||ur);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e};Ve.engineResourcePaths.dbr={version:"11.0.30-dev-20250522174049",path:gr,isInternal:!0},Fe.dbr={js:!1,wasm:!0,deps:[Te.MN_DYNAMSOFT_LICENSE,Te.MN_DYNAMSOFT_IMAGE_PROCESSING]},ke.dbr={};const pr="2.0.0";"string"!=typeof Ve.engineResourcePaths.std&&L(Ve.engineResourcePaths.std.version,pr)<0&&(Ve.engineResourcePaths.std={version:pr,path:_r(gr+`../../dynamsoft-capture-vision-std@${pr}/dist/`),isInternal:!0});const fr="3.0.10";(!Ve.engineResourcePaths.dip||"string"!=typeof Ve.engineResourcePaths.dip&&L(Ve.engineResourcePaths.dip.version,fr)<0)&&(Ve.engineResourcePaths.dip={version:fr,path:_r(gr+`../../dynamsoft-image-processing@${fr}/dist/`),isInternal:!0});const mr={BF_NULL:BigInt(0),BF_ALL:BigInt("0xFFFFFFFEFFFFFFFF"),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552),BF_TELEPEN:BigInt(137438953472),BF_TELEPEN_NUMERIC:BigInt(274877906944)};var Er,Ir,yr,Rr,Tr;(Tr=Er||(Er={}))[Tr.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",Tr[Tr.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",Tr[Tr.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT",function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Ir||(Ir={})),function(e){e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=-2147483648]="LM_REV",e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_END=4294967295]="LM_END"}(yr||(yr={})),function(e){e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e[e.DM_NEURAL_NETWORK=512]="DM_NEURAL_NETWORK",e[e.DM_REV=-2147483648]="DM_REV",e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_END=4294967295]="DM_END"}(Rr||(Rr={}));const Cr=async(e,t)=>{let i,n=document.createElement("canvas"),r=n.getContext("2d"),s=e;try{if(s instanceof Blob){i=URL.createObjectURL(s);const e=await new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.src=i});n.width=e.width,n.height=e.height,r.drawImage(e,0,0),s=r.getImageData(0,0,n.width,n.height)}else n.width=s.width,n.height=s.height,r.putImageData(s,0,0);if("image/bmp"===t){const e=k(s);return new Blob([e],{type:"image/bmp"})}return await new Promise(e=>{n.toBlob(t=>{e(t)},t)})}finally{URL.revokeObjectURL(i)}};function wr(e,t){let i=!0;for(let a=0;a<e.length;a++){const o=(a+1)%e.length;if(n=e[a],s=t,((r=e[o]).x-n.x)*(s.y-n.y)-(r.y-n.y)*(s.x-n.x)<0){i=!1;break}}var n,r,s;return i}function vr(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function Sr(e,t){const[i,n]=e,r=i.x,s=i.y,a=n.x,o=n.y,l=t.x,c=t.y,d=(a-r)**2+(o-s)**2;if(0===d)return Math.sqrt((l-r)**2+(c-s)**2);const h=((l-r)*(a-r)+(c-s)*(o-s))/d;if(h<0)return Math.sqrt((l-r)**2+(c-s)**2);if(h>1)return Math.sqrt((l-a)**2+(c-o)**2);{const e=r+h*(a-r),t=s+h*(o-s);return Math.sqrt((l-e)**2+(c-t)**2)}}function Ar(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t.push([n,r])}return t}function br(e){const[t,i]=e;return{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}function Dr(e,t,i,n){const r=t.x-e.x,s=t.y-e.y,a=n.x-i.x,o=n.y-i.y,l=(-s*(e.x-i.x)+r*(e.y-i.y))/(-a*s+r*o),c=(a*(e.y-i.y)-o*(e.x-i.x))/(-a*s+r*o);return l>=0&&l<=1&&c>=0&&c<=1?{x:e.x+c*r,y:e.y+c*s}:null}function Or(e){let t=0;for(let i=0;i<e.length;i++){const n=(i+1)%e.length;t+=e[i].x*e[n].y,t-=e[n].x*e[i].y}return Math.abs(t/2)}function Lr(e,t,i){let n=t.x-e.x,r=t.y-e.y,s=i.x-e.x;return n*(i.y-e.y)-r*s>0}function Nr(e,t){for(let i=0;i<4;i++)if(!Lr(e.points[i],e.points[(i+1)%4],t))return!1;return!0}function Mr(e,t,i,n){const r=e.points,s=t.points;let a=8*i;a=Math.max(a,5);const o=Ar(r)[3],l=Ar(r)[1],c=Ar(s)[3],d=Ar(s)[1];let h,u=0;if(h=Math.max(Math.abs(Sr(o,t.points[0])),Math.abs(Sr(o,t.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(Sr(l,t.points[1])),Math.abs(Sr(l,t.points[2]))),h>u&&(u=h),h=Math.max(Math.abs(Sr(c,e.points[0])),Math.abs(Sr(c,e.points[3]))),h>u&&(u=h),h=Math.max(Math.abs(Sr(d,e.points[1])),Math.abs(Sr(d,e.points[2]))),h>u&&(u=h),u>a)return!1;const g=br(Ar(r)[0]),_=br(Ar(r)[2]),p=br(Ar(s)[0]),f=br(Ar(s)[2]),m=vr(g,f),E=vr(p,_),I=m>E,y=Math.min(m,E),R=vr(g,_),T=vr(p,f);let C=12*i;return C=Math.max(C,5),C=Math.min(C,R),C=Math.min(C,T),!!(y<C||wr(r,I?p:f)||wr(s,I?_:g))&&(I?(n.points[0]=e.points[0],n.points[1]=e.points[1],n.points[2]=t.points[2],n.points[3]=t.points[3]):(n.points[0]=t.points[0],n.points[1]=t.points[1],n.points[2]=e.points[2],n.points[3]=e.points[3]),n.area=Or(n.points),!0)}class Pr{constructor(e,t,i,n){this.overlapCount=e,this.verificationCount=t,this.crossVerificationFrame=5,this.location=n.location,this.locationArea=n.location.area,this.locationAngle=n.angle,this.format=n.format,this.text=n.text,this.isOneD=i,this.item=n,this.locationThreshold=5*n.moduleSize,this.strictLimit=Math.max(this.locationThreshold,1),this.strictLimit=Math.min(this.strictLimit,15)}getCenterPoint(e){const t={x:0,y:0};return e.forEach(({x:e,y:i})=>{t.x+=e,t.y+=i}),t.x/=e.length,t.y/=e.length,t}isProbablySameLocationWithOffset(e,t){const i=this.item.location,n=e.location;if(i.area<=0)return!1;if(Math.abs(i.area-n.area)>.4*i.area)return!1;let r=new Array(4).fill(0),s=new Array(4).fill(0),a=0,o=0;for(let e=0;e<4;++e)r[e]=Math.round(100*(n.points[e].x-i.points[e].x))/100,a+=r[e],s[e]=Math.round(100*(n.points[e].y-i.points[e].y))/100,o+=s[e];a/=4,o/=4;for(let e=0;e<4;++e){if(Math.abs(r[e]-a)>this.strictLimit||Math.abs(a)>.8)return!1;if(Math.abs(s[e]-o)>this.strictLimit||Math.abs(o)>.8)return!1}return t.x=a,t.y=o,!0}isLocationOverlap(e,t){if(this.locationArea>t){for(let t=0;t<4;t++)if(Nr(this.location,e.points[t]))return!0;const t=this.getCenterPoint(e.points);if(Nr(this.location,t))return!0}else{for(let t=0;t<4;t++)if(Nr(e,this.location.points[t]))return!0;if(Nr(e,this.getCenterPoint(this.location.points)))return!0}return!1}isMatchedLocationWithOffset(e,t={x:0,y:0}){if(this.isOneD){const i=Object.assign({},e.location);for(let e=0;e<4;e++)i.points[e].x-=t.x,i.points[e].y-=t.y;if(!this.isLocationOverlap(i,e.locationArea))return!1;const n=[this.location.points[0],this.location.points[3]],r=[this.location.points[1],this.location.points[2]];for(let e=0;e<4;e++){const t=i.points[e],s=0===e||3===e?n:r;if(Math.abs(Sr(s,t))>this.locationThreshold)return!1}}else for(let i=0;i<4;i++){const n=e.location.points[i],r=this.location.points[i];if(!(Math.abs(r.x+t.x-n.x)<this.locationThreshold))return!1;if(Math.abs(r.y+t.y-n.y)>=this.locationThreshold)return!1}return!0}isOverlappedLocationWithOffset(e,t,i=!0){const n=Object.assign({},e.location);for(let e=0;e<4;e++)n.points[e].x-=t.x,n.points[e].y-=t.y;if(!this.isLocationOverlap(n,e.location.area))return!1;if(i){const e=.75;return function(e,t){const i=[];for(let n=0;n<4;n++)for(let r=0;r<4;r++){const s=Dr(e[n],e[(n+1)%4],t[r],t[(r+1)%4]);s&&i.push(s)}return e.forEach(e=>{wr(t,e)&&i.push(e)}),t.forEach(t=>{wr(e,t)&&i.push(t)}),Or(function(e){if(e.length<=1)return e;e.sort((e,t)=>e.x-t.x||e.y-t.y);const t=e.shift();return e.sort((e,i)=>Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(i.y-t.y,i.x-t.x)),[t,...e]}(i))}([...this.location.points],n.points)>this.locationArea*e}return!0}}var xr,Br,kr,Fr,Ur,Gr;const Vr={barcode:2,text_line:4,detected_quad:8,deskewed_image:16,enhanced_image:64},Wr=e=>Object.values(Vr).includes(e)||Vr.hasOwnProperty(e),Hr=(e,t)=>"string"==typeof e?t[Vr[e]]:t[e],jr=(e,t,i)=>{"string"==typeof e?t[Vr[e]]=i:t[e]=i},Yr=(e,t,i)=>{const n=[{type:le.CRIT_BARCODE,resultName:"decodedBarcodesResult",itemNames:["barcodeResultItems"]},{type:le.CRIT_TEXT_LINE,resultName:"recognizedTextLinesResult",itemNames:["textLineResultItems"]}],r=t.items;if(e.isResultCrossVerificationEnabled(i)){for(let e=r.length-1;e>=0;e--)r[e].type!==i||r[e].verified||r.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const r=t[e.resultName][n];t[e.resultName][n]=r.filter(e=>e.type===i&&e.verified)})}if(e.isResultDeduplicationEnabled(i)){for(let e=r.length-1;e>=0;e--)r[e].type===i&&r[e].duplicate&&r.splice(e,1);const e=n.filter(e=>e.type===i)[0];t[e.resultName]&&e.itemNames.forEach(n=>{const r=t[e.resultName][n];t[e.resultName][n]=r.filter(e=>e.type===i&&!e.duplicate)})}};class Zr{constructor(){this.verificationEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!0,[le.CRIT_DETECTED_QUAD]:!0,[le.CRIT_DESKEWED_IMAGE]:!1},this.duplicateFilterEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1},this.duplicateForgetTime={[le.CRIT_BARCODE]:3e3,[le.CRIT_TEXT_LINE]:3e3,[le.CRIT_DETECTED_QUAD]:3e3,[le.CRIT_DESKEWED_IMAGE]:3e3},this.crossVerificationCriteria={[le.CRIT_BARCODE]:{frameWindow:5,minConsistentFrames:2},[le.CRIT_TEXT_LINE]:{frameWindow:5,minConsistentFrames:2},[le.CRIT_DETECTED_QUAD]:{frameWindow:6,minConsistentFrames:4},[le.CRIT_DESKEWED_IMAGE]:{frameWindow:6,minConsistentFrames:4}},xr.set(this,new Map),Br.set(this,new Map),kr.set(this,new Map),Fr.set(this,new Map),Ur.set(this,new Map),Gr.set(this,new Map),this.overlapSet=[],this.stabilityCount=0,this.crossVerificationFrames=5,this.latestOverlappingEnabled={[le.CRIT_BARCODE]:!1,[le.CRIT_TEXT_LINE]:!1,[le.CRIT_DETECTED_QUAD]:!1,[le.CRIT_DESKEWED_IMAGE]:!1},this.maxOverlappingFrames={[le.CRIT_BARCODE]:this.crossVerificationFrames,[le.CRIT_TEXT_LINE]:this.crossVerificationFrames,[le.CRIT_DETECTED_QUAD]:this.crossVerificationFrames,[le.CRIT_DESKEWED_IMAGE]:this.crossVerificationFrames},Object.defineProperties(this,{onOriginalImageResultReceived:{value:e=>{},writable:!1},onDecodedBarcodesReceived:{value:e=>{this.latestOverlappingFilter(e),Yr(this,e,le.CRIT_BARCODE)},writable:!1},onRecognizedTextLinesReceived:{value:e=>{Yr(this,e,le.CRIT_TEXT_LINE)},writable:!1},onProcessedDocumentResultReceived:{value:e=>{},writable:!1},onParsedResultsReceived:{value:e=>{},writable:!1}})}_dynamsoft(){dr(this,xr,"f").forEach((e,t)=>{jr(t,this.verificationEnabled,e)}),dr(this,Br,"f").forEach((e,t)=>{jr(t,this.duplicateFilterEnabled,e)}),dr(this,kr,"f").forEach((e,t)=>{jr(t,this.duplicateForgetTime,e)}),dr(this,Fr,"f").forEach((e,t)=>{jr(t,this.latestOverlappingEnabled,e)}),dr(this,Ur,"f").forEach((e,t)=>{jr(t,this.maxOverlappingFrames,e)}),dr(this,Gr,"f").forEach((e,t)=>{jr(t,this.crossVerificationCriteria,e)})}enableResultCrossVerification(e,t){Wr(e)&&dr(this,xr,"f").set(e,t)}isResultCrossVerificationEnabled(e){return!!Wr(e)&&Hr(e,this.verificationEnabled)}enableResultDeduplication(e,t){Wr(e)&&(t&&this.enableLatestOverlapping(e,!1),dr(this,Br,"f").set(e,t))}isResultDeduplicationEnabled(e){return!!Wr(e)&&Hr(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,t){Wr(e)&&(t>18e4&&(t=18e4),t<0&&(t=0),dr(this,kr,"f").set(e,t))}getDuplicateForgetTime(e){return Wr(e)?Hr(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0;const t=[le.CRIT_BARCODE,le.CRIT_TEXT_LINE,le.CRIT_DETECTED_QUAD,le.CRIT_DESKEWED_IMAGE,le.CRIT_ENHANCED_IMAGE];for(let i=0;i<t.length;i++)(this.verificationEnabled[t[i]]||this.duplicateFilterEnabled[t[i]])&&(e|=t[i]);return e}setResultCrossVerificationCriteria(e,t,i){t<i&&(t=i),dr(this,Gr,"f").set(e,{frameWindow:t,minConsistentFrames:i})}getResultCrossVerificationCriteria(e){return Hr(e,this.crossVerificationCriteria)}enableLatestOverlapping(e,t){Wr(e)&&(t&&this.enableResultDeduplication(e,!1),dr(this,Fr,"f").set(e,t))}isLatestOverlappingEnabled(e){return!!Wr(e)&&Hr(e,this.latestOverlappingEnabled)}setMaxOverlappingFrames(e,t){Wr(e)&&dr(this,Ur,"f").set(e,t)}getMaxOverlappingFrames(e){return Wr(e)?Hr(e,this.maxOverlappingFrames):-1}latestOverlappingFilter(e){var t,i,n;const r=this.isResultCrossVerificationEnabled(le.CRIT_BARCODE),s=this.isLatestOverlappingEnabled(le.CRIT_BARCODE);if(s){const a=this.crossVerificationFrames,o=60,l=s?this.getMaxOverlappingFrames(le.CRIT_BARCODE):this.crossVerificationFrames,c=e.items.length,d=null===(n=null===(i=null===(t=null==e?void 0:e.intermediateResult)||void 0===t?void 0:t[0])||void 0===i?void 0:i.intermediateResultUnits)||void 0===n?void 0:n[1].localizedBarcodes,h=d?d.length:0;let u=[];const g=[],_={x:0,y:0};let p=new Array(c).fill(-1),f=0;const m=e.items.map(e=>{if(1!==e.type){const t=(BigInt(e.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0);return new Pr(l,t?1:2,t,e)}}).filter(Boolean);if(this.overlapSet.length>0){const e=new Array(c).fill(new Array(this.overlapSet.length).fill(1));let t=0;for(;t<c;){const i={x:0,y:0},n=new Array(c).fill(-1);let r=!1;for(;t<c;t++){if(!m[t])continue;const s=m[t].item;for(let a=0;a<this.overlapSet.length;a++){if(e[t][a]<1)continue;const o=this.overlapSet[a],l=o.item;if(s.format===l.format&&s.text===l.text){if(r=o.isProbablySameLocationWithOffset(m[t],i),r){n[t]=a,e[t][a]=0;break}}else e[t][a]=0}if(r)break}if(r){for(let r=0;r<c;r++){if(r===t||!m[r])continue;const s=m[r].item;for(let t=0;t<this.overlapSet.length;t++){if(e[r][t]<1)continue;if(n.includes(t))continue;const a=this.overlapSet[t],o=a.item;if(s.format===o.format&&s.text===o.text){if(a.isMatchedLocationWithOffset(m[r],i)){n[r]=t,e[r][t]=0;break}}else e[r][t]=0}}const r=n.filter(e=>-1!==e).length;r>f&&(f=r,p=n,_.x=i.x,_.y=i.y)}}if(0===f){for(let t=0;t<c;t++){const i=m[t].item;for(let n=0;n<this.overlapSet.length;n++){if(e[t][n]<1)continue;if(p.includes(n))continue;const r=this.overlapSet[n],s=r.item;if(i.format===s.format&&i.text===s.text){if(r.isMatchedLocationWithOffset(m[t])){p[t]=n,e[t][n]=0;break}}else e[t][n]=0}}f+=p.filter(e=>-1!=e).length}let i=this.overlapSet.length<=3?f>=1:f>=2;if(!i&&s&&h>0){let e=0;for(let t=0;t<this.overlapSet.length;t++){const i=this.overlapSet[t];for(let t=0;t<h;t++)if(i.isOverlappedLocationWithOffset(d[t],_)){e++;break}}i=this.overlapSet.length<=3?e>=1:e>=3}i||(this.overlapSet=[])}if(0===this.overlapSet.length)this.stabilityCount=0,e.items.forEach((e,t)=>{if(1!==e.type){const i=Object.assign({},e),n=(BigInt(e.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(e.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0),s=e.confidence<o,a=new Pr(l,n?1:2,n,i);r&&n&&s&&g.push(t),this.overlapSet.push(a)}});else{let t=!0;s?(Math.abs(_.x)>5||Math.abs(_.y)>5)&&(t=!1):t=!1;for(let i=0;i<e.items.length;i++){const e=p[i];if(e<0&&m[i]){const e=m[i].item;let n={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let i=0;i<4;i++)n.points[i].x=t?e.location.points[i].x-_.x:e.location.points[i].x,n.points[i].y=t?e.location.points[i].y-_.y:e.location.points[i].y;for(let r=0;r<this.overlapSet.length;r++){if(p.includes(r))continue;const s=this.overlapSet[r].item.text,a=this.overlapSet[r].item.format;if(e.format===a&&e.text===s){if(this.overlapSet[r].isOverlappedLocationWithOffset(e,_,!1)){const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[r]=new Pr(l,s,n,t),p[i]=r;break}if(m[i].isOneD){let s={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};for(let e=0;e<4;e++)s.points[e].x=t?this.overlapSet[r].location.points[e].x:this.overlapSet[r].location.points[e].x+_.x,s.points[e].y=t?this.overlapSet[r].location.points[e].y:this.overlapSet[r].location.points[e].y+_.y;let a={points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],area:0};if(Mr(n,s,e.moduleSize,a)){e.location=a;const t=Object.assign({},e),n=(BigInt(t.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0),s=n?1:2;this.overlapSet[r]=new Pr(l,s,n,t),p[i]=r;break}}}}}else{if(t)m[i]&&(m[i].item.location=this.overlapSet[e].location);else{const t=Object.assign({},m[i].item),n=(BigInt(t.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(t.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0),r=n?1:2;this.overlapSet[e]=new Pr(l,r,n,t)}this.overlapSet[e]&&(this.overlapSet[e].overlapCount=l,this.overlapSet[e].verificationCount=2,this.overlapSet[e].crossVerificationFrame=a)}}t?this.stabilityCount<15&&this.stabilityCount++:this.stabilityCount=0;let i=!0;for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const n=this.overlapSet[e];n.overlapCount--,n.crossVerificationFrame--;const r=n.overlapCount+this.stabilityCount;if(s&&r>0){for(let e=0;e<c;e++)if(n.isOverlappedLocationWithOffset(m[e],_,!1)){i=!1;break}if(!i)break;const e=n.item;if(!t){for(let e=0;e<4;e++)n.location.points[e].x+=_.x,n.location.points[e].y+=_.y;e.location=n.location}2===n.verificationCount&&u.push(e)}}if(s&&!i){u=[];for(let e=0;e<this.overlapSet.length;e++){if(p.includes(e))continue;const t=this.overlapSet[e];t.overlapCount=0-this.stabilityCount,t.crossVerificationFrame=0,t.verificationCount=0}}for(let e=0;e<c;e++){if(-1!==p[e]||!m[e])continue;const i=m[e].item;if(t){for(let t=0;t<4;t++)m[e].location.points[t].x-=_.x,m[e].location.points[t].y-=_.y;i.location=m[e].location}let n=!1;for(let t of this.overlapSet)if(!(t.crossVerificationFrame<=0&&t.verificationCount<=0)&&(n=t.isLocationOverlap(m[e].location,m[e].locationArea),n))break;if(n){g.push(e);continue}const s=Object.assign({},i),a=(BigInt(i.format)&BigInt(mr.BF_ONED))!=BigInt(0)||(BigInt(i.format)&BigInt(mr.BF_GS1_DATABAR))!=BigInt(0),c=i.confidence<o,d=new Pr(l,a?1:2,a,s);r&&a&&c?g.push(e):d.verificationCount=2,this.overlapSet.push(d)}this.overlapSet=this.overlapSet.filter(e=>!(e.overlapCount+this.stabilityCount<=0&&e.crossVerificationFrame<=0))}g.sort((e,t)=>t-e).forEach((t,i)=>{e.items.splice(t,1)}),u.forEach(t=>{e.items.push(Object.assign(Object.assign({},t),{overlapped:!0}))})}}}var qr,Xr,Kr,Qr;xr=new WeakMap,Br=new WeakMap,kr=new WeakMap,Fr=new WeakMap,Ur=new WeakMap,Gr=new WeakMap;class $r{static async readFromFile(e){if("string"==typeof e){if(!O(e))return Promise.reject(new TypeError("The input string is not a valid URL."));{const t=await fetch(e);e=await t.blob()}}return await G(e)}static async saveToFile(e,t,i){if(!e||!t)return null;if("string"!=typeof t)throw new TypeError("FileName must be of type string.");const n=F(e);return M(n,t,i)}static async readFromMemory(e){if(!dr($r,qr,"f",Xr).has(e))throw new Error("Image data ID does not exist.");return dr($r,qr,"f",Xr).get(e)}static async saveToMemory(e,t){var i,n,r;const s=await Cr(e,t),a=await G(s),o=(function(e,t,i,n,r){if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");r?r.value=i:t.set(e,i)}(i=$r,qr,(r=dr(i,qr,"f",Kr),n=r++,r),0,Kr),n);return dr($r,qr,"f",Xr).set(o,a),o}static async readFromBase64String(e){const t=await(async e=>{let t,i="image/png";if(e.includes("base64,")){const n=e.split(","),r=n[0].match(/:(.*?);/);r&&(i=r[1]),t=atob(n[1])}else t=atob(e);const n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new Blob([r],{type:i})})(e);return await G(t)}static async saveToBase64String(e,t){e instanceof Blob&&(e=await G(e));let i=F(e);const n=await Cr(i,t);return await(async e=>await new Promise((t,i)=>{const n=new FileReader;n.onload=()=>{t(n.result)},n.onerror=e=>{i(e)},n.readAsDataURL(e)}))(n)}}qr=$r,Xr={value:new Map},Kr={value:0};class zr{static async drawOnImage(e,t,i,n=4294901760,r=1,s="test.png",a){if(!e)throw new Error("Invalid image.");if(!t)throw new Error("Invalid drawingItem.");if(!i)throw new Error("Invalid type.");let o;if(e instanceof Blob)o=await G(e);else if("string"==typeof e){let t=await D(e,"blob");o=await G(t)}else R(e)&&(o=e,"bigint"==typeof o.format&&(o.format=Number(o.format)));return await new Promise((e,l)=>{let c=Oe();Le[c]=async t=>{if(t.success)return a&&$r.saveToFile(t.image,s,a),e(t.image);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},be.postMessage({type:"utility_drawOnImage",id:c,body:{dsImage:o,drawingItem:Array.isArray(t)?t:[t],color:n,thickness:r,type:i}})})}}class Jr{static async cropImage(e,t){const{bytes:i,width:n,height:r,stride:s,format:a}=R(e)?e:await G(e);return await new Promise((e,o)=>{let l=Oe();Le[l]=async t=>{if(t.success)return e(t.cropImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},be.postMessage({type:"utility_cropImage",id:l,body:{type:"Rect",bytes:i,width:n,height:r,stride:s,format:a,roi:t}})})}static async adjustBrightness(e,t){const{bytes:i,width:n,height:r,stride:s,format:a}=R(e)?e:await G(e);return await new Promise((e,o)=>{let l=Oe();Le[l]=async t=>{if(t.success)return e(t.adjustBrightness);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},be.postMessage({type:"utility_adjustBrightness",id:l,body:{bytes:i,width:n,height:r,stride:s,format:a,brightness:t}})})}static async adjustContrast(e,t){const{bytes:i,width:n,height:r,stride:s,format:a}=R(e)?e:await G(e);return await new Promise((e,o)=>{let l=Oe();Le[l]=async t=>{if(t.success)return e(t.adjustContrast);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},be.postMessage({type:"utility_adjustContrast",id:l,body:{bytes:i,width:n,height:r,stride:s,format:a,contrast:t}})})}static async filterImage(e,t){if(![0,1,2].includes(t))throw new Error("Invalid filterType.");const{bytes:i,width:n,height:r,stride:s,format:a}=R(e)?e:await G(e);return await new Promise((e,o)=>{let l=Oe();Le[l]=async t=>{if(t.success)return e(t.filterImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,o(e)}},be.postMessage({type:"utility_filterImage",id:l,body:{bytes:i,width:n,height:r,stride:s,format:a,filterType:t}})})}static async convertToGray(e,t,i,n){const{bytes:r,width:s,height:a,stride:o,format:l}=R(e)?e:await G(e);return await new Promise((e,c)=>{let d=Oe();Le[d]=async t=>{if(t.success)return e(t.convertToGray);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},be.postMessage({type:"utility_convertToGray",id:d,body:{bytes:r,width:s,height:a,stride:o,format:l,R:t,G:i,B:n}})})}static async convertToBinaryGlobal(e,t=-1,i=!1){const{bytes:n,width:r,height:s,stride:a,format:o}=R(e)?e:await G(e);return await new Promise((e,l)=>{let c=Oe();Le[c]=async t=>{if(t.success)return e(t.convertToBinaryGlobal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,l(e)}},be.postMessage({type:"utility_convertToBinaryGlobal",id:c,body:{bytes:n,width:r,height:s,stride:a,format:o,threshold:t,invert:i}})})}static async convertToBinaryLocal(e,t=0,i=10,n=!1){const{bytes:r,width:s,height:a,stride:o,format:l}=R(e)?e:await G(e);return await new Promise((e,c)=>{let d=Oe();Le[d]=async t=>{if(t.success)return e(t.convertToBinaryLocal);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,c(e)}},be.postMessage({type:"utility_convertToBinaryLocal",id:d,body:{bytes:r,width:s,height:a,stride:o,format:l,blockSize:t,compensation:i,invert:n}})})}static async cropAndDeskewImage(e,t,i=0,n=0,r=0){const{bytes:s,width:a,height:o,stride:l,format:c}=R(e)?e:await G(e);return await new Promise((e,d)=>{let h=Oe();Le[h]=async t=>{if(t.success)return e(t.cropAndDeskewImage);{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,d(e)}},be.postMessage({type:"utility_cropAndDeskewImage",id:h,body:{bytes:s,width:a,height:o,stride:l,format:c,roi:t,dstWidth:i,dstHeight:n,padding:r}})})}}!function(e){e[e.FT_HIGH_PASS=0]="FT_HIGH_PASS",e[e.FT_SHARPEN=1]="FT_SHARPEN",e[e.FT_SMOOTH=2]="FT_SMOOTH"}(Qr||(Qr={}));class es{static async findPortraitZone(){return await Ve.loadWasm(),await ke.license.dynamsoft(),await new Promise((e,t)=>{let i=Oe();Le[i]=async i=>{if(i.success){const n=JSON.parse(i.quad);n.errorCode&&0!==n.errorCode&&t(new Error(n.errorString)),e(n)}else{let e=new Error(i.message);e.stack=i.stack+"\n"+e.stack,t(e)}},be.postMessage({type:"identityUtility_findPortraitZone",id:i})})}}class ts{static getVersion(){return`1.0.10-dev-20260129110800(Worker: ${Be.identityutility&&Be.identityutility.worker||"Not Loaded"}, Wasm: ${Be.identityutility&&Be.identityutility.wasm||"Not Loaded"})`}}Ve.engineResourcePaths.rootDirectory=(e=>{if(null==e&&(e="./"),We||He);else{let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(je+"../../"),Ve.engineResourcePaths.dcvBundle={version:"3.4.1000-dev-20260214095351",path:je,isInternal:!0},Ve.engineResourcePaths.dcvData={version:"1.2.0",path:je,isInternal:!0},lt.CoreModule=Ve,lt.handleEngineResourcePaths=N;export{fn as BarcodeReaderModule,st as Beep,tt as Camera,lt as CameraEnhancer,ct as CameraView,Bi as CaptureVisionRouter,ai as CaptureVisionRouterModule,ki as CapturedResultReceiver,Hn as CodeParser,Xn as CodeParserModule,Ve as CoreModule,tr as DocumentNormalizerModule,Ct as DrawingItem,Rt as DrawingLayer,yt as DrawingStyleManager,mn as EnumBarcodeFormat,s as EnumBufferOverflowProtectionMode,le as EnumCapturedResultItemType,a as EnumColourChannelUsageType,ce as EnumCornerType,fe as EnumCrossVerificationStatus,Rn as EnumDeblurMode,Ot as EnumDrawingItemMediaType,Lt as EnumDrawingItemState,Nt as EnumEnhancedFeatures,de as EnumErrorCode,En as EnumExtendedBarcodeResultType,Qr as EnumFilterType,he as EnumGrayscaleEnhancementMode,ue as EnumGrayscaleTransformationMode,Re as EnumImageCaptureDistanceMode,ir as EnumImageColourMode,ye as EnumImageFileFormat,o as EnumImagePixelFormat,oi as EnumImageSourceState,ge as EnumImageTagType,me as EnumIntermediateResultUnitType,yn as EnumLocalizationMode,Mn as EnumMappingStatus,Te as EnumModuleName,_e as EnumPDFReadingMode,Mt as EnumPixelFormat,Ui as EnumPresetTemplate,In as EnumQRCodeErrorCorrectionLevel,pe as EnumRasterDataSource,Nn as EnumRawTextLineStatus,Ee as EnumRegionObjectElementType,Ie as EnumSectionType,Pn as EnumValidationStatus,_t as Feedback,rt as FramePipeline,es as IdentityProcessor,ts as IdentityUtilityModule,zr as ImageDrawer,Wt as ImageEditorView,$r as ImageIO,Jr as ImageProcessor,ne as ImageSourceAdapter,Fi as IntermediateResultReceiver,Pt as KPainter,On as LabelRecognizerModule,on as LicenseManager,cn as LicenseModule,Zr as MultiFrameResultCrossFilter,vt as QuadDrawingItem,cr as UtilityModule,ut as _bufferToCanvas,Tt as _isPointInPolygon,M as _saveToFile,B as _toBlob,P as _toCanvas,x as _toImage,Pe as bDebug,at as beep,G as blobToDsImage,O as checkIsLink,L as compareVersion,F as createImageData,W as d,ve as doOrWaitAsyncDependency,V as e,k as encodeBMP,Oe as getNextTaskID,N as handleEngineResourcePaths,Se as imagePtrToUint8Array,Be as innerVersions,f as isArc,m as isContour,R as isDSImageData,T as isDSRect,I as isDsImageKeyValue,C as isImageTag,w as isLineSegment,p as isObject,y as isOriginalDsImageData,v as isPoint,S as isPolygon,A as isQuad,b as isRect,U as isSimdSupported,Ce as mapAsyncDependency,ke as mapPackageRegister,Le as mapTaskCallBack,Ne as onLog,H as productNameMap,D as requestResource,Ae as resolveDsImageData,xe as setBDebug,Me as setOnLog,qe as stringToHtml,Ln as utilsFuncs,ot as vibrate,we as waitAsyncDependency,be as worker,Fe as workerAutoResources};
